"use strict";(()=>{var aI=Object.defineProperty;var Se=(n,e)=>()=>(n&&(e=n(n=0)),e);var hn=(n,e)=>{for(var t in e)aI(n,t,{get:e[t],enumerable:!0})};var cm={};hn(cm,{mountOverlay:()=>cI});function cI(n,e){try{n.innerHTML=""}catch{}let t=n.attachShadow({mode:"open"}),r=document.createElement("style");r.textContent=`
    :host { all: initial; }
    .wrap {
      position: relative;
      min-width: 320px;
      max-width: 90vw;
      min-height: 160px;
      max-height: 80vh;
      background: #ffffff;
      color: #111;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      box-shadow: 0 12px 32px rgba(0,0,0,0.15);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      overflow: auto;
      padding: 12px;
    }
    .hdr { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; }
    .ttl { font-weight: 700; font-size: 14px; }
    button {
      border: 1px solid #e2e8f0;
      background: #f7fafc;
      border-radius: 8px;
      padding: 4px 10px;
      cursor: pointer;
      font-size: 12px;
    }
    button:hover { background: #eef2f7; }
    .body { font-size: 13px; line-height: 1.5; color: #374151; }
  `,t.appendChild(r);let i=document.createElement("div");i.className="wrap",i.innerHTML=`
    <div class="hdr">
      <div class="ttl">DesAInR Overlay</div>
      <button id="ovl-close" title="Close">Close</button>
    </div>
    <div class="body">Overlay is mounted. This is a minimal stub implementation.</div>
  `,t.appendChild(i);let s=t.getElementById("ovl-close");return s&&s.addEventListener("click",()=>{try{e&&e()}catch{}}),{detach:()=>{try{n.parentNode&&n.parentNode.removeChild(n)}catch{}}}}var um=Se(()=>{"use strict"});var lm,hm=Se(()=>{lm=()=>{}});function il(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}function fn(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function As(n){return(await fetch(n,{credentials:"include"})).ok}function ym(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let t={alg:"none",type:"JWT"},r=e||"demo-project",i=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},n);return[bs(JSON.stringify(t)),bs(JSON.stringify(o)),""].join(".")}function pI(){let n={prod:[],emulator:[]};for(let e of Object.keys(Ts))Ts[e]?n.emulator.push(e):n.prod.push(e);return n}function mI(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}function pa(n,e){if(typeof window>"u"||typeof document>"u"||!fn(window.location.host)||Ts[n]===e||Ts[n]||dm)return;Ts[n]=e;function t(g){return`__firebase__banner__${g}`}let r="__firebase__banner",s=pI().prod.length>0;function o(){let g=document.getElementById(r);g&&g.remove()}function c(g){g.style.display="flex",g.style.background="#7faaf0",g.style.position="fixed",g.style.bottom="5px",g.style.left="5px",g.style.padding=".5em",g.style.borderRadius="5px",g.style.alignItems="center"}function u(g,w){g.setAttribute("width","24"),g.setAttribute("id",w),g.setAttribute("height","24"),g.setAttribute("viewBox","0 0 24 24"),g.setAttribute("fill","none"),g.style.marginLeft="-6px"}function h(){let g=document.createElement("span");return g.style.cursor="pointer",g.style.marginLeft="16px",g.style.fontSize="24px",g.innerHTML=" &times;",g.onclick=()=>{dm=!0,o()},g}function f(g,w){g.setAttribute("id",w),g.innerText="Learn more",g.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",g.setAttribute("target","__blank"),g.style.paddingLeft="5px",g.style.textDecoration="underline"}function p(){let g=mI(r),w=t("text"),k=document.getElementById(w)||document.createElement("span"),D=t("learnmore"),C=document.getElementById(D)||document.createElement("a"),H=t("preprendIcon"),F=document.getElementById(H)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(g.created){let z=g.element;c(z),f(C,D);let ne=h();u(F,H),z.append(F,k,C,ne),document.body.appendChild(z)}s?(k.innerText="Preview backend disconnected.",F.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(F.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,k.innerText="Preview backend running in this workspace."),k.setAttribute("id",w)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",p):p()}function Fe(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function _m(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Fe())}function vm(){var n;let e=(n=fa())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function wm(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Im(){let n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function Em(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Tm(){let n=Fe();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function cl(){return!vm()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function ul(){return!vm()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function ma(){try{return typeof indexedDB=="object"}catch{return!1}}function bm(){return new Promise((n,e)=>{try{let t=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var s;e(((s=i.error)===null||s===void 0?void 0:s.message)||"")}}catch(t){e(t)}})}function yI(n,e){return n.replace(_I,(t,r)=>{let i=e[r];return i!=null?String(i):`<${r}?>`})}function Am(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function pt(n,e){if(n===e)return!0;let t=Object.keys(n),r=Object.keys(e);for(let i of t){if(!r.includes(i))return!1;let s=n[i],o=e[i];if(fm(s)&&fm(o)){if(!pt(s,o))return!1}else if(s!==o)return!1}for(let i of r)if(!t.includes(i))return!1;return!0}function fm(n){return n!==null&&typeof n=="object"}function ci(n){let e=[];for(let[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function ui(n){let e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){let[i,s]=r.split("=");e[decodeURIComponent(i)]=decodeURIComponent(s)}}),e}function li(n){let e=n.indexOf("?");if(!e)return"";let t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function Sm(n,e){let t=new rl(n,e);return t.subscribe.bind(t)}function vI(n,e){if(typeof n!="object"||n===null)return!1;for(let t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function tl(){}function Ie(n){return n&&n._delegate?n._delegate:n}var pm,uI,mm,nl,lI,bs,da,hI,dI,fI,fa,sl,gm,ol,al,ha,Ts,dm,gI,Et,dn,_I,rl,c1,mr=Se(()=>{hm();pm=function(n){let e=[],t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},uI=function(n){let e=[],t=0,r=0;for(;t<n.length;){let i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=n[t++];e[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){let s=n[t++],o=n[t++],c=n[t++],u=((i&7)<<18|(s&63)<<12|(o&63)<<6|c&63)-65536;e[r++]=String.fromCharCode(55296+(u>>10)),e[r++]=String.fromCharCode(56320+(u&1023))}else{let s=n[t++],o=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|o&63)}}return e.join("")},mm={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();let t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){let s=n[i],o=i+1<n.length,c=o?n[i+1]:0,u=i+2<n.length,h=u?n[i+2]:0,f=s>>2,p=(s&3)<<4|c>>4,g=(c&15)<<2|h>>6,w=h&63;u||(w=64,o||(g=64)),r.push(t[f],t[p],t[g],t[w])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(pm(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):uI(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();let t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){let s=t[n.charAt(i++)],c=i<n.length?t[n.charAt(i)]:0;++i;let h=i<n.length?t[n.charAt(i)]:64;++i;let p=i<n.length?t[n.charAt(i)]:64;if(++i,s==null||c==null||h==null||p==null)throw new nl;let g=s<<2|c>>4;if(r.push(g),h!==64){let w=c<<4&240|h>>2;if(r.push(w),p!==64){let k=h<<6&192|p;r.push(k)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},nl=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},lI=function(n){let e=pm(n);return mm.encodeByteArray(e,!0)},bs=function(n){return lI(n).replace(/\./g,"")},da=function(n){try{return mm.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};hI=()=>il().__FIREBASE_DEFAULTS__,dI=()=>{if(typeof process>"u"||typeof process.env>"u")return;let n=process.env.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},fI=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let e=n&&da(n[1]);return e&&JSON.parse(e)},fa=()=>{try{return lm()||hI()||dI()||fI()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},sl=n=>{var e,t;return(t=(e=fa())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},gm=n=>{let e=sl(n);if(!e)return;let t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);let r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},ol=()=>{var n;return(n=fa())===null||n===void 0?void 0:n.config},al=n=>{var e;return(e=fa())===null||e===void 0?void 0:e[`_${n}`]};ha=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}};Ts={};dm=!1;gI="FirebaseError",Et=class n extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=gI,Object.setPrototypeOf(this,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,dn.prototype.create)}},dn=class{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){let r=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],o=s?yI(s,r):"Error",c=`${this.serviceName}: ${o} (${i}).`;return new Et(i,c,r)}};_I=/\{\$([^}]+)}/g;rl=class{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let i;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");vI(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:r},i.next===void 0&&(i.next=tl),i.error===void 0&&(i.error=tl),i.complete===void 0&&(i.complete=tl);let s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}};c1=4*60*60*1e3;});function wI(n){return n===gr?void 0:n}function II(n){return n.instantiationMode==="EAGER"}var St,gr,ll,ga,Ss=Se(()=>{mr();St=class{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};gr="[DEFAULT]";ll=class{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let r=new ha;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{let i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let r=this.normalizeInstanceIdentifier(e?.identifier),i=(t=e?.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(s){if(i)return null;throw s}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(II(e))try{this.getOrInitializeService({instanceIdentifier:gr})}catch{}for(let[t,r]of this.instancesDeferred.entries()){let i=this.normalizeInstanceIdentifier(t);try{let s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(e=gr){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=gr){return this.instances.has(e)}getOptions(e=gr){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[s,o]of this.instancesDeferred.entries()){let c=this.normalizeInstanceIdentifier(s);r===c&&o.resolve(i)}return i}onInit(e,t){var r;let i=this.normalizeInstanceIdentifier(t),s=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;s.add(e),this.onInitCallbacks.set(i,s);let o=this.instances.get(i);return o&&e(o,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:wI(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=gr){return this.component?this.component.multipleInstances?e:gr:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};ga=class{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new ll(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}});var EI,le,TI,bI,AI,SI,xn,Rs=Se(()=>{EI=[];(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(le||(le={}));TI={debug:le.DEBUG,verbose:le.VERBOSE,info:le.INFO,warn:le.WARN,error:le.ERROR,silent:le.SILENT},bI=le.INFO,AI={[le.DEBUG]:"log",[le.VERBOSE]:"log",[le.INFO]:"info",[le.WARN]:"warn",[le.ERROR]:"error"},SI=(n,e,...t)=>{if(e<n.logLevel)return;let r=new Date().toISOString(),i=AI[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},xn=class{constructor(e){this.name=e,this._logLevel=bI,this._logHandler=SI,this._userLogHandler=null,EI.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in le))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?TI[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,le.DEBUG,...e),this._logHandler(this,le.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,le.VERBOSE,...e),this._logHandler(this,le.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,le.INFO,...e),this._logHandler(this,le.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,le.WARN,...e),this._logHandler(this,le.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,le.ERROR,...e),this._logHandler(this,le.ERROR,...e)}}});function PI(){return Rm||(Rm=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function CI(){return Pm||(Pm=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}function kI(n){let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("success",s),n.removeEventListener("error",o)},s=()=>{t(zt(n.result)),i()},o=()=>{r(n.error),i()};n.addEventListener("success",s),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&Cm.set(t,n)}).catch(()=>{}),pl.set(e,n),e}function xI(n){if(dl.has(n))return;let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",o),n.removeEventListener("abort",o)},s=()=>{t(),i()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",s),n.addEventListener("error",o),n.addEventListener("abort",o)});dl.set(n,e)}function xm(n){fl=n(fl)}function DI(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){let r=n.call(ya(this),e,...t);return km.set(r,e.sort?e.sort():[e]),zt(r)}:CI().includes(n)?function(...e){return n.apply(ya(this),e),zt(Cm.get(this))}:function(...e){return zt(n.apply(ya(this),e))}}function NI(n){return typeof n=="function"?DI(n):(n instanceof IDBTransaction&&xI(n),RI(n,PI())?new Proxy(n,fl):n)}function zt(n){if(n instanceof IDBRequest)return kI(n);if(hl.has(n))return hl.get(n);let e=NI(n);return e!==n&&(hl.set(n,e),pl.set(e,n)),e}var RI,Rm,Pm,Cm,dl,km,hl,pl,fl,ya,ml=Se(()=>{RI=(n,e)=>e.some(t=>n instanceof t);Cm=new WeakMap,dl=new WeakMap,km=new WeakMap,hl=new WeakMap,pl=new WeakMap;fl={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return dl.get(n);if(e==="objectStoreNames")return n.objectStoreNames||km.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return zt(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};ya=n=>pl.get(n)});function Nm(n,e,{blocked:t,upgrade:r,blocking:i,terminated:s}={}){let o=indexedDB.open(n,e),c=zt(o);return r&&o.addEventListener("upgradeneeded",u=>{r(zt(o.result),u.oldVersion,u.newVersion,zt(o.transaction),u)}),t&&o.addEventListener("blocked",u=>t(u.oldVersion,u.newVersion,u)),c.then(u=>{s&&u.addEventListener("close",()=>s()),i&&u.addEventListener("versionchange",h=>i(h.oldVersion,h.newVersion,h))}).catch(()=>{}),c}function Dm(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(gl.get(e))return gl.get(e);let t=e.replace(/FromIndex$/,""),r=e!==t,i=VI.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||OI.includes(t)))return;let s=async function(o,...c){let u=this.transaction(o,i?"readwrite":"readonly"),h=u.store;return r&&(h=h.index(c.shift())),(await Promise.all([h[t](...c),i&&u.done]))[0]};return gl.set(e,s),s}var OI,VI,gl,Om=Se(()=>{ml();ml();OI=["get","getKey","getAll","getAllKeys","count"],VI=["put","add","delete","clear"],gl=new Map;xm(n=>({...n,get:(e,t,r)=>Dm(e,t)||n.get(e,t,r),has:(e,t)=>!!Dm(e,t)||n.has(e,t)}))});function LI(n){let e=n.getComponent();return e?.type==="VERSION"}function Lm(n,e){try{n.container.addComponent(e)}catch(t){pn.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Nn(n){let e=n.name;if(wl.has(e))return pn.debug(`There were multiple attempts to register component ${e}.`),!1;wl.set(e,n);for(let t of Ps.values())Lm(t,n);for(let t of hE.values())Lm(t,n);return!0}function yr(n,e){let t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Bm(n,e,t=_a){yr(n,e).clearInstance(t)}function Rt(n){return n==null?!1:n.settings!==void 0}function bl(n,e={}){let t=n;typeof e!="object"&&(e={name:e});let r=Object.assign({name:_a,automaticDataCollectionEnabled:!0},e),i=r.name;if(typeof i!="string"||!i)throw Dn.create("bad-app-name",{appName:String(i)});if(t||(t=ol()),!t)throw Dn.create("no-options");let s=Ps.get(i);if(s){if(pt(t,s.options)&&pt(r,s.config))return s;throw Dn.create("duplicate-app",{appName:i})}let o=new ga(i);for(let u of wl.values())o.addComponent(u);let c=new Il(t,r,o);return Ps.set(i,c),c}function va(n=_a){let e=Ps.get(n);if(!e&&n===_a&&ol())return bl();if(!e)throw Dn.create("no-app",{appName:n});return e}function Al(){return Array.from(Ps.values())}function Nt(n,e,t){var r;let i=(r=lE[n])!==null&&r!==void 0?r:n;t&&(i+=`-${t}`);let s=i.match(/\s|\//),o=e.match(/\s|\//);if(s||o){let c=[`Unable to register library "${i}" with version "${e}":`];s&&c.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&c.push("and"),o&&c.push(`version name "${e}" contains illegal characters (whitespace or "/")`),pn.warn(c.join(" "));return}Nn(new St(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}function jm(){return yl||(yl=Nm(fE,pE,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Cs)}catch(t){console.warn(t)}}}}).catch(n=>{throw Dn.create("idb-open",{originalErrorMessage:n.message})})),yl}async function mE(n){try{let t=(await jm()).transaction(Cs),r=await t.objectStore(Cs).get(qm(n));return await t.done,r}catch(e){if(e instanceof Et)pn.warn(e.message);else{let t=Dn.create("idb-get",{originalErrorMessage:e?.message});pn.warn(t.message)}}}async function Mm(n,e){try{let r=(await jm()).transaction(Cs,"readwrite");await r.objectStore(Cs).put(e,qm(n)),await r.done}catch(t){if(t instanceof Et)pn.warn(t.message);else{let r=Dn.create("idb-set",{originalErrorMessage:t?.message});pn.warn(r.message)}}}function qm(n){return`${n.name}!${n.options.appId}`}function Fm(){return new Date().toISOString().substring(0,10)}function _E(n,e=gE){let t=[],r=n.slice();for(let i of n){let s=t.find(o=>o.agent===i.agent);if(s){if(s.dates.push(i.date),Um(t)>e){s.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),Um(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}function Um(n){return bs(JSON.stringify({version:2,heartbeats:n})).length}function vE(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}function wE(n){Nn(new St("platform-logger",e=>new _l(e),"PRIVATE")),Nn(new St("heartbeat",e=>new El(e),"PRIVATE")),Nt(vl,Vm,n),Nt(vl,Vm,"esm2017"),Nt("fire-js","")}var _l,vl,Vm,pn,MI,FI,UI,BI,jI,qI,zI,$I,HI,GI,WI,KI,QI,YI,JI,XI,ZI,eE,tE,nE,rE,iE,sE,oE,aE,cE,uE,_a,lE,Ps,hE,wl,dE,Dn,Il,On,fE,pE,Cs,yl,gE,yE,El,Tl,hi=Se(()=>{Ss();Rs();mr();mr();Om();_l=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(LI(t)){let r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}};vl="@firebase/app",Vm="0.13.2";pn=new xn("@firebase/app"),MI="@firebase/app-compat",FI="@firebase/analytics-compat",UI="@firebase/analytics",BI="@firebase/app-check-compat",jI="@firebase/app-check",qI="@firebase/auth",zI="@firebase/auth-compat",$I="@firebase/database",HI="@firebase/data-connect",GI="@firebase/database-compat",WI="@firebase/functions",KI="@firebase/functions-compat",QI="@firebase/installations",YI="@firebase/installations-compat",JI="@firebase/messaging",XI="@firebase/messaging-compat",ZI="@firebase/performance",eE="@firebase/performance-compat",tE="@firebase/remote-config",nE="@firebase/remote-config-compat",rE="@firebase/storage",iE="@firebase/storage-compat",sE="@firebase/firestore",oE="@firebase/ai",aE="@firebase/firestore-compat",cE="firebase",uE="11.10.0";_a="[DEFAULT]",lE={[vl]:"fire-core",[MI]:"fire-core-compat",[UI]:"fire-analytics",[FI]:"fire-analytics-compat",[jI]:"fire-app-check",[BI]:"fire-app-check-compat",[qI]:"fire-auth",[zI]:"fire-auth-compat",[$I]:"fire-rtdb",[HI]:"fire-data-connect",[GI]:"fire-rtdb-compat",[WI]:"fire-fn",[KI]:"fire-fn-compat",[QI]:"fire-iid",[YI]:"fire-iid-compat",[JI]:"fire-fcm",[XI]:"fire-fcm-compat",[ZI]:"fire-perf",[eE]:"fire-perf-compat",[tE]:"fire-rc",[nE]:"fire-rc-compat",[rE]:"fire-gcs",[iE]:"fire-gcs-compat",[sE]:"fire-fst",[aE]:"fire-fst-compat",[oE]:"fire-vertex","fire-js":"fire-js",[cE]:"fire-js-all"};Ps=new Map,hE=new Map,wl=new Map;dE={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Dn=new dn("app","Firebase",dE);Il=class{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new St("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Dn.create("app-deleted",{appName:this._name})}};On=uE;fE="firebase-heartbeat-database",pE=1,Cs="firebase-heartbeat-store",yl=null;gE=1024,yE=30,El=class{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new Tl(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{let i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=Fm();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(o=>o.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:i}),this._heartbeatsCache.heartbeats.length>yE){let o=vE(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){pn.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";let t=Fm(),{heartbeatsToSend:r,unsentEntries:i}=_E(this._heartbeatsCache.heartbeats),s=bs(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return pn.warn(t),""}}};Tl=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return ma()?bm().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){let t=await mE(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){let i=await this.read();return Mm(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){let i=await this.read();return Mm(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}};wE("")});var IE,EE,zm=Se(()=>{hi();hi();IE="firebase",EE="11.10.0";Nt(IE,EE,"app")});function wa(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t}var $m=Se(()=>{});function ug(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}function TE(n,...e){Ra.logLevel<=le.WARN&&Ra.warn(`Auth (${On}): ${n}`,...e)}function Ea(n,...e){Ra.logLevel<=le.ERROR&&Ra.error(`Auth (${On}): ${n}`,...e)}function Ot(n,...e){throw Yl(n,...e)}function Ht(n,...e){return Yl(n,...e)}function dg(n,e,t){let r=Object.assign(Object.assign({},lg()),{[e]:t});return new dn("auth","Firebase",r).create(e,{appName:n.name})}function _r(n){return dg(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Yl(n,...e){if(typeof n!="string"){let t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return hg.create(n,...e)}function X(n,e,...t){if(!n)throw Yl(e,...t)}function $t(n){let e="INTERNAL ASSERTION FAILED: "+n;throw Ea(e),new Error(e)}function gn(n,e){n||$t(e)}function xl(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function bE(){return Hm()==="http:"||Hm()==="https:"}function Hm(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}function AE(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(bE()||Im()||"connection"in navigator)?navigator.onLine:!0}function SE(){if(typeof navigator>"u")return null;let n=navigator;return n.languages&&n.languages[0]||n.language||null}function Jl(n,e){gn(n.emulator,"Emulator should always be set here");let{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}function Xe(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function rt(n,e,t,r,i={}){return fg(n,i,async()=>{let s={},o={};r&&(e==="GET"?o=r:s={body:JSON.stringify(r)});let c=ci(Object.assign({key:n.config.apiKey},o)).slice(1),u=await n._getAdditionalHeaders();u["Content-Type"]="application/json",n.languageCode&&(u["X-Firebase-Locale"]=n.languageCode);let h=Object.assign({method:e,headers:u},s);return wm()||(h.referrerPolicy="no-referrer"),n.emulatorConfig&&fn(n.emulatorConfig.host)&&(h.credentials="include"),Pa.fetch()(await pg(n,n.config.apiHost,t,c),h)})}async function fg(n,e,t){n._canInitEmulator=!1;let r=Object.assign(Object.assign({},RE),e);try{let i=new Dl(n),s=await Promise.race([t(),i.promise]);i.clearNetworkTimeout();let o=await s.json();if("needConfirmation"in o)throw xs(n,"account-exists-with-different-credential",o);if(s.ok&&!("errorMessage"in o))return o;{let c=s.ok?o.errorMessage:o.error.message,[u,h]=c.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw xs(n,"credential-already-in-use",o);if(u==="EMAIL_EXISTS")throw xs(n,"email-already-in-use",o);if(u==="USER_DISABLED")throw xs(n,"user-disabled",o);let f=r[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(h)throw dg(n,f,h);Ot(n,f)}}catch(i){if(i instanceof Et)throw i;Ot(n,"network-request-failed",{message:String(i)})}}async function br(n,e,t,r,i={}){let s=await rt(n,e,t,r,i);return"mfaPendingCredential"in s&&Ot(n,"multi-factor-auth-required",{_serverResponse:s}),s}async function pg(n,e,t,r){let i=`${e}${t}?${r}`,s=n,o=s.config.emulator?Jl(n.config,i):`${n.config.apiScheme}://${i}`;return PE.includes(t)&&(await s._persistenceManagerAvailable,s._getPersistenceType()==="COOKIE")?s._getPersistence()._getFinalTarget(o).toString():o}function kE(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}function xs(n,e,t){let r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);let i=Ht(n,e,r);return i.customData._tokenResponse=t,i}function Gm(n){return n!==void 0&&n.enterprise!==void 0}async function mg(n,e){return rt(n,"GET","/v2/recaptchaConfig",Xe(n,e))}async function xE(n,e){return rt(n,"POST","/v1/accounts:delete",e)}async function ka(n,e){return rt(n,"POST","/v1/accounts:lookup",e)}function Ds(n){if(n)try{let e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function gg(n,e=!1){let t=Ie(n),r=await t.getIdToken(e),i=Xl(r);X(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");let s=typeof i.firebase=="object"?i.firebase:void 0,o=s?.sign_in_provider;return{claims:i,token:r,authTime:Ds(Sl(i.auth_time)),issuedAtTime:Ds(Sl(i.iat)),expirationTime:Ds(Sl(i.exp)),signInProvider:o||null,signInSecondFactor:s?.sign_in_second_factor||null}}function Sl(n){return Number(n)*1e3}function Xl(n){let[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Ea("JWT malformed, contained fewer than 3 sections"),null;try{let i=da(t);return i?JSON.parse(i):(Ea("Failed to decode base64 JWT payload"),null)}catch(i){return Ea("Caught error parsing JWT payload as JSON",i?.toString()),null}}function Wm(n){let e=Xl(n);return X(e,"internal-error"),X(typeof e.exp<"u","internal-error"),X(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function Ls(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof Et&&DE(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function DE({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}async function xa(n){var e;let t=n.auth,r=await n.getIdToken(),i=await Ls(n,ka(t,{idToken:r}));X(i?.users.length,t,"internal-error");let s=i.users[0];n._notifyReloadListener(s);let o=!((e=s.providerUserInfo)===null||e===void 0)&&e.length?_g(s.providerUserInfo):[],c=NE(n.providerData,o),u=n.isAnonymous,h=!(n.email&&s.passwordHash)&&!c?.length,f=u?h:!1,p={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:c,metadata:new Ms(s.createdAt,s.lastLoginAt),isAnonymous:f};Object.assign(n,p)}async function yg(n){let e=Ie(n);await xa(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function NE(n,e){return[...n.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function _g(n){return n.map(e=>{var{providerId:t}=e,r=wa(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}async function OE(n,e){let t=await fg(n,{},async()=>{let r=ci({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:s}=n.config,o=await pg(n,i,"/v1/token",`key=${s}`),c=await n._getAdditionalHeaders();c["Content-Type"]="application/x-www-form-urlencoded";let u={method:"POST",headers:c,body:r};return n.emulatorConfig&&fn(n.emulatorConfig.host)&&(u.credentials="include"),Pa.fetch()(o,u)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function VE(n,e){return rt(n,"POST","/v2/accounts:revokeToken",Xe(n,e))}function Vn(n,e){X(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}function mn(n){gn(n instanceof Function,"Expected a class definition");let e=Km.get(n);return e?(gn(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,Km.set(n,e),e)}function Ta(n,e,t){return`firebase:${n}:${e}:${t}`}function Qm(n){let e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Eg(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(vg(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(bg(e))return"Blackberry";if(Ag(e))return"Webos";if(wg(e))return"Safari";if((e.includes("chrome/")||Ig(e))&&!e.includes("edge/"))return"Chrome";if(Tg(e))return"Android";{let t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function vg(n=Fe()){return/firefox\//i.test(n)}function wg(n=Fe()){let e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Ig(n=Fe()){return/crios\//i.test(n)}function Eg(n=Fe()){return/iemobile/i.test(n)}function Tg(n=Fe()){return/android/i.test(n)}function bg(n=Fe()){return/blackberry/i.test(n)}function Ag(n=Fe()){return/webos/i.test(n)}function Zl(n=Fe()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function LE(n=Fe()){var e;return Zl(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function ME(){return Tm()&&document.documentMode===10}function Sg(n=Fe()){return Zl(n)||Tg(n)||Ag(n)||bg(n)||/windows phone/i.test(n)||Eg(n)}function Rg(n,e=[]){let t;switch(n){case"Browser":t=Qm(Fe());break;case"Worker":t=`${Qm(Fe())}-${n}`;break;default:t=n}let r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${On}/${r}`}async function FE(n,e={}){return rt(n,"GET","/v2/passwordPolicy",Xe(n,e))}function pi(n){return Ie(n)}function BE(n){Xa=n}function Pg(n){return Xa.loadJS(n)}function jE(){return Xa.recaptchaEnterpriseScript}function qE(){return Xa.gapiScript}function Cg(n){return`__${n}${Math.floor(Math.random()*1e6)}`}async function ks(n,e,t,r=!1,i=!1){let s=new Va(n),o;if(i)o=Os;else try{o=await s.verify(t)}catch{o=await s.verify(t,!0)}let c=Object.assign({},e);if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in c){let u=c.phoneEnrollmentInfo.phoneNumber,h=c.phoneEnrollmentInfo.recaptchaToken;Object.assign(c,{phoneEnrollmentInfo:{phoneNumber:u,recaptchaToken:h,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in c){let u=c.phoneSignInInfo.recaptchaToken;Object.assign(c,{phoneSignInInfo:{recaptchaToken:u,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return c}return r?Object.assign(c,{captchaResp:o}):Object.assign(c,{captchaResponse:o}),Object.assign(c,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(c,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),c}async function Vs(n,e,t,r,i){var s,o;if(i==="EMAIL_PASSWORD_PROVIDER")if(!((s=n._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){let c=await ks(n,e,t,t==="getOobCode");return r(n,c)}else return r(n,e).catch(async c=>{if(c.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let u=await ks(n,e,t,t==="getOobCode");return r(n,u)}else return Promise.reject(c)});else if(i==="PHONE_PROVIDER")if(!((o=n._getRecaptchaConfig())===null||o===void 0)&&o.isProviderEnabled("PHONE_PROVIDER")){let c=await ks(n,e,t);return r(n,c).catch(async u=>{var h;if(((h=n._getRecaptchaConfig())===null||h===void 0?void 0:h.getProviderEnforcementState("PHONE_PROVIDER"))==="AUDIT"&&(u.code==="auth/missing-recaptcha-token"||u.code==="auth/invalid-app-credential")){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${t} flow.`);let f=await ks(n,e,t,!1,!0);return r(n,f)}return Promise.reject(u)})}else{let c=await ks(n,e,t,!1,!0);return r(n,c)}else return Promise.reject(i+" provider is not supported.")}async function $E(n){let e=pi(n),t=await mg(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new Ca(t);e.tenantId==null?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,r.isAnyProviderEnabled()&&new Va(e).verify()}function kg(n,e){let t=yr(n,"auth");if(t.isInitialized()){let i=t.getImmediate(),s=t.getOptions();if(pt(s,e??{}))return i;Ot(i,"already-initialized")}return t.initialize({options:e})}function HE(n,e){let t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(mn);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}function xg(n,e,t){let r=pi(n);X(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");let i=!!t?.disableWarnings,s=Dg(e),{host:o,port:c}=GE(e),u=c===null?"":`:${c}`,h={url:`${s}//${o}${u}/`},f=Object.freeze({host:o,port:c,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator){X(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),X(pt(h,r.config.emulator)&&pt(f,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=h,r.emulatorConfig=f,r.settings.appVerificationDisabledForTesting=!0,fn(o)?(As(`${s}//${o}${u}`),pa("Auth",!0)):i||WE()}function Dg(n){let e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function GE(n){let e=Dg(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};let r=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){let s=i[1];return{host:s,port:Ym(r.substr(s.length+1))}}else{let[s,o]=r.split(":");return{host:s,port:Ym(o)}}}function Ym(n){if(!n)return null;let e=Number(n);return isNaN(e)?null:e}function WE(){function n(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}async function KE(n,e){return rt(n,"POST","/v1/accounts:signUp",e)}async function QE(n,e){return br(n,"POST","/v1/accounts:signInWithPassword",Xe(n,e))}async function YE(n,e){return br(n,"POST","/v1/accounts:signInWithEmailLink",Xe(n,e))}async function JE(n,e){return br(n,"POST","/v1/accounts:signInWithEmailLink",Xe(n,e))}async function di(n,e){return br(n,"POST","/v1/accounts:signInWithIdp",Xe(n,e))}async function Jm(n,e){return rt(n,"POST","/v1/accounts:sendVerificationCode",Xe(n,e))}async function ZE(n,e){return br(n,"POST","/v1/accounts:signInWithPhoneNumber",Xe(n,e))}async function eT(n,e){let t=await br(n,"POST","/v1/accounts:signInWithPhoneNumber",Xe(n,e));if(t.temporaryProof)throw xs(n,"account-exists-with-different-credential",t);return t}async function nT(n,e){let t=Object.assign(Object.assign({},e),{operation:"REAUTH"});return br(n,"POST","/v1/accounts:signInWithPhoneNumber",Xe(n,t),tT)}function rT(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function iT(n){let e=ui(li(n)).link,t=e?ui(li(e)).deep_link_id:null,r=ui(li(n)).deep_link_id;return(r?ui(li(r)).link:null)||r||t||e||n}function Xm(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}function Ng(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?Bl._fromErrorAndOperation(n,s,e,r):s})}async function sT(n,e,t=!1){let r=await Ls(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return $s._forOperation(n,"link",r)}async function oT(n,e,t=!1){let{auth:r}=n;if(Rt(r.app))return Promise.reject(_r(r));let i="reauthenticate";try{let s=await Ls(n,Ng(r,i,e,n),t);X(s.idToken,r,"internal-error");let o=Xl(s.idToken);X(o,r,"internal-error");let{sub:c}=o;return X(n.uid===c,r,"user-mismatch"),$s._forOperation(n,i,s)}catch(s){throw s?.code==="auth/user-not-found"&&Ot(r,"user-mismatch"),s}}async function aT(n,e,t=!1){if(Rt(n.app))return Promise.reject(_r(n));let r="signIn",i=await Ng(n,r,e),s=await $s._fromIdTokenResponse(n,r,i);return t||await n._updateCurrentUser(s.user),s}function Og(n,e,t,r){return Ie(n).onIdTokenChanged(e,t,r)}function Vg(n,e,t){return Ie(n).beforeAuthStateChanged(e,t)}function Zm(n,e){return rt(n,"POST","/v2/accounts/mfaEnrollment:start",Xe(n,e))}function cT(n,e){return rt(n,"POST","/v2/accounts/mfaEnrollment:finalize",Xe(n,e))}function uT(n,e){return rt(n,"POST","/v2/accounts/mfaEnrollment:start",Xe(n,e))}function lT(n,e){return rt(n,"POST","/v2/accounts/mfaEnrollment:finalize",Xe(n,e))}function Rl(n){var e,t;let r=n.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),i=RegExp(`${r}=([^;]+)`);return(t=(e=document.cookie.match(i))===null||e===void 0?void 0:e[1])!==null&&t!==void 0?t:null}function Pl(n){return`${window.location.protocol==="http:"?"__dev_":"__HOST-"}FIREBASE_${n.split(":")[3]}`}function pT(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}function th(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}function Gt(){return window}function mT(n){Gt().location.href=n}function Mg(){return typeof Gt().WorkerGlobalScope<"u"&&typeof Gt().importScripts=="function"}async function gT(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function yT(){var n;return((n=navigator?.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function _T(){return Mg()?self:null}function Za(n,e){return n.transaction([za],e?"readwrite":"readonly").objectStore(za)}function wT(){let n=indexedDB.deleteDatabase(Fg);return new Tr(n).toPromise()}function zl(){let n=indexedDB.open(Fg,vT);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{let r=n.result;try{r.createObjectStore(za,{keyPath:Ug})}catch(i){t(i)}}),n.addEventListener("success",async()=>{let r=n.result;r.objectStoreNames.contains(za)?e(r):(r.close(),await wT(),e(await zl()))})})}async function eg(n,e,t){let r=Za(n,!0).put({[Ug]:e,value:t});return new Tr(r).toPromise()}async function IT(n,e){let t=Za(n,!1).get(e),r=await new Tr(t).toPromise();return r===void 0?null:r.value}function tg(n,e){let t=Za(n,!0).delete(e);return new Tr(t).toPromise()}function ng(n,e){return rt(n,"POST","/v2/accounts/mfaSignIn:start",Xe(n,e))}function bT(n,e){return rt(n,"POST","/v2/accounts/mfaSignIn:finalize",Xe(n,e))}function AT(n,e){return rt(n,"POST","/v2/accounts/mfaSignIn:finalize",Xe(n,e))}async function ST(n,e,t){var r;if(!n._getRecaptchaConfig())try{await $E(n)}catch{console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let i;if(typeof e=="string"?i={phoneNumber:e}:i=e,"session"in i){let s=i.session;if("phoneNumber"in i){X(s.type==="enroll",n,"internal-error");let o={idToken:s.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"}};return(await Vs(n,o,"mfaSmsEnrollment",async(f,p)=>{if(p.phoneEnrollmentInfo.captchaResponse===Os){X(t?.type===ba,f,"argument-error");let g=await Cl(f,p,t);return Zm(f,g)}return Zm(f,p)},"PHONE_PROVIDER").catch(f=>Promise.reject(f))).phoneSessionInfo.sessionInfo}else{X(s.type==="signin",n,"internal-error");let o=((r=i.multiFactorHint)===null||r===void 0?void 0:r.uid)||i.multiFactorUid;X(o,n,"missing-multi-factor-info");let c={mfaPendingCredential:s.credential,mfaEnrollmentId:o,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}};return(await Vs(n,c,"mfaSmsSignIn",async(p,g)=>{if(g.phoneSignInInfo.captchaResponse===Os){X(t?.type===ba,p,"argument-error");let w=await Cl(p,g,t);return ng(p,w)}return ng(p,g)},"PHONE_PROVIDER").catch(p=>Promise.reject(p))).phoneResponseInfo.sessionInfo}}else{let s={phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"};return(await Vs(n,s,"sendVerificationCode",async(h,f)=>{if(f.captchaResponse===Os){X(t?.type===ba,h,"argument-error");let p=await Cl(h,f,t);return Jm(h,p)}return Jm(h,f)},"PHONE_PROVIDER").catch(h=>Promise.reject(h))).sessionInfo}}finally{t?._reset()}}async function Cl(n,e,t){X(t.type===ba,n,"argument-error");let r=await t.verify();X(typeof r=="string",n,"argument-error");let i=Object.assign({},e);if("phoneEnrollmentInfo"in i){let s=i.phoneEnrollmentInfo.phoneNumber,o=i.phoneEnrollmentInfo.captchaResponse,c=i.phoneEnrollmentInfo.clientType,u=i.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(i,{phoneEnrollmentInfo:{phoneNumber:s,recaptchaToken:r,captchaResponse:o,clientType:c,recaptchaVersion:u}}),i}else if("phoneSignInInfo"in i){let s=i.phoneSignInInfo.captchaResponse,o=i.phoneSignInInfo.clientType,c=i.phoneSignInInfo.recaptchaVersion;return Object.assign(i,{phoneSignInInfo:{recaptchaToken:r,captchaResponse:s,clientType:o,recaptchaVersion:c}}),i}else return Object.assign(i,{recaptchaToken:r}),i}function RT(n,e){return e?mn(e):(X(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}function PT(n){return aT(n.auth,new Gs(n),n.bypassAuthState)}function CT(n){let{auth:e,user:t}=n;return X(t,e,"internal-error"),oT(t,new Gs(n),n.bypassAuthState)}async function kT(n){let{auth:e,user:t}=n;return X(t,e,"internal-error"),sT(t,new Gs(n),n.bypassAuthState)}async function NT(n,e){let t=LT(e),r=VT(n);if(!await r._isAvailable())return!1;let i=await r._get(t)==="true";return await r._remove(t),i}function OT(n,e){Aa.set(n._key(),e)}function VT(n){return mn(n._redirectPersistence)}function LT(n){return Ta(DT,n.config.apiKey,n.name)}async function MT(n,e,t=!1){if(Rt(n.app))return Promise.reject(_r(n));let r=pi(n),i=RT(r,e),o=await new Hl(r,i,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}function rg(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function jg({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function UT(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return jg(n);default:return!1}}async function BT(n,e={}){return rt(n,"GET","/v1/projects",e)}async function zT(n){if(n.config.emulator)return;let{authorizedDomains:e}=await BT(n);for(let t of e)try{if($T(t))return}catch{}Ot(n,"unauthorized-domain")}function $T(n){let e=xl(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){let o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!qT.test(t))return!1;if(jT.test(n))return r===n;let i=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}function ig(){let n=Gt().___jsl;if(n?.H){for(let e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function GT(n){return new Promise((e,t)=>{var r,i,s;function o(){ig(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{ig(),t(Ht(n,"network-request-failed"))},timeout:HT.get()})}if(!((i=(r=Gt().gapi)===null||r===void 0?void 0:r.iframes)===null||i===void 0)&&i.Iframe)e(gapi.iframes.getContext());else if(!((s=Gt().gapi)===null||s===void 0)&&s.load)o();else{let c=Cg("iframefcb");return Gt()[c]=()=>{gapi.load?o():t(Ht(n,"network-request-failed"))},Pg(`${qE()}?onload=${c}`).catch(u=>t(u))}}).catch(e=>{throw Sa=null,e})}function WT(n){return Sa=Sa||GT(n),Sa}function ZT(n){let e=n.config;X(e.authDomain,n,"auth-domain-config-required");let t=e.emulator?Jl(e,YT):`https://${n.config.authDomain}/${QT}`,r={apiKey:e.apiKey,appName:n.name,v:On},i=XT.get(n.config.apiHost);i&&(r.eid=i);let s=n._getFrameworks();return s.length&&(r.fw=s.join(",")),`${t}?${ci(r).slice(1)}`}async function e0(n){let e=await WT(n),t=Gt().gapi;return X(t,n,"internal-error"),e.open({where:document.body,url:ZT(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:JT,dontclear:!0},r=>new Promise(async(i,s)=>{await r.restyle({setHideOnLeave:!1});let o=Ht(n,"network-request-failed"),c=Gt().setTimeout(()=>{s(o)},KT.get());function u(){Gt().clearTimeout(c),i(r)}r.ping(u).then(u,()=>{s(o)})}))}function o0(n,e,t,r=n0,i=r0){let s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString(),c="",u=Object.assign(Object.assign({},t0),{width:r.toString(),height:i.toString(),top:s,left:o}),h=Fe().toLowerCase();t&&(c=Ig(h)?i0:t),vg(h)&&(e=e||s0,u.scrollbars="yes");let f=Object.entries(u).reduce((g,[w,k])=>`${g}${w}=${k},`,"");if(LE(h)&&c!=="_self")return a0(e||"",c),new Ga(null);let p=window.open(e||"",c,f);X(p,n,"popup-blocked");try{p.focus()}catch{}return new Ga(p)}function a0(n,e){let t=document.createElement("a");t.href=n,t.target=e;let r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}async function sg(n,e,t,r,i,s){X(n.config.authDomain,n,"auth-domain-config-required"),X(n.config.apiKey,n,"invalid-api-key");let o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:On,eventId:i};if(e instanceof Ma){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",Am(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(let[f,p]of Object.entries(s||{}))o[f]=p}if(e instanceof Er){let f=e.getScopes().filter(p=>p!=="");f.length>0&&(o.scopes=f.join(","))}n.tenantId&&(o.tid=n.tenantId);let c=o;for(let f of Object.keys(c))c[f]===void 0&&delete c[f];let u=await n._getAppCheckToken(),h=u?`#${l0}=${encodeURIComponent(u)}`:"";return`${h0(n)}?${ci(c).slice(1)}${h}`}function h0({config:n}){return n.emulator?Jl(n,u0):`https://${n.authDomain}/${c0}`}function Ia(n){return typeof n>"u"||n?.length===0}function d0(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function f0(n){Nn(new St("auth",(e,{options:t})=>{let r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:o,authDomain:c}=r.options;X(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});let u={apiKey:o,authDomain:c,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Rg(n)},h=new Ml(r,i,s,u);return HE(h,t),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),Nn(new St("auth-internal",e=>{let t=pi(e.getProvider("auth").getImmediate());return(r=>new Ql(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Nt(og,ag,d0(n)),Nt(og,ag,"esm2017")}function nh(n=va()){let e=yr(n,"auth");if(e.isInitialized())return e.getImmediate();let t=kg(n,{popupRedirectResolver:qg,persistence:[Bg,Lg,eh]}),r=al("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){let s=new URL(r,location.origin);if(location.origin===s.origin){let o=g0(s.toString());Vg(t,o,()=>o(t.currentUser)),Og(t,c=>o(c))}}let i=sl("auth");return i&&xg(t,`http://${i}`),t}function y0(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}var lg,hg,Ra,vr,Pa,RE,PE,CE,Dl,Ca,Nl,Ms,Ns,Ln,Km,Da,Ol,Na,Vl,UE,Ll,Ml,Oa,Xa,Fl,Ul,zE,Os,Va,wr,Fs,XE,Ir,tT,Us,La,fi,Ma,Er,Bs,js,qs,zs,$s,Bl,Fa,Ua,hT,dT,Ba,Lg,fT,jl,ja,eh,qa,ql,Fg,vT,za,Ug,Tr,ET,TT,$a,Bg,L1,M1,ba,Hs,Gs,Ha,xT,$l,DT,Aa,Hl,FT,Gl,jT,qT,HT,Sa,KT,QT,YT,JT,XT,t0,n0,r0,i0,s0,Ga,c0,u0,l0,kl,Wl,qg,Wa,Kl,Ka,Qa,Ya,Ja,og,ag,Ql,p0,m0,cg,g0,zg=Se(()=>{hi();mr();Rs();$m();Ss();lg=ug,hg=new dn("auth","Firebase",ug());Ra=new xn("@firebase/auth");vr=class{constructor(e,t){this.shortDelay=e,this.longDelay=t,gn(t>e,"Short delay should be less than long delay!"),this.isMobile=_m()||Em()}get(){return AE()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}};Pa=class{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;$t("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;$t("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;$t("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}};RE={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};PE=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],CE=new vr(3e4,6e4);Dl=class{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(Ht(this.auth,"network-request-failed")),CE.get())})}};Ca=class{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return kE(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}};Nl=class{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){let r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;let i=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}};Ms=class{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ds(this.lastLoginAt),this.creationTime=Ds(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}};Ns=class n{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){X(e.idToken,"internal-error"),X(typeof e.idToken<"u","internal-error"),X(typeof e.refreshToken<"u","internal-error");let t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Wm(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){X(e.length!==0,"internal-error");let t=Wm(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(X(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){let{accessToken:r,refreshToken:i,expiresIn:s}=await OE(e,t);this.updateTokensAndExpiration(r,i,Number(s))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){let{refreshToken:r,accessToken:i,expirationTime:s}=t,o=new n;return r&&(X(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),i&&(X(typeof i=="string","internal-error",{appName:e}),o.accessToken=i),s&&(X(typeof s=="number","internal-error",{appName:e}),o.expirationTime=s),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new n,this.toJSON())}_performRefresh(){return $t("not implemented")}};Ln=class n{constructor(e){var{uid:t,auth:r,stsTokenManager:i}=e,s=wa(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Nl(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Ms(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){let t=await Ls(this,this.stsTokenManager.getToken(this.auth,e));return X(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return gg(this,e)}reload(){return yg(this)}_assign(e){this!==e&&(X(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new n(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){X(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await xa(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Rt(this.auth.app))return Promise.reject(_r(this.auth));let e=await this.getIdToken();return await Ls(this,xE(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,i,s,o,c,u,h,f;let p=(r=t.displayName)!==null&&r!==void 0?r:void 0,g=(i=t.email)!==null&&i!==void 0?i:void 0,w=(s=t.phoneNumber)!==null&&s!==void 0?s:void 0,k=(o=t.photoURL)!==null&&o!==void 0?o:void 0,D=(c=t.tenantId)!==null&&c!==void 0?c:void 0,C=(u=t._redirectEventId)!==null&&u!==void 0?u:void 0,H=(h=t.createdAt)!==null&&h!==void 0?h:void 0,F=(f=t.lastLoginAt)!==null&&f!==void 0?f:void 0,{uid:z,emailVerified:ne,isAnonymous:se,providerData:re,stsTokenManager:E}=t;X(z&&E,e,"internal-error");let _=Ns.fromJSON(this.name,E);X(typeof z=="string",e,"internal-error"),Vn(p,e.name),Vn(g,e.name),X(typeof ne=="boolean",e,"internal-error"),X(typeof se=="boolean",e,"internal-error"),Vn(w,e.name),Vn(k,e.name),Vn(D,e.name),Vn(C,e.name),Vn(H,e.name),Vn(F,e.name);let v=new n({uid:z,auth:e,email:g,emailVerified:ne,displayName:p,isAnonymous:se,photoURL:k,phoneNumber:w,tenantId:D,stsTokenManager:_,createdAt:H,lastLoginAt:F});return re&&Array.isArray(re)&&(v.providerData=re.map(I=>Object.assign({},I))),C&&(v._redirectEventId=C),v}static async _fromIdTokenResponse(e,t,r=!1){let i=new Ns;i.updateFromServerResponse(t);let s=new n({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:r});return await xa(s),s}static async _fromGetAccountInfoResponse(e,t,r){let i=t.users[0];X(i.localId!==void 0,"internal-error");let s=i.providerUserInfo!==void 0?_g(i.providerUserInfo):[],o=!(i.email&&i.passwordHash)&&!s?.length,c=new Ns;c.updateFromIdToken(r);let u=new n({uid:i.localId,auth:e,stsTokenManager:c,isAnonymous:o}),h={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:s,metadata:new Ms(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!s?.length};return Object.assign(u,h),u}};Km=new Map;Da=class{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){let t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}};Da.type="NONE";Ol=Da;Na=class n{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;let{config:i,name:s}=this.auth;this.fullUserKey=Ta(this.userKey,i.apiKey,s),this.fullPersistenceKey=Ta("persistence",i.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){let e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){let t=await ka(this.auth,{idToken:e}).catch(()=>{});return t?Ln._fromGetAccountInfoResponse(this.auth,t,e):null}return Ln._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;let t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new n(mn(Ol),e,r);let i=(await Promise.all(t.map(async h=>{if(await h._isAvailable())return h}))).filter(h=>h),s=i[0]||mn(Ol),o=Ta(r,e.config.apiKey,e.name),c=null;for(let h of t)try{let f=await h._get(o);if(f){let p;if(typeof f=="string"){let g=await ka(e,{idToken:f}).catch(()=>{});if(!g)break;p=await Ln._fromGetAccountInfoResponse(e,g,f)}else p=Ln._fromJSON(e,f);h!==s&&(c=p),s=h;break}}catch{}let u=i.filter(h=>h._shouldAllowMigration);return!s._shouldAllowMigration||!u.length?new n(s,e,r):(s=u[0],c&&await s._set(o,c.toJSON()),await Promise.all(t.map(async h=>{if(h!==s)try{await h._remove(o)}catch{}})),new n(s,e,r))}};Vl=class{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let r=s=>new Promise((o,c)=>{try{let u=e(s);o(u)}catch(u){c(u)}});r.onAbort=t,this.queue.push(r);let i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;let t=[];try{for(let r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(let i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}};UE=6,Ll=class{constructor(e){var t,r,i,s;let o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:UE,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(s=e.forceUpgradeOnSignin)!==null&&s!==void 0?s:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,i,s,o,c;let u={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,u),this.validatePasswordCharacterOptions(e,u),u.isValid&&(u.isValid=(t=u.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),u.isValid&&(u.isValid=(r=u.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),u.isValid&&(u.isValid=(i=u.containsLowercaseLetter)!==null&&i!==void 0?i:!0),u.isValid&&(u.isValid=(s=u.containsUppercaseLetter)!==null&&s!==void 0?s:!0),u.isValid&&(u.isValid=(o=u.containsNumericCharacter)!==null&&o!==void 0?o:!0),u.isValid&&(u.isValid=(c=u.containsNonAlphanumericCharacter)!==null&&c!==void 0?c:!0),u}validatePasswordLengthOptions(e,t){let r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,i,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}};Ml=class{constructor(e,t,r,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Oa(this),this.idTokenSubscription=new Oa(this),this.beforeStateQueue=new Vl(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=hg,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(s=>this._resolvePersistenceManagerAvailable=s)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=mn(t)),this._initializationPromise=this.queue(async()=>{var r,i,s;if(!this._deleted&&(this.persistenceManager=await Na.create(this,e),(r=this._resolvePersistenceManagerAvailable)===null||r===void 0||r.call(this),!this._deleted)){if(!((i=this._popupRedirectResolver)===null||i===void 0)&&i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;let e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{let t=await ka(this,{idToken:e}),r=await Ln._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(Rt(this.app)){let o=this.app.settings.authIdToken;return o?new Promise(c=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(c,c))}):this.directlySetCurrentUser(null)}let r=await this.assertedPersistence.getCurrentUser(),i=r,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();let o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,c=i?._redirectEventId,u=await this.tryRedirectSignIn(e);(!o||o===c)&&u?.user&&(i=u.user,s=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(i)}catch(o){i=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return X(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await xa(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=SE()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Rt(this.app))return Promise.reject(_r(this));let t=e?Ie(e):null;return t&&X(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&X(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Rt(this.app)?Promise.reject(_r(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Rt(this.app)?Promise.reject(_r(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(mn(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){let e=await FE(this),t=new Ll(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new dn("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){let t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await VE(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){let r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){let t=e&&mn(e)||this._popupRedirectResolver;X(t,this,"argument-error"),this.redirectPersistenceManager=await Na.create(this,[mn(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,i){if(this._deleted)return()=>{};let s=typeof t=="function"?t:t.next.bind(t),o=!1,c=this._isInitialized?Promise.resolve():this._initializationPromise;if(X(c,this,"internal-error"),c.then(()=>{o||s(this.currentUser)}),typeof t=="function"){let u=e.addObserver(t,r,i);return()=>{o=!0,u()}}else{let u=e.addObserver(t);return()=>{o=!0,u()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return X(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Rg(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;let t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);let r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);let i=await this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t}async _getAppCheckToken(){var e;if(Rt(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t?.error&&TE(`Error while retrieving App Check token: ${t.error}`),t?.token}};Oa=class{constructor(e){this.auth=e,this.observer=null,this.addObserver=Sm(t=>this.observer=t)}get next(){return X(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};Xa={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};Fl=class{constructor(){this.enterprise=new Ul}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}},Ul=class{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}},zE="recaptcha-enterprise",Os="NO_RECAPTCHA",Va=class{constructor(e){this.type=zE,this.auth=pi(e)}async verify(e="verify",t=!1){async function r(s){if(!t){if(s.tenantId==null&&s._agentRecaptchaConfig!=null)return s._agentRecaptchaConfig.siteKey;if(s.tenantId!=null&&s._tenantRecaptchaConfigs[s.tenantId]!==void 0)return s._tenantRecaptchaConfigs[s.tenantId].siteKey}return new Promise(async(o,c)=>{mg(s,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(u=>{if(u.recaptchaKey===void 0)c(new Error("recaptcha Enterprise site key undefined"));else{let h=new Ca(u);return s.tenantId==null?s._agentRecaptchaConfig=h:s._tenantRecaptchaConfigs[s.tenantId]=h,o(h.siteKey)}}).catch(u=>{c(u)})})}function i(s,o,c){let u=window.grecaptcha;Gm(u)?u.enterprise.ready(()=>{u.enterprise.execute(s,{action:e}).then(h=>{o(h)}).catch(()=>{o(Os)})}):c(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new Fl().execute("siteKey",{action:"verify"}):new Promise((s,o)=>{r(this.auth).then(c=>{if(!t&&Gm(window.grecaptcha))i(c,s,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let u=jE();u.length!==0&&(u+=c),Pg(u).then(()=>{i(c,s,o)}).catch(h=>{o(h)})}}).catch(c=>{o(c)})})}};wr=class{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return $t("not implemented")}_getIdTokenResponse(e){return $t("not implemented")}_linkToIdToken(e,t){return $t("not implemented")}_getReauthenticationResolver(e){return $t("not implemented")}};Fs=class n extends wr{constructor(e,t,r,i=null){super("password",r),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new n(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new n(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t=typeof e=="string"?JSON.parse(e):e;if(t?.email&&t?.password){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":let t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Vs(e,t,"signInWithPassword",QE,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return YE(e,{email:this._email,oobCode:this._password});default:Ot(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":let r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Vs(e,r,"signUpPassword",KE,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return JE(e,{idToken:t,email:this._email,oobCode:this._password});default:Ot(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}};XE="http://localhost",Ir=class n extends wr{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){let t=new n(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Ot("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){let t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i}=t,s=wa(t,["providerId","signInMethod"]);if(!r||!i)return null;let o=new n(r,i);return o.idToken=s.idToken||void 0,o.accessToken=s.accessToken||void 0,o.secret=s.secret,o.nonce=s.nonce,o.pendingToken=s.pendingToken||null,o}_getIdTokenResponse(e){let t=this.buildRequest();return di(e,t)}_linkToIdToken(e,t){let r=this.buildRequest();return r.idToken=t,di(e,r)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,di(e,t)}buildRequest(){let e={requestUri:XE,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{let t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=ci(t)}return e}};tT={USER_NOT_FOUND:"user-not-found"};Us=class n extends wr{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new n({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new n({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return ZE(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return eT(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return nT(e,this._makeVerificationRequest())}_makeVerificationRequest(){let{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:i}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:i}}toJSON(){let e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));let{verificationId:t,verificationCode:r,phoneNumber:i,temporaryProof:s}=e;return!r&&!t&&!i&&!s?null:new n({verificationId:t,verificationCode:r,phoneNumber:i,temporaryProof:s})}};La=class n{constructor(e){var t,r,i,s,o,c;let u=ui(li(e)),h=(t=u.apiKey)!==null&&t!==void 0?t:null,f=(r=u.oobCode)!==null&&r!==void 0?r:null,p=rT((i=u.mode)!==null&&i!==void 0?i:null);X(h&&f&&p,"argument-error"),this.apiKey=h,this.operation=p,this.code=f,this.continueUrl=(s=u.continueUrl)!==null&&s!==void 0?s:null,this.languageCode=(o=u.lang)!==null&&o!==void 0?o:null,this.tenantId=(c=u.tenantId)!==null&&c!==void 0?c:null}static parseLink(e){let t=iT(e);try{return new n(t)}catch{return null}}};fi=class n{constructor(){this.providerId=n.PROVIDER_ID}static credential(e,t){return Fs._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){let r=La.parseLink(t);return X(r,"argument-error"),Fs._fromEmailAndCode(e,r.code,r.tenantId)}};fi.PROVIDER_ID="password";fi.EMAIL_PASSWORD_SIGN_IN_METHOD="password";fi.EMAIL_LINK_SIGN_IN_METHOD="emailLink";Ma=class{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}};Er=class extends Ma{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}};Bs=class n extends Er{constructor(){super("facebook.com")}static credential(e){return Ir._fromParams({providerId:n.PROVIDER_ID,signInMethod:n.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return n.credentialFromTaggedObject(e)}static credentialFromError(e){return n.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return n.credential(e.oauthAccessToken)}catch{return null}}};Bs.FACEBOOK_SIGN_IN_METHOD="facebook.com";Bs.PROVIDER_ID="facebook.com";js=class n extends Er{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Ir._fromParams({providerId:n.PROVIDER_ID,signInMethod:n.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return n.credentialFromTaggedObject(e)}static credentialFromError(e){return n.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return n.credential(t,r)}catch{return null}}};js.GOOGLE_SIGN_IN_METHOD="google.com";js.PROVIDER_ID="google.com";qs=class n extends Er{constructor(){super("github.com")}static credential(e){return Ir._fromParams({providerId:n.PROVIDER_ID,signInMethod:n.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return n.credentialFromTaggedObject(e)}static credentialFromError(e){return n.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return n.credential(e.oauthAccessToken)}catch{return null}}};qs.GITHUB_SIGN_IN_METHOD="github.com";qs.PROVIDER_ID="github.com";zs=class n extends Er{constructor(){super("twitter.com")}static credential(e,t){return Ir._fromParams({providerId:n.PROVIDER_ID,signInMethod:n.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return n.credentialFromTaggedObject(e)}static credentialFromError(e){return n.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return n.credential(t,r)}catch{return null}}};zs.TWITTER_SIGN_IN_METHOD="twitter.com";zs.PROVIDER_ID="twitter.com";$s=class n{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,i=!1){let s=await Ln._fromIdTokenResponse(e,r,i),o=Xm(r);return new n({user:s,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);let i=Xm(r);return new n({user:e,providerId:i,_tokenResponse:r,operationType:t})}};Bl=class n extends Et{constructor(e,t,r,i){var s;super(t.code,t.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,n.prototype),this.customData={appName:e.name,tenantId:(s=e.tenantId)!==null&&s!==void 0?s:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,i){return new n(e,t,r,i)}};Fa="__sak";Ua=class{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Fa,"1"),this.storage.removeItem(Fa),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}};hT=1e3,dT=10,Ba=class extends Ua{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Sg(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(let t of Object.keys(this.listeners)){let r=this.storage.getItem(t),i=this.localCache[t];r!==i&&e(t,i,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,c,u)=>{this.notifyListeners(o,u)});return}let r=e.key;t?this.detachListener():this.stopPolling();let i=()=>{let o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},s=this.storage.getItem(r);ME()&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,dT):i()}notifyListeners(e,t){this.localCache[e]=t;let r=this.listeners[e];if(r)for(let i of Array.from(r))i(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},hT)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){let t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}};Ba.type="LOCAL";Lg=Ba;fT=1e3;jl=class{constructor(){this.type="COOKIE",this.listenerUnsubscribes=new Map}_getFinalTarget(e){if(typeof window===void 0)return e;let t=new URL(`${window.location.origin}/__cookies__`);return t.searchParams.set("finalTarget",e),t}async _isAvailable(){var e;return typeof isSecureContext=="boolean"&&!isSecureContext||typeof navigator>"u"||typeof document>"u"?!1:(e=navigator.cookieEnabled)!==null&&e!==void 0?e:!0}async _set(e,t){}async _get(e){if(!this._isAvailable())return null;let t=Pl(e);if(window.cookieStore){let r=await window.cookieStore.get(t);return r?.value}return Rl(t)}async _remove(e){if(!this._isAvailable()||!await this._get(e))return;let r=Pl(e);document.cookie=`${r}=;Max-Age=34560000;Partitioned;Secure;SameSite=Strict;Path=/;Priority=High`,await fetch("/__cookies__",{method:"DELETE"}).catch(()=>{})}_addListener(e,t){if(!this._isAvailable())return;let r=Pl(e);if(window.cookieStore){let c=h=>{let f=h.changed.find(g=>g.name===r);f&&t(f.value),h.deleted.find(g=>g.name===r)&&t(null)},u=()=>window.cookieStore.removeEventListener("change",c);return this.listenerUnsubscribes.set(t,u),window.cookieStore.addEventListener("change",c)}let i=Rl(r),s=setInterval(()=>{let c=Rl(r);c!==i&&(t(c),i=c)},fT),o=()=>clearInterval(s);this.listenerUnsubscribes.set(t,o)}_removeListener(e,t){let r=this.listenerUnsubscribes.get(t);r&&(r(),this.listenerUnsubscribes.delete(t))}};jl.type="COOKIE";ja=class extends Ua{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}};ja.type="SESSION";eh=ja;qa=class n{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){let t=this.receivers.find(i=>i.isListeningto(e));if(t)return t;let r=new n(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){let t=e,{eventId:r,eventType:i,data:s}=t.data,o=this.handlersMap[i];if(!o?.size)return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:i});let c=Array.from(o).map(async h=>h(t.origin,s)),u=await pT(c);t.ports[0].postMessage({status:"done",eventId:r,eventType:i,response:u})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}};qa.receivers=[];ql=class{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){let i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,o;return new Promise((c,u)=>{let h=th("",20);i.port1.start();let f=setTimeout(()=>{u(new Error("unsupported_event"))},r);o={messageChannel:i,onMessage(p){let g=p;if(g.data.eventId===h)switch(g.data.status){case"ack":clearTimeout(f),s=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),c(g.data.response);break;default:clearTimeout(f),clearTimeout(s),u(new Error("invalid_response"));break}}},this.handlers.add(o),i.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:h,data:t},[i.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}};Fg="firebaseLocalStorageDb",vT=1,za="firebaseLocalStorage",Ug="fbase_key",Tr=class{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}};ET=800,TT=3,$a=class{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await zl(),this.db)}async _withRetries(e){let t=0;for(;;)try{let r=await this._openDb();return await e(r)}catch(r){if(t++>TT)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Mg()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=qa._getInstance(_T()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await gT(),!this.activeServiceWorker)return;this.sender=new ql(this.activeServiceWorker);let r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((t=r[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||yT()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;let e=await zl();return await eg(e,Fa,"1"),await tg(e,Fa),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>eg(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){let t=await this._withRetries(r=>IT(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>tg(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){let e=await this._withRetries(i=>{let s=Za(i,!1).getAll();return new Tr(s).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];let t=[],r=new Set;if(e.length!==0)for(let{fbase_key:i,value:s}of e)r.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(s)&&(this.notifyListeners(i,s),t.push(i));for(let i of Object.keys(this.localCache))this.localCache[i]&&!r.has(i)&&(this.notifyListeners(i,null),t.push(i));return t}notifyListeners(e,t){this.localCache[e]=t;let r=this.listeners[e];if(r)for(let i of Array.from(r))i(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),ET)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}};$a.type="LOCAL";Bg=$a;L1=Cg("rcb"),M1=new vr(3e4,6e4);ba="recaptcha";Hs=class n{constructor(e){this.providerId=n.PROVIDER_ID,this.auth=pi(e)}verifyPhoneNumber(e,t){return ST(this.auth,e,Ie(t))}static credential(e,t){return Us._fromVerification(e,t)}static credentialFromResult(e){let t=e;return n.credentialFromTaggedObject(t)}static credentialFromError(e){return n.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{phoneNumber:t,temporaryProof:r}=e;return t&&r?Us._fromTokenResponse(t,r):null}};Hs.PROVIDER_ID="phone";Hs.PHONE_SIGN_IN_METHOD="phone";Gs=class extends wr{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return di(e,this._buildIdpRequest())}_linkToIdToken(e,t){return di(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return di(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}};Ha=class{constructor(e,t,r,i,s=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){let{urlResponse:t,sessionId:r,postBody:i,tenantId:s,error:o,type:c}=e;if(o){this.reject(o);return}let u={auth:this.auth,requestUri:t,sessionId:r,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(c)(u))}catch(h){this.reject(h)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return PT;case"linkViaPopup":case"linkViaRedirect":return kT;case"reauthViaPopup":case"reauthViaRedirect":return CT;default:Ot(this.auth,"internal-error")}}resolve(e){gn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){gn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}};xT=new vr(2e3,1e4),$l=class n extends Ha{constructor(e,t,r,i,s){super(e,t,i,s),this.provider=r,this.authWindow=null,this.pollId=null,n.currentPopupAction&&n.currentPopupAction.cancel(),n.currentPopupAction=this}async executeNotNull(){let e=await this.execute();return X(e,this.auth,"internal-error"),e}async onExecution(){gn(this.filter.length===1,"Popup operations only handle one event");let e=th();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Ht(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Ht(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,n.currentPopupAction=null}pollUserCancellation(){let e=()=>{var t,r;if(!((r=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Ht(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,xT.get())};e()}};$l.currentPopupAction=null;DT="pendingRedirect",Aa=new Map,Hl=class extends Ha{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=Aa.get(this.auth._key());if(!e){try{let r=await NT(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}Aa.set(this.auth._key(),e)}return this.bypassAuthState||Aa.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){let t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}};FT=10*60*1e3,Gl=class{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!UT(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!jg(e)){let i=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(Ht(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=FT&&this.cachedEventUids.clear(),this.cachedEventUids.has(rg(e))}saveEventToCache(e){this.cachedEventUids.add(rg(e)),this.lastProcessedEventTime=Date.now()}};jT=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,qT=/^https?/;HT=new vr(3e4,6e4);Sa=null;KT=new vr(5e3,15e3),QT="__/auth/iframe",YT="emulator/auth/iframe",JT={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},XT=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);t0={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},n0=500,r0=600,i0="_blank",s0="http://localhost",Ga=class{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}};c0="__/auth/handler",u0="emulator/auth/handler",l0=encodeURIComponent("fac");kl="webStorageSupport",Wl=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=eh,this._completeRedirectFn=MT,this._overrideRedirectResult=OT}async _openPopup(e,t,r,i){var s;gn((s=this.eventManagers[e._key()])===null||s===void 0?void 0:s.manager,"_initialize() not called before _openPopup()");let o=await sg(e,t,r,xl(),i);return o0(e,o,th())}async _openRedirect(e,t,r,i){await this._originValidation(e);let s=await sg(e,t,r,xl(),i);return mT(s),new Promise(()=>{})}_initialize(e){let t=e._key();if(this.eventManagers[t]){let{manager:i,promise:s}=this.eventManagers[t];return i?Promise.resolve(i):(gn(s,"If manager is not set, promise should be"),s)}let r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){let t=await e0(e),r=new Gl(e);return t.register("authEvent",i=>(X(i?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(kl,{type:kl},i=>{var s;let o=(s=i?.[0])===null||s===void 0?void 0:s[kl];o!==void 0&&t(!!o),Ot(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=zT(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Sg()||wg()||Zl()}},qg=Wl,Wa=class{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return $t("unexpected MultiFactorSessionType")}}},Kl=class n extends Wa{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new n(e)}_finalizeEnroll(e,t,r){return cT(e,{idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return bT(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}},Ka=class{constructor(){}static assertion(e){return Kl._fromCredential(e)}};Ka.FACTOR_ID="phone";Qa=class{static assertionForEnrollment(e,t){return Ya._fromSecret(e,t)}static assertionForSignIn(e,t){return Ya._fromEnrollmentId(e,t)}static async generateSecret(e){var t;let r=e;X(typeof((t=r.user)===null||t===void 0?void 0:t.auth)<"u","internal-error");let i=await uT(r.user.auth,{idToken:r.credential,totpEnrollmentInfo:{}});return Ja._fromStartTotpMfaEnrollmentResponse(i,r.user.auth)}};Qa.FACTOR_ID="totp";Ya=class n extends Wa{constructor(e,t,r){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=r}static _fromSecret(e,t){return new n(t,void 0,e)}static _fromEnrollmentId(e,t){return new n(t,e)}async _finalizeEnroll(e,t,r){return X(typeof this.secret<"u",e,"argument-error"),lT(e,{idToken:t,displayName:r,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(e,t){X(this.enrollmentId!==void 0&&this.otp!==void 0,e,"argument-error");let r={verificationCode:this.otp};return AT(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:r})}},Ja=class n{constructor(e,t,r,i,s,o,c){this.sessionInfo=o,this.auth=c,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=r,this.codeIntervalSeconds=i,this.enrollmentCompletionDeadline=s}static _fromStartTotpMfaEnrollmentResponse(e,t){return new n(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){var r;let i=!1;return(Ia(e)||Ia(t))&&(i=!0),i&&(Ia(e)&&(e=((r=this.auth.currentUser)===null||r===void 0?void 0:r.email)||"unknownuser"),Ia(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}};og="@firebase/auth",ag="1.10.8";Ql=class{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){X(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}};p0=5*60,m0=al("authIdTokenMaxAge")||p0,cg=null,g0=n=>async e=>{let t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>m0)return;let i=t?.token;cg!==i&&(cg=i,await fetch(n,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};BE({loadJS(n){return new Promise((e,t)=>{let r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=i=>{let s=Ht("internal-error");s.customData=i,t(s)},r.type="text/javascript",r.charset="UTF-8",y0().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});f0("Browser")});var $g=Se(()=>{zg();hi();mr();Rs();Ss()});var Hg=Se(()=>{$g()});var Gg,Wg,yn,rh,Kg=Se(()=>{Gg=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Wg={};(function(){var n;function e(E,_){function v(){}v.prototype=_.prototype,E.D=_.prototype,E.prototype=new v,E.prototype.constructor=E,E.C=function(I,T,S){for(var y=Array(arguments.length-2),dt=2;dt<arguments.length;dt++)y[dt-2]=arguments[dt];return _.prototype[T].apply(I,y)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(E,_,v){v||(v=0);var I=Array(16);if(typeof _=="string")for(var T=0;16>T;++T)I[T]=_.charCodeAt(v++)|_.charCodeAt(v++)<<8|_.charCodeAt(v++)<<16|_.charCodeAt(v++)<<24;else for(T=0;16>T;++T)I[T]=_[v++]|_[v++]<<8|_[v++]<<16|_[v++]<<24;_=E.g[0],v=E.g[1],T=E.g[2];var S=E.g[3],y=_+(S^v&(T^S))+I[0]+3614090360&4294967295;_=v+(y<<7&4294967295|y>>>25),y=S+(T^_&(v^T))+I[1]+3905402710&4294967295,S=_+(y<<12&4294967295|y>>>20),y=T+(v^S&(_^v))+I[2]+606105819&4294967295,T=S+(y<<17&4294967295|y>>>15),y=v+(_^T&(S^_))+I[3]+3250441966&4294967295,v=T+(y<<22&4294967295|y>>>10),y=_+(S^v&(T^S))+I[4]+4118548399&4294967295,_=v+(y<<7&4294967295|y>>>25),y=S+(T^_&(v^T))+I[5]+1200080426&4294967295,S=_+(y<<12&4294967295|y>>>20),y=T+(v^S&(_^v))+I[6]+2821735955&4294967295,T=S+(y<<17&4294967295|y>>>15),y=v+(_^T&(S^_))+I[7]+4249261313&4294967295,v=T+(y<<22&4294967295|y>>>10),y=_+(S^v&(T^S))+I[8]+1770035416&4294967295,_=v+(y<<7&4294967295|y>>>25),y=S+(T^_&(v^T))+I[9]+2336552879&4294967295,S=_+(y<<12&4294967295|y>>>20),y=T+(v^S&(_^v))+I[10]+4294925233&4294967295,T=S+(y<<17&4294967295|y>>>15),y=v+(_^T&(S^_))+I[11]+2304563134&4294967295,v=T+(y<<22&4294967295|y>>>10),y=_+(S^v&(T^S))+I[12]+1804603682&4294967295,_=v+(y<<7&4294967295|y>>>25),y=S+(T^_&(v^T))+I[13]+4254626195&4294967295,S=_+(y<<12&4294967295|y>>>20),y=T+(v^S&(_^v))+I[14]+2792965006&4294967295,T=S+(y<<17&4294967295|y>>>15),y=v+(_^T&(S^_))+I[15]+1236535329&4294967295,v=T+(y<<22&4294967295|y>>>10),y=_+(T^S&(v^T))+I[1]+4129170786&4294967295,_=v+(y<<5&4294967295|y>>>27),y=S+(v^T&(_^v))+I[6]+3225465664&4294967295,S=_+(y<<9&4294967295|y>>>23),y=T+(_^v&(S^_))+I[11]+643717713&4294967295,T=S+(y<<14&4294967295|y>>>18),y=v+(S^_&(T^S))+I[0]+3921069994&4294967295,v=T+(y<<20&4294967295|y>>>12),y=_+(T^S&(v^T))+I[5]+3593408605&4294967295,_=v+(y<<5&4294967295|y>>>27),y=S+(v^T&(_^v))+I[10]+38016083&4294967295,S=_+(y<<9&4294967295|y>>>23),y=T+(_^v&(S^_))+I[15]+3634488961&4294967295,T=S+(y<<14&4294967295|y>>>18),y=v+(S^_&(T^S))+I[4]+3889429448&4294967295,v=T+(y<<20&4294967295|y>>>12),y=_+(T^S&(v^T))+I[9]+568446438&4294967295,_=v+(y<<5&4294967295|y>>>27),y=S+(v^T&(_^v))+I[14]+3275163606&4294967295,S=_+(y<<9&4294967295|y>>>23),y=T+(_^v&(S^_))+I[3]+4107603335&4294967295,T=S+(y<<14&4294967295|y>>>18),y=v+(S^_&(T^S))+I[8]+1163531501&4294967295,v=T+(y<<20&4294967295|y>>>12),y=_+(T^S&(v^T))+I[13]+2850285829&4294967295,_=v+(y<<5&4294967295|y>>>27),y=S+(v^T&(_^v))+I[2]+4243563512&4294967295,S=_+(y<<9&4294967295|y>>>23),y=T+(_^v&(S^_))+I[7]+1735328473&4294967295,T=S+(y<<14&4294967295|y>>>18),y=v+(S^_&(T^S))+I[12]+2368359562&4294967295,v=T+(y<<20&4294967295|y>>>12),y=_+(v^T^S)+I[5]+4294588738&4294967295,_=v+(y<<4&4294967295|y>>>28),y=S+(_^v^T)+I[8]+2272392833&4294967295,S=_+(y<<11&4294967295|y>>>21),y=T+(S^_^v)+I[11]+1839030562&4294967295,T=S+(y<<16&4294967295|y>>>16),y=v+(T^S^_)+I[14]+4259657740&4294967295,v=T+(y<<23&4294967295|y>>>9),y=_+(v^T^S)+I[1]+2763975236&4294967295,_=v+(y<<4&4294967295|y>>>28),y=S+(_^v^T)+I[4]+1272893353&4294967295,S=_+(y<<11&4294967295|y>>>21),y=T+(S^_^v)+I[7]+4139469664&4294967295,T=S+(y<<16&4294967295|y>>>16),y=v+(T^S^_)+I[10]+3200236656&4294967295,v=T+(y<<23&4294967295|y>>>9),y=_+(v^T^S)+I[13]+681279174&4294967295,_=v+(y<<4&4294967295|y>>>28),y=S+(_^v^T)+I[0]+3936430074&4294967295,S=_+(y<<11&4294967295|y>>>21),y=T+(S^_^v)+I[3]+3572445317&4294967295,T=S+(y<<16&4294967295|y>>>16),y=v+(T^S^_)+I[6]+76029189&4294967295,v=T+(y<<23&4294967295|y>>>9),y=_+(v^T^S)+I[9]+3654602809&4294967295,_=v+(y<<4&4294967295|y>>>28),y=S+(_^v^T)+I[12]+3873151461&4294967295,S=_+(y<<11&4294967295|y>>>21),y=T+(S^_^v)+I[15]+530742520&4294967295,T=S+(y<<16&4294967295|y>>>16),y=v+(T^S^_)+I[2]+3299628645&4294967295,v=T+(y<<23&4294967295|y>>>9),y=_+(T^(v|~S))+I[0]+4096336452&4294967295,_=v+(y<<6&4294967295|y>>>26),y=S+(v^(_|~T))+I[7]+1126891415&4294967295,S=_+(y<<10&4294967295|y>>>22),y=T+(_^(S|~v))+I[14]+2878612391&4294967295,T=S+(y<<15&4294967295|y>>>17),y=v+(S^(T|~_))+I[5]+4237533241&4294967295,v=T+(y<<21&4294967295|y>>>11),y=_+(T^(v|~S))+I[12]+1700485571&4294967295,_=v+(y<<6&4294967295|y>>>26),y=S+(v^(_|~T))+I[3]+2399980690&4294967295,S=_+(y<<10&4294967295|y>>>22),y=T+(_^(S|~v))+I[10]+4293915773&4294967295,T=S+(y<<15&4294967295|y>>>17),y=v+(S^(T|~_))+I[1]+2240044497&4294967295,v=T+(y<<21&4294967295|y>>>11),y=_+(T^(v|~S))+I[8]+1873313359&4294967295,_=v+(y<<6&4294967295|y>>>26),y=S+(v^(_|~T))+I[15]+4264355552&4294967295,S=_+(y<<10&4294967295|y>>>22),y=T+(_^(S|~v))+I[6]+2734768916&4294967295,T=S+(y<<15&4294967295|y>>>17),y=v+(S^(T|~_))+I[13]+1309151649&4294967295,v=T+(y<<21&4294967295|y>>>11),y=_+(T^(v|~S))+I[4]+4149444226&4294967295,_=v+(y<<6&4294967295|y>>>26),y=S+(v^(_|~T))+I[11]+3174756917&4294967295,S=_+(y<<10&4294967295|y>>>22),y=T+(_^(S|~v))+I[2]+718787259&4294967295,T=S+(y<<15&4294967295|y>>>17),y=v+(S^(T|~_))+I[9]+3951481745&4294967295,E.g[0]=E.g[0]+_&4294967295,E.g[1]=E.g[1]+(T+(y<<21&4294967295|y>>>11))&4294967295,E.g[2]=E.g[2]+T&4294967295,E.g[3]=E.g[3]+S&4294967295}r.prototype.u=function(E,_){_===void 0&&(_=E.length);for(var v=_-this.blockSize,I=this.B,T=this.h,S=0;S<_;){if(T==0)for(;S<=v;)i(this,E,S),S+=this.blockSize;if(typeof E=="string"){for(;S<_;)if(I[T++]=E.charCodeAt(S++),T==this.blockSize){i(this,I),T=0;break}}else for(;S<_;)if(I[T++]=E[S++],T==this.blockSize){i(this,I),T=0;break}}this.h=T,this.o+=_},r.prototype.v=function(){var E=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);E[0]=128;for(var _=1;_<E.length-8;++_)E[_]=0;var v=8*this.o;for(_=E.length-8;_<E.length;++_)E[_]=v&255,v/=256;for(this.u(E),E=Array(16),_=v=0;4>_;++_)for(var I=0;32>I;I+=8)E[v++]=this.g[_]>>>I&255;return E};function s(E,_){var v=c;return Object.prototype.hasOwnProperty.call(v,E)?v[E]:v[E]=_(E)}function o(E,_){this.h=_;for(var v=[],I=!0,T=E.length-1;0<=T;T--){var S=E[T]|0;I&&S==_||(v[T]=S,I=!1)}this.g=v}var c={};function u(E){return-128<=E&&128>E?s(E,function(_){return new o([_|0],0>_?-1:0)}):new o([E|0],0>E?-1:0)}function h(E){if(isNaN(E)||!isFinite(E))return p;if(0>E)return C(h(-E));for(var _=[],v=1,I=0;E>=v;I++)_[I]=E/v|0,v*=4294967296;return new o(_,0)}function f(E,_){if(E.length==0)throw Error("number format error: empty string");if(_=_||10,2>_||36<_)throw Error("radix out of range: "+_);if(E.charAt(0)=="-")return C(f(E.substring(1),_));if(0<=E.indexOf("-"))throw Error('number format error: interior "-" character');for(var v=h(Math.pow(_,8)),I=p,T=0;T<E.length;T+=8){var S=Math.min(8,E.length-T),y=parseInt(E.substring(T,T+S),_);8>S?(S=h(Math.pow(_,S)),I=I.j(S).add(h(y))):(I=I.j(v),I=I.add(h(y)))}return I}var p=u(0),g=u(1),w=u(16777216);n=o.prototype,n.m=function(){if(D(this))return-C(this).m();for(var E=0,_=1,v=0;v<this.g.length;v++){var I=this.i(v);E+=(0<=I?I:4294967296+I)*_,_*=4294967296}return E},n.toString=function(E){if(E=E||10,2>E||36<E)throw Error("radix out of range: "+E);if(k(this))return"0";if(D(this))return"-"+C(this).toString(E);for(var _=h(Math.pow(E,6)),v=this,I="";;){var T=ne(v,_).g;v=H(v,T.j(_));var S=((0<v.g.length?v.g[0]:v.h)>>>0).toString(E);if(v=T,k(v))return S+I;for(;6>S.length;)S="0"+S;I=S+I}},n.i=function(E){return 0>E?0:E<this.g.length?this.g[E]:this.h};function k(E){if(E.h!=0)return!1;for(var _=0;_<E.g.length;_++)if(E.g[_]!=0)return!1;return!0}function D(E){return E.h==-1}n.l=function(E){return E=H(this,E),D(E)?-1:k(E)?0:1};function C(E){for(var _=E.g.length,v=[],I=0;I<_;I++)v[I]=~E.g[I];return new o(v,~E.h).add(g)}n.abs=function(){return D(this)?C(this):this},n.add=function(E){for(var _=Math.max(this.g.length,E.g.length),v=[],I=0,T=0;T<=_;T++){var S=I+(this.i(T)&65535)+(E.i(T)&65535),y=(S>>>16)+(this.i(T)>>>16)+(E.i(T)>>>16);I=y>>>16,S&=65535,y&=65535,v[T]=y<<16|S}return new o(v,v[v.length-1]&-2147483648?-1:0)};function H(E,_){return E.add(C(_))}n.j=function(E){if(k(this)||k(E))return p;if(D(this))return D(E)?C(this).j(C(E)):C(C(this).j(E));if(D(E))return C(this.j(C(E)));if(0>this.l(w)&&0>E.l(w))return h(this.m()*E.m());for(var _=this.g.length+E.g.length,v=[],I=0;I<2*_;I++)v[I]=0;for(I=0;I<this.g.length;I++)for(var T=0;T<E.g.length;T++){var S=this.i(I)>>>16,y=this.i(I)&65535,dt=E.i(T)>>>16,G=E.i(T)&65535;v[2*I+2*T]+=y*G,F(v,2*I+2*T),v[2*I+2*T+1]+=S*G,F(v,2*I+2*T+1),v[2*I+2*T+1]+=y*dt,F(v,2*I+2*T+1),v[2*I+2*T+2]+=S*dt,F(v,2*I+2*T+2)}for(I=0;I<_;I++)v[I]=v[2*I+1]<<16|v[2*I];for(I=_;I<2*_;I++)v[I]=0;return new o(v,0)};function F(E,_){for(;(E[_]&65535)!=E[_];)E[_+1]+=E[_]>>>16,E[_]&=65535,_++}function z(E,_){this.g=E,this.h=_}function ne(E,_){if(k(_))throw Error("division by zero");if(k(E))return new z(p,p);if(D(E))return _=ne(C(E),_),new z(C(_.g),C(_.h));if(D(_))return _=ne(E,C(_)),new z(C(_.g),_.h);if(30<E.g.length){if(D(E)||D(_))throw Error("slowDivide_ only works with positive integers.");for(var v=g,I=_;0>=I.l(E);)v=se(v),I=se(I);var T=re(v,1),S=re(I,1);for(I=re(I,2),v=re(v,2);!k(I);){var y=S.add(I);0>=y.l(E)&&(T=T.add(v),S=y),I=re(I,1),v=re(v,1)}return _=H(E,T.j(_)),new z(T,_)}for(T=p;0<=E.l(_);){for(v=Math.max(1,Math.floor(E.m()/_.m())),I=Math.ceil(Math.log(v)/Math.LN2),I=48>=I?1:Math.pow(2,I-48),S=h(v),y=S.j(_);D(y)||0<y.l(E);)v-=I,S=h(v),y=S.j(_);k(S)&&(S=g),T=T.add(S),E=H(E,y)}return new z(T,E)}n.A=function(E){return ne(this,E).h},n.and=function(E){for(var _=Math.max(this.g.length,E.g.length),v=[],I=0;I<_;I++)v[I]=this.i(I)&E.i(I);return new o(v,this.h&E.h)},n.or=function(E){for(var _=Math.max(this.g.length,E.g.length),v=[],I=0;I<_;I++)v[I]=this.i(I)|E.i(I);return new o(v,this.h|E.h)},n.xor=function(E){for(var _=Math.max(this.g.length,E.g.length),v=[],I=0;I<_;I++)v[I]=this.i(I)^E.i(I);return new o(v,this.h^E.h)};function se(E){for(var _=E.g.length+1,v=[],I=0;I<_;I++)v[I]=E.i(I)<<1|E.i(I-1)>>>31;return new o(v,E.h)}function re(E,_){var v=_>>5;_%=32;for(var I=E.g.length-v,T=[],S=0;S<I;S++)T[S]=0<_?E.i(S+v)>>>_|E.i(S+v+1)<<32-_:E.i(S+v);return new o(T,E.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,rh=Wg.Md5=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=h,o.fromString=f,yn=Wg.Integer=o}).apply(typeof Gg<"u"?Gg:typeof self<"u"?self:typeof window<"u"?window:{})});var ec,_n,ih,_0,mi,sh,Ws,tc,oh,ah,ch,Qg=Se(()=>{ec=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},_n={};(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(a,l,d){return a==Array.prototype||a==Object.prototype||(a[l]=d.value),a};function t(a){a=[typeof globalThis=="object"&&globalThis,a,typeof window=="object"&&window,typeof self=="object"&&self,typeof ec=="object"&&ec];for(var l=0;l<a.length;++l){var d=a[l];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}var r=t(this);function i(a,l){if(l)e:{var d=r;a=a.split(".");for(var m=0;m<a.length-1;m++){var b=a[m];if(!(b in d))break e;d=d[b]}a=a[a.length-1],m=d[a],l=l(m),l!=m&&l!=null&&e(d,a,{configurable:!0,writable:!0,value:l})}}function s(a,l){a instanceof String&&(a+="");var d=0,m=!1,b={next:function(){if(!m&&d<a.length){var x=d++;return{value:l(x,a[x]),done:!1}}return m=!0,{done:!0,value:void 0}}};return b[Symbol.iterator]=function(){return b},b}i("Array.prototype.values",function(a){return a||function(){return s(this,function(l,d){return d})}});var o=o||{},c=this||self;function u(a){var l=typeof a;return l=l!="object"?l:a?Array.isArray(a)?"array":l:"null",l=="array"||l=="object"&&typeof a.length=="number"}function h(a){var l=typeof a;return l=="object"&&a!=null||l=="function"}function f(a,l,d){return a.call.apply(a.bind,arguments)}function p(a,l,d){if(!a)throw Error();if(2<arguments.length){var m=Array.prototype.slice.call(arguments,2);return function(){var b=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(b,m),a.apply(l,b)}}return function(){return a.apply(l,arguments)}}function g(a,l,d){return g=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?f:p,g.apply(null,arguments)}function w(a,l){var d=Array.prototype.slice.call(arguments,1);return function(){var m=d.slice();return m.push.apply(m,arguments),a.apply(this,m)}}function k(a,l){function d(){}d.prototype=l.prototype,a.aa=l.prototype,a.prototype=new d,a.prototype.constructor=a,a.Qb=function(m,b,x){for(var j=Array(arguments.length-2),Te=2;Te<arguments.length;Te++)j[Te-2]=arguments[Te];return l.prototype[b].apply(m,j)}}function D(a){let l=a.length;if(0<l){let d=Array(l);for(let m=0;m<l;m++)d[m]=a[m];return d}return[]}function C(a,l){for(let d=1;d<arguments.length;d++){let m=arguments[d];if(u(m)){let b=a.length||0,x=m.length||0;a.length=b+x;for(let j=0;j<x;j++)a[b+j]=m[j]}else a.push(m)}}class H{constructor(l,d){this.i=l,this.j=d,this.h=0,this.g=null}get(){let l;return 0<this.h?(this.h--,l=this.g,this.g=l.next,l.next=null):l=this.i(),l}}function F(a){return/^[\s\xa0]*$/.test(a)}function z(){var a=c.navigator;return a&&(a=a.userAgent)?a:""}function ne(a){return ne[" "](a),a}ne[" "]=function(){};var se=z().indexOf("Gecko")!=-1&&!(z().toLowerCase().indexOf("webkit")!=-1&&z().indexOf("Edge")==-1)&&!(z().indexOf("Trident")!=-1||z().indexOf("MSIE")!=-1)&&z().indexOf("Edge")==-1;function re(a,l,d){for(let m in a)l.call(d,a[m],m,a)}function E(a,l){for(let d in a)l.call(void 0,a[d],d,a)}function _(a){let l={};for(let d in a)l[d]=a[d];return l}let v="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function I(a,l){let d,m;for(let b=1;b<arguments.length;b++){m=arguments[b];for(d in m)a[d]=m[d];for(let x=0;x<v.length;x++)d=v[x],Object.prototype.hasOwnProperty.call(m,d)&&(a[d]=m[d])}}function T(a){var l=1;a=a.split(":");let d=[];for(;0<l&&a.length;)d.push(a.shift()),l--;return a.length&&d.push(a.join(":")),d}function S(a){c.setTimeout(()=>{throw a},0)}function y(){var a=we;let l=null;return a.g&&(l=a.g,a.g=a.g.next,a.g||(a.h=null),l.next=null),l}class dt{constructor(){this.h=this.g=null}add(l,d){let m=G.get();m.set(l,d),this.h?this.h.next=m:this.g=m,this.h=m}}var G=new H(()=>new ue,a=>a.reset());class ue{constructor(){this.next=this.g=this.h=null}set(l,d){this.h=l,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let de,ce=!1,we=new dt,De=()=>{let a=c.Promise.resolve(void 0);de=()=>{a.then(jt)}};var jt=()=>{for(var a;a=y();){try{a.h.call(a.g)}catch(d){S(d)}var l=G;l.j(a),100>l.h&&(l.h++,a.next=l.g,l.g=a)}ce=!1};function Ne(){this.s=this.s,this.C=this.C}Ne.prototype.s=!1,Ne.prototype.ma=function(){this.s||(this.s=!0,this.N())},Ne.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function me(a,l){this.type=a,this.g=this.target=l,this.defaultPrevented=!1}me.prototype.h=function(){this.defaultPrevented=!0};var Rn=function(){if(!c.addEventListener||!Object.defineProperty)return!1;var a=!1,l=Object.defineProperty({},"passive",{get:function(){a=!0}});try{let d=()=>{};c.addEventListener("test",d,l),c.removeEventListener("test",d,l)}catch{}return a}();function ft(a,l){if(me.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a){var d=this.type=a.type,m=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;if(this.target=a.target||a.srcElement,this.g=l,l=a.relatedTarget){if(se){e:{try{ne(l.nodeName);var b=!0;break e}catch{}b=!1}b||(l=null)}}else d=="mouseover"?l=a.fromElement:d=="mouseout"&&(l=a.toElement);this.relatedTarget=l,m?(this.clientX=m.clientX!==void 0?m.clientX:m.pageX,this.clientY=m.clientY!==void 0?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0):(this.clientX=a.clientX!==void 0?a.clientX:a.pageX,this.clientY=a.clientY!==void 0?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType=typeof a.pointerType=="string"?a.pointerType:vt[a.pointerType]||"",this.state=a.state,this.i=a,a.defaultPrevented&&ft.aa.h.call(this)}}k(ft,me);var vt={2:"touch",3:"pen",4:"mouse"};ft.prototype.h=function(){ft.aa.h.call(this);var a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var Oe="closure_listenable_"+(1e6*Math.random()|0),an=0;function ei(a,l,d,m,b){this.listener=a,this.proxy=null,this.src=l,this.type=d,this.capture=!!m,this.ha=b,this.key=++an,this.da=this.fa=!1}function lt(a){a.da=!0,a.listener=null,a.proxy=null,a.src=null,a.ha=null}function ti(a){this.src=a,this.g={},this.h=0}ti.prototype.add=function(a,l,d,m,b){var x=a.toString();a=this.g[x],a||(a=this.g[x]=[],this.h++);var j=ni(a,l,m,b);return-1<j?(l=a[j],d||(l.fa=!1)):(l=new ei(l,this.src,x,!!m,b),l.fa=d,a.push(l)),l};function Ke(a,l){var d=l.type;if(d in a.g){var m=a.g[d],b=Array.prototype.indexOf.call(m,l,void 0),x;(x=0<=b)&&Array.prototype.splice.call(m,b,1),x&&(lt(l),a.g[d].length==0&&(delete a.g[d],a.h--))}}function ni(a,l,d,m){for(var b=0;b<a.length;++b){var x=a[b];if(!x.da&&x.listener==l&&x.capture==!!d&&x.ha==m)return b}return-1}var wt="closure_lm_"+(1e6*Math.random()|0),qt={};function lr(a,l,d,m,b){if(m&&m.once)return Qe(a,l,d,m,b);if(Array.isArray(l)){for(var x=0;x<l.length;x++)lr(a,l[x],d,m,b);return null}return d=Z(d),a&&a[Oe]?a.K(l,d,h(m)?!!m.capture:!!m,b):us(a,l,d,!1,m,b)}function us(a,l,d,m,b,x){if(!l)throw Error("Invalid event type");var j=h(b)?!!b.capture:!!b,Te=M(a);if(Te||(a[wt]=Te=new ti(a)),d=Te.add(l,d,m,j,x),d.proxy)return d;if(m=ri(),d.proxy=m,m.src=a,m.listener=d,a.addEventListener)Rn||(b=j),b===void 0&&(b=!1),a.addEventListener(l.toString(),m,b);else if(a.attachEvent)a.attachEvent(O(l.toString()),m);else if(a.addListener&&a.removeListener)a.addListener(m);else throw Error("addEventListener and attachEvent are unavailable.");return d}function ri(){function a(d){return l.call(a.src,a.listener,d)}let l=U;return a}function Qe(a,l,d,m,b){if(Array.isArray(l)){for(var x=0;x<l.length;x++)Qe(a,l[x],d,m,b);return null}return d=Z(d),a&&a[Oe]?a.L(l,d,h(m)?!!m.capture:!!m,b):us(a,l,d,!0,m,b)}function cn(a,l,d,m,b){if(Array.isArray(l))for(var x=0;x<l.length;x++)cn(a,l[x],d,m,b);else m=h(m)?!!m.capture:!!m,d=Z(d),a&&a[Oe]?(a=a.i,l=String(l).toString(),l in a.g&&(x=a.g[l],d=ni(x,d,m,b),-1<d&&(lt(x[d]),Array.prototype.splice.call(x,d,1),x.length==0&&(delete a.g[l],a.h--)))):a&&(a=M(a))&&(l=a.g[l.toString()],a=-1,l&&(a=ni(l,d,m,b)),(d=-1<a?l[a]:null)&&A(d))}function A(a){if(typeof a!="number"&&a&&!a.da){var l=a.src;if(l&&l[Oe])Ke(l.i,a);else{var d=a.type,m=a.proxy;l.removeEventListener?l.removeEventListener(d,m,a.capture):l.detachEvent?l.detachEvent(O(d),m):l.addListener&&l.removeListener&&l.removeListener(m),(d=M(l))?(Ke(d,a),d.h==0&&(d.src=null,l[wt]=null)):lt(a)}}}function O(a){return a in qt?qt[a]:qt[a]="on"+a}function U(a,l){if(a.da)a=!0;else{l=new ft(l,this);var d=a.listener,m=a.ha||a.src;a.fa&&A(a),a=d.call(m,l)}return a}function M(a){return a=a[wt],a instanceof ti?a:null}var Q="__closure_events_fn_"+(1e9*Math.random()>>>0);function Z(a){return typeof a=="function"?a:(a[Q]||(a[Q]=function(l){return a.handleEvent(l)}),a[Q])}function K(){Ne.call(this),this.i=new ti(this),this.M=this,this.F=null}k(K,Ne),K.prototype[Oe]=!0,K.prototype.removeEventListener=function(a,l,d,m){cn(this,a,l,d,m)};function $(a,l){var d,m=a.F;if(m)for(d=[];m;m=m.F)d.push(m);if(a=a.M,m=l.type||l,typeof l=="string")l=new me(l,a);else if(l instanceof me)l.target=l.target||a;else{var b=l;l=new me(m,a),I(l,b)}if(b=!0,d)for(var x=d.length-1;0<=x;x--){var j=l.g=d[x];b=L(j,m,!0,l)&&b}if(j=l.g=a,b=L(j,m,!0,l)&&b,b=L(j,m,!1,l)&&b,d)for(x=0;x<d.length;x++)j=l.g=d[x],b=L(j,m,!1,l)&&b}K.prototype.N=function(){if(K.aa.N.call(this),this.i){var a=this.i,l;for(l in a.g){for(var d=a.g[l],m=0;m<d.length;m++)lt(d[m]);delete a.g[l],a.h--}}this.F=null},K.prototype.K=function(a,l,d,m){return this.i.add(String(a),l,!1,d,m)},K.prototype.L=function(a,l,d,m){return this.i.add(String(a),l,!0,d,m)};function L(a,l,d,m){if(l=a.i.g[String(l)],!l)return!0;l=l.concat();for(var b=!0,x=0;x<l.length;++x){var j=l[x];if(j&&!j.da&&j.capture==d){var Te=j.listener,et=j.ha||j.src;j.fa&&Ke(a.i,j),b=Te.call(et,m)!==!1&&b}}return b&&!m.defaultPrevented}function J(a,l,d){if(typeof a=="function")d&&(a=g(a,d));else if(a&&typeof a.handleEvent=="function")a=g(a.handleEvent,a);else throw Error("Invalid listener argument");return 2147483647<Number(l)?-1:c.setTimeout(a,l||0)}function oe(a){a.g=J(()=>{a.g=null,a.i&&(a.i=!1,oe(a))},a.l);let l=a.h;a.h=null,a.m.apply(null,l)}class ae extends Ne{constructor(l,d){super(),this.m=l,this.l=d,this.h=null,this.i=!1,this.g=null}j(l){this.h=arguments,this.g?this.i=!0:oe(this)}N(){super.N(),this.g&&(c.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ce(a){Ne.call(this),this.h=a,this.g={}}k(Ce,Ne);var Ze=[];function kt(a){re(a.g,function(l,d){this.g.hasOwnProperty(d)&&A(l)},a),a.g={}}Ce.prototype.N=function(){Ce.aa.N.call(this),kt(this)},Ce.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var xt=c.JSON.stringify,Lw=c.JSON.parse,Mw=class{stringify(a){return c.JSON.stringify(a,void 0)}parse(a){return c.JSON.parse(a,void 0)}};function Bu(){}Bu.prototype.h=null;function yp(a){return a.h||(a.h=a.i())}function _p(){}var ls={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ju(){me.call(this,"d")}k(ju,me);function qu(){me.call(this,"c")}k(qu,me);var hr={},vp=null;function Jo(){return vp=vp||new K}hr.La="serverreachability";function wp(a){me.call(this,hr.La,a)}k(wp,me);function hs(a){let l=Jo();$(l,new wp(l))}hr.STAT_EVENT="statevent";function Ip(a,l){me.call(this,hr.STAT_EVENT,a),this.stat=l}k(Ip,me);function ht(a){let l=Jo();$(l,new Ip(l,a))}hr.Ma="timingevent";function Ep(a,l){me.call(this,hr.Ma,a),this.size=l}k(Ep,me);function ds(a,l){if(typeof a!="function")throw Error("Fn must not be null and must be a function");return c.setTimeout(function(){a()},l)}function fs(){this.g=!0}fs.prototype.xa=function(){this.g=!1};function Fw(a,l,d,m,b,x){a.info(function(){if(a.g)if(x)for(var j="",Te=x.split("&"),et=0;et<Te.length;et++){var ye=Te[et].split("=");if(1<ye.length){var tt=ye[0];ye=ye[1];var nt=tt.split("_");j=2<=nt.length&&nt[1]=="type"?j+(tt+"="+ye+"&"):j+(tt+"=redacted&")}}else j=null;else j=x;return"XMLHTTP REQ ("+m+") [attempt "+b+"]: "+l+`
`+d+`
`+j})}function Uw(a,l,d,m,b,x,j){a.info(function(){return"XMLHTTP RESP ("+m+") [ attempt "+b+"]: "+l+`
`+d+`
`+x+" "+j})}function ii(a,l,d,m){a.info(function(){return"XMLHTTP TEXT ("+l+"): "+jw(a,d)+(m?" "+m:"")})}function Bw(a,l){a.info(function(){return"TIMEOUT: "+l})}fs.prototype.info=function(){};function jw(a,l){if(!a.g)return l;if(!l)return null;try{var d=JSON.parse(l);if(d){for(a=0;a<d.length;a++)if(Array.isArray(d[a])){var m=d[a];if(!(2>m.length)){var b=m[1];if(Array.isArray(b)&&!(1>b.length)){var x=b[0];if(x!="noop"&&x!="stop"&&x!="close")for(var j=1;j<b.length;j++)b[j]=""}}}}return xt(d)}catch{return l}}var Xo={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Tp={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},zu;function Zo(){}k(Zo,Bu),Zo.prototype.g=function(){return new XMLHttpRequest},Zo.prototype.i=function(){return{}},zu=new Zo;function Pn(a,l,d,m){this.j=a,this.i=l,this.l=d,this.R=m||1,this.U=new Ce(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new bp}function bp(){this.i=null,this.g="",this.h=!1}var Ap={},$u={};function Hu(a,l,d){a.L=1,a.v=ra(un(l)),a.m=d,a.P=!0,Sp(a,null)}function Sp(a,l){a.F=Date.now(),ea(a),a.A=un(a.v);var d=a.A,m=a.R;Array.isArray(m)||(m=[String(m)]),Bp(d.i,"t",m),a.C=0,d=a.j.J,a.h=new bp,a.g=im(a.j,d?l:null,!a.m),0<a.O&&(a.M=new ae(g(a.Y,a,a.g),a.O)),l=a.U,d=a.g,m=a.ca;var b="readystatechange";Array.isArray(b)||(b&&(Ze[0]=b.toString()),b=Ze);for(var x=0;x<b.length;x++){var j=lr(d,b[x],m||l.handleEvent,!1,l.h||l);if(!j)break;l.g[j.key]=j}l=a.H?_(a.H):{},a.m?(a.u||(a.u="POST"),l["Content-Type"]="application/x-www-form-urlencoded",a.g.ea(a.A,a.u,a.m,l)):(a.u="GET",a.g.ea(a.A,a.u,null,l)),hs(),Fw(a.i,a.u,a.A,a.l,a.R,a.m)}Pn.prototype.ca=function(a){a=a.target;let l=this.M;l&&ln(a)==3?l.j():this.Y(a)},Pn.prototype.Y=function(a){try{if(a==this.g)e:{let nt=ln(this.g);var l=this.g.Ba();let ai=this.g.Z();if(!(3>nt)&&(nt!=3||this.g&&(this.h.h||this.g.oa()||Wp(this.g)))){this.J||nt!=4||l==7||(l==8||0>=ai?hs(3):hs(2)),Gu(this);var d=this.g.Z();this.X=d;t:if(Rp(this)){var m=Wp(this.g);a="";var b=m.length,x=ln(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){dr(this),ps(this);var j="";break t}this.h.i=new c.TextDecoder}for(l=0;l<b;l++)this.h.h=!0,a+=this.h.i.decode(m[l],{stream:!(x&&l==b-1)});m.length=0,this.h.g+=a,this.C=0,j=this.h.g}else j=this.g.oa();if(this.o=d==200,Uw(this.i,this.u,this.A,this.l,this.R,nt,d),this.o){if(this.T&&!this.K){t:{if(this.g){var Te,et=this.g;if((Te=et.g?et.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!F(Te)){var ye=Te;break t}}ye=null}if(d=ye)ii(this.i,this.l,d,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Wu(this,d);else{this.o=!1,this.s=3,ht(12),dr(this),ps(this);break e}}if(this.P){d=!0;let Dt;for(;!this.J&&this.C<j.length;)if(Dt=qw(this,j),Dt==$u){nt==4&&(this.s=4,ht(14),d=!1),ii(this.i,this.l,null,"[Incomplete Response]");break}else if(Dt==Ap){this.s=4,ht(15),ii(this.i,this.l,j,"[Invalid Chunk]"),d=!1;break}else ii(this.i,this.l,Dt,null),Wu(this,Dt);if(Rp(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),nt!=4||j.length!=0||this.h.h||(this.s=1,ht(16),d=!1),this.o=this.o&&d,!d)ii(this.i,this.l,j,"[Invalid Chunked Response]"),dr(this),ps(this);else if(0<j.length&&!this.W){this.W=!0;var tt=this.j;tt.g==this&&tt.ba&&!tt.M&&(tt.j.info("Great, no buffering proxy detected. Bytes received: "+j.length),Zu(tt),tt.M=!0,ht(11))}}else ii(this.i,this.l,j,null),Wu(this,j);nt==4&&dr(this),this.o&&!this.J&&(nt==4?em(this.j,this):(this.o=!1,ea(this)))}else sI(this.g),d==400&&0<j.indexOf("Unknown SID")?(this.s=3,ht(12)):(this.s=0,ht(13)),dr(this),ps(this)}}}catch{}finally{}};function Rp(a){return a.g?a.u=="GET"&&a.L!=2&&a.j.Ca:!1}function qw(a,l){var d=a.C,m=l.indexOf(`
`,d);return m==-1?$u:(d=Number(l.substring(d,m)),isNaN(d)?Ap:(m+=1,m+d>l.length?$u:(l=l.slice(m,m+d),a.C=m+d,l)))}Pn.prototype.cancel=function(){this.J=!0,dr(this)};function ea(a){a.S=Date.now()+a.I,Pp(a,a.I)}function Pp(a,l){if(a.B!=null)throw Error("WatchDog timer not null");a.B=ds(g(a.ba,a),l)}function Gu(a){a.B&&(c.clearTimeout(a.B),a.B=null)}Pn.prototype.ba=function(){this.B=null;let a=Date.now();0<=a-this.S?(Bw(this.i,this.A),this.L!=2&&(hs(),ht(17)),dr(this),this.s=2,ps(this)):Pp(this,this.S-a)};function ps(a){a.j.G==0||a.J||em(a.j,a)}function dr(a){Gu(a);var l=a.M;l&&typeof l.ma=="function"&&l.ma(),a.M=null,kt(a.U),a.g&&(l=a.g,a.g=null,l.abort(),l.ma())}function Wu(a,l){try{var d=a.j;if(d.G!=0&&(d.g==a||Ku(d.h,a))){if(!a.K&&Ku(d.h,a)&&d.G==3){try{var m=d.Da.g.parse(l)}catch{m=null}if(Array.isArray(m)&&m.length==3){var b=m;if(b[0]==0){e:if(!d.u){if(d.g)if(d.g.F+3e3<a.F)ca(d),oa(d);else break e;Xu(d),ht(18)}}else d.za=b[1],0<d.za-d.T&&37500>b[2]&&d.F&&d.v==0&&!d.C&&(d.C=ds(g(d.Za,d),6e3));if(1>=xp(d.h)&&d.ca){try{d.ca()}catch{}d.ca=void 0}}else pr(d,11)}else if((a.K||d.g==a)&&ca(d),!F(l))for(b=d.Da.g.parse(l),l=0;l<b.length;l++){let ye=b[l];if(d.T=ye[0],ye=ye[1],d.G==2)if(ye[0]=="c"){d.K=ye[1],d.ia=ye[2];let tt=ye[3];tt!=null&&(d.la=tt,d.j.info("VER="+d.la));let nt=ye[4];nt!=null&&(d.Aa=nt,d.j.info("SVER="+d.Aa));let ai=ye[5];ai!=null&&typeof ai=="number"&&0<ai&&(m=1.5*ai,d.L=m,d.j.info("backChannelRequestTimeoutMs_="+m)),m=d;let Dt=a.g;if(Dt){let la=Dt.g?Dt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(la){var x=m.h;x.g||la.indexOf("spdy")==-1&&la.indexOf("quic")==-1&&la.indexOf("h2")==-1||(x.j=x.l,x.g=new Set,x.h&&(Qu(x,x.h),x.h=null))}if(m.D){let el=Dt.g?Dt.g.getResponseHeader("X-HTTP-Session-Id"):null;el&&(m.ya=el,Ae(m.I,m.D,el))}}d.G=3,d.l&&d.l.ua(),d.ba&&(d.R=Date.now()-a.F,d.j.info("Handshake RTT: "+d.R+"ms")),m=d;var j=a;if(m.qa=rm(m,m.J?m.ia:null,m.W),j.K){Dp(m.h,j);var Te=j,et=m.L;et&&(Te.I=et),Te.B&&(Gu(Te),ea(Te)),m.g=j}else Xp(m);0<d.i.length&&aa(d)}else ye[0]!="stop"&&ye[0]!="close"||pr(d,7);else d.G==3&&(ye[0]=="stop"||ye[0]=="close"?ye[0]=="stop"?pr(d,7):Ju(d):ye[0]!="noop"&&d.l&&d.l.ta(ye),d.v=0)}}hs(4)}catch{}}var zw=class{constructor(a,l){this.g=a,this.map=l}};function Cp(a){this.l=a||10,c.PerformanceNavigationTiming?(a=c.performance.getEntriesByType("navigation"),a=0<a.length&&(a[0].nextHopProtocol=="hq"||a[0].nextHopProtocol=="h2")):a=!!(c.chrome&&c.chrome.loadTimes&&c.chrome.loadTimes()&&c.chrome.loadTimes().wasFetchedViaSpdy),this.j=a?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function kp(a){return a.h?!0:a.g?a.g.size>=a.j:!1}function xp(a){return a.h?1:a.g?a.g.size:0}function Ku(a,l){return a.h?a.h==l:a.g?a.g.has(l):!1}function Qu(a,l){a.g?a.g.add(l):a.h=l}function Dp(a,l){a.h&&a.h==l?a.h=null:a.g&&a.g.has(l)&&a.g.delete(l)}Cp.prototype.cancel=function(){if(this.i=Np(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let a of this.g.values())a.cancel();this.g.clear()}};function Np(a){if(a.h!=null)return a.i.concat(a.h.D);if(a.g!=null&&a.g.size!==0){let l=a.i;for(let d of a.g.values())l=l.concat(d.D);return l}return D(a.i)}function $w(a){if(a.V&&typeof a.V=="function")return a.V();if(typeof Map<"u"&&a instanceof Map||typeof Set<"u"&&a instanceof Set)return Array.from(a.values());if(typeof a=="string")return a.split("");if(u(a)){for(var l=[],d=a.length,m=0;m<d;m++)l.push(a[m]);return l}l=[],d=0;for(m in a)l[d++]=a[m];return l}function Hw(a){if(a.na&&typeof a.na=="function")return a.na();if(!a.V||typeof a.V!="function"){if(typeof Map<"u"&&a instanceof Map)return Array.from(a.keys());if(!(typeof Set<"u"&&a instanceof Set)){if(u(a)||typeof a=="string"){var l=[];a=a.length;for(var d=0;d<a;d++)l.push(d);return l}l=[],d=0;for(let m in a)l[d++]=m;return l}}}function Op(a,l){if(a.forEach&&typeof a.forEach=="function")a.forEach(l,void 0);else if(u(a)||typeof a=="string")Array.prototype.forEach.call(a,l,void 0);else for(var d=Hw(a),m=$w(a),b=m.length,x=0;x<b;x++)l.call(void 0,m[x],d&&d[x],a)}var Vp=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Gw(a,l){if(a){a=a.split("&");for(var d=0;d<a.length;d++){var m=a[d].indexOf("="),b=null;if(0<=m){var x=a[d].substring(0,m);b=a[d].substring(m+1)}else x=a[d];l(x,b?decodeURIComponent(b.replace(/\+/g," ")):"")}}}function fr(a){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,a instanceof fr){this.h=a.h,ta(this,a.j),this.o=a.o,this.g=a.g,na(this,a.s),this.l=a.l;var l=a.i,d=new ys;d.i=l.i,l.g&&(d.g=new Map(l.g),d.h=l.h),Lp(this,d),this.m=a.m}else a&&(l=String(a).match(Vp))?(this.h=!1,ta(this,l[1]||"",!0),this.o=ms(l[2]||""),this.g=ms(l[3]||"",!0),na(this,l[4]),this.l=ms(l[5]||"",!0),Lp(this,l[6]||"",!0),this.m=ms(l[7]||"")):(this.h=!1,this.i=new ys(null,this.h))}fr.prototype.toString=function(){var a=[],l=this.j;l&&a.push(gs(l,Mp,!0),":");var d=this.g;return(d||l=="file")&&(a.push("//"),(l=this.o)&&a.push(gs(l,Mp,!0),"@"),a.push(encodeURIComponent(String(d)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d=this.s,d!=null&&a.push(":",String(d))),(d=this.l)&&(this.g&&d.charAt(0)!="/"&&a.push("/"),a.push(gs(d,d.charAt(0)=="/"?Qw:Kw,!0))),(d=this.i.toString())&&a.push("?",d),(d=this.m)&&a.push("#",gs(d,Jw)),a.join("")};function un(a){return new fr(a)}function ta(a,l,d){a.j=d?ms(l,!0):l,a.j&&(a.j=a.j.replace(/:$/,""))}function na(a,l){if(l){if(l=Number(l),isNaN(l)||0>l)throw Error("Bad port number "+l);a.s=l}else a.s=null}function Lp(a,l,d){l instanceof ys?(a.i=l,Xw(a.i,a.h)):(d||(l=gs(l,Yw)),a.i=new ys(l,a.h))}function Ae(a,l,d){a.i.set(l,d)}function ra(a){return Ae(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),a}function ms(a,l){return a?l?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function gs(a,l,d){return typeof a=="string"?(a=encodeURI(a).replace(l,Ww),d&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function Ww(a){return a=a.charCodeAt(0),"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var Mp=/[#\/\?@]/g,Kw=/[#\?:]/g,Qw=/[#\?]/g,Yw=/[#\?@]/g,Jw=/#/g;function ys(a,l){this.h=this.g=null,this.i=a||null,this.j=!!l}function Cn(a){a.g||(a.g=new Map,a.h=0,a.i&&Gw(a.i,function(l,d){a.add(decodeURIComponent(l.replace(/\+/g," ")),d)}))}n=ys.prototype,n.add=function(a,l){Cn(this),this.i=null,a=si(this,a);var d=this.g.get(a);return d||this.g.set(a,d=[]),d.push(l),this.h+=1,this};function Fp(a,l){Cn(a),l=si(a,l),a.g.has(l)&&(a.i=null,a.h-=a.g.get(l).length,a.g.delete(l))}function Up(a,l){return Cn(a),l=si(a,l),a.g.has(l)}n.forEach=function(a,l){Cn(this),this.g.forEach(function(d,m){d.forEach(function(b){a.call(l,b,m,this)},this)},this)},n.na=function(){Cn(this);let a=Array.from(this.g.values()),l=Array.from(this.g.keys()),d=[];for(let m=0;m<l.length;m++){let b=a[m];for(let x=0;x<b.length;x++)d.push(l[m])}return d},n.V=function(a){Cn(this);let l=[];if(typeof a=="string")Up(this,a)&&(l=l.concat(this.g.get(si(this,a))));else{a=Array.from(this.g.values());for(let d=0;d<a.length;d++)l=l.concat(a[d])}return l},n.set=function(a,l){return Cn(this),this.i=null,a=si(this,a),Up(this,a)&&(this.h-=this.g.get(a).length),this.g.set(a,[l]),this.h+=1,this},n.get=function(a,l){return a?(a=this.V(a),0<a.length?String(a[0]):l):l};function Bp(a,l,d){Fp(a,l),0<d.length&&(a.i=null,a.g.set(si(a,l),D(d)),a.h+=d.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let a=[],l=Array.from(this.g.keys());for(var d=0;d<l.length;d++){var m=l[d];let x=encodeURIComponent(String(m)),j=this.V(m);for(m=0;m<j.length;m++){var b=x;j[m]!==""&&(b+="="+encodeURIComponent(String(j[m]))),a.push(b)}}return this.i=a.join("&")};function si(a,l){return l=String(l),a.j&&(l=l.toLowerCase()),l}function Xw(a,l){l&&!a.j&&(Cn(a),a.i=null,a.g.forEach(function(d,m){var b=m.toLowerCase();m!=b&&(Fp(this,m),Bp(this,b,d))},a)),a.j=l}function Zw(a,l){let d=new fs;if(c.Image){let m=new Image;m.onload=w(kn,d,"TestLoadImage: loaded",!0,l,m),m.onerror=w(kn,d,"TestLoadImage: error",!1,l,m),m.onabort=w(kn,d,"TestLoadImage: abort",!1,l,m),m.ontimeout=w(kn,d,"TestLoadImage: timeout",!1,l,m),c.setTimeout(function(){m.ontimeout&&m.ontimeout()},1e4),m.src=a}else l(!1)}function eI(a,l){let d=new fs,m=new AbortController,b=setTimeout(()=>{m.abort(),kn(d,"TestPingServer: timeout",!1,l)},1e4);fetch(a,{signal:m.signal}).then(x=>{clearTimeout(b),x.ok?kn(d,"TestPingServer: ok",!0,l):kn(d,"TestPingServer: server error",!1,l)}).catch(()=>{clearTimeout(b),kn(d,"TestPingServer: error",!1,l)})}function kn(a,l,d,m,b){try{b&&(b.onload=null,b.onerror=null,b.onabort=null,b.ontimeout=null),m(d)}catch{}}function tI(){this.g=new Mw}function nI(a,l,d){let m=d||"";try{Op(a,function(b,x){let j=b;h(b)&&(j=xt(b)),l.push(m+x+"="+encodeURIComponent(j))})}catch(b){throw l.push(m+"type="+encodeURIComponent("_badmap")),b}}function _s(a){this.l=a.Ub||null,this.j=a.eb||!1}k(_s,Bu),_s.prototype.g=function(){return new ia(this.l,this.j)},_s.prototype.i=function(a){return function(){return a}}({});function ia(a,l){K.call(this),this.D=a,this.o=l,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}k(ia,K),n=ia.prototype,n.open=function(a,l){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=a,this.A=l,this.readyState=1,ws(this)},n.send=function(a){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let l={headers:this.u,method:this.B,credentials:this.m,cache:void 0};a&&(l.body=a),(this.D||c).fetch(new Request(this.A,l)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,vs(this)),this.readyState=0},n.Sa=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,ws(this)),this.g&&(this.readyState=3,ws(this),this.g)))if(this.responseType==="arraybuffer")a.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof c.ReadableStream<"u"&&"body"in a){if(this.j=a.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;jp(this)}else a.text().then(this.Ra.bind(this),this.ga.bind(this))};function jp(a){a.j.read().then(a.Pa.bind(a)).catch(a.ga.bind(a))}n.Pa=function(a){if(this.g){if(this.o&&a.value)this.response.push(a.value);else if(!this.o){var l=a.value?a.value:new Uint8Array(0);(l=this.v.decode(l,{stream:!a.done}))&&(this.response=this.responseText+=l)}a.done?vs(this):ws(this),this.readyState==3&&jp(this)}},n.Ra=function(a){this.g&&(this.response=this.responseText=a,vs(this))},n.Qa=function(a){this.g&&(this.response=a,vs(this))},n.ga=function(){this.g&&vs(this)};function vs(a){a.readyState=4,a.l=null,a.j=null,a.v=null,ws(a)}n.setRequestHeader=function(a,l){this.u.append(a,l)},n.getResponseHeader=function(a){return this.h&&this.h.get(a.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let a=[],l=this.h.entries();for(var d=l.next();!d.done;)d=d.value,a.push(d[0]+": "+d[1]),d=l.next();return a.join(`\r
`)};function ws(a){a.onreadystatechange&&a.onreadystatechange.call(a)}Object.defineProperty(ia.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(a){this.m=a?"include":"same-origin"}});function qp(a){let l="";return re(a,function(d,m){l+=m,l+=":",l+=d,l+=`\r
`}),l}function Yu(a,l,d){e:{for(m in d){var m=!1;break e}m=!0}m||(d=qp(d),typeof a=="string"?d!=null&&encodeURIComponent(String(d)):Ae(a,l,d))}function Ve(a){K.call(this),this.headers=new Map,this.o=a||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}k(Ve,K);var rI=/^https?$/i,iI=["POST","PUT"];n=Ve.prototype,n.Ha=function(a){this.J=a},n.ea=function(a,l,d,m){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+a);l=l?l.toUpperCase():"GET",this.D=a,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():zu.g(),this.v=this.o?yp(this.o):yp(zu),this.g.onreadystatechange=g(this.Ea,this);try{this.B=!0,this.g.open(l,String(a),!0),this.B=!1}catch(x){zp(this,x);return}if(a=d||"",d=new Map(this.headers),m)if(Object.getPrototypeOf(m)===Object.prototype)for(var b in m)d.set(b,m[b]);else if(typeof m.keys=="function"&&typeof m.get=="function")for(let x of m.keys())d.set(x,m.get(x));else throw Error("Unknown input type for opt_headers: "+String(m));m=Array.from(d.keys()).find(x=>x.toLowerCase()=="content-type"),b=c.FormData&&a instanceof c.FormData,!(0<=Array.prototype.indexOf.call(iI,l,void 0))||m||b||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[x,j]of d)this.g.setRequestHeader(x,j);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Gp(this),this.u=!0,this.g.send(a),this.u=!1}catch(x){zp(this,x)}};function zp(a,l){a.h=!1,a.g&&(a.j=!0,a.g.abort(),a.j=!1),a.l=l,a.m=5,$p(a),sa(a)}function $p(a){a.A||(a.A=!0,$(a,"complete"),$(a,"error"))}n.abort=function(a){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=a||7,$(this,"complete"),$(this,"abort"),sa(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),sa(this,!0)),Ve.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Hp(this):this.bb())},n.bb=function(){Hp(this)};function Hp(a){if(a.h&&typeof o<"u"&&(!a.v[1]||ln(a)!=4||a.Z()!=2)){if(a.u&&ln(a)==4)J(a.Ea,0,a);else if($(a,"readystatechange"),ln(a)==4){a.h=!1;try{let j=a.Z();e:switch(j){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var l=!0;break e;default:l=!1}var d;if(!(d=l)){var m;if(m=j===0){var b=String(a.D).match(Vp)[1]||null;!b&&c.self&&c.self.location&&(b=c.self.location.protocol.slice(0,-1)),m=!rI.test(b?b.toLowerCase():"")}d=m}if(d)$(a,"complete"),$(a,"success");else{a.m=6;try{var x=2<ln(a)?a.g.statusText:""}catch{x=""}a.l=x+" ["+a.Z()+"]",$p(a)}}finally{sa(a)}}}}function sa(a,l){if(a.g){Gp(a);let d=a.g,m=a.v[0]?()=>{}:null;a.g=null,a.v=null,l||$(a,"ready");try{d.onreadystatechange=m}catch{}}}function Gp(a){a.I&&(c.clearTimeout(a.I),a.I=null)}n.isActive=function(){return!!this.g};function ln(a){return a.g?a.g.readyState:0}n.Z=function(){try{return 2<ln(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(a){if(this.g){var l=this.g.responseText;return a&&l.indexOf(a)==0&&(l=l.substring(a.length)),Lw(l)}};function Wp(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.H){case"":case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch{return null}}function sI(a){let l={};a=(a.g&&2<=ln(a)&&a.g.getAllResponseHeaders()||"").split(`\r
`);for(let m=0;m<a.length;m++){if(F(a[m]))continue;var d=T(a[m]);let b=d[0];if(d=d[1],typeof d!="string")continue;d=d.trim();let x=l[b]||[];l[b]=x,x.push(d)}E(l,function(m){return m.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Is(a,l,d){return d&&d.internalChannelParams&&d.internalChannelParams[a]||l}function Kp(a){this.Aa=0,this.i=[],this.j=new fs,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Is("failFast",!1,a),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Is("baseRetryDelayMs",5e3,a),this.cb=Is("retryDelaySeedMs",1e4,a),this.Wa=Is("forwardChannelMaxRetries",2,a),this.wa=Is("forwardChannelRequestTimeoutMs",2e4,a),this.pa=a&&a.xmlHttpFactory||void 0,this.Xa=a&&a.Tb||void 0,this.Ca=a&&a.useFetchStreams||!1,this.L=void 0,this.J=a&&a.supportsCrossDomainXhr||!1,this.K="",this.h=new Cp(a&&a.concurrentRequestLimit),this.Da=new tI,this.P=a&&a.fastHandshake||!1,this.O=a&&a.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=a&&a.Rb||!1,a&&a.xa&&this.j.xa(),a&&a.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&a&&a.detectBufferingProxy||!1,this.ja=void 0,a&&a.longPollingTimeout&&0<a.longPollingTimeout&&(this.ja=a.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Kp.prototype,n.la=8,n.G=1,n.connect=function(a,l,d,m){ht(0),this.W=a,this.H=l||{},d&&m!==void 0&&(this.H.OSID=d,this.H.OAID=m),this.F=this.X,this.I=rm(this,null,this.W),aa(this)};function Ju(a){if(Qp(a),a.G==3){var l=a.U++,d=un(a.I);if(Ae(d,"SID",a.K),Ae(d,"RID",l),Ae(d,"TYPE","terminate"),Es(a,d),l=new Pn(a,a.j,l),l.L=2,l.v=ra(un(d)),d=!1,c.navigator&&c.navigator.sendBeacon)try{d=c.navigator.sendBeacon(l.v.toString(),"")}catch{}!d&&c.Image&&(new Image().src=l.v,d=!0),d||(l.g=im(l.j,null),l.g.ea(l.v)),l.F=Date.now(),ea(l)}nm(a)}function oa(a){a.g&&(Zu(a),a.g.cancel(),a.g=null)}function Qp(a){oa(a),a.u&&(c.clearTimeout(a.u),a.u=null),ca(a),a.h.cancel(),a.s&&(typeof a.s=="number"&&c.clearTimeout(a.s),a.s=null)}function aa(a){if(!kp(a.h)&&!a.s){a.s=!0;var l=a.Ga;de||De(),ce||(de(),ce=!0),we.add(l,a),a.B=0}}function oI(a,l){return xp(a.h)>=a.h.j-(a.s?1:0)?!1:a.s?(a.i=l.D.concat(a.i),!0):a.G==1||a.G==2||a.B>=(a.Va?0:a.Wa)?!1:(a.s=ds(g(a.Ga,a,l),tm(a,a.B)),a.B++,!0)}n.Ga=function(a){if(this.s)if(this.s=null,this.G==1){if(!a){this.U=Math.floor(1e5*Math.random()),a=this.U++;let b=new Pn(this,this.j,a),x=this.o;if(this.S&&(x?(x=_(x),I(x,this.S)):x=this.S),this.m!==null||this.O||(b.H=x,x=null),this.P)e:{for(var l=0,d=0;d<this.i.length;d++){t:{var m=this.i[d];if("__data__"in m.map&&(m=m.map.__data__,typeof m=="string")){m=m.length;break t}m=void 0}if(m===void 0)break;if(l+=m,4096<l){l=d;break e}if(l===4096||d===this.i.length-1){l=d+1;break e}}l=1e3}else l=1e3;l=Jp(this,b,l),d=un(this.I),Ae(d,"RID",a),Ae(d,"CVER",22),this.D&&Ae(d,"X-HTTP-Session-Id",this.D),Es(this,d),x&&(this.O?l="headers="+encodeURIComponent(String(qp(x)))+"&"+l:this.m&&Yu(d,this.m,x)),Qu(this.h,b),this.Ua&&Ae(d,"TYPE","init"),this.P?(Ae(d,"$req",l),Ae(d,"SID","null"),b.T=!0,Hu(b,d,null)):Hu(b,d,l),this.G=2}}else this.G==3&&(a?Yp(this,a):this.i.length==0||kp(this.h)||Yp(this))};function Yp(a,l){var d;l?d=l.l:d=a.U++;let m=un(a.I);Ae(m,"SID",a.K),Ae(m,"RID",d),Ae(m,"AID",a.T),Es(a,m),a.m&&a.o&&Yu(m,a.m,a.o),d=new Pn(a,a.j,d,a.B+1),a.m===null&&(d.H=a.o),l&&(a.i=l.D.concat(a.i)),l=Jp(a,d,1e3),d.I=Math.round(.5*a.wa)+Math.round(.5*a.wa*Math.random()),Qu(a.h,d),Hu(d,m,l)}function Es(a,l){a.H&&re(a.H,function(d,m){Ae(l,m,d)}),a.l&&Op({},function(d,m){Ae(l,m,d)})}function Jp(a,l,d){d=Math.min(a.i.length,d);var m=a.l?g(a.l.Na,a.l,a):null;e:{var b=a.i;let x=-1;for(;;){let j=["count="+d];x==-1?0<d?(x=b[0].g,j.push("ofs="+x)):x=0:j.push("ofs="+x);let Te=!0;for(let et=0;et<d;et++){let ye=b[et].g,tt=b[et].map;if(ye-=x,0>ye)x=Math.max(0,b[et].g-100),Te=!1;else try{nI(tt,j,"req"+ye+"_")}catch{m&&m(tt)}}if(Te){m=j.join("&");break e}}}return a=a.i.splice(0,d),l.D=a,m}function Xp(a){if(!a.g&&!a.u){a.Y=1;var l=a.Fa;de||De(),ce||(de(),ce=!0),we.add(l,a),a.v=0}}function Xu(a){return a.g||a.u||3<=a.v?!1:(a.Y++,a.u=ds(g(a.Fa,a),tm(a,a.v)),a.v++,!0)}n.Fa=function(){if(this.u=null,Zp(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var a=2*this.R;this.j.info("BP detection timer enabled: "+a),this.A=ds(g(this.ab,this),a)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,ht(10),oa(this),Zp(this))};function Zu(a){a.A!=null&&(c.clearTimeout(a.A),a.A=null)}function Zp(a){a.g=new Pn(a,a.j,"rpc",a.Y),a.m===null&&(a.g.H=a.o),a.g.O=0;var l=un(a.qa);Ae(l,"RID","rpc"),Ae(l,"SID",a.K),Ae(l,"AID",a.T),Ae(l,"CI",a.F?"0":"1"),!a.F&&a.ja&&Ae(l,"TO",a.ja),Ae(l,"TYPE","xmlhttp"),Es(a,l),a.m&&a.o&&Yu(l,a.m,a.o),a.L&&(a.g.I=a.L);var d=a.g;a=a.ia,d.L=1,d.v=ra(un(l)),d.m=null,d.P=!0,Sp(d,a)}n.Za=function(){this.C!=null&&(this.C=null,oa(this),Xu(this),ht(19))};function ca(a){a.C!=null&&(c.clearTimeout(a.C),a.C=null)}function em(a,l){var d=null;if(a.g==l){ca(a),Zu(a),a.g=null;var m=2}else if(Ku(a.h,l))d=l.D,Dp(a.h,l),m=1;else return;if(a.G!=0){if(l.o)if(m==1){d=l.m?l.m.length:0,l=Date.now()-l.F;var b=a.B;m=Jo(),$(m,new Ep(m,d)),aa(a)}else Xp(a);else if(b=l.s,b==3||b==0&&0<l.X||!(m==1&&oI(a,l)||m==2&&Xu(a)))switch(d&&0<d.length&&(l=a.h,l.i=l.i.concat(d)),b){case 1:pr(a,5);break;case 4:pr(a,10);break;case 3:pr(a,6);break;default:pr(a,2)}}}function tm(a,l){let d=a.Ta+Math.floor(Math.random()*a.cb);return a.isActive()||(d*=2),d*l}function pr(a,l){if(a.j.info("Error code "+l),l==2){var d=g(a.fb,a),m=a.Xa;let b=!m;m=new fr(m||"//www.google.com/images/cleardot.gif"),c.location&&c.location.protocol=="http"||ta(m,"https"),ra(m),b?Zw(m.toString(),d):eI(m.toString(),d)}else ht(2);a.G=0,a.l&&a.l.sa(l),nm(a),Qp(a)}n.fb=function(a){a?(this.j.info("Successfully pinged google.com"),ht(2)):(this.j.info("Failed to ping google.com"),ht(1))};function nm(a){if(a.G=0,a.ka=[],a.l){let l=Np(a.h);(l.length!=0||a.i.length!=0)&&(C(a.ka,l),C(a.ka,a.i),a.h.i.length=0,D(a.i),a.i.length=0),a.l.ra()}}function rm(a,l,d){var m=d instanceof fr?un(d):new fr(d);if(m.g!="")l&&(m.g=l+"."+m.g),na(m,m.s);else{var b=c.location;m=b.protocol,l=l?l+"."+b.hostname:b.hostname,b=+b.port;var x=new fr(null);m&&ta(x,m),l&&(x.g=l),b&&na(x,b),d&&(x.l=d),m=x}return d=a.D,l=a.ya,d&&l&&Ae(m,d,l),Ae(m,"VER",a.la),Es(a,m),m}function im(a,l,d){if(l&&!a.J)throw Error("Can't create secondary domain capable XhrIo object.");return l=a.Ca&&!a.pa?new Ve(new _s({eb:d})):new Ve(a.pa),l.Ha(a.J),l}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function sm(){}n=sm.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function ua(){}ua.prototype.g=function(a,l){return new It(a,l)};function It(a,l){K.call(this),this.g=new Kp(l),this.l=a,this.h=l&&l.messageUrlParams||null,a=l&&l.messageHeaders||null,l&&l.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.g.o=a,a=l&&l.initMessageHeaders||null,l&&l.messageContentType&&(a?a["X-WebChannel-Content-Type"]=l.messageContentType:a={"X-WebChannel-Content-Type":l.messageContentType}),l&&l.va&&(a?a["X-WebChannel-Client-Profile"]=l.va:a={"X-WebChannel-Client-Profile":l.va}),this.g.S=a,(a=l&&l.Sb)&&!F(a)&&(this.g.m=a),this.v=l&&l.supportsCrossDomainXhr||!1,this.u=l&&l.sendRawJson||!1,(l=l&&l.httpSessionIdParam)&&!F(l)&&(this.g.D=l,a=this.h,a!==null&&l in a&&(a=this.h,l in a&&delete a[l])),this.j=new oi(this)}k(It,K),It.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},It.prototype.close=function(){Ju(this.g)},It.prototype.o=function(a){var l=this.g;if(typeof a=="string"){var d={};d.__data__=a,a=d}else this.u&&(d={},d.__data__=xt(a),a=d);l.i.push(new zw(l.Ya++,a)),l.G==3&&aa(l)},It.prototype.N=function(){this.g.l=null,delete this.j,Ju(this.g),delete this.g,It.aa.N.call(this)};function om(a){ju.call(this),a.__headers__&&(this.headers=a.__headers__,this.statusCode=a.__status__,delete a.__headers__,delete a.__status__);var l=a.__sm__;if(l){e:{for(let d in l){a=d;break e}a=void 0}(this.i=a)&&(a=this.i,l=l!==null&&a in l?l[a]:void 0),this.data=l}else this.data=a}k(om,ju);function am(){qu.call(this),this.status=1}k(am,qu);function oi(a){this.g=a}k(oi,sm),oi.prototype.ua=function(){$(this.g,"a")},oi.prototype.ta=function(a){$(this.g,new om(a))},oi.prototype.sa=function(a){$(this.g,new am)},oi.prototype.ra=function(){$(this.g,"b")},ua.prototype.createWebChannel=ua.prototype.g,It.prototype.send=It.prototype.o,It.prototype.open=It.prototype.m,It.prototype.close=It.prototype.close,ch=_n.createWebChannelTransport=function(){return new ua},ah=_n.getStatEventTarget=function(){return Jo()},oh=_n.Event=hr,tc=_n.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Xo.NO_ERROR=0,Xo.TIMEOUT=8,Xo.HTTP_ERROR=6,Ws=_n.ErrorCode=Xo,Tp.COMPLETE="complete",sh=_n.EventType=Tp,_p.EventType=ls,ls.OPEN="a",ls.CLOSE="b",ls.ERROR="c",ls.MESSAGE="d",K.prototype.listen=K.prototype.K,mi=_n.WebChannel=_p,_0=_n.FetchXmlHttpFactory=_s,Ve.prototype.listenOnce=Ve.prototype.L,Ve.prototype.getLastError=Ve.prototype.Ka,Ve.prototype.getLastErrorCode=Ve.prototype.Ba,Ve.prototype.getStatus=Ve.prototype.Z,Ve.prototype.getResponseJson=Ve.prototype.Oa,Ve.prototype.getResponseText=Ve.prototype.oa,Ve.prototype.send=Ve.prototype.ea,Ve.prototype.setWithCredentials=Ve.prototype.Ha,ih=_n.XhrIo=Ve}).apply(typeof ec<"u"?ec:typeof self<"u"?self:typeof window<"u"?window:{})});function Ei(){return Hn.logLevel}function v0(n){Hn.setLogLevel(n)}function V(n,...e){if(Hn.logLevel<=le.DEBUG){let t=e.map(Tf);Hn.debug(`Firestore (${Zi}): ${n}`,...t)}}function Ue(n,...e){if(Hn.logLevel<=le.ERROR){let t=e.map(Tf);Hn.error(`Firestore (${Zi}): ${n}`,...t)}}function ut(n,...e){if(Hn.logLevel<=le.WARN){let t=e.map(Tf);Hn.warn(`Firestore (${Zi}): ${n}`,...t)}}function Tf(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}function W(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,d_(n,r,t)}function d_(n,e,t){let r=`FIRESTORE (${Zi}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw Ue(r),new Error(r)}function Y(n,e,t,r){let i="Unexpected state";typeof t=="string"?i=t:r=t,n||d_(e,i,r)}function w0(n,e){n||W(57014,e)}function B(n,e){return n}function I0(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}function bf(){return new TextEncoder}function te(n,e){return n<e?-1:n>e?1:0}function Eh(n,e){let t=0;for(;t<n.length&&t<e.length;){let r=n.codePointAt(t),i=e.codePointAt(t);if(r!==i){if(r<128&&i<128)return te(r,i);{let s=bf(),o=E0(s.encode(Xg(n,t)),s.encode(Xg(e,t)));return o!==0?o:te(r,i)}}t+=r>65535?2:1}return te(n.length,e.length)}function Xg(n,e){return n.codePointAt(e)>65535?n.substring(e,e+2):n.substring(e,e+1)}function E0(n,e){for(let t=0;t<n.length&&t<e.length;++t)if(n[t]!==e[t])return te(n[t],e[t]);return te(n.length,e.length)}function xi(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}function f_(n){return n+"\0"}function Af(n,e,t){if(!t)throw new N(R.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function p_(n,e,t,r){if(e===!0&&r===!0)throw new N(R.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Zg(n){if(!q.isDocumentKey(n))throw new N(R.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function ey(n){if(q.isDocumentKey(n))throw new N(R.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function m_(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function wu(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":W(12329,{type:typeof n})}function he(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new N(R.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=wu(n);throw new N(R.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function g_(n,e){if(e<=0)throw new N(R.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}function He(n,e){let t={typeString:n};return e&&(t.value=e),t}function Qr(n,e){if(!m_(n))throw new N(R.INVALID_ARGUMENT,"JSON must be an object");let t;for(let r in e)if(e[r]){let i=e[r].typeString,s="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}let o=n[r];if(i&&typeof o!==i){t=`JSON field '${r}' must be a ${i}.`;break}if(s!==void 0&&o!==s.value){t=`Expected '${r}' field to equal '${s.value}'`;break}}if(t)throw new N(R.INVALID_ARGUMENT,t);return!0}function bh(n){return n.fields.find(e=>e.kind===2)}function Sr(n){return n.fields.filter(e=>e.kind!==2)}function b0(n,e){let t=te(n.collectionGroup,e.collectionGroup);if(t!==0)return t;for(let r=0;r<Math.min(n.fields.length,e.fields.length);++r)if(t=A0(n.fields[r],e.fields[r]),t!==0)return t;return te(n.fields.length,e.fields.length)}function A0(n,e){let t=Be.comparator(n.fieldPath,e.fieldPath);return t!==0?t:te(n.kind,e.kind)}function y_(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=ee.fromTimestamp(r===1e9?new Re(t+1,0):new Re(t,r));return new Pt(i,q.empty(),e)}function __(n){return new Pt(n.readTime,n.key,Di)}function Sf(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=q.comparator(n.documentKey,e.documentKey),t!==0?t:te(n.largestBatchId,e.largestBatchId))}async function sr(n){if(n.code!==R.FAILED_PRECONDITION||n.message!==v_)throw n;V("LocalStore","Unexpectedly lost primary lease")}function w_(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function or(n){return n.name==="IndexedDbTransactionError"}function Pr(n){return new P((e,t)=>{n.onsuccess=r=>{let i=r.target.result;e(i)},n.onerror=r=>{let i=Rf(r.target.error);t(i)}})}function Rf(n){let e=Wn.M(Fe());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){let r=new N("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return ry||(ry=!0,setTimeout(()=>{throw r},0)),r}}return n}function $o(n){return n==null}function uo(n){return n===0&&1/n==-1/0}function I_(n){return typeof n=="number"&&Number.isInteger(n)&&!uo(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function at(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=iy(e)),e=S0(n.get(t),e);return iy(e)}function S0(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+="";break;case Ic:t+="";break;default:t+=s}}return t}function iy(n){return n+Ic+""}function Kt(n){let e=n.length;if(Y(e>=2,64408,{path:n}),e===2)return Y(n.charAt(0)===Ic&&n.charAt(1)==="",56145,{path:n}),fe.emptyPath();let t=e-2,r=[],i="";for(let s=0;s<e;){let o=n.indexOf(Ic,s);switch((o<0||o>t)&&W(50515,{path:n}),n.charAt(o+1)){case"":let c=n.substring(s,o),u;i.length===0?u=c:(i+=c,u=i,i=""),r.push(u);break;case"":i+=n.substring(s,o),i+="\0";break;case"":i+=n.substring(s,o+1);break;default:W(61167,{path:n})}s=o+2}return new fe(r)}function cc(n,e){return[n,at(e)]}function E_(n,e,t){return[n,at(e),t]}function Je(n,e){let t=B(n);return Wn.N(t.ce,e)}function ay(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function ar(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function D_(n,e){let t=[];for(let r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.push(e(n[r],r,n));return t}function N_(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function yi(n){return n.hasNext()?n.getNext():void 0}function X0(){return typeof atob<"u"}function En(n){if(Y(!!n,39018),typeof n=="string"){let e=0,t=Z0.exec(n);if(Y(!!t,46558,{timestamp:n}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:ke(n.seconds),nanos:ke(n.nanos)}}function ke(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Tn(n){return typeof n=="string"?Me.fromBase64String(n):Me.fromUint8Array(n)}function bu(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[V_])===null||t===void 0?void 0:t.stringValue)===O_}function Au(n){let e=n.mapValue.fields[L_];return bu(e)?Au(e):e}function mo(n){let e=En(n.mapValue.fields[M_].timestampValue);return new Re(e.seconds,e.nanos)}function Kn(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?bu(n)?4:U_(n)?9007199254740991:Su(n)?10:11:W(28295,{value:n})}function en(n,e){if(n===e)return!0;let t=Kn(n);if(t!==Kn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return mo(n).isEqual(mo(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let o=En(i.timestampValue),c=En(s.timestampValue);return o.seconds===c.seconds&&o.nanos===c.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,s){return Tn(i.bytesValue).isEqual(Tn(s.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return ke(i.geoPointValue.latitude)===ke(s.geoPointValue.latitude)&&ke(i.geoPointValue.longitude)===ke(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return ke(i.integerValue)===ke(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let o=ke(i.doubleValue),c=ke(s.doubleValue);return o===c?uo(o)===uo(c):isNaN(o)&&isNaN(c)}return!1}(n,e);case 9:return xi(n.arrayValue.values||[],e.arrayValue.values||[],en);case 10:case 11:return function(i,s){let o=i.mapValue.fields||{},c=s.mapValue.fields||{};if(ay(o)!==ay(c))return!1;for(let u in o)if(o.hasOwnProperty(u)&&(c[u]===void 0||!en(o[u],c[u])))return!1;return!0}(n,e);default:return W(52216,{left:n})}}function yo(n,e){return(n.values||[]).find(t=>en(t,e))!==void 0}function Qn(n,e){if(n===e)return 0;let t=Kn(n),r=Kn(e);if(t!==r)return te(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return te(n.booleanValue,e.booleanValue);case 2:return function(s,o){let c=ke(s.integerValue||s.doubleValue),u=ke(o.integerValue||o.doubleValue);return c<u?-1:c>u?1:c===u?0:isNaN(c)?isNaN(u)?0:-1:1}(n,e);case 3:return cy(n.timestampValue,e.timestampValue);case 4:return cy(mo(n),mo(e));case 5:return Eh(n.stringValue,e.stringValue);case 6:return function(s,o){let c=Tn(s),u=Tn(o);return c.compareTo(u)}(n.bytesValue,e.bytesValue);case 7:return function(s,o){let c=s.split("/"),u=o.split("/");for(let h=0;h<c.length&&h<u.length;h++){let f=te(c[h],u[h]);if(f!==0)return f}return te(c.length,u.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,o){let c=te(ke(s.latitude),ke(o.latitude));return c!==0?c:te(ke(s.longitude),ke(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return uy(n.arrayValue,e.arrayValue);case 10:return function(s,o){var c,u,h,f;let p=s.fields||{},g=o.fields||{},w=(c=p[Fi])===null||c===void 0?void 0:c.arrayValue,k=(u=g[Fi])===null||u===void 0?void 0:u.arrayValue,D=te(((h=w?.values)===null||h===void 0?void 0:h.length)||0,((f=k?.values)===null||f===void 0?void 0:f.length)||0);return D!==0?D:uy(w,k)}(n.mapValue,e.mapValue);case 11:return function(s,o){if(s===qn.mapValue&&o===qn.mapValue)return 0;if(s===qn.mapValue)return 1;if(o===qn.mapValue)return-1;let c=s.fields||{},u=Object.keys(c),h=o.fields||{},f=Object.keys(h);u.sort(),f.sort();for(let p=0;p<u.length&&p<f.length;++p){let g=Eh(u[p],f[p]);if(g!==0)return g;let w=Qn(c[u[p]],h[f[p]]);if(w!==0)return w}return te(u.length,f.length)}(n.mapValue,e.mapValue);default:throw W(23264,{le:t})}}function cy(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return te(n,e);let t=En(n),r=En(e),i=te(t.seconds,r.seconds);return i!==0?i:te(t.nanos,r.nanos)}function uy(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let s=Qn(t[i],r[i]);if(s)return s}return te(t.length,r.length)}function Ui(n){return Nh(n)}function Nh(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){let r=En(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return Tn(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return q.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(let s of t.values||[])i?i=!1:r+=",",r+=Nh(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){let r=Object.keys(t.fields||{}).sort(),i="{",s=!0;for(let o of r)s?s=!1:i+=",",i+=`${o}:${Nh(t.fields[o])}`;return i+"}"}(n.mapValue):W(61005,{value:n})}function hc(n){switch(Kn(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let e=Au(n);return e?16+hc(e):16;case 5:return 2*n.stringValue.length;case 6:return Tn(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((i,s)=>i+hc(s),0)}(n.arrayValue);case 10:case 11:return function(r){let i=0;return ar(r.fields,(s,o)=>{i+=s.length+hc(o)}),i}(n.mapValue);default:throw W(13486,{value:n})}}function Fr(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Oh(n){return!!n&&"integerValue"in n}function _o(n){return!!n&&"arrayValue"in n}function ly(n){return!!n&&"nullValue"in n}function hy(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function dc(n){return!!n&&"mapValue"in n}function Su(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[Df])===null||t===void 0?void 0:t.stringValue)===Nf}function ro(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return ar(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=ro(r)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=ro(n.arrayValue.values[t]);return e}return Object.assign({},n)}function U_(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===F_}function eb(n){return"nullValue"in n?lc:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Fr(Mr.empty(),q.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?Su(n)?B_:{mapValue:{}}:W(35942,{value:n})}function tb(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Fr(Mr.empty(),q.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?B_:"mapValue"in n?Su(n)?{mapValue:{}}:qn:W(61959,{value:n})}function dy(n,e){let t=Qn(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function fy(n,e){let t=Qn(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}function j_(n){let e=[];return ar(n.fields,(t,r)=>{let i=new Be([t]);if(dc(r)){let s=j_(r.mapValue).fields;if(s.length===0)e.push(i);else for(let o of s)e.push(i.child(o))}else e.push(i)}),new bt(e)}function py(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],o=n.position[i];if(s.field.isKeyField()?r=q.comparator(q.fromName(o.referenceValue),t.key):r=Qn(o,t.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function my(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!en(n.position[t],e.position[t]))return!1;return!0}function nb(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}function Bi(n){return n.op==="and"}function Vh(n){return n.op==="or"}function Of(n){return q_(n)&&Bi(n)}function q_(n){for(let e of n.filters)if(e instanceof ve)return!1;return!0}function Lh(n){if(n instanceof pe)return n.field.canonicalString()+n.op.toString()+Ui(n.value);if(Of(n))return n.filters.map(e=>Lh(e)).join(",");{let e=n.filters.map(t=>Lh(t)).join(",");return`${n.op}(${e})`}}function z_(n,e){return n instanceof pe?function(r,i){return i instanceof pe&&r.op===i.op&&r.field.isEqual(i.field)&&en(r.value,i.value)}(n,e):n instanceof ve?function(r,i){return i instanceof ve&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,o,c)=>s&&z_(o,i.filters[c]),!0):!1}(n,e):void W(19439)}function $_(n,e){let t=n.filters.concat(e);return ve.create(t,n.op)}function H_(n){return n instanceof pe?function(t){return`${t.field.canonicalString()} ${t.op} ${Ui(t.value)}`}(n):n instanceof ve?function(t){return t.op.toString()+" {"+t.getFilters().map(H_).join(" ,")+"}"}(n):"Filter"}function G_(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>q.fromName(r.referenceValue))}function $h(n,e=null,t=[],r=[],i=null,s=null,o=null){return new zh(n,e,t,r,i,s,o)}function Br(n){let e=B(n);if(e.Pe===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Lh(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),$o(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Ui(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Ui(r)).join(",")),e.Pe=t}return e.Pe}function Go(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!nb(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!z_(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!my(n.startAt,e.startAt)&&my(n.endAt,e.endAt)}function Pc(n){return q.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Cc(n,e){return n.filters.filter(t=>t instanceof pe&&t.field.isEqual(e))}function gy(n,e,t){let r=lc,i=!0;for(let s of Cc(n,e)){let o=lc,c=!0;switch(s.op){case"<":case"<=":o=eb(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,c=!1;break;case"!=":case"not-in":o=lc}dy({value:r,inclusive:i},{value:o,inclusive:c})<0&&(r=o,i=c)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];dy({value:r,inclusive:i},{value:o,inclusive:t.inclusive})<0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}function yy(n,e,t){let r=qn,i=!0;for(let s of Cc(n,e)){let o=qn,c=!0;switch(s.op){case">=":case">":o=tb(s.value),c=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,c=!1;break;case"!=":case"not-in":o=qn}fy({value:r,inclusive:i},{value:o,inclusive:c})>0&&(r=o,i=c)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];fy({value:r,inclusive:i},{value:o,inclusive:t.inclusive})>0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}function W_(n,e,t,r,i,s,o,c){return new Ft(n,e,t,r,i,s,o,c)}function es(n){return new Ft(n)}function _y(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Vf(n){return n.collectionGroup!==null}function Ri(n){let e=B(n);if(e.Te===null){e.Te=[];let t=new Set;for(let s of e.explicitOrderBy)e.Te.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let c=new Ee(Be.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(h=>{h.isInequality()&&(c=c.add(h.field))})}),c})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.Te.push(new Ur(s,r))}),t.has(Be.keyField().canonicalString())||e.Te.push(new Ur(Be.keyField(),r))}return e.Te}function ct(n){let e=B(n);return e.Ie||(e.Ie=Q_(e,Ri(n))),e.Ie}function K_(n){let e=B(n);return e.de||(e.de=Q_(e,n.explicitOrderBy)),e.de}function Q_(n,e){if(n.limitType==="F")return $h(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new Ur(i.field,s)});let t=n.endAt?new tn(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new tn(n.startAt.position,n.startAt.inclusive):null;return $h(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Hh(n,e){let t=n.filters.concat([e]);return new Ft(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function kc(n,e,t){return new Ft(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Wo(n,e){return Go(ct(n),ct(e))&&n.limitType===e.limitType}function Y_(n){return`${Br(ct(n))}|lt:${n.limitType}`}function Ti(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>H_(i)).join(", ")}]`),$o(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>Ui(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>Ui(i)).join(",")),`Target(${r})`}(ct(n))}; limitType=${n.limitType})`}function Ko(n,e){return e.isFoundDocument()&&function(r,i){let s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):q.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(let s of Ri(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(n,e)&&function(r,i){for(let s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&function(r,i){return!(r.startAt&&!function(o,c,u){let h=py(o,c,u);return o.inclusive?h<=0:h<0}(r.startAt,Ri(r),i)||r.endAt&&!function(o,c,u){let h=py(o,c,u);return o.inclusive?h>=0:h>0}(r.endAt,Ri(r),i))}(n,e)}function J_(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function X_(n){return(e,t)=>{let r=!1;for(let i of Ri(n)){let s=rb(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function rb(n,e,t){let r=n.field.isKeyField()?q.comparator(e.key,t.key):function(s,o,c){let u=o.data.field(s),h=c.data.field(s);return u!==null&&h!==null?Qn(u,h):W(42886)}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return W(19790,{direction:n.dir})}}function gt(){return ib}function Xs(...n){let e=Z_;for(let t of n)e=e.insert(t.key,t);return e}function ev(n){let e=Z_;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Qt(){return io()}function tv(){return io()}function io(){return new Ut(n=>n.toString(),(n,e)=>n.isEqual(e))}function ie(...n){let e=ob;for(let t of n)e=e.add(t);return e}function Lf(){return ab}function Mf(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:uo(e)?"-0":e}}function nv(n){return{integerValue:""+n}}function rv(n,e){return I_(e)?nv(e):Mf(n,e)}function cb(n,e,t){return n instanceof Yn?function(i,s){let o={fields:{[V_]:{stringValue:O_},[M_]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&bu(s)&&(s=Au(s)),s&&(o.fields[L_]=s),{mapValue:o}}(t,e):n instanceof bn?sv(n,e):n instanceof An?ov(n,e):function(i,s){let o=iv(i,s),c=vy(o)+vy(i.Ee);return Oh(o)&&Oh(i.Ee)?nv(c):Mf(i.serializer,c)}(n,e)}function ub(n,e,t){return n instanceof bn?sv(n,e):n instanceof An?ov(n,e):t}function iv(n,e){return n instanceof Jn?function(r){return Oh(r)||function(s){return!!s&&"doubleValue"in s}(r)}(e)?e:{integerValue:0}:null}function sv(n,e){let t=av(e);for(let r of n.elements)t.some(i=>en(i,r))||t.push(r);return{arrayValue:{values:t}}}function ov(n,e){let t=av(e);for(let r of n.elements)t=t.filter(i=>!en(i,r));return{arrayValue:{values:t}}}function vy(n){return ke(n.integerValue||n.doubleValue)}function av(n){return _o(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function lb(n,e){return n.field.isEqual(e.field)&&function(r,i){return r instanceof bn&&i instanceof bn||r instanceof An&&i instanceof An?xi(r.elements,i.elements,en):r instanceof Jn&&i instanceof Jn?en(r.Ee,i.Ee):r instanceof Yn&&i instanceof Yn}(n.transform,e.transform)}function fc(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}function cv(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Zn(n.key,Le.none()):new Xn(n.key,n.data,Le.none());{let t=n.data,r=st.empty(),i=new Ee(Be.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new Bt(n.key,r,new bt(i.toArray()),Le.none())}}function hb(n,e,t){n instanceof Xn?function(i,s,o){let c=i.value.clone(),u=Iy(i.fieldTransforms,s,o.transformResults);c.setAll(u),s.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(n,e,t):n instanceof Bt?function(i,s,o){if(!fc(i.precondition,s))return void s.convertToUnknownDocument(o.version);let c=Iy(i.fieldTransforms,s,o.transformResults),u=s.data;u.setAll(uv(i)),u.setAll(c),s.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(n,e,t):function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function so(n,e,t,r){return n instanceof Xn?function(s,o,c,u){if(!fc(s.precondition,o))return c;let h=s.value.clone(),f=Ey(s.fieldTransforms,u,o);return h.setAll(f),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),null}(n,e,t,r):n instanceof Bt?function(s,o,c,u){if(!fc(s.precondition,o))return c;let h=Ey(s.fieldTransforms,u,o),f=o.data;return f.setAll(uv(s)),f.setAll(h),o.convertToFoundDocument(o.version,f).setHasLocalMutations(),c===null?null:c.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(p=>p.field))}(n,e,t,r):function(s,o,c){return fc(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):c}(n,e,t)}function db(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=iv(r.transform,i||null);s!=null&&(t===null&&(t=st.empty()),t.set(r.field,s))}return t||null}function wy(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&xi(r,i,(s,o)=>lb(s,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}function uv(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function Iy(n,e,t){let r=new Map;Y(n.length===t.length,32656,{Ae:t.length,Re:n.length});for(let i=0;i<t.length;i++){let s=n[i],o=s.transform,c=e.data.field(s.field);r.set(s.field,ub(o,c,t[i]))}return r}function Ey(n,e,t){let r=new Map;for(let i of n){let s=i.transform,o=t.data.field(i.field);r.set(i.field,cb(s,o,e))}return r}function lv(n){switch(n){case R.OK:return W(64938);case R.CANCELLED:case R.UNKNOWN:case R.DEADLINE_EXCEEDED:case R.RESOURCE_EXHAUSTED:case R.INTERNAL:case R.UNAVAILABLE:case R.UNAUTHENTICATED:return!1;case R.INVALID_ARGUMENT:case R.NOT_FOUND:case R.ALREADY_EXISTS:case R.PERMISSION_DENIED:case R.FAILED_PRECONDITION:case R.ABORTED:case R.OUT_OF_RANGE:case R.UNIMPLEMENTED:case R.DATA_LOSS:return!0;default:return W(15467,{code:n})}}function hv(n){if(n===void 0)return Ue("GRPC error has no .code"),R.UNKNOWN;switch(n){case qe.OK:return R.OK;case qe.CANCELLED:return R.CANCELLED;case qe.UNKNOWN:return R.UNKNOWN;case qe.DEADLINE_EXCEEDED:return R.DEADLINE_EXCEEDED;case qe.RESOURCE_EXHAUSTED:return R.RESOURCE_EXHAUSTED;case qe.INTERNAL:return R.INTERNAL;case qe.UNAVAILABLE:return R.UNAVAILABLE;case qe.UNAUTHENTICATED:return R.UNAUTHENTICATED;case qe.INVALID_ARGUMENT:return R.INVALID_ARGUMENT;case qe.NOT_FOUND:return R.NOT_FOUND;case qe.ALREADY_EXISTS:return R.ALREADY_EXISTS;case qe.PERMISSION_DENIED:return R.PERMISSION_DENIED;case qe.FAILED_PRECONDITION:return R.FAILED_PRECONDITION;case qe.ABORTED:return R.ABORTED;case qe.OUT_OF_RANGE:return R.OUT_OF_RANGE;case qe.UNIMPLEMENTED:return R.UNIMPLEMENTED;case qe.DATA_LOSS:return R.DATA_LOSS;default:return W(39323,{code:n})}}function Ty(n){let e=bf().encode(n),t=new rh;return t.update(e),new Uint8Array(t.digest())}function by(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new yn([t,r],0),new yn([i,s],0)]}function nc(){return new Pe(q.comparator)}function Ay(){return new Pe(q.comparator)}function Xh(n,e){return n.useProto3Json||$o(e)?e:{value:e}}function zi(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function dv(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function yb(n,e){return zi(n,e.toTimestamp())}function je(n){return Y(!!n,49232),ee.fromTimestamp(function(t){let r=En(t);return new Re(r.seconds,r.nanos)}(n))}function Ff(n,e){return Zh(n,e).canonicalString()}function Zh(n,e){let t=function(i){return new fe(["projects",i.projectId,"databases",i.database])}(n).child("documents");return e===void 0?t:t.child(e)}function fv(n){let e=fe.fromString(n);return Y(Ev(e),10190,{key:e.toString()}),e}function bo(n,e){return Ff(n.databaseId,e.path)}function Jt(n,e){let t=fv(e);if(t.get(1)!==n.databaseId.projectId)throw new N(R.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new N(R.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new q(gv(t))}function pv(n,e){return Ff(n.databaseId,e)}function mv(n){let e=fv(n);return e.length===4?fe.emptyPath():gv(e)}function ed(n){return new fe(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function gv(n){return Y(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function Sy(n,e,t){return{name:bo(n,e),fields:t.value.mapValue.fields}}function Ru(n,e,t){let r=Jt(n,e.name),i=je(e.updateTime),s=e.createTime?je(e.createTime):ee.min(),o=new st({mapValue:{fields:e.fields}}),c=We.newFoundDocument(r,i,s,o);return t&&c.setHasCommittedMutations(),t?c.setHasCommittedMutations():c}function _b(n,e){return"found"in e?function(r,i){Y(!!i.found,43571),i.found.name,i.found.updateTime;let s=Jt(r,i.found.name),o=je(i.found.updateTime),c=i.found.createTime?je(i.found.createTime):ee.min(),u=new st({mapValue:{fields:i.found.fields}});return We.newFoundDocument(s,o,c,u)}(n,e):"missing"in e?function(r,i){Y(!!i.missing,3894),Y(!!i.readTime,22933);let s=Jt(r,i.missing),o=je(i.readTime);return We.newNoDocument(s,o)}(n,e):W(7234,{result:e})}function vb(n,e){let t;if("targetChange"in e){e.targetChange;let r=function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:W(39313,{state:h})}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(h,f){return h.useProto3Json?(Y(f===void 0||typeof f=="string",58123),Me.fromBase64String(f||"")):(Y(f===void 0||f instanceof Buffer||f instanceof Uint8Array,16193),Me.fromUint8Array(f||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,c=o&&function(h){let f=h.code===void 0?R.UNKNOWN:hv(h.code);return new N(f,h.message||"")}(o);t=new Oc(r,i,s,c||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=Jt(n,r.document.name),s=je(r.document.updateTime),o=r.document.createTime?je(r.document.createTime):ee.min(),c=new st({mapValue:{fields:r.document.fields}}),u=We.newFoundDocument(i,s,o,c),h=r.targetIds||[],f=r.removedTargetIds||[];t=new Pi(h,f,u.key,u)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=Jt(n,r.document),s=r.readTime?je(r.readTime):ee.min(),o=We.newNoDocument(i,s),c=r.removedTargetIds||[];t=new Pi([],c,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=Jt(n,r.document),s=r.removedTargetIds||[];t=new Pi([],s,i,null)}else{if(!("filter"in e))return W(11601,{At:e});{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new Kh(i,s),c=r.targetId;t=new Nc(c,o)}}return t}function Ao(n,e){let t;if(e instanceof Xn)t={update:Sy(n,e.key,e.value)};else if(e instanceof Zn)t={delete:bo(n,e.key)};else if(e instanceof Bt)t={update:Sy(n,e.key,e.data),updateMask:Ab(e.fieldMask)};else{if(!(e instanceof vo))return W(16599,{Rt:e.type});t={verify:bo(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,o){let c=o.transform;if(c instanceof Yn)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof bn)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof An)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof Jn)return{fieldPath:o.field.canonicalString(),increment:c.Ee};throw W(20930,{transform:o.transform})}(0,r))),e.precondition.isNone||(t.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:yb(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:W(27497)}(n,e.precondition)),t}function td(n,e){let t=e.currentDocument?function(s){return s.updateTime!==void 0?Le.updateTime(je(s.updateTime)):s.exists!==void 0?Le.exists(s.exists):Le.none()}(e.currentDocument):Le.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(o,c){let u=null;if("setToServerValue"in c)Y(c.setToServerValue==="REQUEST_TIME",16630,{proto:c}),u=new Yn;else if("appendMissingElements"in c){let f=c.appendMissingElements.values||[];u=new bn(f)}else if("removeAllFromArray"in c){let f=c.removeAllFromArray.values||[];u=new An(f)}else"increment"in c?u=new Jn(o,c.increment):W(16584,{proto:c});let h=Be.fromServerFormat(c.fieldPath);return new jr(h,u)}(n,i)):[];if(e.update){e.update.name;let i=Jt(n,e.update.name),s=new st({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=function(u){let h=u.fieldPaths||[];return new bt(h.map(f=>Be.fromServerFormat(f)))}(e.updateMask);return new Bt(i,s,o,t,r)}return new Xn(i,s,t,r)}if(e.delete){let i=Jt(n,e.delete);return new Zn(i,t)}if(e.verify){let i=Jt(n,e.verify);return new vo(i,t)}return W(1463,{proto:e})}function wb(n,e){return n&&n.length>0?(Y(e!==void 0,14353),n.map(t=>function(i,s){let o=i.updateTime?je(i.updateTime):je(s);return o.isEqual(ee.min())&&(o=je(s)),new Gh(o,i.transformResults||[])}(t,e))):[]}function yv(n,e){return{documents:[pv(n,e.path)]}}function Pu(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=pv(n,i);let s=function(h){if(h.length!==0)return Iv(ve.create(h,"and"))}(e.filters);s&&(t.structuredQuery.where=s);let o=function(h){if(h.length!==0)return h.map(f=>function(g){return{field:Bn(g.field),direction:Eb(g.dir)}}(f))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);let c=Xh(n,e.limit);return c!==null&&(t.structuredQuery.limit=c),e.startAt&&(t.structuredQuery.startAt=function(h){return{before:h.inclusive,values:h.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(h){return{before:!h.inclusive,values:h.position}}(e.endAt)),{Vt:t,parent:i}}function _v(n,e,t,r){let{Vt:i,parent:s}=Pu(n,e),o={},c=[],u=0;return t.forEach(h=>{let f=r?h.alias:"aggregate_"+u++;o[f]=h.alias,h.aggregateType==="count"?c.push({alias:f,count:{}}):h.aggregateType==="avg"?c.push({alias:f,avg:{field:Bn(h.fieldPath)}}):h.aggregateType==="sum"&&c.push({alias:f,sum:{field:Bn(h.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:c,structuredQuery:i.structuredQuery},parent:i.parent},ft:o,parent:s}}function vv(n){let e=mv(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){Y(r===1,65062);let f=t.from[0];f.allDescendants?i=f.collectionId:e=e.child(f.collectionId)}let s=[];t.where&&(s=function(p){let g=wv(p);return g instanceof ve&&Of(g)?g.getFilters():[g]}(t.where));let o=[];t.orderBy&&(o=function(p){return p.map(g=>function(k){return new Ur(bi(k.field),function(C){switch(C){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(k.direction))}(g))}(t.orderBy));let c=null;t.limit&&(c=function(p){let g;return g=typeof p=="object"?p.value:p,$o(g)?null:g}(t.limit));let u=null;t.startAt&&(u=function(p){let g=!!p.before,w=p.values||[];return new tn(w,g)}(t.startAt));let h=null;return t.endAt&&(h=function(p){let g=!p.before,w=p.values||[];return new tn(w,g)}(t.endAt)),W_(e,i,o,s,c,"F",u,h)}function Ib(n,e){let t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return W(28987,{purpose:i})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function wv(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let r=bi(t.unaryFilter.field);return pe.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=bi(t.unaryFilter.field);return pe.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=bi(t.unaryFilter.field);return pe.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=bi(t.unaryFilter.field);return pe.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return W(61313);default:return W(60726)}}(n):n.fieldFilter!==void 0?function(t){return pe.create(bi(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return W(58110);default:return W(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return ve.create(t.compositeFilter.filters.map(r=>wv(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return W(1026)}}(t.compositeFilter.op))}(n):W(30097,{filter:n})}function Eb(n){return pb[n]}function Tb(n){return mb[n]}function bb(n){return gb[n]}function Bn(n){return{fieldPath:n.canonicalString()}}function bi(n){return Be.fromServerFormat(n.fieldPath)}function Iv(n){return n instanceof pe?function(t){if(t.op==="=="){if(hy(t.value))return{unaryFilter:{field:Bn(t.field),op:"IS_NAN"}};if(ly(t.value))return{unaryFilter:{field:Bn(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(hy(t.value))return{unaryFilter:{field:Bn(t.field),op:"IS_NOT_NAN"}};if(ly(t.value))return{unaryFilter:{field:Bn(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Bn(t.field),op:Tb(t.op),value:t.value}}}(n):n instanceof ve?function(t){let r=t.getFilters().map(i=>Iv(i));return r.length===1?r[0]:{compositeFilter:{op:bb(t.op),filters:r}}}(n):W(54877,{filter:n})}function Ab(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Ev(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}function Sb(n,e){let t;if(e.document)t=Ru(n.gt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let r=q.fromSegments(e.noDocument.path),i=zr(e.noDocument.readTime);t=We.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return W(56709);{let r=q.fromSegments(e.unknownDocument.path),i=zr(e.unknownDocument.version);t=We.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime(function(i){let s=new Re(i[0],i[1]);return ee.fromTimestamp(s)}(e.readTime)),t}function Ry(n,e){let t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Mc(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(s,o){return{name:bo(s,o.key),fields:o.data.value.mapValue.fields,updateTime:zi(s,o.version.toTimestamp()),createTime:zi(s,o.createTime.toTimestamp())}}(n.gt,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:qr(e.version)};else{if(!e.isUnknownDocument())return W(57904,{document:e});r.unknownDocument={path:t.path.toArray(),version:qr(e.version)}}return r}function Mc(n){let e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function qr(n){let e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function zr(n){let e=new Re(n.seconds,n.nanoseconds);return ee.fromTimestamp(e)}function Cr(n,e){let t=(e.baseMutations||[]).map(s=>td(n.gt,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let c=e.mutations[s+1];o.updateTransforms=c.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let r=e.mutations.map(s=>td(n.gt,s)),i=Re.fromMillis(e.localWriteTimeMs);return new wo(e.batchId,i,t,r)}function Zs(n){let e=zr(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?zr(n.lastLimboFreeSnapshotVersion):ee.min(),r;return r=function(s){return s.documents!==void 0}(n.query)?function(s){let o=s.documents.length;return Y(o===1,1966,{count:o}),ct(es(mv(s.documents[0])))}(n.query):function(s){return ct(vv(s))}(n.query),new $i(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Me.fromBase64String(n.resumeToken))}function Tv(n,e){let t=qr(e.snapshotVersion),r=qr(e.lastLimboFreeSnapshotVersion),i;i=Pc(e.target)?yv(n.gt,e.target):Pu(n.gt,e.target).Vt;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Br(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function Cu(n){let e=vv({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?kc(e,e.limit,"L"):e}function uh(n,e){return new Io(e.largestBatchId,td(n.gt,e.overlayMutation))}function Py(n,e){let t=e.path.lastSegment();return[n,at(e.path.popLast()),t]}function Cy(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:qr(r.readTime),documentKey:at(r.documentKey.path),largestBatchId:r.largestBatchId}}function ky(n){return Je(n,Iu)}function xy(n){return Je(n,Eu)}function Ks(n){return Je(n,Tu)}function Rb(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n<<=4),n>>6||(e+=2,n<<=2),n>>7||(e+=1),e}function Dy(n){let e=64-function(r){let i=0;for(let s=0;s<8;++s){let o=Rb(255&r[s]);if(i+=o,o!==8)break}return i}(n);return Math.ceil(e/8)}function Mn(n,e){let t=n.Pn-e.Pn;return t!==0?t:(t=Ny(n.In,e.In),t!==0?t:(t=Ny(n.dn,e.dn),t!==0?t:q.comparator(n.Tn,e.Tn)))}function Ny(n,e){for(let t=0;t<n.length&&t<e.length;++t){let r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}function pc(n){return ul()?function(t){let r="";for(let i=0;i<t.length;i++)r+=String.fromCharCode(t[i]);return r}(n):n}function Oy(n){return typeof n!="string"?n:function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(n)}function bv(n){var e,t;if(Y(n instanceof pe||n instanceof ve,20012),n instanceof pe){if(n instanceof Rc){let i=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>pe.create(n.field,"==",s)))||[];return ve.create(i,"or")}return n}let r=n.filters.map(i=>bv(i));return ve.create(r,n.op)}function Pb(n){if(n.getFilters().length===0)return[];let e=ud(bv(n));return Y(Av(e),7391),ad(e)||cd(e)?[e]:e.getFilters()}function ad(n){return n instanceof pe}function cd(n){return n instanceof ve&&Of(n)}function Av(n){return ad(n)||cd(n)||function(t){if(t instanceof ve&&Vh(t)){for(let r of t.getFilters())if(!ad(r)&&!cd(r))return!1;return!0}return!1}(n)}function ud(n){if(Y(n instanceof pe||n instanceof ve,34018),n instanceof pe)return n;if(n.filters.length===1)return ud(n.filters[0]);let e=n.filters.map(r=>ud(r)),t=ve.create(e,n.op);return t=Bc(t),Av(t)?t:(Y(t instanceof ve,64498),Y(Bi(t),40251),Y(t.filters.length>1,57927),t.filters.reduce((r,i)=>Uf(r,i)))}function Uf(n,e){let t;return Y(n instanceof pe||n instanceof ve,38388),Y(e instanceof pe||e instanceof ve,25473),t=n instanceof pe?e instanceof pe?function(i,s){return ve.create([i,s],"and")}(n,e):Vy(n,e):e instanceof pe?Vy(e,n):function(i,s){if(Y(i.filters.length>0&&s.filters.length>0,48005),Bi(i)&&Bi(s))return $_(i,s.getFilters());let o=Vh(i)?i:s,c=Vh(i)?s:i,u=o.filters.map(h=>Uf(h,c));return ve.create(u,"or")}(n,e),Bc(t)}function Vy(n,e){if(Bi(e))return $_(e,n.getFilters());{let t=e.filters.map(r=>Uf(n,r));return ve.create(t,"or")}}function Bc(n){if(Y(n instanceof pe||n instanceof ve,11850),n instanceof pe)return n;let e=n.getFilters();if(e.length===1)return Bc(e[0]);if(q_(n))return n;let t=e.map(i=>Bc(i)),r=[];return t.forEach(i=>{i instanceof pe?r.push(i):i instanceof ve&&(i.op===n.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:ve.create(r,n.op)}function My(n){return Je(n,fo)}function vi(n){return Je(n,no)}function Qs(n){return Je(n,Cf)}function wi(n){return Je(n,to)}function Fy(n){Y(n.length!==0,28825);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){let i=n[r].indexState.offset;Sf(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new Pt(e.readTime,e.documentKey,t)}function Rv(n,e,t){let r=n.store(Vt),i=n.store(Oi),s=[],o=IDBKeyRange.only(t.batchId),c=0,u=r.X({range:o},(f,p,g)=>(c++,g.delete()));s.push(u.next(()=>{Y(c===1,47070,{batchId:t.batchId})}));let h=[];for(let f of t.mutations){let p=E_(e,f.key.path,t.batchId);s.push(i.delete(p)),h.push(f.key)}return P.waitFor(s).next(()=>h)}function jc(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw W(14731);e=n.noDocument}return JSON.stringify(e).length}function Pv(n,e,t){let r=cc(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r),o=!1;return Ai(n).X({range:s,Z:!0},(c,u,h)=>{let[f,p,g]=c;f===e&&p===i&&(o=!0),h.done()}).next(()=>o)}function Fn(n){return Je(n,Vt)}function Ai(n){return Je(n,Oi)}function Cv(n){return Je(n,lo)}function Ii(n){return Je(n,Vi)}function By(n){return Je(n,Vr)}function jn(n){return Je(n,Li)}function qy([n,e],[t,r]){let i=te(n,t);return i===0?te(e,r):i}function xv(n,e){return new pd(n,e)}function ic(n,e){return jn(n).put(function(r,i){return{targetId:0,path:at(r.path),sequenceNumber:i}}(e,n.currentSequenceNumber))}function Dv(n){return new gd(n)}function zy(n){return Je(n,ho)}function Ar(n){return Je(n,Ec)}function Ys(n){let e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function $y(n,e){let t=e.documentKey.path.toArray();return[n,Mc(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function Hy(n,e){let t=n.path.toArray(),r=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=te(t[s],r[s]),i)return i;return i=te(t.length,r.length),i||(i=te(t[t.length-2],r[r.length-2]),i||te(t[t.length-1],r[r.length-1]))}function Gy(n){n.createObjectStore(Li,{keyPath:N0}).createIndex(Pf,O0,{unique:!0}),n.createObjectStore(Vi,{keyPath:"targetId"}).createIndex(b_,D0,{unique:!0}),n.createObjectStore(Vr)}function Js(n){return Je(n,Ho)}function sc(n){return Je(n,Mi)}function Bf(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}function Ov(n,e,t,r){return new xd(n,e,t,r)}async function Vv(n,e){let t=B(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.Ns(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{let o=[],c=[],u=ie();for(let h of i){o.push(h.batchId);for(let f of h.mutations)u=u.add(f.key)}for(let h of s){c.push(h.batchId);for(let f of h.mutations)u=u.add(f.key)}return t.localDocuments.getDocuments(r,u).next(h=>({Bs:h,removedBatchIds:o,addedBatchIds:c}))})})}function kb(n,e){let t=B(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.Os.newChangeBuffer({trackRemovals:!0});return function(c,u,h,f){let p=h.batch,g=p.keys(),w=P.resolve();return g.forEach(k=>{w=w.next(()=>f.getEntry(u,k)).next(D=>{let C=h.docVersions.get(k);Y(C!==null,48541),D.version.compareTo(C)<0&&(p.applyToRemoteDocument(D,h),D.isValidDocument()&&(D.setReadTime(h.commitVersion),f.addEntry(D)))})}),w.next(()=>c.mutationQueue.removeMutationBatch(u,p))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(c){let u=ie();for(let h=0;h<c.mutationResults.length;++h)c.mutationResults[h].transformResults.length>0&&(u=u.add(c.batch.mutations[h].key));return u}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function Lv(n){let e=B(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.hi.getLastRemoteSnapshotVersion(t))}function xb(n,e){let t=B(n),r=e.snapshotVersion,i=t.Fs;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.Os.newChangeBuffer({trackRemovals:!0});i=t.Fs;let c=[];e.targetChanges.forEach((f,p)=>{let g=i.get(p);if(!g)return;c.push(t.hi.removeMatchingKeys(s,f.removedDocuments,p).next(()=>t.hi.addMatchingKeys(s,f.addedDocuments,p)));let w=g.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(p)!==null?w=w.withResumeToken(Me.EMPTY_BYTE_STRING,ee.min()).withLastLimboFreeSnapshotVersion(ee.min()):f.resumeToken.approximateByteSize()>0&&(w=w.withResumeToken(f.resumeToken,r)),i=i.insert(p,w),function(D,C,H){return D.resumeToken.approximateByteSize()===0||C.snapshotVersion.toMicroseconds()-D.snapshotVersion.toMicroseconds()>=Cb?!0:H.addedDocuments.size+H.modifiedDocuments.size+H.removedDocuments.size>0}(g,w,f)&&c.push(t.hi.updateTargetData(s,w))});let u=gt(),h=ie();if(e.documentUpdates.forEach(f=>{e.resolvedLimboDocuments.has(f)&&c.push(t.persistence.referenceDelegate.updateLimboDocument(s,f))}),c.push(Mv(s,o,e.documentUpdates).next(f=>{u=f.Ls,h=f.ks})),!r.isEqual(ee.min())){let f=t.hi.getLastRemoteSnapshotVersion(s).next(p=>t.hi.setTargetsMetadata(s,s.currentSequenceNumber,r));c.push(f)}return P.waitFor(c).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,u,h)).next(()=>u)}).then(s=>(t.Fs=i,s))}function Mv(n,e,t){let r=ie(),i=ie();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=gt();return t.forEach((c,u)=>{let h=s.get(c);u.isFoundDocument()!==h.isFoundDocument()&&(i=i.add(c)),u.isNoDocument()&&u.version.isEqual(ee.min())?(e.removeEntry(c,u.readTime),o=o.insert(c,u)):!h.isValidDocument()||u.version.compareTo(h.version)>0||u.version.compareTo(h.version)===0&&h.hasPendingWrites?(e.addEntry(u),o=o.insert(c,u)):V(jf,"Ignoring outdated watch update for ",c,". Current version:",h.version," Watch version:",u.version)}),{Ls:o,ks:i}})}function Db(n,e){let t=B(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=$n),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Gi(n,e){let t=B(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.hi.getTargetData(r,e).next(s=>s?(i=s,P.resolve(i)):t.hi.allocateTargetId(r).next(o=>(i=new $i(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.hi.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.Fs.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Fs=t.Fs.insert(r.targetId,r),t.Ms.set(e,r.targetId)),r})}async function Wi(n,e,t){let r=B(n),i=r.Fs.get(e),s=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i))}catch(o){if(!or(o))throw o;V(jf,`Failed to update sequence numbers for target ${e}: ${o}`)}r.Fs=r.Fs.remove(e),r.Ms.delete(i.target)}function Qc(n,e,t){let r=B(n),i=ee.min(),s=ie();return r.persistence.runTransaction("Execute query","readwrite",o=>function(u,h,f){let p=B(u),g=p.Ms.get(f);return g!==void 0?P.resolve(p.Fs.get(g)):p.hi.getTargetData(h,f)}(r,o,ct(e)).next(c=>{if(c)return i=c.lastLimboFreeSnapshotVersion,r.hi.getMatchingKeysForTargetId(o,c.targetId).next(u=>{s=u})}).next(()=>r.Cs.getDocumentsMatchingQuery(o,e,t?i:ee.min(),t?s:ie())).next(c=>(Bv(r,J_(e),c),{documents:c,qs:s})))}function Fv(n,e){let t=B(n),r=B(t.hi),i=t.Fs.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r.Et(s,e).next(o=>o?o.target:null))}function Uv(n,e){let t=B(n),r=t.xs.get(e)||ee.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.Os.getAllFromCollectionGroup(i,e,y_(r,Di),Number.MAX_SAFE_INTEGER)).then(i=>(Bv(t,e,i),i))}function Bv(n,e,t){let r=n.xs.get(e)||ee.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.xs.set(e,r)}async function Nb(n,e,t,r){let i=B(n),s=ie(),o=gt();for(let h of t){let f=e.Qs(h.metadata.name);h.document&&(s=s.add(f));let p=e.$s(h);p.setReadTime(e.Us(h.metadata.readTime)),o=o.insert(f,p)}let c=i.Os.newChangeBuffer({trackRemovals:!0}),u=await Gi(i,function(f){return ct(es(fe.fromString(`__bundle__/docs/${f}`)))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",h=>Mv(h,c,o).next(f=>(c.apply(h),f)).next(f=>i.hi.removeMatchingKeysForTargetId(h,u.targetId).next(()=>i.hi.addMatchingKeys(h,s,u.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(h,f.Ls,f.ks)).next(()=>f.Ls)))}async function Ob(n,e,t=ie()){let r=await Gi(n,ct(Cu(e.bundledQuery))),i=B(n);return i.persistence.runTransaction("Save named query","readwrite",s=>{let o=je(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return i.Ti.saveNamedQuery(s,e);let c=r.withResumeToken(Me.EMPTY_BYTE_STRING,o);return i.Fs=i.Fs.insert(c.targetId,c),i.hi.updateTargetData(s,c).next(()=>i.hi.removeMatchingKeysForTargetId(s,r.targetId)).next(()=>i.hi.addMatchingKeys(s,t,r.targetId)).next(()=>i.Ti.saveNamedQuery(s,e))})}function Wy(n,e){return`${jv}_${n}_${e}`}function Ky(n,e,t){let r=`${qv}_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function fh(n,e){return`${zv}_${n}_${e}`}function Od(){return oc===null?oc=function(){return 268435456+Math.round(2147483648*Math.random())}():oc++,"0x"+oc.toString(16)}function $v(){return typeof window<"u"?window:null}function mc(){return typeof document<"u"?document:null}function Yr(n){return new Jh(n,!0)}async function Qo(n){if(cr(n))for(let e of n.da)await e(!0)}async function ts(n){for(let e of n.da)await e(!1)}function ku(n,e){let t=B(n);t.Ta.has(e.targetId)||(t.Ta.set(e.targetId,e),$f(t)?zf(t):rs(t).x_()&&qf(t,e))}function Ki(n,e){let t=B(n),r=rs(t);t.Ta.delete(e),r.x_()&&Hv(t,e),t.Ta.size===0&&(r.x_()?r.B_():cr(t)&&t.Aa.set("Unknown"))}function qf(n,e){if(n.Ra.$e(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ee.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}rs(n).H_(e)}function Hv(n,e){n.Ra.$e(e),rs(n).Y_(e)}function zf(n){n.Ra=new Yh({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),Et:e=>n.Ta.get(e)||null,lt:()=>n.datastore.serializer.databaseId}),rs(n).start(),n.Aa.aa()}function $f(n){return cr(n)&&!rs(n).M_()&&n.Ta.size>0}function cr(n){return B(n).Ia.size===0}function Gv(n){n.Ra=void 0}async function Lb(n){n.Aa.set("Online")}async function Mb(n){n.Ta.forEach((e,t)=>{qf(n,e)})}async function Fb(n,e){Gv(n),$f(n)?(n.Aa.la(e),zf(n)):n.Aa.set("Unknown")}async function Ub(n,e,t){if(n.Aa.set("Online"),e instanceof Oc&&e.state===2&&e.cause)try{await async function(i,s){let o=s.cause;for(let c of s.targetIds)i.Ta.has(c)&&(await i.remoteSyncer.rejectListen(c,o),i.Ta.delete(c),i.Ra.removeTarget(c))}(n,e)}catch(r){V($r,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await tu(n,r)}else if(e instanceof Pi?n.Ra.Ye(e):e instanceof Nc?n.Ra.it(e):n.Ra.et(e),!t.isEqual(ee.min()))try{let r=await Lv(n.localStore);t.compareTo(r)>=0&&await function(s,o){let c=s.Ra.Pt(o);return c.targetChanges.forEach((u,h)=>{if(u.resumeToken.approximateByteSize()>0){let f=s.Ta.get(h);f&&s.Ta.set(h,f.withResumeToken(u.resumeToken,o))}}),c.targetMismatches.forEach((u,h)=>{let f=s.Ta.get(u);if(!f)return;s.Ta.set(u,f.withResumeToken(Me.EMPTY_BYTE_STRING,f.snapshotVersion)),Hv(s,u);let p=new $i(f.target,u,h,f.sequenceNumber);qf(s,p)}),s.remoteSyncer.applyRemoteEvent(c)}(n,t)}catch(r){V($r,"Failed to raise snapshot:",r),await tu(n,r)}}async function tu(n,e,t){if(!or(e))throw e;n.Ia.add(1),await ts(n),n.Aa.set("Offline"),t||(t=()=>Lv(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{V($r,"Retrying IndexedDB access"),await t(),n.Ia.delete(1),await Qo(n)})}function Wv(n,e){return e().catch(t=>tu(n,t,e))}async function ns(n){let e=B(n),t=er(e),r=e.Pa.length>0?e.Pa[e.Pa.length-1].batchId:$n;for(;Bb(e);)try{let i=await Db(e.localStore,r);if(i===null){e.Pa.length===0&&t.B_();break}r=i.batchId,jb(e,i)}catch(i){await tu(e,i)}Kv(e)&&Qv(e)}function Bb(n){return cr(n)&&n.Pa.length<10}function jb(n,e){n.Pa.push(e);let t=er(n);t.x_()&&t.Z_&&t.X_(e.mutations)}function Kv(n){return cr(n)&&!er(n).M_()&&n.Pa.length>0}function Qv(n){er(n).start()}async function qb(n){er(n).na()}async function zb(n){let e=er(n);for(let t of n.Pa)e.X_(t.mutations)}async function $b(n,e,t){let r=n.Pa.shift(),i=Wh.from(r,e,t);await Wv(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),await ns(n)}async function Hb(n,e){e&&er(n).Z_&&await async function(r,i){if(function(o){return lv(o)&&o!==R.ABORTED}(i.code)){let s=r.Pa.shift();er(r).N_(),await Wv(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),await ns(r)}}(n,e),Kv(n)&&Qv(n)}async function Jy(n,e){let t=B(n);t.asyncQueue.verifyOperationInProgress(),V($r,"RemoteStore received new credentials");let r=cr(t);t.Ia.add(3),await ts(t),r&&t.Aa.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ia.delete(3),await Qo(t)}async function $d(n,e){let t=B(n);e?(t.Ia.delete(2),await Qo(t)):e||(t.Ia.add(2),await ts(t),t.Aa.set("Unknown"))}function rs(n){return n.Va||(n.Va=function(t,r,i){let s=B(t);return s.ia(),new Fd(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Zo:Lb.bind(null,n),e_:Mb.bind(null,n),n_:Fb.bind(null,n),J_:Ub.bind(null,n)}),n.da.push(async e=>{e?(n.Va.N_(),$f(n)?zf(n):n.Aa.set("Unknown")):(await n.Va.stop(),Gv(n))})),n.Va}function er(n){return n.ma||(n.ma=function(t,r,i){let s=B(t);return s.ia(),new Ud(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Zo:()=>Promise.resolve(),e_:qb.bind(null,n),n_:Hb.bind(null,n),ea:zb.bind(null,n),ta:$b.bind(null,n)}),n.da.push(async e=>{e?(n.ma.N_(),await ns(n)):(await n.ma.stop(),n.Pa.length>0&&(V($r,`Stopping write stream with ${n.Pa.length} pending writes`),n.Pa=[]))})),n.ma}function is(n,e){if(Ue("AsyncQueue",`${e}: ${n}`),or(n))return new N(R.UNAVAILABLE,`${e}: ${n}`);throw n}function Xy(){return new Ut(n=>Y_(n),Wo)}async function Hf(n,e){let t=B(n),r=3,i=e.query,s=t.queries.get(i);s?!s.Sa()&&e.ba()&&(r=2):(s=new Gd,r=e.ba()?0:1);try{switch(r){case 0:s.ya=await t.onListen(i,!0);break;case 1:s.ya=await t.onListen(i,!1);break;case 2:await t.onFirstRemoteStoreListen(i)}}catch(o){let c=is(o,`Initialization of query '${Ti(e.query)}' failed`);return void e.onError(c)}t.queries.set(i,s),s.wa.push(e),e.va(t.onlineState),s.ya&&e.Ca(s.ya)&&Wf(t)}async function Gf(n,e){let t=B(n),r=e.query,i=3,s=t.queries.get(r);if(s){let o=s.wa.indexOf(e);o>=0&&(s.wa.splice(o,1),s.wa.length===0?i=e.ba()?0:1:!s.Sa()&&e.ba()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function Gb(n,e){let t=B(n),r=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let c of o.wa)c.Ca(i)&&(r=!0);o.ya=i}}r&&Wf(t)}function Wb(n,e,t){let r=B(n),i=r.queries.get(e);if(i)for(let s of i.wa)s.onError(t);r.queries.delete(e)}function Wf(n){n.Da.forEach(e=>{e.next()})}function Yv(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}async function Kb(n,e,t=!0){let r=xu(n),i,s=r.Pu.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.cu()):i=await Jv(r,e,t,!0),i}async function Qb(n,e){let t=xu(n);await Jv(t,e,!0,!1)}async function Jv(n,e,t,r){let i=await Gi(n.localStore,ct(e)),s=i.targetId,o=n.sharedClientState.addLocalQueryTarget(s,t),c;return r&&(c=await Kf(n,e,s,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&ku(n.remoteStore,i),c}async function Kf(n,e,t,r,i){n.gu=(p,g,w)=>async function(D,C,H,F){let z=C.view.nu(H);z.Ds&&(z=await Qc(D.localStore,C.query,!1).then(({documents:E})=>C.view.nu(E,z)));let ne=F&&F.targetChanges.get(C.targetId),se=F&&F.targetMismatches.get(C.targetId)!=null,re=C.view.applyChanges(z,D.isPrimaryClient,ne,se);return Xd(D,C.targetId,re._u),re.snapshot}(n,p,g,w);let s=await Qc(n.localStore,e,!0),o=new au(e,s.qs),c=o.nu(s.documents),u=To.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),h=o.applyChanges(c,n.isPrimaryClient,u);Xd(n,t,h._u);let f=new Qd(e,t,o);return n.Pu.set(e,f),n.Tu.has(t)?n.Tu.get(t).push(e):n.Tu.set(t,[e]),h.snapshot}async function Yb(n,e,t){let r=B(n),i=r.Pu.get(e),s=r.Tu.get(i.targetId);if(s.length>1)return r.Tu.set(i.targetId,s.filter(o=>!Wo(o,e))),void r.Pu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await Wi(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&Ki(r.remoteStore,i.targetId),Qi(r,i.targetId)}).catch(sr)):(Qi(r,i.targetId),await Wi(r.localStore,i.targetId,!0))}async function Jb(n,e){let t=B(n),r=t.Pu.get(e),i=t.Tu.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Ki(t.remoteStore,r.targetId))}async function Xb(n,e,t){let r=Xf(n);try{let i=await function(o,c){let u=B(o),h=Re.now(),f=c.reduce((w,k)=>w.add(k.key),ie()),p,g;return u.persistence.runTransaction("Locally write mutations","readwrite",w=>{let k=gt(),D=ie();return u.Os.getEntries(w,f).next(C=>{k=C,k.forEach((H,F)=>{F.isValidDocument()||(D=D.add(H))})}).next(()=>u.localDocuments.getOverlayedDocuments(w,k)).next(C=>{p=C;let H=[];for(let F of c){let z=db(F,p.get(F.key).overlayedDocument);z!=null&&H.push(new Bt(F.key,z,j_(z.value.mapValue),Le.exists(!0)))}return u.mutationQueue.addMutationBatch(w,h,H,c)}).next(C=>{g=C;let H=C.applyToLocalDocumentSet(p,D);return u.documentOverlayCache.saveOverlays(w,C.batchId,H)})}).then(()=>({batchId:g.batchId,changes:ev(p)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(o,c,u){let h=o.Ru[o.currentUser.toKey()];h||(h=new Pe(te)),h=h.insert(c,u),o.Ru[o.currentUser.toKey()]=h}(r,i.batchId,t),await Sn(r,i.changes),await ns(r.remoteStore)}catch(i){let s=is(i,"Failed to persist write");t.reject(s)}}async function Xv(n,e){let t=B(n);try{let r=await xb(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t.Eu.get(s);o&&(Y(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?o.lu=!0:i.modifiedDocuments.size>0?Y(o.lu,14607):i.removedDocuments.size>0&&(Y(o.lu,42227),o.lu=!1))}),await Sn(t,r,e)}catch(r){await sr(r)}}function e_(n,e,t){let r=B(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.Pu.forEach((s,o)=>{let c=o.view.va(e);c.snapshot&&i.push(c.snapshot)}),function(o,c){let u=B(o);u.onlineState=c;let h=!1;u.queries.forEach((f,p)=>{for(let g of p.wa)g.va(c)&&(h=!0)}),h&&Wf(u)}(r.eventManager,e),i.length&&r.hu.J_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function Zb(n,e,t){let r=B(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.Eu.get(e),s=i&&i.key;if(s){let o=new Pe(q.comparator);o=o.insert(s,We.newNoDocument(s,ee.min()));let c=ie().add(s),u=new Eo(ee.min(),new Map,new Pe(te),o,c);await Xv(r,u),r.du=r.du.remove(s),r.Eu.delete(e),Jf(r)}else await Wi(r.localStore,e,!1).then(()=>Qi(r,e,t)).catch(sr)}async function eA(n,e){let t=B(n),r=e.batch.batchId;try{let i=await kb(t.localStore,e);Yf(t,r,null),Qf(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Sn(t,i)}catch(i){await sr(i)}}async function tA(n,e,t){let r=B(n);try{let i=await function(o,c){let u=B(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let f;return u.mutationQueue.lookupMutationBatch(h,c).next(p=>(Y(p!==null,37113),f=p.keys(),u.mutationQueue.removeMutationBatch(h,p))).next(()=>u.mutationQueue.performConsistencyCheck(h)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(h,f,c)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,f)).next(()=>u.localDocuments.getDocuments(h,f))})}(r.localStore,e);Yf(r,e,t),Qf(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Sn(r,i)}catch(i){await sr(i)}}async function nA(n,e){let t=B(n);cr(t.remoteStore)||V(ur,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=await function(o){let c=B(o);return c.persistence.runTransaction("Get highest unacknowledged batch id","readonly",u=>c.mutationQueue.getHighestUnacknowledgedBatchId(u))}(t.localStore);if(r===$n)return void e.resolve();let i=t.Vu.get(r)||[];i.push(e),t.Vu.set(r,i)}catch(r){let i=is(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}}function Qf(n,e){(n.Vu.get(e)||[]).forEach(t=>{t.resolve()}),n.Vu.delete(e)}function Yf(n,e,t){let r=B(n),i=r.Ru[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.Ru[r.currentUser.toKey()]=i}}function Qi(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.Tu.get(e))n.Pu.delete(r),t&&n.hu.pu(r,t);n.Tu.delete(e),n.isPrimaryClient&&n.Au.zr(e).forEach(r=>{n.Au.containsKey(r)||Zv(n,r)})}function Zv(n,e){n.Iu.delete(e.path.canonicalString());let t=n.du.get(e);t!==null&&(Ki(n.remoteStore,t),n.du=n.du.remove(e),n.Eu.delete(t),Jf(n))}function Xd(n,e,t){for(let r of t)r instanceof su?(n.Au.addReference(r.key,e),rA(n,r)):r instanceof ou?(V(ur,"Document no longer in limbo: "+r.key),n.Au.removeReference(r.key,e),n.Au.containsKey(r.key)||Zv(n,r.key)):W(19791,{yu:r})}function rA(n,e){let t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Iu.has(r)||(V(ur,"New document in limbo: "+t),n.Iu.add(r),Jf(n))}function Jf(n){for(;n.Iu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){let e=n.Iu.values().next().value;n.Iu.delete(e);let t=new q(fe.fromString(e)),r=n.mu.next();n.Eu.set(r,new Yd(t)),n.du=n.du.insert(t,r),ku(n.remoteStore,new $i(ct(es(t.path)),r,"TargetPurposeLimboResolution",ot.ue))}}async function Sn(n,e,t){let r=B(n),i=[],s=[],o=[];r.Pu.isEmpty()||(r.Pu.forEach((c,u)=>{o.push(r.gu(u,e,t).then(h=>{var f;if((h||t)&&r.isPrimaryClient){let p=h?!h.fromCache:(f=t?.targetChanges.get(u.targetId))===null||f===void 0?void 0:f.current;r.sharedClientState.updateQueryState(u.targetId,p?"current":"not-current")}if(h){i.push(h);let p=Cd.Es(u.targetId,h);s.push(p)}}))}),await Promise.all(o),r.hu.J_(i),await async function(u,h){let f=B(u);try{await f.persistence.runTransaction("notifyLocalViewChanges","readwrite",p=>P.forEach(h,g=>P.forEach(g.Is,w=>f.persistence.referenceDelegate.addReference(p,g.targetId,w)).next(()=>P.forEach(g.ds,w=>f.persistence.referenceDelegate.removeReference(p,g.targetId,w)))))}catch(p){if(!or(p))throw p;V(jf,"Failed to update sequence numbers: "+p)}for(let p of h){let g=p.targetId;if(!p.fromCache){let w=f.Fs.get(g),k=w.snapshotVersion,D=w.withLastLimboFreeSnapshotVersion(k);f.Fs=f.Fs.insert(g,D)}}}(r.localStore,s))}async function iA(n,e){let t=B(n);if(!t.currentUser.isEqual(e)){V(ur,"User change. New user:",e.toKey());let r=await Vv(t.localStore,e);t.currentUser=e,function(s,o){s.Vu.forEach(c=>{c.forEach(u=>{u.reject(new N(R.CANCELLED,o))})}),s.Vu.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Sn(t,r.Bs)}}function sA(n,e){let t=B(n),r=t.Eu.get(e);if(r&&r.lu)return ie().add(r.key);{let i=ie(),s=t.Tu.get(e);if(!s)return i;for(let o of s){let c=t.Pu.get(o);i=i.unionWith(c.view.tu)}return i}}async function oA(n,e){let t=B(n),r=await Qc(t.localStore,e.query,!0),i=e.view.uu(r);return t.isPrimaryClient&&Xd(t,e.targetId,i._u),i}async function aA(n,e){let t=B(n);return Uv(t.localStore,e).then(r=>Sn(t,r))}async function cA(n,e,t,r){let i=B(n),s=await function(c,u){let h=B(c),f=B(h.mutationQueue);return h.persistence.runTransaction("Lookup mutation documents","readonly",p=>f.Xn(p,u).next(g=>g?h.localDocuments.getDocuments(p,g):P.resolve(null)))}(i.localStore,e);s!==null?(t==="pending"?await ns(i.remoteStore):t==="acknowledged"||t==="rejected"?(Yf(i,e,r||null),Qf(i,e),function(c,u){B(B(c).mutationQueue).rr(u)}(i.localStore,e)):W(6720,"Unknown batchState",{wu:t}),await Sn(i,s)):V(ur,"Cannot apply mutation batch with id: "+e)}async function uA(n,e){let t=B(n);if(xu(t),Xf(t),e===!0&&t.fu!==!0){let r=t.sharedClientState.getAllActiveQueryTargets(),i=await t_(t,r.toArray());t.fu=!0,await $d(t.remoteStore,!0);for(let s of i)ku(t.remoteStore,s)}else if(e===!1&&t.fu!==!1){let r=[],i=Promise.resolve();t.Tu.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(Qi(t,o),Wi(t.localStore,o,!0))),Ki(t.remoteStore,o)}),await i,await t_(t,r),function(o){let c=B(o);c.Eu.forEach((u,h)=>{Ki(c.remoteStore,h)}),c.Au.jr(),c.Eu=new Map,c.du=new Pe(q.comparator)}(t),t.fu=!1,await $d(t.remoteStore,!1)}}async function t_(n,e,t){let r=B(n),i=[],s=[];for(let o of e){let c,u=r.Tu.get(o);if(u&&u.length!==0){c=await Gi(r.localStore,ct(u[0]));for(let h of u){let f=r.Pu.get(h),p=await oA(r,f);p.snapshot&&s.push(p.snapshot)}}else{let h=await Fv(r.localStore,o);c=await Gi(r.localStore,h),await Kf(r,ew(h),o,!1,c.resumeToken)}i.push(c)}return r.hu.J_(s),i}function ew(n){return W_(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function lA(n){return function(t){return B(B(t).persistence).Ps()}(B(n).localStore)}async function hA(n,e,t,r){let i=B(n);if(i.fu)return void V(ur,"Ignoring unexpected query state notification.");let s=i.Tu.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let o=await Uv(i.localStore,J_(s[0])),c=Eo.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Me.EMPTY_BYTE_STRING);await Sn(i,o,c);break}case"rejected":await Wi(i.localStore,e,!0),Qi(i,e,r);break;default:W(64155,t)}}async function dA(n,e,t){let r=xu(n);if(r.fu){for(let i of e){if(r.Tu.has(i)&&r.sharedClientState.isActiveQueryTarget(i)){V(ur,"Adding an already active target "+i);continue}let s=await Fv(r.localStore,i),o=await Gi(r.localStore,s);await Kf(r,ew(s),o.targetId,!1,o.resumeToken),ku(r.remoteStore,o)}for(let i of t)r.Tu.has(i)&&await Wi(r.localStore,i,!1).then(()=>{Ki(r.remoteStore,i),Qi(r,i)}).catch(sr)}}function xu(n){let e=B(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Xv.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=sA.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Zb.bind(null,e),e.hu.J_=Gb.bind(null,e.eventManager),e.hu.pu=Wb.bind(null,e.eventManager),e}function Xf(n){let e=B(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=eA.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=tA.bind(null,e),e}function fA(n,e,t){let r=B(n);(async function(s,o,c){try{let u=await o.getMetadata();if(await function(w,k){let D=B(w),C=je(k.createTime);return D.persistence.runTransaction("hasNewerBundle","readonly",H=>D.Ti.getBundleMetadata(H,k.id)).then(H=>!!H&&H.createTime.compareTo(C)>=0)}(s.localStore,u))return await o.close(),c._completeWith(function(w){return{taskState:"Success",documentsLoaded:w.totalDocuments,bytesLoaded:w.totalBytes,totalDocuments:w.totalDocuments,totalBytes:w.totalBytes}}(u)),Promise.resolve(new Set);c._updateProgress(Yv(u));let h=new No(u,o.serializer),f=await o.Su();for(;f;){let g=await h.Wa(f);g&&c._updateProgress(g),f=await o.Su()}let p=await h.za(s.localStore);return await Sn(s,p.Ja,void 0),await function(w,k){let D=B(w);return D.persistence.runTransaction("Save bundle","readwrite",C=>D.Ti.saveBundleMetadata(C,k))}(s.localStore,u),c._completeWith(p.progress),Promise.resolve(p.ja)}catch(u){return ut(ur,`Loading bundle failed with ${u}`),c._failWith(u),Promise.resolve(new Set)}})(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}function n_(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){let r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}async function mh(n,e){n.asyncQueue.verifyOperationInProgress(),V(nr,"Initializing OfflineComponentProvider");let t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async i=>{r.isEqual(i)||(await Vv(e.localStore,i),r=i)}),e.persistence.setDatabaseDeletedListener(()=>{ut("Terminating Firestore due to IndexedDb database deletion"),n.terminate().then(()=>{V("Terminating Firestore due to IndexedDb database deletion completed successfully")}).catch(i=>{ut("Terminating Firestore due to IndexedDb database deletion failed",i)})}),n._offlineComponents=e}async function r_(n,e){n.asyncQueue.verifyOperationInProgress();let t=await Zf(n);V(nr,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>Jy(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>Jy(e.remoteStore,i)),n._onlineComponents=e}async function Zf(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){V(nr,"Using user provided OfflineComponentProvider");try{await mh(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!function(i){return i.name==="FirebaseError"?i.code===R.FAILED_PRECONDITION||i.code===R.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(t))throw t;ut("Error using user provided cache. Falling back to memory cache: "+t),await mh(n,new tr)}}else V(nr,"Using default OfflineComponentProvider"),await mh(n,new Oo(void 0));return n._offlineComponents}async function Du(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(V(nr,"Using user provided OnlineComponentProvider"),await r_(n,n._uninitializedComponentsProvider._online)):(V(nr,"Using default OnlineComponentProvider"),await r_(n,new nn))),n._onlineComponents}function tw(n){return Zf(n).then(e=>e.persistence)}function ss(n){return Zf(n).then(e=>e.localStore)}function nw(n){return Du(n).then(e=>e.remoteStore)}function ep(n){return Du(n).then(e=>e.syncEngine)}function rw(n){return Du(n).then(e=>e.datastore)}async function Ji(n){let e=await Du(n),t=e.eventManager;return t.onListen=Kb.bind(null,e.syncEngine),t.onUnlisten=Yb.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Qb.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=Jb.bind(null,e.syncEngine),t}function pA(n){return n.asyncQueue.enqueue(async()=>{let e=await tw(n),t=await nw(n);return e.setNetworkEnabled(!0),function(i){let s=B(i);return s.Ia.delete(0),Qo(s)}(t)})}function mA(n){return n.asyncQueue.enqueue(async()=>{let e=await tw(n),t=await nw(n);return e.setNetworkEnabled(!1),async function(i){let s=B(i);s.Ia.add(0),await ts(s),s.Aa.set("Offline")}(t)})}function gA(n,e){let t=new Ge;return n.asyncQueue.enqueueAndForget(async()=>async function(i,s,o){try{let c=await function(h,f){let p=B(h);return p.persistence.runTransaction("read document","readonly",g=>p.localDocuments.getDocument(g,f))}(i,s);c.isFoundDocument()?o.resolve(c):c.isNoDocument()?o.resolve(null):o.reject(new N(R.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(c){let u=is(c,`Failed to get document '${s} from cache`);o.reject(u)}}(await ss(n),e,t)),t.promise}function iw(n,e,t={}){let r=new Ge;return n.asyncQueue.enqueueAndForget(async()=>function(s,o,c,u,h){let f=new Yi({next:g=>{f.Ou(),o.enqueueAndForget(()=>Gf(s,p));let w=g.docs.has(c);!w&&g.fromCache?h.reject(new N(R.UNAVAILABLE,"Failed to get document because the client is offline.")):w&&g.fromCache&&u&&u.source==="server"?h.reject(new N(R.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(g)},error:g=>h.reject(g)}),p=new Do(es(c.path),f,{includeMetadataChanges:!0,ka:!0});return Hf(s,p)}(await Ji(n),n.asyncQueue,e,t,r)),r.promise}function yA(n,e){let t=new Ge;return n.asyncQueue.enqueueAndForget(async()=>async function(i,s,o){try{let c=await Qc(i,s,!0),u=new au(s,c.qs),h=u.nu(c.documents),f=u.applyChanges(h,!1);o.resolve(f.snapshot)}catch(c){let u=is(c,`Failed to execute query '${s} against cache`);o.reject(u)}}(await ss(n),e,t)),t.promise}function sw(n,e,t={}){let r=new Ge;return n.asyncQueue.enqueueAndForget(async()=>function(s,o,c,u,h){let f=new Yi({next:g=>{f.Ou(),o.enqueueAndForget(()=>Gf(s,p)),g.fromCache&&u.source==="server"?h.reject(new N(R.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(g)},error:g=>h.reject(g)}),p=new Do(c,f,{includeMetadataChanges:!0,ka:!0});return Hf(s,p)}(await Ji(n),n.asyncQueue,e,t,r)),r.promise}function _A(n,e,t){let r=new Ge;return n.asyncQueue.enqueueAndForget(async()=>{try{let i=await rw(n);r.resolve(async function(o,c,u){var h;let f=B(o),{request:p,ft:g,parent:w}=_v(f.serializer,K_(c),u);f.connection.Qo||delete p.parent;let k=(await f.Jo("RunAggregationQuery",f.serializer.databaseId,w,p,1)).filter(C=>!!C.result);Y(k.length===1,64727);let D=(h=k[0].result)===null||h===void 0?void 0:h.aggregateFields;return Object.keys(D).reduce((C,H)=>(C[g[H]]=D[H],C),{})}(i,e,t))}catch(i){r.reject(i)}}),r.promise}function vA(n,e){let t=new Yi(e);return n.asyncQueue.enqueueAndForget(async()=>function(i,s){B(i).Da.add(s),s.next()}(await Ji(n),t)),()=>{t.Ou(),n.asyncQueue.enqueueAndForget(async()=>function(i,s){B(i).Da.delete(s)}(await Ji(n),t))}}function wA(n,e,t,r){let i=function(o,c){let u;return u=typeof o=="string"?bf().encode(o):o,function(f,p){return new Zd(f,p)}(function(f,p){if(f instanceof Uint8Array)return n_(f,p);if(f instanceof ArrayBuffer)return n_(new Uint8Array(f),p);if(f instanceof ReadableStream)return f.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(u),c)}(t,Yr(e));n.asyncQueue.enqueueAndForget(async()=>{fA(await ep(n),i,r)})}function IA(n,e){return n.asyncQueue.enqueue(async()=>function(r,i){let s=B(r);return s.persistence.runTransaction("Get named query","readonly",o=>s.Ti.getNamedQuery(o,i))}(await ss(n),e))}function ow(n,e){return function(r,i){return new ef(r,i)}(n,e)}function EA(n,e){return n.asyncQueue.enqueue(async()=>async function(r,i){let s=B(r),o=s.indexManager,c=[];return s.persistence.runTransaction("Configure indexes","readwrite",u=>o.getFieldIndexes(u).next(h=>function(p,g,w,k,D){p=[...p],g=[...g],p.sort(w),g.sort(w);let C=p.length,H=g.length,F=0,z=0;for(;F<H&&z<C;){let ne=w(p[z],g[F]);ne<0?D(p[z++]):ne>0?k(g[F++]):(F++,z++)}for(;F<H;)k(g[F++]);for(;z<C;)D(p[z++])}(h,i,b0,f=>{c.push(o.addFieldIndex(u,f))},f=>{c.push(o.deleteFieldIndex(u,f))})).next(()=>P.waitFor(c)))}(await ss(n),e))}function TA(n,e){return n.asyncQueue.enqueue(async()=>function(r,i){B(r).Cs.Rs=i}(await ss(n),e))}function bA(n){return n.asyncQueue.enqueue(async()=>function(t){let r=B(t),i=r.indexManager;return r.persistence.runTransaction("Delete All Indexes","readwrite",s=>i.deleteAllFieldIndexes(s))}(await ss(n)))}function aw(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}function uw(n,e,t,r={}){var i;n=he(n,Gr);let s=fn(e),o=n._getSettings(),c=Object.assign(Object.assign({},o),{emulatorOptions:n._getEmulatorOptions()}),u=`${e}:${t}`;s&&(As(`https://${u}`),pa("Firestore",!0)),o.host!==cw&&o.host!==u&&ut("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let h=Object.assign(Object.assign({},o),{host:u,ssl:s,emulatorOptions:r});if(!pt(h,c)&&(n._setSettings(h),r.mockUserToken)){let f,p;if(typeof r.mockUserToken=="string")f=r.mockUserToken,p=$e.MOCK_USER;else{f=ym(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let g=r.mockUserToken.sub||r.mockUserToken.user_id;if(!g)throw new N(R.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");p=new $e(g)}n._authCredentials=new gh(new gc(f,p))}}function AA(n,e,...t){if(n=Ie(n),Af("collection","path",e),n instanceof Gr){let r=fe.fromString(e,...t);return ey(r),new Mt(n,null,r)}{if(!(n instanceof be||n instanceof Mt))throw new N(R.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(fe.fromString(e,...t));return ey(r),new Mt(n.firestore,null,r)}}function SA(n,e){if(n=he(n,Gr),Af("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new N(R.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Ye(n,null,function(r){return new Ft(fe.emptyPath(),r)}(e))}function lw(n,e,...t){if(n=Ie(n),arguments.length===1&&(e=ki.newId()),Af("doc","path",e),n instanceof Gr){let r=fe.fromString(e,...t);return Zg(r),new be(n,null,new q(r))}{if(!(n instanceof be||n instanceof Mt))throw new N(R.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(fe.fromString(e,...t));return Zg(r),new be(n.firestore,n instanceof Mt?n.converter:null,new q(r))}}function RA(n,e){return n=Ie(n),e=Ie(e),(n instanceof be||n instanceof Mt)&&(e instanceof be||e instanceof Mt)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function tp(n,e){return n=Ie(n),e=Ie(e),n instanceof Ye&&e instanceof Ye&&n.firestore===e.firestore&&Wo(n._query,e._query)&&n.converter===e.converter}function a_(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}function Ci(n){return function(t,r){if(typeof t!="object"||t===null)return!1;let i=t;for(let s of r)if(s in i&&typeof i[s]=="function")return!0;return!1}(n,["next","error","complete"])}function CA(n,e,t){t||(t=go);let r=yr(n,"firestore");if(r.isInitialized(t)){let i=r.getImmediate({identifier:t}),s=r.getOptions(t);if(pt(s,e))return i;throw new N(R.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new N(R.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<kv)throw new N(R.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return e.host&&fn(e.host)&&As(e.host),r.initialize({options:e,instanceIdentifier:t})}function np(n,e){let t=typeof n=="object"?n:va(),r=typeof n=="string"?n:e||go,i=yr(t,"firestore").getImmediate({identifier:r});if(!i._initialized){let s=gm("firestore");s&&uw(i,...s)}return i}function xe(n){if(n._terminated)throw new N(R.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||hw(n),n._firestoreClient}function hw(n){var e,t,r;let i=n._freezeSettings(),s=function(c,u,h,f){return new Dh(c,u,h,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,aw(f.experimentalLongPollingOptions),f.useFetchStreams,f.isUsingEmulator)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._componentsProvider||!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),n._firestoreClient=new rf(n._authCredentials,n._appCheckCredentials,n._queue,s,n._componentsProvider&&function(c){let u=c?._online.build();return{_offline:c?._offline.build(u),_online:u}}(n._componentsProvider))}function kA(n,e){ut("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=n._freezeSettings();return dw(n,nn.provider,{build:r=>new Vo(r,t.cacheSizeBytes,e?.forceOwnership)}),Promise.resolve()}async function xA(n){ut("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let e=n._freezeSettings();dw(n,nn.provider,{build:t=>new cu(t,e.cacheSizeBytes)})}function dw(n,e,t){if((n=he(n,_e))._firestoreClient||n._terminated)throw new N(R.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new N(R.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},hw(n)}function DA(n){if(n._initialized&&!n._terminated)throw new N(R.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new Ge;return n._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(r){if(!Wn.C())return Promise.resolve();let i=r+Nv;await Wn.delete(i)}(Bf(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}function NA(n){return function(t){let r=new Ge;return t.asyncQueue.enqueueAndForget(async()=>nA(await ep(t),r)),r.promise}(xe(n=he(n,_e)))}function OA(n){return pA(xe(n=he(n,_e)))}function VA(n){return mA(xe(n=he(n,_e)))}function LA(n){return Bm(n.app,"firestore",n._databaseId.database),n._delete()}function sf(n,e){let t=xe(n=he(n,_e)),r=new hu;return wA(t,n._databaseId,e,r),r}function fw(n,e){return IA(xe(n=he(n,_e)),e).then(t=>t?new Ye(n,null,t.query):null)}function MA(){return new rn(Th)}function pw(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw W(40011,{Ec:n})}}function Jr(n){let e=n._freezeSettings(),t=Yr(n._databaseId);return new af(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Nu(n,e,t,r,i,s={}){let o=n.Dc(s.merge||s.mergeFields?2:0,e,t,i);sp("Data must be an object, but it was:",o,r);let c=yw(r,o),u,h;if(s.merge)u=new bt(o.fieldMask),h=o.fieldTransforms;else if(s.mergeFields){let f=[];for(let p of s.mergeFields){let g=Mo(e,p,t);if(!o.contains(g))throw new N(R.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);vw(f,g)||f.push(g)}u=new bt(f),h=o.fieldTransforms.filter(p=>u.covers(p.field))}else u=null,h=o.fieldTransforms;return new of(new st(c),u,h)}function mw(n,e,t){return new pu({Ec:3,bc:e.settings.bc,methodName:n._methodName,mc:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}function rp(n,e,t,r){let i=n.Dc(1,e,t);sp("Data must be an object, but it was:",i,r);let s=[],o=st.empty();ar(r,(u,h)=>{let f=Ou(e,u,t);h=Ie(h);let p=i.gc(f);if(h instanceof Lo)s.push(f);else{let g=Xr(h,p);g!=null&&(s.push(f),o.set(f,g))}});let c=new bt(s);return new fu(o,c,i.fieldTransforms)}function ip(n,e,t,r,i,s){let o=n.Dc(1,e,t),c=[Mo(e,r,t)],u=[i];if(s.length%2!=0)throw new N(R.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<s.length;g+=2)c.push(Mo(e,s[g])),u.push(s[g+1]);let h=[],f=st.empty();for(let g=c.length-1;g>=0;--g)if(!vw(h,c[g])){let w=c[g],k=u[g];k=Ie(k);let D=o.gc(w);if(k instanceof Lo)h.push(w);else{let C=Xr(k,D);C!=null&&(h.push(w),f.set(w,C))}}let p=new bt(h);return new fu(f,p,o.fieldTransforms)}function gw(n,e,t,r=!1){return Xr(t,n.Dc(r?4:3,e))}function Xr(n,e){if(_w(n=Ie(n)))return sp("Unsupported field value:",e,n),yw(n,e);if(n instanceof sn)return function(r,i){if(!pw(i.Ec))throw i.wc(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.wc(`${r._methodName}() is not currently supported inside arrays`);let s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.mc&&e.Ec!==4)throw e.wc("Nested arrays are not supported");return function(r,i){let s=[],o=0;for(let c of r){let u=Xr(c,i.yc(o));u==null&&(u={nullValue:"NULL_VALUE"}),s.push(u),o++}return{arrayValue:{values:s}}}(n,e)}return function(r,i){if((r=Ie(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return rv(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let s=Re.fromDate(r);return{timestampValue:zi(i.serializer,s)}}if(r instanceof Re){let s=new Re(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:zi(i.serializer,s)}}if(r instanceof In)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Xt)return{bytesValue:dv(i.serializer,r._byteString)};if(r instanceof be){let s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.wc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Ff(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof Zt)return function(o,c){return{mapValue:{fields:{[Df]:{stringValue:Nf},[Fi]:{arrayValue:{values:o.toArray().map(h=>{if(typeof h!="number")throw c.wc("VectorValues must only contain numeric values.");return Mf(c.serializer,h)})}}}}}}(r,i);throw i.wc(`Unsupported field value: ${wu(r)}`)}(n,e)}function yw(n,e){let t={};return N_(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):ar(n,(r,i)=>{let s=Xr(i,e.Vc(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function _w(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Re||n instanceof In||n instanceof Xt||n instanceof be||n instanceof sn||n instanceof Zt)}function sp(n,e,t){if(!_w(t)||!m_(t)){let r=wu(t);throw r==="an object"?e.wc(n+" a custom object"):e.wc(n+" "+r)}}function Mo(n,e,t){if((e=Ie(e))instanceof rn)return e._internalPath;if(typeof e=="string")return Ou(n,e);throw mu("Field path arguments must be of type string or ",n,!1,void 0,t)}function Ou(n,e,t){if(e.search(UA)>=0)throw mu(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new rn(...e.split("."))._internalPath}catch{throw mu(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function mu(n,e,t,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,c=`Function ${e}() called with invalid data`;t&&(c+=" (via `toFirestore()`)"),c+=". ";let u="";return(s||o)&&(u+=" (found",s&&(u+=` in field ${r}`),o&&(u+=` in document ${i}`),u+=")"),new N(R.INVALID_ARGUMENT,c+n+u)}function vw(n,e){return n.some(t=>t.isEqual(e))}function Vu(n,e){return typeof e=="string"?Ou(n,e):e instanceof rn?e._internalPath:e._delegate._internalPath}function ww(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new N(R.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}function BA(n,e,...t){let r=[];e instanceof Fo&&r.push(e),r=r.concat(t),function(s){let o=s.filter(u=>u instanceof Kr).length,c=s.filter(u=>u instanceof Xi).length;if(o>1||o>0&&c>0)throw new N(R.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(let i of r)n=i._apply(n);return n}function jA(n,e,t){let r=e,i=Vu("where",n);return Xi._create(i,r,t)}function qA(...n){return n.forEach(e=>Tw("or",e)),Kr._create("or",n)}function zA(...n){return n.forEach(e=>Tw("and",e)),Kr._create("and",n)}function $A(n,e="asc"){let t=e,r=Vu("orderBy",n);return gu._create(r,t)}function HA(n){return g_("limit",n),Uo._create("limit",n,"F")}function GA(n){return g_("limitToLast",n),Uo._create("limitToLast",n,"L")}function WA(...n){return Bo._create("startAt",n,!0)}function KA(...n){return Bo._create("startAfter",n,!1)}function QA(...n){return jo._create("endBefore",n,!1)}function YA(...n){return jo._create("endAt",n,!0)}function Iw(n,e,t,r){if(t[0]=Ie(t[0]),t[0]instanceof Wr)return function(s,o,c,u,h){if(!u)throw new N(R.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${c}().`);let f=[];for(let p of Ri(s))if(p.field.isKeyField())f.push(Fr(o,u.key));else{let g=u.data.field(p.field);if(bu(g))throw new N(R.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+p.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(g===null){let w=p.field.canonicalString();throw new N(R.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${w}' (used as the orderBy) does not exist.`)}f.push(g)}return new tn(f,h)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{let i=Jr(n.firestore);return function(o,c,u,h,f,p){let g=o.explicitOrderBy;if(f.length>g.length)throw new N(R.INVALID_ARGUMENT,`Too many arguments provided to ${h}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let w=[];for(let k=0;k<f.length;k++){let D=f[k];if(g[k].field.isKeyField()){if(typeof D!="string")throw new N(R.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${h}(), but got a ${typeof D}`);if(!Vf(o)&&D.indexOf("/")!==-1)throw new N(R.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${h}() must be a plain document ID, but '${D}' contains a slash.`);let C=o.path.child(fe.fromString(D));if(!q.isDocumentKey(C))throw new N(R.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${h}() must result in a valid document path, but '${C}' is not because it contains an odd number of segments.`);let H=new q(C);w.push(Fr(c,H))}else{let C=gw(u,h,D);w.push(C)}}return new tn(w,p)}(n._query,n.firestore._databaseId,i,e,t,r)}}function c_(n,e,t){if(typeof(t=Ie(t))=="string"){if(t==="")throw new N(R.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Vf(e)&&t.indexOf("/")!==-1)throw new N(R.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(fe.fromString(t));if(!q.isDocumentKey(r))throw new N(R.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Fr(n,new q(r))}if(t instanceof be)return Fr(n,t._key);throw new N(R.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${wu(t)}.`)}function u_(n,e){if(!Array.isArray(n)||n.length===0)throw new N(R.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Ew(n,e){let t=function(i,s){for(let o of i)for(let c of o.getFlattenedFilters())if(s.indexOf(c.op)>=0)return c.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new N(R.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new N(R.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function Tw(n,e){if(!(e instanceof Xi||e instanceof Kr))throw new N(R.INVALID_ARGUMENT,`Function ${n}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}function Lu(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}function JA(n){return new rr("sum",Mo("sum",n))}function XA(n){return new rr("avg",Mo("average",n))}function bw(){return new rr("count")}function ZA(n,e){var t,r;return n instanceof rr&&e instanceof rr&&n.aggregateType===e.aggregateType&&((t=n._internalFieldPath)===null||t===void 0?void 0:t.canonicalString())===((r=e._internalFieldPath)===null||r===void 0?void 0:r.canonicalString())}function eS(n,e){return tp(n.query,e.query)&&pt(n.data(),e.data())}function tS(n,e,t){if(Qr(e,yt._jsonSchema)){if(e.bundle===Aw)throw new N(R.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");let r=Yr(n._databaseId),i=ow(e.bundle,r),s=i.Ku(),o=new No(i.getMetadata(),r);for(let f of s)o.Wa(f);let c=o.documents;if(c.length!==1)throw new N(R.INVALID_ARGUMENT,`Expected bundle data to contain 1 document, but it contains ${c.length} documents.`);let u=Ru(r,c[0].document),h=new q(fe.fromString(e.bundleName));return new yt(n,new zo(n),h,u,new Lt(!1,!1),t||null)}}function nS(n,e,t){if(Qr(e,_t._jsonSchema)){if(e.bundle===Aw)throw new N(R.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");let r=Yr(n._databaseId),i=ow(e.bundle,r),s=i.Ku(),o=new No(i.getMetadata(),r);for(let g of s)o.Wa(g);if(o.queries.length!==1)throw new N(R.INVALID_ARGUMENT,`Snapshot data expected 1 query but found ${o.queries.length} queries.`);let c=Cu(o.queries[0].bundledQuery),u=o.documents,h=new xo;u.map(g=>{let w=Ru(r,g.document);h=h.add(w)});let f=Hr.fromInitialDocuments(c,h,ie(),!1,!1),p=new Ye(n,t||null,c);return new _t(n,new zo(n),p,f)}}function rS(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return W(61501,{type:n})}}function iS(n,e){return n instanceof yt&&e instanceof yt?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof _t&&e instanceof _t&&n._firestore===e._firestore&&tp(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}function sS(n){n=he(n,be);let e=he(n.firestore,_e);return iw(xe(e),n._key).then(t=>op(e,n,t))}function oS(n){n=he(n,be);let e=he(n.firestore,_e),t=xe(e),r=new on(e);return gA(t,n._key).then(i=>new yt(e,r,n._key,i,new Lt(i!==null&&i.hasLocalMutations,!0),n.converter))}function aS(n){n=he(n,be);let e=he(n.firestore,_e);return iw(xe(e),n._key,{source:"server"}).then(t=>op(e,n,t))}function cS(n){n=he(n,Ye);let e=he(n.firestore,_e),t=xe(e),r=new on(e);return ww(n._query),sw(t,n._query).then(i=>new _t(e,r,n,i))}function uS(n){n=he(n,Ye);let e=he(n.firestore,_e),t=xe(e),r=new on(e);return yA(t,n._query).then(i=>new _t(e,r,n,i))}function lS(n){n=he(n,Ye);let e=he(n.firestore,_e),t=xe(e),r=new on(e);return sw(t,n._query,{source:"server"}).then(i=>new _t(e,r,n,i))}function hS(n,e,t){n=he(n,be);let r=he(n.firestore,_e),i=Lu(n.converter,e,t);return os(r,[Nu(Jr(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,Le.none())])}function dS(n,e,t,...r){n=he(n,be);let i=he(n.firestore,_e),s=Jr(i),o;return o=typeof(e=Ie(e))=="string"||e instanceof rn?ip(s,"updateDoc",n._key,e,t,r):rp(s,"updateDoc",n._key,e),os(i,[o.toMutation(n._key,Le.exists(!0))])}function fS(n){return os(he(n.firestore,_e),[new Zn(n._key,Le.none())])}function pS(n,e){let t=he(n.firestore,_e),r=lw(n),i=Lu(n.converter,e);return os(t,[Nu(Jr(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,Le.exists(!1))]).then(()=>r)}function ff(n,...e){var t,r,i;n=Ie(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||Ci(e[o])||(s=e[o++]);let c={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(Ci(e[o])){let p=e[o];e[o]=(t=p.next)===null||t===void 0?void 0:t.bind(p),e[o+1]=(r=p.error)===null||r===void 0?void 0:r.bind(p),e[o+2]=(i=p.complete)===null||i===void 0?void 0:i.bind(p)}let u,h,f;if(n instanceof be)h=he(n.firestore,_e),f=es(n._key.path),u={next:p=>{e[o]&&e[o](op(h,n,p))},error:e[o+1],complete:e[o+2]};else{let p=he(n,Ye);h=he(p.firestore,_e),f=p._query;let g=new on(h);u={next:w=>{e[o]&&e[o](new _t(h,g,p,w))},error:e[o+1],complete:e[o+2]},ww(n._query)}return function(g,w,k,D){let C=new Yi(D),H=new Do(w,C,k);return g.asyncQueue.enqueueAndForget(async()=>Hf(await Ji(g),H)),()=>{C.Ou(),g.asyncQueue.enqueueAndForget(async()=>Gf(await Ji(g),H))}}(xe(h),f,c,u)}function mS(n,e,...t){let r=Ie(n),i=function(u){let h={bundle:"",bundleName:"",bundleSource:""},f=["bundle","bundleName","bundleSource"];for(let p of f){if(!(p in u)){h.error=`snapshotJson missing required field: ${p}`;break}let g=u[p];if(typeof g!="string"){h.error=`snapshotJson field '${p}' must be a string.`;break}if(g.length===0){h.error=`snapshotJson field '${p}' cannot be an empty string.`;break}p==="bundle"?h.bundle=g:p==="bundleName"?h.bundleName=g:p==="bundleSource"&&(h.bundleSource=g)}return h}(e);if(i.error)throw new N(R.INVALID_ARGUMENT,i.error);let s,o=0;if(typeof t[o]!="object"||Ci(t[o])||(s=t[o++]),i.bundleSource==="QuerySnapshot"){let c=null;if(typeof t[o]=="object"&&Ci(t[o])){let u=t[o++];c={next:u.next,error:u.error,complete:u.complete}}else c={next:t[o++],error:t[o++],complete:t[o++]};return function(h,f,p,g,w){let k,D=!1;return sf(h,f.bundle).then(()=>fw(h,f.bundleName)).then(H=>{H&&!D&&(w&&H.withConverter(w),k=ff(H,p||{},g))}).catch(H=>(g.error&&g.error(H),()=>{})),()=>{D||(D=!0,k&&k())}}(r,i,s,c,t[o])}if(i.bundleSource==="DocumentSnapshot"){let c=null;if(typeof t[o]=="object"&&Ci(t[o])){let u=t[o++];c={next:u.next,error:u.error,complete:u.complete}}else c={next:t[o++],error:t[o++],complete:t[o++]};return function(h,f,p,g,w){let k,D=!1;return sf(h,f.bundle).then(()=>{if(!D){let H=new be(h,w||null,q.fromPath(f.bundleName));k=ff(H,p||{},g)}}).catch(H=>(g.error&&g.error(H),()=>{})),()=>{D||(D=!0,k&&k())}}(r,i,s,c,t[o])}throw new N(R.INVALID_ARGUMENT,`unsupported bundle source: ${i.bundleSource}`)}function gS(n,e){return vA(xe(n=he(n,_e)),Ci(e)?e:{next:e})}function os(n,e){return function(r,i){let s=new Ge;return r.asyncQueue.enqueueAndForget(async()=>Xb(await ep(r),i,s)),s.promise}(xe(n),e)}function op(n,e,t){let r=t.docs.get(e._key),i=new on(n);return new yt(n,i,e._key,r,new Lt(t.hasPendingWrites,t.fromCache),e.converter)}function yS(n){return Sw(n,{count:bw()})}function Sw(n,e){let t=he(n.firestore,_e),r=xe(t),i=D_(e,(s,o)=>new xc(o,s.aggregateType,s._internalFieldPath));return _A(r,n._query,i).then(s=>function(c,u,h){let f=new on(c);return new du(u,f,h)}(t,n,s))}function _S(){return new gf}function vS(n){return new yf(n?.cacheSizeBytes)}function wS(n){return new pf(n)}function IS(n){return new mf(n)}function Rw(n){return new _f(n?.forceOwnership)}function ES(){return new vf}function zn(n,e){if((n=Ie(n)).firestore!==e)throw new N(R.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}function bS(n,e,t){n=he(n,_e);let r=Object.assign(Object.assign({},TS),t);return function(s){if(s.maxAttempts<1)throw new N(R.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(s,o,c){let u=new Ge;return s.asyncQueue.enqueueAndForget(async()=>{let h=await rw(s);new nf(s.asyncQueue,h,c,o,u).zu()}),u.promise}(xe(n),i=>e(new _u(n,i)),r)}function AS(){return new Lo("deleteField")}function SS(){return new cf("serverTimestamp")}function RS(...n){return new uf("arrayUnion",n)}function PS(...n){return new lf("arrayRemove",n)}function CS(n){return new hf("increment",n)}function kS(n){return new Zt(n)}function xS(n){return xe(n=he(n,_e)),new yu(n,e=>os(n,e))}function DS(n,e){let t=xe(n=he(n,_e));if(!t._uninitializedComponentsProvider||t._uninitializedComponentsProvider._offline.kind==="memory")return ut("Cannot enable indexes when persistence is disabled"),Promise.resolve();let r=function(s){let o=typeof s=="string"?function(h){try{return JSON.parse(h)}catch(f){throw new N(R.INVALID_ARGUMENT,"Failed to parse JSON: "+f?.message)}}(s):s,c=[];if(Array.isArray(o.indexes))for(let u of o.indexes){let h=l_(u,"collectionGroup"),f=[];if(Array.isArray(u.fields))for(let p of u.fields){let g=Ou("setIndexConfiguration",l_(p,"fieldPath"));p.arrayConfig==="CONTAINS"?f.push(new wn(g,2)):p.order==="ASCENDING"?f.push(new wn(g,0)):p.order==="DESCENDING"&&f.push(new wn(g,1))}c.push(new Gn(Gn.UNKNOWN_ID,h,f,Ni.empty()))}return c}(e);return EA(t,r)}function l_(n,e){if(typeof n[e]!="string")throw new N(R.INVALID_ARGUMENT,"Missing string value for: "+e);return n[e]}function NS(n){var e;n=he(n,_e);let t=h_.get(n);if(t)return t;if(((e=xe(n)._uninitializedComponentsProvider)===null||e===void 0?void 0:e._offline.kind)!=="persistent")return null;let r=new vu(n);return h_.set(n,r),r}function OS(n){Pw(n,!0)}function VS(n){Pw(n,!1)}function LS(n){bA(xe(n._firestore)).then(e=>V("deleting all persistent cache indexes succeeded")).catch(e=>ut("deleting all persistent cache indexes failed",e))}function Pw(n,e){TA(xe(n._firestore),e).then(t=>V(`setting persistent cache index auto creation isEnabled=${e} succeeded`)).catch(t=>ut(`setting persistent cache index auto creation isEnabled=${e} failed`,t))}function MS(n){var e;let t=(e=xe(he(n.firestore,_e))._onlineComponents)===null||e===void 0?void 0:e.datastore.serializer;return t===void 0?null:Pu(t,ct(n._query)).Vt}function FS(n,e){var t;let r=D_(e,(s,o)=>new xc(o,s.aggregateType,s._internalFieldPath)),i=(t=xe(he(n.firestore,_e))._onlineComponents)===null||t===void 0?void 0:t.datastore.serializer;return i===void 0?null:_v(i,K_(n._query),r,!0).request}var Yg,Jg,$e,Zi,Hn,R,N,Ge,gc,yc,gh,yh,_h,vh,co,wh,Ih,ki,Th,_c,fe,T0,Be,q,ty,ny,Re,ee,Di,Gn,wn,Ni,Pt,v_,vc,P,Tt,wc,Wn,Ah,Or,Sh,ry,eo,Rh,Ph,ot,$n,Ic,Rr,Ho,gi,lo,R0,Vt,sy,Dr,oy,P0,Oi,Ec,C0,uc,k0,T_,x0,ho,Ch,Vi,b_,D0,Li,N0,Pf,O0,Tc,Vr,fo,V0,Mi,L0,Iu,M0,Eu,F0,Cf,U0,kh,B0,to,j0,A_,q0,no,z0,S_,$0,Tu,H0,xh,G0,R_,W0,kf,K0,P_,Q0,C_,k_,xf,Y0,x_,J0,po,Pe,Si,Yt,Ee,bc,bt,Ac,Me,Z0,O_,V_,L_,M_,Dh,go,Mr,Df,F_,qn,Nf,Fi,lc,B_,st,We,tn,Ur,Sc,pe,ve,Mh,Fh,Uh,Bh,Rc,jh,qh,zh,Ft,Ut,ib,Z_,sb,ob,ab,ji,Yn,bn,An,Jn,jr,Gh,Le,qi,Xn,Bt,Zn,vo,wo,Wh,Io,xc,Kh,qe,ge,Dc,fb,Qh,Nr,Eo,To,Pi,Nc,Oc,Vc,Yh,pb,mb,gb,Jh,$i,Lc,nd,Fc,rd,vn,_i,id,sd,od,kr,xr,Uc,ld,So,Ly,rc,hd,Uy,Sv,mt,qc,Hi,dd,jy,kv,fd,zc,pd,md,$c,gd,yd,_d,Hc,vd,wd,Id,Ro,ze,Ed,Td,bd,Ad,Po,Sd,Gc,Wc,Rd,Un,lh,hh,dh,Nv,Pd,Cd,kd,Kc,jf,Cb,xd,jv,qv,zv,Wt,Yc,oo,Jc,Dd,Co,ao,Xc,Nd,Qy,Zc,oc,ph,Vb,Vd,Ld,it,Md,ko,Yy,eu,Fd,Ud,Bd,jd,qd,$r,zd,Hd,xo,nu,Hr,Gd,Wd,Kd,Zy,Do,ru,iu,No,su,ou,au,ur,Qd,Yd,Jd,tr,Oo,Vo,cu,nn,Yi,Zd,ef,tf,nf,nr,rf,i_,cw,s_,uu,Gr,Ye,be,Mt,o_,lu,hu,PA,_e,rr,du,Xt,rn,sn,In,Zt,FA,of,fu,pu,af,Lo,cf,uf,lf,hf,UA,Wr,df,Fo,ir,Xi,Kr,gu,Uo,Bo,jo,qo,zo,Aw,Lt,yt,Lr,_t,on,pf,mf,gf,yf,_f,vf,TS,yu,wf,_u,vu,h_,If,Ef,ac,Cw=Se(()=>{hi();Ss();Rs();mr();Kg();Qg();Yg="@firebase/firestore",Jg="4.8.0";$e=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};$e.UNAUTHENTICATED=new $e(null),$e.GOOGLE_CREDENTIALS=new $e("google-credentials-uid"),$e.FIRST_PARTY=new $e("first-party-uid"),$e.MOCK_USER=new $e("mock-user");Zi="11.10.0";Hn=new xn("@firebase/firestore");R={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},N=class extends Et{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};Ge=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};gc=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},yc=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t($e.UNAUTHENTICATED))}shutdown(){}},gh=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},yh=class{constructor(e){this.t=e,this.currentUser=$e.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Y(this.o===void 0,42304);let r=this.i,i=u=>this.i!==r?(r=this.i,t(u)):Promise.resolve(),s=new Ge;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Ge,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let u=s;e.enqueueRetryable(async()=>{await u.promise,await i(this.currentUser)})},c=u=>{V("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(u=>c(u)),setTimeout(()=>{if(!this.auth){let u=this.t.getImmediate({optional:!0});u?c(u):(V("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Ge)}},0),o()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(V("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Y(typeof r.accessToken=="string",31837,{l:r}),new gc(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return Y(e===null||typeof e=="string",2055,{h:e}),new $e(e)}},_h=class{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=$e.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}},vh=class{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new _h(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t($e.FIRST_PARTY))}shutdown(){}invalidateToken(){}},co=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},wh=class{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Rt(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){Y(this.o===void 0,3512);let r=s=>{s.error!=null&&V("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.m;return this.m=s.token,V("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{V("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.V.getImmediate({optional:!0});s?i(s):V("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new co(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Y(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new co(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}},Ih=class{getToken(){return Promise.resolve(new co(""))}invalidateToken(){}start(e,t){}shutdown(){}};ki=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516),r="";for(;r.length<20;){let i=I0(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%62))}return r}};Th="__name__",_c=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&W(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&W(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=n.compareSegments(e.get(i),t.get(i));if(s!==0)return s}return te(e.length,t.length)}static compareSegments(e,t){let r=n.isNumericId(e),i=n.isNumericId(t);return r&&!i?-1:!r&&i?1:r&&i?n.extractNumericId(e).compare(n.extractNumericId(t)):Eh(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return yn.fromString(e.substring(4,e.length-2))}},fe=class n extends _c{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new N(R.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},T0=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Be=class n extends _c{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return T0.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Th}static keyField(){return new n([Th])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new N(R.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},o=!1;for(;i<e.length;){let c=e[i];if(c==="\\"){if(i+1===e.length)throw new N(R.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let u=e[i+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new N(R.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,i+=2}else c==="`"?(o=!o,i++):c!=="."||o?(r+=c,i++):(s(),i++)}if(s(),o)throw new N(R.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};q=class n{constructor(e){this.path=e}static fromPath(e){return new n(fe.fromString(e))}static fromName(e){return new n(fe.fromString(e).popFirst(5))}static empty(){return new n(fe.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&fe.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return fe.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new fe(e.slice()))}};ty=-62135596800,ny=1e6,Re=class n{static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*ny);return new n(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new N(R.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new N(R.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<ty)throw new N(R.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new N(R.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/ny}_compareTo(e){return this.seconds===e.seconds?te(this.nanoseconds,e.nanoseconds):te(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:n._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Qr(e,n._jsonSchema))return new n(e.seconds,e.nanoseconds)}valueOf(){let e=this.seconds-ty;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};Re._jsonSchemaVersion="firestore/timestamp/1.0",Re._jsonSchema={type:He("string",Re._jsonSchemaVersion),seconds:He("number"),nanoseconds:He("number")};ee=class n{static fromTimestamp(e){return new n(e)}static min(){return new n(new Re(0,0))}static max(){return new n(new Re(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};Di=-1,Gn=class{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}};Gn.UNKNOWN_ID=-1;wn=class{constructor(e,t){this.fieldPath=e,this.kind=t}};Ni=class n{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new n(0,Pt.min())}};Pt=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(ee.min(),q.empty(),Di)}static max(){return new n(ee.max(),q.empty(),Di)}};v_="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",vc=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};P=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&W(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,o=!1;e.forEach(c=>{++i,c.next(()=>{++s,o&&s===i&&t()},u=>r(u))}),o=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,o=new Array(s),c=0;for(let u=0;u<s;u++){let h=u;t(e[h]).next(f=>{o[h]=f,++c,c===s&&r(o)},f=>i(f))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};Tt="SimpleDb",wc=class n{static open(e,t,r,i){try{return new n(t,e.transaction(i,r))}catch(s){throw new Or(t,s)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new Ge,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new Or(e,t.error)):this.S.resolve()},this.transaction.onerror=r=>{let i=Rf(r.target.error);this.S.reject(new Or(e,i))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(V(Tt,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}v(){let e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){let t=this.transaction.objectStore(e);return new Sh(t)}},Wn=class n{static delete(e){return V(Tt,"Removing database:",e),Pr(il().indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!ma())return!1;if(n.F())return!0;let e=Fe(),t=n.M(e),r=0<t&&t<10,i=w_(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static F(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.O)==="YES"}static N(e,t){return e.store(t)}static M(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}constructor(e,t,r){this.name=e,this.version=t,this.B=r,this.L=null,n.M(Fe())===12.2&&Ue("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async k(e){return this.db||(V(Tt,"Opening database:",this.name),this.db=await new Promise((t,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;t(o)},i.onblocked=()=>{r(new Or(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?r(new N(R.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new N(R.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new Or(e,o))},i.onupgradeneeded=s=>{V(Tt,'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;if(this.L!==null&&this.L!==s.oldVersion)throw new Error(`refusing to open IndexedDB database due to potential corruption of the IndexedDB database data; this corruption could be caused by clicking the "clear site data" button in a web browser; try reloading the web page to re-initialize the IndexedDB database: lastClosedDbVersion=${this.L}, event.oldVersion=${s.oldVersion}, event.newVersion=${s.newVersion}, db.version=${o.version}`);this.B.q(o,i.transaction,s.oldVersion,this.version).next(()=>{V(Tt,"Database upgrade to version "+this.version+" complete")})}}),this.db.addEventListener("close",t=>{let r=t.target;this.L=r.version},{passive:!0})),this.db.addEventListener("versionchange",t=>{var r;t.newVersion===null&&(ut('Received "versionchange" event with newVersion===null; notifying the registered DatabaseDeletedListener, if any'),(r=this.databaseDeletedListener)===null||r===void 0||r.call(this))},{passive:!0}),this.db}setDatabaseDeletedListener(e){if(this.databaseDeletedListener)throw new Error("setDatabaseDeletedListener() may only be called once, and it has already been called");this.databaseDeletedListener=e}async runTransaction(e,t,r,i){let s=t==="readonly",o=0;for(;;){++o;try{this.db=await this.k(e);let c=wc.open(this.db,e,s?"readonly":"readwrite",r),u=i(c).next(h=>(c.v(),h)).catch(h=>(c.abort(h),P.reject(h))).toPromise();return u.catch(()=>{}),await c.D,u}catch(c){let u=c,h=u.name!=="FirebaseError"&&o<3;if(V(Tt,"Transaction failed with error:",u.message,"Retrying:",h),this.close(),!h)return Promise.reject(u)}}}close(){this.db&&this.db.close(),this.db=void 0}};Ah=class{constructor(e){this.$=e,this.U=!1,this.K=null}get isDone(){return this.U}get W(){return this.K}set cursor(e){this.$=e}done(){this.U=!0}G(e){this.K=e}delete(){return Pr(this.$.delete())}},Or=class extends N{constructor(e,t){super(R.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};Sh=class{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(V(Tt,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(V(Tt,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Pr(r)}add(e){return V(Tt,"ADD",this.store.name,e,e),Pr(this.store.add(e))}get(e){return Pr(this.store.get(e)).next(t=>(t===void 0&&(t=null),V(Tt,"GET",this.store.name,e,t),t))}delete(e){return V(Tt,"DELETE",this.store.name,e),Pr(this.store.delete(e))}count(){return V(Tt,"COUNT",this.store.name),Pr(this.store.count())}j(e,t){let r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(r.range);return new P((o,c)=>{s.onerror=u=>{c(u.target.error)},s.onsuccess=u=>{o(u.target.result)}})}{let s=this.cursor(r),o=[];return this.J(s,(c,u)=>{o.push(u)}).next(()=>o)}}H(e,t){let r=this.store.getAll(e,t===null?void 0:t);return new P((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}Y(e,t){V(Tt,"DELETE ALL",this.store.name);let r=this.options(e,t);r.Z=!1;let i=this.cursor(r);return this.J(i,(s,o,c)=>c.delete())}X(e,t){let r;t?r=e:(r={},t=e);let i=this.cursor(r);return this.J(i,t)}ee(e){let t=this.cursor({});return new P((r,i)=>{t.onerror=s=>{let o=Rf(s.target.error);i(o)},t.onsuccess=s=>{let o=s.target.result;o?e(o.primaryKey,o.value).next(c=>{c?o.continue():r()}):r()}})}J(e,t){let r=[];return new P((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let c=o.target.result;if(!c)return void i();let u=new Ah(c),h=t(c.primaryKey,c.value,u);if(h instanceof P){let f=h.catch(p=>(u.done(),P.reject(p)));r.push(f)}u.isDone?i():u.W===null?c.continue():c.continue(u.W)}}).next(()=>P.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.Z?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}};ry=!1;eo="IndexBackfiller",Rh=class{constructor(e,t){this.asyncQueue=e,this.te=t,this.task=null}start(){this.ne(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}ne(e){V(eo,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{let t=await this.te.re();V(eo,`Documents written: ${t}`)}catch(t){or(t)?V(eo,"Ignoring IndexedDB error during index backfill: ",t):await sr(t)}await this.ne(6e4)})}},Ph=class{constructor(e,t){this.localStore=e,this.persistence=t}async re(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.ie(t,e))}ie(e,t){let r=new Set,i=t,s=!0;return P.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return V(eo,`Processing collection: ${o}`),this.se(e,o,i).next(c=>{i-=c,r.add(o)});s=!1})).next(()=>t-i)}se(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.oe(i,s)).next(c=>(V(eo,`Updating offset: ${c}`),this.localStore.indexManager.updateCollectionGroup(e,t,c))).next(()=>o.size)}))}oe(e,t){let r=e;return t.changes.forEach((i,s)=>{let o=__(s);Sf(o,r)>0&&(r=o)}),new Pt(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}};ot=class{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this._e(r),this.ae=r=>t.writeSequenceNumber(r))}_e(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ae&&this.ae(e),e}};ot.ue=-1;$n=-1;Ic="";Rr="remoteDocuments",Ho="owner",gi="owner",lo="mutationQueues",R0="userId",Vt="mutations",sy="batchId",Dr="userMutationsIndex",oy=["userId","batchId"];P0={},Oi="documentMutations",Ec="remoteDocumentsV14",C0=["prefixPath","collectionGroup","readTime","documentId"],uc="documentKeyIndex",k0=["prefixPath","collectionGroup","documentId"],T_="collectionGroupIndex",x0=["collectionGroup","readTime","prefixPath","documentId"],ho="remoteDocumentGlobal",Ch="remoteDocumentGlobalKey",Vi="targets",b_="queryTargetsIndex",D0=["canonicalId","targetId"],Li="targetDocuments",N0=["targetId","path"],Pf="documentTargetsIndex",O0=["path","targetId"],Tc="targetGlobalKey",Vr="targetGlobal",fo="collectionParents",V0=["collectionId","parent"],Mi="clientMetadata",L0="clientId",Iu="bundles",M0="bundleId",Eu="namedQueries",F0="name",Cf="indexConfiguration",U0="indexId",kh="collectionGroupIndex",B0="collectionGroup",to="indexState",j0=["indexId","uid"],A_="sequenceNumberIndex",q0=["uid","sequenceNumber"],no="indexEntries",z0=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],S_="documentKeyIndex",$0=["indexId","uid","orderedDocumentKey"],Tu="documentOverlays",H0=["userId","collectionPath","documentId"],xh="collectionPathOverlayIndex",G0=["userId","collectionPath","largestBatchId"],R_="collectionGroupOverlayIndex",W0=["userId","collectionGroup","largestBatchId"],kf="globals",K0="name",P_=[lo,Vt,Oi,Rr,Vi,Ho,Vr,Li,Mi,ho,fo,Iu,Eu],Q0=[...P_,Tu],C_=[lo,Vt,Oi,Ec,Vi,Ho,Vr,Li,Mi,ho,fo,Iu,Eu,Tu],k_=C_,xf=[...k_,Cf,to,no],Y0=xf,x_=[...xf,kf],J0=x_;po=class extends vc{constructor(e,t){super(),this.ce=e,this.currentSequenceNumber=t}};Pe=class n{constructor(e,t){this.comparator=e,this.root=t||Yt.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Yt.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Yt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Si(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Si(this.root,e,this.comparator,!1)}getReverseIterator(){return new Si(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Si(this.root,e,this.comparator,!0)}},Si=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Yt=class n{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=s??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new n(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this,s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw W(43730,{key:this.key,value:this.value});if(this.right.isRed())throw W(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw W(27949);return e+(this.isRed()?0:1)}};Yt.EMPTY=null,Yt.RED=!0,Yt.BLACK=!1;Yt.EMPTY=new class{constructor(){this.size=0}get key(){throw W(57766)}get value(){throw W(16141)}get color(){throw W(16727)}get left(){throw W(29726)}get right(){throw W(36894)}copy(e,t,r,i,s){return this}insert(e,t,r){return new Yt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};Ee=class n{constructor(e){this.comparator=e,this.data=new Pe(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new bc(this.data.getIterator())}getIteratorFrom(e){return new bc(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},bc=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};bt=class n{constructor(e){this.fields=e,e.sort(Be.comparator)}static empty(){return new n([])}unionWith(e){let t=new Ee(Be.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return xi(this.fields,e.fields,(t,r)=>t.isEqual(r))}};Ac=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};Me=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Ac("Invalid base64 string: "+s):s}}(e);return new n(t)}static fromUint8Array(e){let t=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return te(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Me.EMPTY_BYTE_STRING=new Me("");Z0=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);O_="server_timestamp",V_="__type__",L_="__previous_value__",M_="__local_write_time__";Dh=class{constructor(e,t,r,i,s,o,c,u,h,f){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=c,this.longPollingOptions=u,this.useFetchStreams=h,this.isUsingEmulator=f}},go="(default)",Mr=class n{constructor(e,t){this.projectId=e,this.database=t||go}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===go}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};Df="__type__",F_="__max__",qn={mapValue:{fields:{__type__:{stringValue:F_}}}},Nf="__vector__",Fi="value",lc={nullValue:"NULL_VALUE"};B_={mapValue:{fields:{[Df]:{stringValue:Nf},[Fi]:{arrayValue:{}}}}};st=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!dc(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ro(t)}setAll(e){let t=Be.emptyPath(),r={},i=[];e.forEach((o,c)=>{if(!t.isImmediateParentOf(c)){let u=this.getFieldsMap(t);this.applyChanges(u,r,i),r={},i=[],t=c.popLast()}o?r[c.lastSegment()]=ro(o):i.push(c.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());dc(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return en(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];dc(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){ar(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(ro(this.value))}};We=class n{constructor(e,t,r,i,s,o,c){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=c}static newInvalidDocument(e){return new n(e,0,ee.min(),ee.min(),ee.min(),st.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,ee.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,ee.min(),ee.min(),st.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,ee.min(),ee.min(),st.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ee.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=st.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=st.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ee.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};tn=class{constructor(e,t){this.position=e,this.inclusive=t}};Ur=class{constructor(e,t="asc"){this.field=e,this.dir=t}};Sc=class{},pe=class n extends Sc{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new Mh(e,t,r):t==="array-contains"?new Bh(e,r):t==="in"?new Rc(e,r):t==="not-in"?new jh(e,r):t==="array-contains-any"?new qh(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new Fh(e,r):new Uh(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Qn(t,this.value)):t!==null&&Kn(this.value)===Kn(t)&&this.matchesComparison(Qn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return W(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},ve=class n extends Sc{constructor(e,t){super(),this.filters=e,this.op=t,this.he=null}static create(e,t){return new n(e,t)}matches(e){return Bi(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.he!==null||(this.he=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.he}getFilters(){return Object.assign([],this.filters)}};Mh=class extends pe{constructor(e,t,r){super(e,t,r),this.key=q.fromName(r.referenceValue)}matches(e){let t=q.comparator(e.key,this.key);return this.matchesComparison(t)}},Fh=class extends pe{constructor(e,t){super(e,"in",t),this.keys=G_("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},Uh=class extends pe{constructor(e,t){super(e,"not-in",t),this.keys=G_("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};Bh=class extends pe{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return _o(t)&&yo(t.arrayValue,this.value)}},Rc=class extends pe{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&yo(this.value.arrayValue,t)}},jh=class extends pe{constructor(e,t){super(e,"not-in",t)}matches(e){if(yo(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!yo(this.value.arrayValue,t)}},qh=class extends pe{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!_o(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>yo(this.value.arrayValue,r))}};zh=class{constructor(e,t=null,r=[],i=[],s=null,o=null,c=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=c,this.Pe=null}};Ft=class{constructor(e,t=null,r=[],i=[],s=null,o="F",c=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=c,this.endAt=u,this.Te=null,this.Ie=null,this.de=null,this.startAt,this.endAt}};Ut=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){ar(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return N_(this.inner)}size(){return this.innerSize}};ib=new Pe(q.comparator);Z_=new Pe(q.comparator);sb=new Pe(q.comparator),ob=new Ee(q.comparator);ab=new Ee(te);ji=class{constructor(){this._=void 0}};Yn=class extends ji{},bn=class extends ji{constructor(e){super(),this.elements=e}};An=class extends ji{constructor(e){super(),this.elements=e}};Jn=class extends ji{constructor(e,t){super(),this.serializer=e,this.Ee=t}};jr=class{constructor(e,t){this.field=e,this.transform=t}};Gh=class{constructor(e,t){this.version=e,this.transformResults=t}},Le=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};qi=class{};Xn=class extends qi{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},Bt=class extends qi{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};Zn=class extends qi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},vo=class extends qi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};wo=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&hb(s,e,r[i])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=so(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=so(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=tv();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,c=this.applyToLocalView(o,s.mutatedFields);c=t.has(i.key)?null:c;let u=cv(o,c);u!==null&&r.set(i.key,u),o.isValidDocument()||o.convertToNoDocument(ee.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),ie())}isEqual(e){return this.batchId===e.batchId&&xi(this.mutations,e.mutations,(t,r)=>wy(t,r))&&xi(this.baseMutations,e.baseMutations,(t,r)=>wy(t,r))}},Wh=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){Y(e.mutations.length===r.length,58842,{Ve:e.mutations.length,me:r.length});let i=function(){return sb}(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(e,t,r,i)}};Io=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};xc=class{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}};Kh=class{constructor(e,t){this.count=e,this.unchangedNames=t}};(ge=qe||(qe={}))[ge.OK=0]="OK",ge[ge.CANCELLED=1]="CANCELLED",ge[ge.UNKNOWN=2]="UNKNOWN",ge[ge.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ge[ge.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ge[ge.NOT_FOUND=5]="NOT_FOUND",ge[ge.ALREADY_EXISTS=6]="ALREADY_EXISTS",ge[ge.PERMISSION_DENIED=7]="PERMISSION_DENIED",ge[ge.UNAUTHENTICATED=16]="UNAUTHENTICATED",ge[ge.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ge[ge.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ge[ge.ABORTED=10]="ABORTED",ge[ge.OUT_OF_RANGE=11]="OUT_OF_RANGE",ge[ge.UNIMPLEMENTED=12]="UNIMPLEMENTED",ge[ge.INTERNAL=13]="INTERNAL",ge[ge.UNAVAILABLE=14]="UNAVAILABLE",ge[ge.DATA_LOSS=15]="DATA_LOSS";Dc=null;fb=new yn([4294967295,4294967295],0);Qh=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Nr(`Invalid padding: ${t}`);if(r<0)throw new Nr(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Nr(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Nr(`Invalid padding when bitmap length is 0: ${t}`);this.fe=8*e.length-t,this.ge=yn.fromNumber(this.fe)}pe(e,t,r){let i=e.add(t.multiply(yn.fromNumber(r)));return i.compare(fb)===1&&(i=new yn([i.getBits(0),i.getBits(1)],0)),i.modulo(this.ge).toNumber()}ye(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.fe===0)return!1;let t=Ty(e),[r,i]=by(t);for(let s=0;s<this.hashCount;s++){let o=this.pe(r,i,s);if(!this.ye(o))return!1}return!0}static create(e,t,r){let i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,i,t);return r.forEach(c=>o.insert(c)),o}insert(e){if(this.fe===0)return;let t=Ty(e),[r,i]=by(t);for(let s=0;s<this.hashCount;s++){let o=this.pe(r,i,s);this.we(o)}}we(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},Nr=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};Eo=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,To.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(ee.min(),i,new Pe(te),gt(),ie())}},To=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,ie(),ie(),ie())}};Pi=class{constructor(e,t,r,i){this.Se=e,this.removedTargetIds=t,this.key=r,this.be=i}},Nc=class{constructor(e,t){this.targetId=e,this.De=t}},Oc=class{constructor(e,t,r=Me.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},Vc=class{constructor(){this.ve=0,this.Ce=Ay(),this.Fe=Me.EMPTY_BYTE_STRING,this.Me=!1,this.xe=!0}get current(){return this.Me}get resumeToken(){return this.Fe}get Oe(){return this.ve!==0}get Ne(){return this.xe}Be(e){e.approximateByteSize()>0&&(this.xe=!0,this.Fe=e)}Le(){let e=ie(),t=ie(),r=ie();return this.Ce.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:W(38017,{changeType:s})}}),new To(this.Fe,this.Me,e,t,r)}ke(){this.xe=!1,this.Ce=Ay()}qe(e,t){this.xe=!0,this.Ce=this.Ce.insert(e,t)}Qe(e){this.xe=!0,this.Ce=this.Ce.remove(e)}$e(){this.ve+=1}Ue(){this.ve-=1,Y(this.ve>=0,3241,{ve:this.ve})}Ke(){this.xe=!0,this.Me=!0}},Yh=class{constructor(e){this.We=e,this.Ge=new Map,this.ze=gt(),this.je=nc(),this.Je=nc(),this.He=new Pe(te)}Ye(e){for(let t of e.Se)e.be&&e.be.isFoundDocument()?this.Ze(t,e.be):this.Xe(t,e.key,e.be);for(let t of e.removedTargetIds)this.Xe(t,e.key,e.be)}et(e){this.forEachTarget(e,t=>{let r=this.tt(t);switch(e.state){case 0:this.nt(t)&&r.Be(e.resumeToken);break;case 1:r.Ue(),r.Oe||r.ke(),r.Be(e.resumeToken);break;case 2:r.Ue(),r.Oe||this.removeTarget(t);break;case 3:this.nt(t)&&(r.Ke(),r.Be(e.resumeToken));break;case 4:this.nt(t)&&(this.rt(t),r.Be(e.resumeToken));break;default:W(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Ge.forEach((r,i)=>{this.nt(i)&&t(i)})}it(e){let t=e.targetId,r=e.De.count,i=this.st(t);if(i){let s=i.target;if(Pc(s))if(r===0){let o=new q(s.path);this.Xe(t,o,We.newNoDocument(o,ee.min()))}else Y(r===1,20013,{expectedCount:r});else{let o=this.ot(t);if(o!==r){let c=this._t(e),u=c?this.ut(c,e,o):1;if(u!==0){this.rt(t);let h=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.He=this.He.insert(t,h)}Dc?.ct(function(f,p,g,w,k){var D,C,H,F,z,ne;let se={localCacheCount:f,existenceFilterCount:p.count,databaseId:g.database,projectId:g.projectId},re=p.unchangedNames;return re&&(se.bloomFilter={applied:k===0,hashCount:(D=re?.hashCount)!==null&&D!==void 0?D:0,bitmapLength:(F=(H=(C=re?.bits)===null||C===void 0?void 0:C.bitmap)===null||H===void 0?void 0:H.length)!==null&&F!==void 0?F:0,padding:(ne=(z=re?.bits)===null||z===void 0?void 0:z.padding)!==null&&ne!==void 0?ne:0,mightContain:E=>{var _;return(_=w?.mightContain(E))!==null&&_!==void 0&&_}}),se}(o,e.De,this.We.lt(),c,u))}}}}_t(e){let t=e.De.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,o,c;try{o=Tn(r).toUint8Array()}catch(u){if(u instanceof Ac)return ut("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{c=new Qh(o,i,s)}catch(u){return ut(u instanceof Nr?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return c.fe===0?null:c}ut(e,t,r){return t.De.count===r-this.ht(e,t.targetId)?0:2}ht(e,t){let r=this.We.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let o=this.We.lt(),c=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(c)||(this.Xe(t,s,null),i++)}),i}Pt(e){let t=new Map;this.Ge.forEach((s,o)=>{let c=this.st(o);if(c){if(s.current&&Pc(c.target)){let u=new q(c.target.path);this.Tt(u).has(o)||this.It(o,u)||this.Xe(o,u,We.newNoDocument(u,e))}s.Ne&&(t.set(o,s.Le()),s.ke())}});let r=ie();this.Je.forEach((s,o)=>{let c=!0;o.forEachWhile(u=>{let h=this.st(u);return!h||h.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)}),c&&(r=r.add(s))}),this.ze.forEach((s,o)=>o.setReadTime(e));let i=new Eo(e,t,this.He,this.ze,r);return this.ze=gt(),this.je=nc(),this.Je=nc(),this.He=new Pe(te),i}Ze(e,t){if(!this.nt(e))return;let r=this.It(e,t.key)?2:0;this.tt(e).qe(t.key,r),this.ze=this.ze.insert(t.key,t),this.je=this.je.insert(t.key,this.Tt(t.key).add(e)),this.Je=this.Je.insert(t.key,this.dt(t.key).add(e))}Xe(e,t,r){if(!this.nt(e))return;let i=this.tt(e);this.It(e,t)?i.qe(t,1):i.Qe(t),this.Je=this.Je.insert(t,this.dt(t).delete(e)),this.Je=this.Je.insert(t,this.dt(t).add(e)),r&&(this.ze=this.ze.insert(t,r))}removeTarget(e){this.Ge.delete(e)}ot(e){let t=this.tt(e).Le();return this.We.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.tt(e).$e()}tt(e){let t=this.Ge.get(e);return t||(t=new Vc,this.Ge.set(e,t)),t}dt(e){let t=this.Je.get(e);return t||(t=new Ee(te),this.Je=this.Je.insert(e,t)),t}Tt(e){let t=this.je.get(e);return t||(t=new Ee(te),this.je=this.je.insert(e,t)),t}nt(e){let t=this.st(e)!==null;return t||V("WatchChangeAggregator","Detected inactive target",e),t}st(e){let t=this.Ge.get(e);return t&&t.Oe?null:this.We.Et(e)}rt(e){this.Ge.set(e,new Vc),this.We.getRemoteKeysForTarget(e).forEach(t=>{this.Xe(e,t,null)})}It(e,t){return this.We.getRemoteKeysForTarget(e).has(t)}};pb={asc:"ASCENDING",desc:"DESCENDING"},mb={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},gb={and:"AND",or:"OR"},Jh=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};$i=class n{constructor(e,t,r,i,s=ee.min(),o=ee.min(),c=Me.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=c,this.expectedCount=u}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};Lc=class{constructor(e){this.gt=e}};nd=class{getBundleMetadata(e,t){return ky(e).get(t).next(r=>{if(r)return function(s){return{id:s.bundleId,createTime:zr(s.createTime),version:s.version}}(r)})}saveBundleMetadata(e,t){return ky(e).put(function(i){return{bundleId:i.id,createTime:qr(je(i.createTime)),version:i.version}}(t))}getNamedQuery(e,t){return xy(e).get(t).next(r=>{if(r)return function(s){return{name:s.name,query:Cu(s.bundledQuery),readTime:zr(s.readTime)}}(r)})}saveNamedQuery(e,t){return xy(e).put(function(i){return{name:i.name,readTime:qr(je(i.readTime)),bundledQuery:i.bundledQuery}}(t))}};Fc=class n{constructor(e,t){this.serializer=e,this.userId=t}static yt(e,t){let r=t.uid||"";return new n(e,r)}getOverlay(e,t){return Ks(e).get(Py(this.userId,t)).next(r=>r?uh(this.serializer,r):null)}getOverlays(e,t){let r=Qt();return P.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){let i=[];return r.forEach((s,o)=>{let c=new Io(t,o);i.push(this.wt(e,c))}),P.waitFor(i)}removeOverlaysForBatchId(e,t,r){let i=new Set;t.forEach(o=>i.add(at(o.getCollectionPath())));let s=[];return i.forEach(o=>{let c=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(Ks(e).Y(xh,c))}),P.waitFor(s)}getOverlaysForCollection(e,t,r){let i=Qt(),s=at(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Ks(e).j(xh,o).next(c=>{for(let u of c){let h=uh(this.serializer,u);i.set(h.getKey(),h)}return i})}getOverlaysForCollectionGroup(e,t,r,i){let s=Qt(),o,c=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Ks(e).X({index:R_,range:c},(u,h,f)=>{let p=uh(this.serializer,h);s.size()<i||p.largestBatchId===o?(s.set(p.getKey(),p),o=p.largestBatchId):f.done()}).next(()=>s)}wt(e,t){return Ks(e).put(function(i,s,o){let[c,u,h]=Py(s,o.mutation.key);return{userId:s,collectionPath:u,documentId:h,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Ao(i.gt,o.mutation)}}(this.serializer,this.userId,t))}};rd=class{St(e){return Je(e,kf)}getSessionToken(e){return this.St(e).get("sessionToken").next(t=>{let r=t?.value;return r?Me.fromUint8Array(r):Me.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.St(e).put({name:"sessionToken",value:t.toUint8Array()})}};vn=class{constructor(){}bt(e,t){this.Dt(e,t),t.vt()}Dt(e,t){if("nullValue"in e)this.Ct(t,5);else if("booleanValue"in e)this.Ct(t,10),t.Ft(e.booleanValue?1:0);else if("integerValue"in e)this.Ct(t,15),t.Ft(ke(e.integerValue));else if("doubleValue"in e){let r=ke(e.doubleValue);isNaN(r)?this.Ct(t,13):(this.Ct(t,15),uo(r)?t.Ft(0):t.Ft(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ct(t,20),typeof r=="string"&&(r=En(r)),t.Mt(`${r.seconds||""}`),t.Ft(r.nanos||0)}else if("stringValue"in e)this.xt(e.stringValue,t),this.Ot(t);else if("bytesValue"in e)this.Ct(t,30),t.Nt(Tn(e.bytesValue)),this.Ot(t);else if("referenceValue"in e)this.Bt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Ct(t,45),t.Ft(r.latitude||0),t.Ft(r.longitude||0)}else"mapValue"in e?U_(e)?this.Ct(t,Number.MAX_SAFE_INTEGER):Su(e)?this.Lt(e.mapValue,t):(this.kt(e.mapValue,t),this.Ot(t)):"arrayValue"in e?(this.qt(e.arrayValue,t),this.Ot(t)):W(19022,{Qt:e})}xt(e,t){this.Ct(t,25),this.$t(e,t)}$t(e,t){t.Mt(e)}kt(e,t){let r=e.fields||{};this.Ct(t,55);for(let i of Object.keys(r))this.xt(i,t),this.Dt(r[i],t)}Lt(e,t){var r,i;let s=e.fields||{};this.Ct(t,53);let o=Fi,c=((i=(r=s[o].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.length)||0;this.Ct(t,15),t.Ft(ke(c)),this.xt(o,t),this.Dt(s[o],t)}qt(e,t){let r=e.values||[];this.Ct(t,50);for(let i of r)this.Dt(i,t)}Bt(e,t){this.Ct(t,37),q.fromName(e).path.forEach(r=>{this.Ct(t,60),this.$t(r,t)})}Ct(e,t){e.Ft(t)}Ot(e){e.Ft(2)}};vn.Ut=new vn;_i=255;id=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Kt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Wt(r.value),r=t.next();this.Gt()}zt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.jt(r.value),r=t.next();this.Jt()}Ht(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.Wt(r);else if(r<2048)this.Wt(960|r>>>6),this.Wt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Wt(480|r>>>12),this.Wt(128|63&r>>>6),this.Wt(128|63&r);else{let i=t.codePointAt(0);this.Wt(240|i>>>18),this.Wt(128|63&i>>>12),this.Wt(128|63&i>>>6),this.Wt(128|63&i)}}this.Gt()}Yt(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.jt(r);else if(r<2048)this.jt(960|r>>>6),this.jt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.jt(480|r>>>12),this.jt(128|63&r>>>6),this.jt(128|63&r);else{let i=t.codePointAt(0);this.jt(240|i>>>18),this.jt(128|63&i>>>12),this.jt(128|63&i>>>6),this.jt(128|63&i)}}this.Jt()}Zt(e){let t=this.Xt(e),r=Dy(t);this.en(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}tn(e){let t=this.Xt(e),r=Dy(t);this.en(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}nn(){this.rn(_i),this.rn(255)}sn(){this._n(_i),this._n(255)}reset(){this.position=0}seed(e){this.en(e.length),this.buffer.set(e,this.position),this.position+=e.length}an(){return this.buffer.slice(0,this.position)}Xt(e){let t=function(s){let o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(e),r=!!(128&t[0]);t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}Wt(e){let t=255&e;t===0?(this.rn(0),this.rn(255)):t===_i?(this.rn(_i),this.rn(0)):this.rn(t)}jt(e){let t=255&e;t===0?(this._n(0),this._n(255)):t===_i?(this._n(_i),this._n(0)):this._n(e)}Gt(){this.rn(0),this.rn(1)}Jt(){this._n(0),this._n(1)}rn(e){this.en(1),this.buffer[this.position++]=e}_n(e){this.en(1),this.buffer[this.position++]=~e}en(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);let i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}},sd=class{constructor(e){this.un=e}Nt(e){this.un.Kt(e)}Mt(e){this.un.Ht(e)}Ft(e){this.un.Zt(e)}vt(){this.un.nn()}},od=class{constructor(e){this.un=e}Nt(e){this.un.zt(e)}Mt(e){this.un.Yt(e)}Ft(e){this.un.tn(e)}vt(){this.un.sn()}},kr=class{constructor(){this.un=new id,this.cn=new sd(this.un),this.ln=new od(this.un)}seed(e){this.un.seed(e)}hn(e){return e===0?this.cn:this.ln}an(){return this.un.an()}reset(){this.un.reset()}};xr=class n{constructor(e,t,r,i){this.Pn=e,this.Tn=t,this.In=r,this.dn=i}En(){let e=this.dn.length,t=e===0||this.dn[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.dn,0),t!==e?r.set([0],this.dn.length):++r[r.length-1],new n(this.Pn,this.Tn,this.In,r)}An(e,t,r){return{indexId:this.Pn,uid:e,arrayValue:pc(this.In),directionalValue:pc(this.dn),orderedDocumentKey:pc(t),documentKey:r.path.toArray()}}Rn(e,t,r){let i=this.An(e,t,r);return[i.indexId,i.uid,i.arrayValue,i.directionalValue,i.orderedDocumentKey,i.documentKey]}};Uc=class{constructor(e){this.Vn=new Ee((t,r)=>Be.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.mn=e.orderBy,this.fn=[];for(let t of e.filters){let r=t;r.isInequality()?this.Vn=this.Vn.add(r):this.fn.push(r)}}get gn(){return this.Vn.size>1}pn(e){if(Y(e.collectionGroup===this.collectionId,49279),this.gn)return!1;let t=bh(e);if(t!==void 0&&!this.yn(t))return!1;let r=Sr(e),i=new Set,s=0,o=0;for(;s<r.length&&this.yn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.Vn.size>0){let c=this.Vn.getIterator().getNext();if(!i.has(c.field.canonicalString())){let u=r[s];if(!this.wn(c,u)||!this.Sn(this.mn[o++],u))return!1}++s}for(;s<r.length;++s){let c=r[s];if(o>=this.mn.length||!this.Sn(this.mn[o++],c))return!1}return!0}bn(){if(this.gn)return null;let e=new Ee(Be.comparator),t=[];for(let r of this.fn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new wn(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new wn(r.field,0))}for(let r of this.mn)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new wn(r.field,r.dir==="asc"?0:1)));return new Gn(Gn.UNKNOWN_ID,this.collectionId,t,Ni.empty())}yn(e){for(let t of this.fn)if(this.wn(t,e))return!0;return!1}wn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}Sn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}};ld=class{constructor(){this.Dn=new So}addToCollectionParentIndex(e,t){return this.Dn.add(t),P.resolve()}getCollectionParents(e,t){return P.resolve(this.Dn.getEntries(t))}addFieldIndex(e,t){return P.resolve()}deleteFieldIndex(e,t){return P.resolve()}deleteAllFieldIndexes(e){return P.resolve()}createTargetIndexes(e,t){return P.resolve()}getDocumentsMatchingTarget(e,t){return P.resolve(null)}getIndexType(e,t){return P.resolve(0)}getFieldIndexes(e,t){return P.resolve([])}getNextCollectionGroupToUpdate(e){return P.resolve(null)}getMinOffset(e,t){return P.resolve(Pt.min())}getMinOffsetFromCollectionGroup(e,t){return P.resolve(Pt.min())}updateCollectionGroup(e,t,r){return P.resolve()}updateIndexEntries(e,t){return P.resolve()}},So=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new Ee(fe.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new Ee(fe.comparator)).toArray()}};Ly="IndexedDbIndexManager",rc=new Uint8Array(0),hd=class{constructor(e,t){this.databaseId=t,this.vn=new So,this.Cn=new Ut(r=>Br(r),(r,i)=>Go(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.vn.has(t)){let r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.vn.add(t)});let s={collectionId:r,parent:at(i)};return My(e).put(s)}return P.resolve()}getCollectionParents(e,t){let r=[],i=IDBKeyRange.bound([t,""],[f_(t),""],!1,!0);return My(e).j(i).next(s=>{for(let o of s){if(o.collectionId!==t)break;r.push(Kt(o.parent))}return r})}addFieldIndex(e,t){let r=Qs(e),i=function(c){return{indexId:c.indexId,collectionGroup:c.collectionGroup,fields:c.fields.map(u=>[u.fieldPath.canonicalString(),u.kind])}}(t);delete i.indexId;let s=r.add(i);if(t.indexState){let o=wi(e);return s.next(c=>{o.put(Cy(c,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){let r=Qs(e),i=wi(e),s=vi(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=Qs(e),r=vi(e),i=wi(e);return t.Y().next(()=>r.Y()).next(()=>i.Y())}createTargetIndexes(e,t){return P.forEach(this.Fn(t),r=>this.getIndexType(e,r).next(i=>{if(i===0||i===1){let s=new Uc(r).bn();if(s!=null)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){let r=vi(e),i=!0,s=new Map;return P.forEach(this.Fn(t),o=>this.Mn(e,o).next(c=>{i&&(i=!!c),s.set(o,c)})).next(()=>{if(i){let o=ie(),c=[];return P.forEach(s,(u,h)=>{V(Ly,`Using index ${function(z){return`id=${z.indexId}|cg=${z.collectionGroup}|f=${z.fields.map(ne=>`${ne.fieldPath}:${ne.kind}`).join(",")}`}(u)} to execute ${Br(t)}`);let f=function(z,ne){let se=bh(ne);if(se===void 0)return null;for(let re of Cc(z,se.fieldPath))switch(re.op){case"array-contains-any":return re.value.arrayValue.values||[];case"array-contains":return[re.value]}return null}(h,u),p=function(z,ne){let se=new Map;for(let re of Sr(ne))for(let E of Cc(z,re.fieldPath))switch(E.op){case"==":case"in":se.set(re.fieldPath.canonicalString(),E.value);break;case"not-in":case"!=":return se.set(re.fieldPath.canonicalString(),E.value),Array.from(se.values())}return null}(h,u),g=function(z,ne){let se=[],re=!0;for(let E of Sr(ne)){let _=E.kind===0?gy(z,E.fieldPath,z.startAt):yy(z,E.fieldPath,z.startAt);se.push(_.value),re&&(re=_.inclusive)}return new tn(se,re)}(h,u),w=function(z,ne){let se=[],re=!0;for(let E of Sr(ne)){let _=E.kind===0?yy(z,E.fieldPath,z.endAt):gy(z,E.fieldPath,z.endAt);se.push(_.value),re&&(re=_.inclusive)}return new tn(se,re)}(h,u),k=this.xn(u,h,g),D=this.xn(u,h,w),C=this.On(u,h,p),H=this.Nn(u.indexId,f,k,g.inclusive,D,w.inclusive,C);return P.forEach(H,F=>r.H(F,t.limit).next(z=>{z.forEach(ne=>{let se=q.fromSegments(ne.documentKey);o.has(se)||(o=o.add(se),c.push(se))})}))}).next(()=>c)}return P.resolve(null)})}Fn(e){let t=this.Cn.get(e);return t||(e.filters.length===0?t=[e]:t=Pb(ve.create(e.filters,"and")).map(r=>$h(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.Cn.set(e,t),t)}Nn(e,t,r,i,s,o,c){let u=(t!=null?t.length:1)*Math.max(r.length,s.length),h=u/(t!=null?t.length:1),f=[];for(let p=0;p<u;++p){let g=t?this.Bn(t[p/h]):rc,w=this.Ln(e,g,r[p%h],i),k=this.kn(e,g,s[p%h],o),D=c.map(C=>this.Ln(e,g,C,!0));f.push(...this.createRange(w,k,D))}return f}Ln(e,t,r,i){let s=new xr(e,q.empty(),t,r);return i?s:s.En()}kn(e,t,r,i){let s=new xr(e,q.empty(),t,r);return i?s.En():s}Mn(e,t){let r=new Uc(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(let c of s)r.pn(c)&&(!o||c.fields.length>o.fields.length)&&(o=c);return o})}getIndexType(e,t){let r=2,i=this.Fn(t);return P.forEach(i,s=>this.Mn(e,s).next(o=>{o?r!==0&&o.fields.length<function(u){let h=new Ee(Be.comparator),f=!1;for(let p of u.filters)for(let g of p.getFlattenedFilters())g.field.isKeyField()||(g.op==="array-contains"||g.op==="array-contains-any"?f=!0:h=h.add(g.field));for(let p of u.orderBy)p.field.isKeyField()||(h=h.add(p.field));return h.size+(f?1:0)}(s)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&i.length>1&&r===2?1:r)}qn(e,t){let r=new kr;for(let i of Sr(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let o=r.hn(i.kind);vn.Ut.bt(s,o)}return r.an()}Bn(e){let t=new kr;return vn.Ut.bt(e,t.hn(0)),t.an()}Qn(e,t){let r=new kr;return vn.Ut.bt(Fr(this.databaseId,t),r.hn(function(s){let o=Sr(s);return o.length===0?0:o[o.length-1].kind}(e))),r.an()}On(e,t,r){if(r===null)return[];let i=[];i.push(new kr);let s=0;for(let o of Sr(e)){let c=r[s++];for(let u of i)if(this.$n(t,o.fieldPath)&&_o(c))i=this.Un(i,o,c);else{let h=u.hn(o.kind);vn.Ut.bt(c,h)}}return this.Kn(i)}xn(e,t,r){return this.On(e,t,r.position)}Kn(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].an();return t}Un(e,t,r){let i=[...e],s=[];for(let o of r.arrayValue.values||[])for(let c of i){let u=new kr;u.seed(c.an()),vn.Ut.bt(o,u.hn(t.kind)),s.push(u)}return s}$n(e,t){return!!e.filters.find(r=>r instanceof pe&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){let r=Qs(e),i=wi(e);return(t?r.j(kh,IDBKeyRange.bound(t,t)):r.j()).next(s=>{let o=[];return P.forEach(s,c=>i.get([c.indexId,this.uid]).next(u=>{o.push(function(f,p){let g=p?new Ni(p.sequenceNumber,new Pt(zr(p.readTime),new q(Kt(p.documentKey)),p.largestBatchId)):Ni.empty(),w=f.fields.map(([k,D])=>new wn(Be.fromServerFormat(k),D));return new Gn(f.indexId,f.collectionGroup,w,g)}(c,u))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,i)=>{let s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:te(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){let i=Qs(e),s=wi(e);return this.Wn(e).next(o=>i.j(kh,IDBKeyRange.bound(t,t)).next(c=>P.forEach(c,u=>s.put(Cy(u.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){let r=new Map;return P.forEach(t,(i,s)=>{let o=r.get(i.collectionGroup);return(o?P.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(c=>(r.set(i.collectionGroup,c),P.forEach(c,u=>this.Gn(e,i,u).next(h=>{let f=this.zn(s,u);return h.isEqual(f)?P.resolve():this.jn(e,s,u,h,f)}))))})}Jn(e,t,r,i){return vi(e).put(i.An(this.uid,this.Qn(r,t.key),t.key))}Hn(e,t,r,i){return vi(e).delete(i.Rn(this.uid,this.Qn(r,t.key),t.key))}Gn(e,t,r){let i=vi(e),s=new Ee(Mn);return i.X({index:S_,range:IDBKeyRange.only([r.indexId,this.uid,pc(this.Qn(r,t))])},(o,c)=>{s=s.add(new xr(r.indexId,t,Oy(c.arrayValue),Oy(c.directionalValue)))}).next(()=>s)}zn(e,t){let r=new Ee(Mn),i=this.qn(t,e);if(i==null)return r;let s=bh(t);if(s!=null){let o=e.data.field(s.fieldPath);if(_o(o))for(let c of o.arrayValue.values||[])r=r.add(new xr(t.indexId,e.key,this.Bn(c),i))}else r=r.add(new xr(t.indexId,e.key,rc,i));return r}jn(e,t,r,i,s){V(Ly,"Updating index entries for document '%s'",t.key);let o=[];return function(u,h,f,p,g){let w=u.getIterator(),k=h.getIterator(),D=yi(w),C=yi(k);for(;D||C;){let H=!1,F=!1;if(D&&C){let z=f(D,C);z<0?F=!0:z>0&&(H=!0)}else D!=null?F=!0:H=!0;H?(p(C),C=yi(k)):F?(g(D),D=yi(w)):(D=yi(w),C=yi(k))}}(i,s,Mn,c=>{o.push(this.Jn(e,t,r,c))},c=>{o.push(this.Hn(e,t,r,c))}),P.waitFor(o)}Wn(e){let t=1;return wi(e).X({index:A_,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,c)=>Mn(o,c)).filter((o,c,u)=>!c||Mn(o,u[c-1])!==0);let i=[];i.push(e);for(let o of r){let c=Mn(o,e),u=Mn(o,t);if(c===0)i[0]=e.En();else if(c>0&&u<0)i.push(o),i.push(o.En());else if(u>0)break}i.push(t);let s=[];for(let o=0;o<i.length;o+=2){if(this.Yn(i[o],i[o+1]))return[];let c=i[o].Rn(this.uid,rc,q.empty()),u=i[o+1].Rn(this.uid,rc,q.empty());s.push(IDBKeyRange.bound(c,u))}return s}Yn(e,t){return Mn(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Fy)}getMinOffset(e,t){return P.mapArray(this.Fn(t),r=>this.Mn(e,r).next(i=>i||W(44426))).next(Fy)}};Uy={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Sv=41943040,mt=class n{static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}};mt.DEFAULT_COLLECTION_PERCENTILE=10,mt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,mt.DEFAULT=new mt(Sv,mt.DEFAULT_COLLECTION_PERCENTILE,mt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),mt.DISABLED=new mt(-1,0,0);qc=class n{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.Zn={}}static yt(e,t,r,i){Y(e.uid!=="",64387);let s=e.isAuthenticated()?e.uid:"";return new n(s,t,r,i)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Fn(e).X({index:Dr,range:r},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,i){let s=Ai(e),o=Fn(e);return o.add({}).next(c=>{Y(typeof c=="number",49019);let u=new wo(c,t,r,i),h=function(w,k,D){let C=D.baseMutations.map(F=>Ao(w.gt,F)),H=D.mutations.map(F=>Ao(w.gt,F));return{userId:k,batchId:D.batchId,localWriteTimeMs:D.localWriteTime.toMillis(),baseMutations:C,mutations:H}}(this.serializer,this.userId,u),f=[],p=new Ee((g,w)=>te(g.canonicalString(),w.canonicalString()));for(let g of i){let w=E_(this.userId,g.key.path,c);p=p.add(g.key.path.popLast()),f.push(o.put(h)),f.push(s.put(w,P0))}return p.forEach(g=>{f.push(this.indexManager.addToCollectionParentIndex(e,g))}),e.addOnCommittedListener(()=>{this.Zn[c]=u.keys()}),P.waitFor(f).next(()=>u)})}lookupMutationBatch(e,t){return Fn(e).get(t).next(r=>r?(Y(r.userId===this.userId,48,"Unexpected user for mutation batch",{userId:r.userId,batchId:t}),Cr(this.serializer,r)):null)}Xn(e,t){return this.Zn[t]?P.resolve(this.Zn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){let i=r.keys();return this.Zn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),s=null;return Fn(e).X({index:Dr,range:i},(o,c,u)=>{c.userId===this.userId&&(Y(c.batchId>=r,47524,{er:r}),s=Cr(this.serializer,c)),u.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=$n;return Fn(e).X({index:Dr,range:t,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,$n],[this.userId,Number.POSITIVE_INFINITY]);return Fn(e).j(Dr,t).next(r=>r.map(i=>Cr(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=cc(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return Ai(e).X({range:i},(o,c,u)=>{let[h,f,p]=o,g=Kt(f);if(h===this.userId&&t.path.isEqual(g))return Fn(e).get(p).next(w=>{if(!w)throw W(61480,{tr:o,batchId:p});Y(w.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:w.userId,batchId:p}),s.push(Cr(this.serializer,w))});u.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Ee(te),i=[];return t.forEach(s=>{let o=cc(this.userId,s.path),c=IDBKeyRange.lowerBound(o),u=Ai(e).X({range:c},(h,f,p)=>{let[g,w,k]=h,D=Kt(w);g===this.userId&&s.path.isEqual(D)?r=r.add(k):p.done()});i.push(u)}),P.waitFor(i).next(()=>this.nr(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=cc(this.userId,r),o=IDBKeyRange.lowerBound(s),c=new Ee(te);return Ai(e).X({range:o},(u,h,f)=>{let[p,g,w]=u,k=Kt(g);p===this.userId&&r.isPrefixOf(k)?k.length===i&&(c=c.add(w)):f.done()}).next(()=>this.nr(e,c))}nr(e,t){let r=[],i=[];return t.forEach(s=>{i.push(Fn(e).get(s).next(o=>{if(o===null)throw W(35274,{batchId:s});Y(o.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:o.userId,batchId:s}),r.push(Cr(this.serializer,o))}))}),P.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return Rv(e.ce,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.rr(t.batchId)}),P.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}rr(e){delete this.Zn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return P.resolve();let r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),i=[];return Ai(e).X({range:r},(s,o,c)=>{if(s[0]===this.userId){let u=Kt(s[1]);i.push(u)}else c.done()}).next(()=>{Y(i.length===0,56720,{ir:i.map(s=>s.canonicalString())})})})}containsKey(e,t){return Pv(e,this.userId,t)}sr(e){return Cv(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:$n,lastStreamToken:""})}};Hi=class n{constructor(e){this._r=e}next(){return this._r+=2,this._r}static ar(){return new n(0)}static ur(){return new n(-1)}};dd=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.cr(e).next(t=>{let r=new Hi(t.highestTargetId);return t.highestTargetId=r.next(),this.lr(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.cr(e).next(t=>ee.fromTimestamp(new Re(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.cr(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.cr(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.lr(e,i)))}addTargetData(e,t){return this.hr(e,t).next(()=>this.cr(e).next(r=>(r.targetCount+=1,this.Pr(t,r),this.lr(e,r))))}updateTargetData(e,t){return this.hr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Ii(e).delete(t.targetId)).next(()=>this.cr(e)).next(r=>(Y(r.targetCount>0,8065),r.targetCount-=1,this.lr(e,r)))}removeTargets(e,t,r){let i=0,s=[];return Ii(e).X((o,c)=>{let u=Zs(c);u.sequenceNumber<=t&&r.get(u.targetId)===null&&(i++,s.push(this.removeTargetData(e,u)))}).next(()=>P.waitFor(s)).next(()=>i)}forEachTarget(e,t){return Ii(e).X((r,i)=>{let s=Zs(i);t(s)})}cr(e){return By(e).get(Tc).next(t=>(Y(t!==null,2888),t))}lr(e,t){return By(e).put(Tc,t)}hr(e,t){return Ii(e).put(Tv(this.serializer,t))}Pr(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.cr(e).next(t=>t.targetCount)}getTargetData(e,t){let r=Br(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),s=null;return Ii(e).X({range:i,index:b_},(o,c,u)=>{let h=Zs(c);Go(t,h.target)&&(s=h,u.done())}).next(()=>s)}addMatchingKeys(e,t,r){let i=[],s=jn(e);return t.forEach(o=>{let c=at(o.path);i.push(s.put({targetId:r,path:c})),i.push(this.referenceDelegate.addReference(e,r,o))}),P.waitFor(i)}removeMatchingKeys(e,t,r){let i=jn(e);return P.forEach(t,s=>{let o=at(s.path);return P.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){let r=jn(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),i=jn(e),s=ie();return i.X({range:r,Z:!0},(o,c,u)=>{let h=Kt(o[1]),f=new q(h);s=s.add(f)}).next(()=>s)}containsKey(e,t){let r=at(t.path),i=IDBKeyRange.bound([r],[f_(r)],!1,!0),s=0;return jn(e).X({index:Pf,Z:!0,range:i},([o,c],u,h)=>{o!==0&&(s++,h.done())}).next(()=>s>0)}Et(e,t){return Ii(e).get(t).next(r=>r?Zs(r):null)}};jy="LruGarbageCollector",kv=1048576;fd=class{constructor(e){this.Tr=e,this.buffer=new Ee(qy),this.Ir=0}dr(){return++this.Ir}Er(e){let t=[e,this.dr()];if(this.buffer.size<this.Tr)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();qy(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},zc=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Ar=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Rr(6e4)}stop(){this.Ar&&(this.Ar.cancel(),this.Ar=null)}get started(){return this.Ar!==null}Rr(e){V(jy,`Garbage collection scheduled in ${e}ms`),this.Ar=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Ar=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){or(t)?V(jy,"Ignoring IndexedDB error during garbage collection: ",t):await sr(t)}await this.Rr(3e5)})}},pd=class{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.mr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return P.resolve(ot.ue);let r=new fd(t);return this.Vr.forEachTarget(e,i=>r.Er(i.sequenceNumber)).next(()=>this.Vr.gr(e,i=>r.Er(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Vr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(V("LruGarbageCollector","Garbage collection skipped; disabled"),P.resolve(Uy)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(V("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Uy):this.pr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}pr(e,t){let r,i,s,o,c,u,h,f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(p=>(p>this.params.maximumSequenceNumbersToCollect?(V("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),i=this.params.maximumSequenceNumbersToCollect):i=p,o=Date.now(),this.nthSequenceNumber(e,i))).next(p=>(r=p,c=Date.now(),this.removeTargets(e,r,t))).next(p=>(s=p,u=Date.now(),this.removeOrphanedDocuments(e,r))).next(p=>(h=Date.now(),Ei()<=le.DEBUG&&V("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-f}ms
	Determined least recently used ${i} in `+(c-o)+`ms
	Removed ${s} targets in `+(u-c)+`ms
	Removed ${p} documents in `+(h-u)+`ms
Total Duration: ${h-f}ms`),P.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:p})))}};md=class{constructor(e,t){this.db=e,this.garbageCollector=xv(this,t)}mr(e){let t=this.yr(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}yr(e){let t=0;return this.gr(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}gr(e,t){return this.wr(e,(r,i)=>t(i))}addReference(e,t,r){return ic(e,r)}removeReference(e,t,r){return ic(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return ic(e,t)}Sr(e,t){return function(i,s){let o=!1;return Cv(i).ee(c=>Pv(i,c,s).next(u=>(u&&(o=!0),P.resolve(!u)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.wr(e,(o,c)=>{if(c<=t){let u=this.Sr(e,o).next(h=>{if(!h)return s++,r.getEntry(e,o).next(()=>(r.removeEntry(o,ee.min()),jn(e).delete(function(p){return[0,at(p.path)]}(o))))});i.push(u)}}).next(()=>P.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return ic(e,t)}wr(e,t){let r=jn(e),i,s=ot.ue;return r.X({index:Pf},([o,c],{path:u,sequenceNumber:h})=>{o===0?(s!==ot.ue&&t(new q(Kt(i)),s),s=h,i=u):s=ot.ue}).next(()=>{s!==ot.ue&&t(new q(Kt(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};$c=class{constructor(){this.changes=new Ut(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,We.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?P.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};gd=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Ar(e).put(r)}removeEntry(e,t,r){return Ar(e).delete(function(s,o){let c=s.path.toArray();return[c.slice(0,c.length-2),c[c.length-2],Mc(o),c[c.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.br(e,r)))}getEntry(e,t){let r=We.newInvalidDocument(t);return Ar(e).X({index:uc,range:IDBKeyRange.only(Ys(t))},(i,s)=>{r=this.Dr(t,s)}).next(()=>r)}vr(e,t){let r={size:0,document:We.newInvalidDocument(t)};return Ar(e).X({index:uc,range:IDBKeyRange.only(Ys(t))},(i,s)=>{r={document:this.Dr(t,s),size:jc(s)}}).next(()=>r)}getEntries(e,t){let r=gt();return this.Cr(e,t,(i,s)=>{let o=this.Dr(i,s);r=r.insert(i,o)}).next(()=>r)}Fr(e,t){let r=gt(),i=new Pe(q.comparator);return this.Cr(e,t,(s,o)=>{let c=this.Dr(s,o);r=r.insert(s,c),i=i.insert(s,jc(o))}).next(()=>({documents:r,Mr:i}))}Cr(e,t,r){if(t.isEmpty())return P.resolve();let i=new Ee(Hy);t.forEach(u=>i=i.add(u));let s=IDBKeyRange.bound(Ys(i.first()),Ys(i.last())),o=i.getIterator(),c=o.getNext();return Ar(e).X({index:uc,range:s},(u,h,f)=>{let p=q.fromSegments([...h.prefixPath,h.collectionGroup,h.documentId]);for(;c&&Hy(c,p)<0;)r(c,null),c=o.getNext();c&&c.isEqual(p)&&(r(c,h),c=o.hasNext()?o.getNext():null),c?f.G(Ys(c)):f.done()}).next(()=>{for(;c;)r(c,null),c=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){let o=t.path,c=[o.popLast().toArray(),o.lastSegment(),Mc(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],u=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Ar(e).j(IDBKeyRange.bound(c,u,!0)).next(h=>{s?.incrementDocumentReadCount(h.length);let f=gt();for(let p of h){let g=this.Dr(q.fromSegments(p.prefixPath.concat(p.collectionGroup,p.documentId)),p);g.isFoundDocument()&&(Ko(t,g)||i.has(g.key))&&(f=f.insert(g.key,g))}return f})}getAllFromCollectionGroup(e,t,r,i){let s=gt(),o=$y(t,r),c=$y(t,Pt.max());return Ar(e).X({index:T_,range:IDBKeyRange.bound(o,c,!0)},(u,h,f)=>{let p=this.Dr(q.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);s=s.insert(p.key,p),s.size===i&&f.done()}).next(()=>s)}newChangeBuffer(e){return new yd(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return zy(e).get(Ch).next(t=>(Y(!!t,20021),t))}br(e,t){return zy(e).put(Ch,t)}Dr(e,t){if(t){let r=Sb(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(ee.min())))return r}return We.newInvalidDocument(e)}};yd=class extends $c{constructor(e,t){super(),this.Or=e,this.trackRemovals=t,this.Nr=new Ut(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){let t=[],r=0,i=new Ee((s,o)=>te(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let c=this.Nr.get(s);if(t.push(this.Or.removeEntry(e,s,c.readTime)),o.isValidDocument()){let u=Ry(this.Or.serializer,o);i=i.add(s.path.popLast());let h=jc(u);r+=h-c.size,t.push(this.Or.addEntry(e,s,u))}else if(r-=c.size,this.trackRemovals){let u=Ry(this.Or.serializer,o.convertToNoDocument(ee.min()));t.push(this.Or.addEntry(e,s,u))}}),i.forEach(s=>{t.push(this.Or.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.Or.updateMetadata(e,r)),P.waitFor(t)}getFromCache(e,t){return this.Or.vr(e,t).next(r=>(this.Nr.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.Or.Fr(e,t).next(({documents:r,Mr:i})=>(i.forEach((s,o)=>{this.Nr.set(s,{size:o,readTime:r.get(s).readTime})}),r))}};_d=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};Hc=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&so(r.mutation,i,bt.empty(),Re.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,ie()).next(()=>r))}getLocalViewOfDocuments(e,t,r=ie()){let i=Qt();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=Xs();return s.forEach((c,u)=>{o=o.insert(c,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let r=Qt();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,ie()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,c)=>{t.set(o,c)})})}computeViews(e,t,r,i){let s=gt(),o=io(),c=function(){return io()}();return t.forEach((u,h)=>{let f=r.get(h.key);i.has(h.key)&&(f===void 0||f.mutation instanceof Bt)?s=s.insert(h.key,h):f!==void 0?(o.set(h.key,f.mutation.getFieldMask()),so(f.mutation,h,f.mutation.getFieldMask(),Re.now())):o.set(h.key,bt.empty())}),this.recalculateAndSaveOverlays(e,s).next(u=>(u.forEach((h,f)=>o.set(h,f)),t.forEach((h,f)=>{var p;return c.set(h,new _d(f,(p=o.get(h))!==null&&p!==void 0?p:null))}),c))}recalculateAndSaveOverlays(e,t){let r=io(),i=new Pe((o,c)=>o-c),s=ie();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let c of o)c.keys().forEach(u=>{let h=t.get(u);if(h===null)return;let f=r.get(u)||bt.empty();f=c.applyToLocalView(h,f),r.set(u,f);let p=(i.get(c.batchId)||ie()).add(u);i=i.insert(c.batchId,p)})}).next(()=>{let o=[],c=i.getReverseIterator();for(;c.hasNext();){let u=c.getNext(),h=u.key,f=u.value,p=tv();f.forEach(g=>{if(!s.has(g)){let w=cv(t.get(g),r.get(g));w!==null&&p.set(g,w),s=s.add(g)}}),o.push(this.documentOverlayCache.saveOverlays(e,h,p))}return P.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return function(o){return q.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Vf(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):P.resolve(Qt()),c=Di,u=s;return o.next(h=>P.forEach(h,(f,p)=>(c<p.largestBatchId&&(c=p.largestBatchId),s.get(f)?P.resolve():this.remoteDocumentCache.getEntry(e,f).next(g=>{u=u.insert(f,g)}))).next(()=>this.populateOverlays(e,h,s)).next(()=>this.computeViews(e,u,h,ie())).next(f=>({batchId:c,changes:ev(f)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new q(t)).next(r=>{let i=Xs();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,o=Xs();return this.indexManager.getCollectionParents(e,s).next(c=>P.forEach(c,u=>{let h=function(p,g){return new Ft(g,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt)}(t,u.child(s));return this.getDocumentsMatchingCollectionQuery(e,h,r,i).next(f=>{f.forEach((p,g)=>{o=o.insert(p,g)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((u,h)=>{let f=h.getKey();o.get(f)===null&&(o=o.insert(f,We.newInvalidDocument(f)))});let c=Xs();return o.forEach((u,h)=>{let f=s.get(u);f!==void 0&&so(f.mutation,h,bt.empty(),Re.now()),Ko(t,h)&&(c=c.insert(u,h))}),c})}};vd=class{constructor(e){this.serializer=e,this.Br=new Map,this.Lr=new Map}getBundleMetadata(e,t){return P.resolve(this.Br.get(t))}saveBundleMetadata(e,t){return this.Br.set(t.id,function(i){return{id:i.id,version:i.version,createTime:je(i.createTime)}}(t)),P.resolve()}getNamedQuery(e,t){return P.resolve(this.Lr.get(t))}saveNamedQuery(e,t){return this.Lr.set(t.name,function(i){return{name:i.name,query:Cu(i.bundledQuery),readTime:je(i.readTime)}}(t)),P.resolve()}};wd=class{constructor(){this.overlays=new Pe(q.comparator),this.kr=new Map}getOverlay(e,t){return P.resolve(this.overlays.get(t))}getOverlays(e,t){let r=Qt();return P.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.wt(e,t,s)}),P.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.kr.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.kr.delete(r)),P.resolve()}getOverlaysForCollection(e,t,r){let i=Qt(),s=t.length+1,o=new q(t.child("")),c=this.overlays.getIteratorFrom(o);for(;c.hasNext();){let u=c.getNext().value,h=u.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===s&&u.largestBatchId>r&&i.set(u.getKey(),u)}return P.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new Pe((h,f)=>h-f),o=this.overlays.getIterator();for(;o.hasNext();){let h=o.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>r){let f=s.get(h.largestBatchId);f===null&&(f=Qt(),s=s.insert(h.largestBatchId,f)),f.set(h.getKey(),h)}}let c=Qt(),u=s.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((h,f)=>c.set(h,f)),!(c.size()>=i)););return P.resolve(c)}wt(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.kr.get(i.largestBatchId).delete(r.key);this.kr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Io(t,r));let s=this.kr.get(t);s===void 0&&(s=ie(),this.kr.set(t,s)),this.kr.set(t,s.add(r.key))}};Id=class{constructor(){this.sessionToken=Me.EMPTY_BYTE_STRING}getSessionToken(e){return P.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,P.resolve()}};Ro=class{constructor(){this.qr=new Ee(ze.Qr),this.$r=new Ee(ze.Ur)}isEmpty(){return this.qr.isEmpty()}addReference(e,t){let r=new ze(e,t);this.qr=this.qr.add(r),this.$r=this.$r.add(r)}Kr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Wr(new ze(e,t))}Gr(e,t){e.forEach(r=>this.removeReference(r,t))}zr(e){let t=new q(new fe([])),r=new ze(t,e),i=new ze(t,e+1),s=[];return this.$r.forEachInRange([r,i],o=>{this.Wr(o),s.push(o.key)}),s}jr(){this.qr.forEach(e=>this.Wr(e))}Wr(e){this.qr=this.qr.delete(e),this.$r=this.$r.delete(e)}Jr(e){let t=new q(new fe([])),r=new ze(t,e),i=new ze(t,e+1),s=ie();return this.$r.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new ze(e,0),r=this.qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},ze=class{constructor(e,t){this.key=e,this.Hr=t}static Qr(e,t){return q.comparator(e.key,t.key)||te(e.Hr,t.Hr)}static Ur(e,t){return te(e.Hr,t.Hr)||q.comparator(e.key,t.key)}};Ed=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.er=1,this.Yr=new Ee(ze.Qr)}checkEmpty(e){return P.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.er;this.er++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new wo(s,t,r,i);this.mutationQueue.push(o);for(let c of i)this.Yr=this.Yr.add(new ze(c.key,s)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast());return P.resolve(o)}lookupMutationBatch(e,t){return P.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.Xr(r),s=i<0?0:i;return P.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return P.resolve(this.mutationQueue.length===0?$n:this.er-1)}getAllMutationBatches(e){return P.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new ze(t,0),i=new ze(t,Number.POSITIVE_INFINITY),s=[];return this.Yr.forEachInRange([r,i],o=>{let c=this.Zr(o.Hr);s.push(c)}),P.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Ee(te);return t.forEach(i=>{let s=new ze(i,0),o=new ze(i,Number.POSITIVE_INFINITY);this.Yr.forEachInRange([s,o],c=>{r=r.add(c.Hr)})}),P.resolve(this.ei(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;q.isDocumentKey(s)||(s=s.child(""));let o=new ze(new q(s),0),c=new Ee(te);return this.Yr.forEachWhile(u=>{let h=u.key.path;return!!r.isPrefixOf(h)&&(h.length===i&&(c=c.add(u.Hr)),!0)},o),P.resolve(this.ei(c))}ei(e){let t=[];return e.forEach(r=>{let i=this.Zr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){Y(this.ti(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Yr;return P.forEach(t.mutations,i=>{let s=new ze(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Yr=r})}rr(e){}containsKey(e,t){let r=new ze(t,0),i=this.Yr.firstAfterOrEqual(r);return P.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,P.resolve()}ti(e,t){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){let t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};Td=class{constructor(e){this.ni=e,this.docs=function(){return new Pe(q.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.ni(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return P.resolve(r?r.document.mutableCopy():We.newInvalidDocument(t))}getEntries(e,t){let r=gt();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():We.newInvalidDocument(i))}),P.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=gt(),o=t.path,c=new q(o.child("__id-9223372036854775808__")),u=this.docs.getIteratorFrom(c);for(;u.hasNext();){let{key:h,value:{document:f}}=u.getNext();if(!o.isPrefixOf(h.path))break;h.path.length>o.length+1||Sf(__(f),r)<=0||(i.has(f.key)||Ko(t,f))&&(s=s.insert(f.key,f.mutableCopy()))}return P.resolve(s)}getAllFromCollectionGroup(e,t,r,i){W(9500)}ri(e,t){return P.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new bd(this)}getSize(e){return P.resolve(this.size)}},bd=class extends $c{constructor(e){super(),this.Or=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.Or.addEntry(e,i)):this.Or.removeEntry(r)}),P.waitFor(t)}getFromCache(e,t){return this.Or.getEntry(e,t)}getAllFromCache(e,t){return this.Or.getEntries(e,t)}};Ad=class{constructor(e){this.persistence=e,this.ii=new Ut(t=>Br(t),Go),this.lastRemoteSnapshotVersion=ee.min(),this.highestTargetId=0,this.si=0,this.oi=new Ro,this.targetCount=0,this._i=Hi.ar()}forEachTarget(e,t){return this.ii.forEach((r,i)=>t(i)),P.resolve()}getLastRemoteSnapshotVersion(e){return P.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return P.resolve(this.si)}allocateTargetId(e){return this.highestTargetId=this._i.next(),P.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.si&&(this.si=t),P.resolve()}hr(e){this.ii.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this._i=new Hi(t),this.highestTargetId=t),e.sequenceNumber>this.si&&(this.si=e.sequenceNumber)}addTargetData(e,t){return this.hr(t),this.targetCount+=1,P.resolve()}updateTargetData(e,t){return this.hr(t),P.resolve()}removeTargetData(e,t){return this.ii.delete(t.target),this.oi.zr(t.targetId),this.targetCount-=1,P.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.ii.forEach((o,c)=>{c.sequenceNumber<=t&&r.get(c.targetId)===null&&(this.ii.delete(o),s.push(this.removeMatchingKeysForTargetId(e,c.targetId)),i++)}),P.waitFor(s).next(()=>i)}getTargetCount(e){return P.resolve(this.targetCount)}getTargetData(e,t){let r=this.ii.get(t)||null;return P.resolve(r)}addMatchingKeys(e,t,r){return this.oi.Kr(t,r),P.resolve()}removeMatchingKeys(e,t,r){this.oi.Gr(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),P.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.oi.zr(t),P.resolve()}getMatchingKeysForTargetId(e,t){let r=this.oi.Jr(t);return P.resolve(r)}containsKey(e,t){return P.resolve(this.oi.containsKey(t))}};Po=class{constructor(e,t){this.ai={},this.overlays={},this.ui=new ot(0),this.ci=!1,this.ci=!0,this.li=new Id,this.referenceDelegate=e(this),this.hi=new Ad(this),this.indexManager=new ld,this.remoteDocumentCache=function(i){return new Td(i)}(r=>this.referenceDelegate.Pi(r)),this.serializer=new Lc(t),this.Ti=new vd(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ci=!1,Promise.resolve()}get started(){return this.ci}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new wd,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ai[e.toKey()];return r||(r=new Ed(t,this.referenceDelegate),this.ai[e.toKey()]=r),r}getGlobalsCache(){return this.li}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ti}runTransaction(e,t,r){V("MemoryPersistence","Starting transaction:",e);let i=new Sd(this.ui.next());return this.referenceDelegate.Ii(),r(i).next(s=>this.referenceDelegate.di(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Ei(e,t){return P.or(Object.values(this.ai).map(r=>()=>r.containsKey(e,t)))}},Sd=class extends vc{constructor(e){super(),this.currentSequenceNumber=e}},Gc=class n{constructor(e){this.persistence=e,this.Ai=new Ro,this.Ri=null}static Vi(e){return new n(e)}get mi(){if(this.Ri)return this.Ri;throw W(60996)}addReference(e,t,r){return this.Ai.addReference(r,t),this.mi.delete(r.toString()),P.resolve()}removeReference(e,t,r){return this.Ai.removeReference(r,t),this.mi.add(r.toString()),P.resolve()}markPotentiallyOrphaned(e,t){return this.mi.add(t.toString()),P.resolve()}removeTarget(e,t){this.Ai.zr(t.targetId).forEach(i=>this.mi.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.mi.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}Ii(){this.Ri=new Set}di(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return P.forEach(this.mi,r=>{let i=q.fromPath(r);return this.fi(e,i).next(s=>{s||t.removeEntry(i,ee.min())})}).next(()=>(this.Ri=null,t.apply(e)))}updateLimboDocument(e,t){return this.fi(e,t).next(r=>{r?this.mi.delete(t.toString()):this.mi.add(t.toString())})}Pi(e){return 0}fi(e,t){return P.or([()=>P.resolve(this.Ai.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}},Wc=class n{constructor(e,t){this.persistence=e,this.gi=new Ut(r=>at(r.path),(r,i)=>r.isEqual(i)),this.garbageCollector=xv(this,t)}static Vi(e,t){return new n(e,t)}Ii(){}di(e){return P.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}mr(e){let t=this.yr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}yr(e){let t=0;return this.gr(e,r=>{t++}).next(()=>t)}gr(e,t){return P.forEach(this.gi,(r,i)=>this.Sr(e,r,i).next(s=>s?P.resolve():t(i)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.ri(e,o=>this.Sr(e,o,t).next(c=>{c||(r++,s.removeEntry(o,ee.min()))})).next(()=>s.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.gi.set(t,e.currentSequenceNumber),P.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.gi.set(r,e.currentSequenceNumber),P.resolve()}removeReference(e,t,r){return this.gi.set(r,e.currentSequenceNumber),P.resolve()}updateLimboDocument(e,t){return this.gi.set(t,e.currentSequenceNumber),P.resolve()}Pi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=hc(e.data.value)),t}Sr(e,t,r){return P.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let i=this.gi.get(t);return P.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}};Rd=class{constructor(e){this.serializer=e}q(e,t,r,i){let s=new wc("createOrUpgrade",t);r<1&&i>=1&&(function(u){u.createObjectStore(Ho)}(e),function(u){u.createObjectStore(lo,{keyPath:R0}),u.createObjectStore(Vt,{keyPath:sy,autoIncrement:!0}).createIndex(Dr,oy,{unique:!0}),u.createObjectStore(Oi)}(e),Gy(e),function(u){u.createObjectStore(Rr)}(e));let o=P.resolve();return r<3&&i>=3&&(r!==0&&(function(u){u.deleteObjectStore(Li),u.deleteObjectStore(Vi),u.deleteObjectStore(Vr)}(e),Gy(e)),o=o.next(()=>function(u){let h=u.store(Vr),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:ee.min().toTimestamp(),targetCount:0};return h.put(Tc,f)}(s))),r<4&&i>=4&&(r!==0&&(o=o.next(()=>function(u,h){return h.store(Vt).j().next(p=>{u.deleteObjectStore(Vt),u.createObjectStore(Vt,{keyPath:sy,autoIncrement:!0}).createIndex(Dr,oy,{unique:!0});let g=h.store(Vt),w=p.map(k=>g.put(k));return P.waitFor(w)})}(e,s))),o=o.next(()=>{(function(u){u.createObjectStore(Mi,{keyPath:L0})})(e)})),r<5&&i>=5&&(o=o.next(()=>this.pi(s))),r<6&&i>=6&&(o=o.next(()=>(function(u){u.createObjectStore(ho)}(e),this.yi(s)))),r<7&&i>=7&&(o=o.next(()=>this.wi(s))),r<8&&i>=8&&(o=o.next(()=>this.Si(e,s))),r<9&&i>=9&&(o=o.next(()=>{(function(u){u.objectStoreNames.contains("remoteDocumentChanges")&&u.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&i>=10&&(o=o.next(()=>this.bi(s))),r<11&&i>=11&&(o=o.next(()=>{(function(u){u.createObjectStore(Iu,{keyPath:M0})})(e),function(u){u.createObjectStore(Eu,{keyPath:F0})}(e)})),r<12&&i>=12&&(o=o.next(()=>{(function(u){let h=u.createObjectStore(Tu,{keyPath:H0});h.createIndex(xh,G0,{unique:!1}),h.createIndex(R_,W0,{unique:!1})})(e)})),r<13&&i>=13&&(o=o.next(()=>function(u){let h=u.createObjectStore(Ec,{keyPath:C0});h.createIndex(uc,k0),h.createIndex(T_,x0)}(e)).next(()=>this.Di(e,s)).next(()=>e.deleteObjectStore(Rr))),r<14&&i>=14&&(o=o.next(()=>this.Ci(e,s))),r<15&&i>=15&&(o=o.next(()=>function(u){u.createObjectStore(Cf,{keyPath:U0,autoIncrement:!0}).createIndex(kh,B0,{unique:!1}),u.createObjectStore(to,{keyPath:j0}).createIndex(A_,q0,{unique:!1}),u.createObjectStore(no,{keyPath:z0}).createIndex(S_,$0,{unique:!1})}(e))),r<16&&i>=16&&(o=o.next(()=>{t.objectStore(to).clear()}).next(()=>{t.objectStore(no).clear()})),r<17&&i>=17&&(o=o.next(()=>{(function(u){u.createObjectStore(kf,{keyPath:K0})})(e)})),r<18&&i>=18&&ul()&&(o=o.next(()=>{t.objectStore(to).clear()}).next(()=>{t.objectStore(no).clear()})),o}yi(e){let t=0;return e.store(Rr).X((r,i)=>{t+=jc(i)}).next(()=>{let r={byteSize:t};return e.store(ho).put(Ch,r)})}pi(e){let t=e.store(lo),r=e.store(Vt);return t.j().next(i=>P.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,$n],[s.userId,s.lastAcknowledgedBatchId]);return r.j(Dr,o).next(c=>P.forEach(c,u=>{Y(u.userId===s.userId,18650,"Cannot process batch from unexpected user",{batchId:u.batchId});let h=Cr(this.serializer,u);return Rv(e,s.userId,h).next(()=>{})}))}))}wi(e){let t=e.store(Li),r=e.store(Rr);return e.store(Vr).get(Tc).next(i=>{let s=[];return r.X((o,c)=>{let u=new fe(o),h=function(p){return[0,at(p)]}(u);s.push(t.get(h).next(f=>f?P.resolve():(p=>t.put({targetId:0,path:at(p),sequenceNumber:i.highestListenSequenceNumber}))(u)))}).next(()=>P.waitFor(s))})}Si(e,t){e.createObjectStore(fo,{keyPath:V0});let r=t.store(fo),i=new So,s=o=>{if(i.add(o)){let c=o.lastSegment(),u=o.popLast();return r.put({collectionId:c,parent:at(u)})}};return t.store(Rr).X({Z:!0},(o,c)=>{let u=new fe(o);return s(u.popLast())}).next(()=>t.store(Oi).X({Z:!0},([o,c,u],h)=>{let f=Kt(c);return s(f.popLast())}))}bi(e){let t=e.store(Vi);return t.X((r,i)=>{let s=Zs(i),o=Tv(this.serializer,s);return t.put(o)})}Di(e,t){let r=t.store(Rr),i=[];return r.X((s,o)=>{let c=t.store(Ec),u=function(p){return p.document?new q(fe.fromString(p.document.name).popFirst(5)):p.noDocument?q.fromSegments(p.noDocument.path):p.unknownDocument?q.fromSegments(p.unknownDocument.path):W(36783)}(o).path.toArray(),h={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(c.put(h))}).next(()=>P.waitFor(i))}Ci(e,t){let r=t.store(Vt),i=Dv(this.serializer),s=new Po(Gc.Vi,this.serializer.gt);return r.j().next(o=>{let c=new Map;return o.forEach(u=>{var h;let f=(h=c.get(u.userId))!==null&&h!==void 0?h:ie();Cr(this.serializer,u).keys().forEach(p=>f=f.add(p)),c.set(u.userId,f)}),P.forEach(c,(u,h)=>{let f=new $e(h),p=Fc.yt(this.serializer,f),g=s.getIndexManager(f),w=qc.yt(f,this.serializer,g,s.referenceDelegate);return new Hc(i,w,p,g).recalculateAndSaveOverlaysForDocumentKeys(new po(t,ot.ue),u).next()})})}};Un="IndexedDbPersistence",lh=18e5,hh=5e3,dh="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Nv="main",Pd=class n{constructor(e,t,r,i,s,o,c,u,h,f,p=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Fi=s,this.window=o,this.document=c,this.Mi=h,this.xi=f,this.Oi=p,this.ui=null,this.ci=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ni=null,this.inForeground=!1,this.Bi=null,this.Li=null,this.ki=Number.NEGATIVE_INFINITY,this.qi=g=>Promise.resolve(),!n.C())throw new N(R.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new md(this,i),this.Qi=t+Nv,this.serializer=new Lc(u),this.$i=new Wn(this.Qi,this.Oi,new Rd(this.serializer)),this.li=new rd,this.hi=new dd(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Dv(this.serializer),this.Ti=new nd,this.window&&this.window.localStorage?this.Ui=this.window.localStorage:(this.Ui=null,f===!1&&Ue(Un,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ki().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new N(R.FAILED_PRECONDITION,dh);return this.Wi(),this.Gi(),this.zi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.hi.getHighestSequenceNumber(e))}).then(e=>{this.ui=new ot(e,this.Mi)}).then(()=>{this.ci=!0}).catch(e=>(this.$i&&this.$i.close(),Promise.reject(e)))}ji(e){return this.qi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.$i.setDatabaseDeletedListener(e)}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Fi.enqueueAndForget(async()=>{this.started&&await this.Ki()}))}Ki(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>sc(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Ji(e).next(t=>{t||(this.isPrimary=!1,this.Fi.enqueueRetryable(()=>this.qi(!1)))})}).next(()=>this.Hi(e)).next(t=>this.isPrimary&&!t?this.Yi(e).next(()=>!1):!!t&&this.Zi(e).next(()=>!0))).catch(e=>{if(or(e))return V(Un,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return V(Un,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Fi.enqueueRetryable(()=>this.qi(e)),this.isPrimary=e})}Ji(e){return Js(e).get(gi).next(t=>P.resolve(this.Xi(t)))}es(e){return sc(e).delete(this.clientId)}async ts(){if(this.isPrimary&&!this.ns(this.ki,lh)){this.ki=Date.now();let e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let r=Je(t,Mi);return r.j().next(i=>{let s=this.rs(i,lh),o=i.filter(c=>s.indexOf(c)===-1);return P.forEach(o,c=>r.delete(c.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Ui)for(let t of e)this.Ui.removeItem(this.ss(t.clientId))}}zi(){this.Li=this.Fi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Ki().then(()=>this.ts()).then(()=>this.zi()))}Xi(e){return!!e&&e.ownerId===this.clientId}Hi(e){return this.xi?P.resolve(!0):Js(e).get(gi).next(t=>{if(t!==null&&this.ns(t.leaseTimestampMs,hh)&&!this._s(t.ownerId)){if(this.Xi(t)&&this.networkEnabled)return!0;if(!this.Xi(t)){if(!t.allowTabSynchronization)throw new N(R.FAILED_PRECONDITION,dh);return!1}}return!(!this.networkEnabled||!this.inForeground)||sc(e).j().next(r=>this.rs(r,hh).find(i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,o=!this.inForeground&&i.inForeground,c=this.networkEnabled===i.networkEnabled;if(s||o&&c)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&V(Un,`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.ci=!1,this.us(),this.Li&&(this.Li.cancel(),this.Li=null),this.cs(),this.ls(),await this.$i.runTransaction("shutdown","readwrite",[Ho,Mi],e=>{let t=new po(e,ot.ue);return this.Yi(t).next(()=>this.es(t))}),this.$i.close(),this.hs()}rs(e,t){return e.filter(r=>this.ns(r.updateTimeMs,t)&&!this._s(r.clientId))}Ps(){return this.runTransaction("getActiveClients","readonly",e=>sc(e).j().next(t=>this.rs(t,lh).map(r=>r.clientId)))}get started(){return this.ci}getGlobalsCache(){return this.li}getMutationQueue(e,t){return qc.yt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new hd(e,this.serializer.gt.databaseId)}getDocumentOverlayCache(e){return Fc.yt(this.serializer,e)}getBundleCache(){return this.Ti}runTransaction(e,t,r){V(Un,"Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",s=function(u){return u===18?J0:u===17?x_:u===16?Y0:u===15?xf:u===14?k_:u===13?C_:u===12?Q0:u===11?P_:void W(60245)}(this.Oi),o;return this.$i.runTransaction(e,i,s,c=>(o=new po(c,this.ui?this.ui.next():ot.ue),t==="readwrite-primary"?this.Ji(o).next(u=>!!u||this.Hi(o)).next(u=>{if(!u)throw Ue(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Fi.enqueueRetryable(()=>this.qi(!1)),new N(R.FAILED_PRECONDITION,v_);return r(o)}).next(u=>this.Zi(o).next(()=>u)):this.Ts(o).next(()=>r(o)))).then(c=>(o.raiseOnCommittedEvent(),c))}Ts(e){return Js(e).get(gi).next(t=>{if(t!==null&&this.ns(t.leaseTimestampMs,hh)&&!this._s(t.ownerId)&&!this.Xi(t)&&!(this.xi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new N(R.FAILED_PRECONDITION,dh)})}Zi(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Js(e).put(gi,t)}static C(){return Wn.C()}Yi(e){let t=Js(e);return t.get(gi).next(r=>this.Xi(r)?(V(Un,"Releasing primary lease."),t.delete(gi)):P.resolve())}ns(e,t){let r=Date.now();return!(e<r-t)&&(!(e>r)||(Ue(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Wi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Bi=()=>{this.Fi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Ki()))},this.document.addEventListener("visibilitychange",this.Bi),this.inForeground=this.document.visibilityState==="visible")}cs(){this.Bi&&(this.document.removeEventListener("visibilitychange",this.Bi),this.Bi=null)}Gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Ni=()=>{this.us();let t=/(?:Version|Mobile)\/1[456]/;cl()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.Fi.enterRestrictedMode(!0),this.Fi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Ni))}ls(){this.Ni&&(this.window.removeEventListener("pagehide",this.Ni),this.Ni=null)}_s(e){var t;try{let r=((t=this.Ui)===null||t===void 0?void 0:t.getItem(this.ss(e)))!==null;return V(Un,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Ue(Un,"Failed to get zombied client id.",r),!1}}us(){if(this.Ui)try{this.Ui.setItem(this.ss(this.clientId),String(Date.now()))}catch(e){Ue("Failed to set zombie client id.",e)}}hs(){if(this.Ui)try{this.Ui.removeItem(this.ss(this.clientId))}catch{}}ss(e){return`firestore_zombie_${this.persistenceKey}_${e}`}};Cd=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.Is=r,this.ds=i}static Es(e,t){let r=ie(),i=ie();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new n(e,t.fromCache,r,i)}};kd=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};Kc=class{constructor(){this.As=!1,this.Rs=!1,this.Vs=100,this.fs=function(){return cl()?8:w_(Fe())>0?6:4}()}initialize(e,t){this.gs=e,this.indexManager=t,this.As=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.ps(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.ys(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new kd;return this.ws(e,t,o).next(c=>{if(s.result=c,this.Rs)return this.Ss(e,t,o,c.size)})}).next(()=>s.result)}Ss(e,t,r,i){return r.documentReadCount<this.Vs?(Ei()<=le.DEBUG&&V("QueryEngine","SDK will not create cache indexes for query:",Ti(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),P.resolve()):(Ei()<=le.DEBUG&&V("QueryEngine","Query:",Ti(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.fs*i?(Ei()<=le.DEBUG&&V("QueryEngine","The SDK decides to create cache indexes for query:",Ti(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ct(t))):P.resolve())}ps(e,t){if(_y(t))return P.resolve(null);let r=ct(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=kc(t,null,"F"),r=ct(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let o=ie(...s);return this.gs.getDocuments(e,o).next(c=>this.indexManager.getMinOffset(e,r).next(u=>{let h=this.bs(t,c);return this.Ds(t,h,o,u.readTime)?this.ps(e,kc(t,null,"F")):this.vs(e,h,t,u)}))})))}ys(e,t,r,i){return _y(t)||i.isEqual(ee.min())?P.resolve(null):this.gs.getDocuments(e,r).next(s=>{let o=this.bs(t,s);return this.Ds(t,o,r,i)?P.resolve(null):(Ei()<=le.DEBUG&&V("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Ti(t)),this.vs(e,o,t,y_(i,Di)).next(c=>c))})}bs(e,t){let r=new Ee(X_(e));return t.forEach((i,s)=>{Ko(e,s)&&(r=r.add(s))}),r}Ds(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}ws(e,t,r){return Ei()<=le.DEBUG&&V("QueryEngine","Using full collection scan to execute query:",Ti(t)),this.gs.getDocumentsMatchingQuery(e,t,Pt.min(),r)}vs(e,t,r,i){return this.gs.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};jf="LocalStore",Cb=3e8,xd=class{constructor(e,t,r,i){this.persistence=e,this.Cs=t,this.serializer=i,this.Fs=new Pe(te),this.Ms=new Ut(s=>Br(s),Go),this.xs=new Map,this.Os=e.getRemoteDocumentCache(),this.hi=e.getTargetCache(),this.Ti=e.getBundleCache(),this.Ns(r)}Ns(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Hc(this.Os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Os.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Fs))}};jv="firestore_clients";qv="firestore_mutations";zv="firestore_targets";Wt="SharedClientState",Yc=class n{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static Ks(e,t,r){let i=JSON.parse(r),s,o=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return o&&i.error&&(o=typeof i.error.message=="string"&&typeof i.error.code=="string",o&&(s=new N(i.error.code,i.error.message))),o?new n(e,t,i.state,s):(Ue(Wt,`Failed to parse mutation state for ID '${t}': ${r}`),null)}Ws(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},oo=class n{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Ks(e,t){let r=JSON.parse(t),i,s=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return s&&r.error&&(s=typeof r.error.message=="string"&&typeof r.error.code=="string",s&&(i=new N(r.error.code,r.error.message))),s?new n(e,r.state,i):(Ue(Wt,`Failed to parse target state for ID '${e}': ${t}`),null)}Ws(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Jc=class n{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ks(e,t){let r=JSON.parse(t),i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=Lf();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=I_(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new n(e,s):(Ue(Wt,`Failed to parse client data for instance '${e}': ${t}`),null)}},Dd=class n{constructor(e,t){this.clientId=e,this.onlineState=t}static Ks(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new n(t.clientId,t.onlineState):(Ue(Wt,`Failed to parse online state: ${e}`),null)}},Co=class{constructor(){this.activeTargetIds=Lf()}Gs(e){this.activeTargetIds=this.activeTargetIds.add(e)}zs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},ao=class{constructor(e,t,r,i,s){this.window=e,this.Fi=t,this.persistenceKey=r,this.js=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Js=this.Hs.bind(this),this.Ys=new Pe(te),this.started=!1,this.Zs=[];let o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Xs=Wy(this.persistenceKey,this.js),this.eo=function(u){return`firestore_sequence_number_${u}`}(this.persistenceKey),this.Ys=this.Ys.insert(this.js,new Co),this.no=new RegExp(`^${jv}_${o}_([^_]*)$`),this.ro=new RegExp(`^${qv}_${o}_(\\d+)(?:_(.*))?$`),this.io=new RegExp(`^${zv}_${o}_(\\d+)$`),this.so=function(u){return`firestore_online_state_${u}`}(this.persistenceKey),this.oo=function(u){return`firestore_bundle_loaded_v2_${u}`}(this.persistenceKey),this.window.addEventListener("storage",this.Js)}static C(e){return!(!e||!e.localStorage)}async start(){let e=await this.syncEngine.Ps();for(let r of e){if(r===this.js)continue;let i=this.getItem(Wy(this.persistenceKey,r));if(i){let s=Jc.Ks(r,i);s&&(this.Ys=this.Ys.insert(s.clientId,s))}}this._o();let t=this.storage.getItem(this.so);if(t){let r=this.ao(t);r&&this.uo(r)}for(let r of this.Zs)this.Hs(r);this.Zs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.eo,JSON.stringify(e))}getAllActiveQueryTargets(){return this.co(this.Ys)}isActiveQueryTarget(e){let t=!1;return this.Ys.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.lo(e,"pending")}updateMutationState(e,t,r){this.lo(e,t,r),this.ho(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){let i=this.storage.getItem(fh(this.persistenceKey,e));if(i){let s=oo.Ks(e,i);s&&(r=s.state)}}return t&&this.Po.Gs(e),this._o(),r}removeLocalQueryTarget(e){this.Po.zs(e),this._o()}isLocalQueryTarget(e){return this.Po.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(fh(this.persistenceKey,e))}updateQueryState(e,t,r){this.To(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.ho(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Io(e)}notifyBundleLoaded(e){this.Eo(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Js),this.removeItem(this.Xs),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return V(Wt,"READ",e,t),t}setItem(e,t){V(Wt,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){V(Wt,"REMOVE",e),this.storage.removeItem(e)}Hs(e){let t=e;if(t.storageArea===this.storage){if(V(Wt,"EVENT",t.key,t.newValue),t.key===this.Xs)return void Ue("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Fi.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.no.test(t.key)){if(t.newValue==null){let r=this.Ao(t.key);return this.Ro(r,null)}{let r=this.Vo(t.key,t.newValue);if(r)return this.Ro(r.clientId,r)}}else if(this.ro.test(t.key)){if(t.newValue!==null){let r=this.mo(t.key,t.newValue);if(r)return this.fo(r)}}else if(this.io.test(t.key)){if(t.newValue!==null){let r=this.po(t.key,t.newValue);if(r)return this.yo(r)}}else if(t.key===this.so){if(t.newValue!==null){let r=this.ao(t.newValue);if(r)return this.uo(r)}}else if(t.key===this.eo){let r=function(s){let o=ot.ue;if(s!=null)try{let c=JSON.parse(s);Y(typeof c=="number",30636,{wo:s}),o=c}catch(c){Ue(Wt,"Failed to read sequence number from WebStorage",c)}return o}(t.newValue);r!==ot.ue&&this.sequenceNumberHandler(r)}else if(t.key===this.oo){let r=this.So(t.newValue);await Promise.all(r.map(i=>this.syncEngine.bo(i)))}}}else this.Zs.push(t)})}}get Po(){return this.Ys.get(this.js)}_o(){this.setItem(this.Xs,this.Po.Ws())}lo(e,t,r){let i=new Yc(this.currentUser,e,t,r),s=Ky(this.persistenceKey,this.currentUser,e);this.setItem(s,i.Ws())}ho(e){let t=Ky(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Io(e){let t={clientId:this.js,onlineState:e};this.storage.setItem(this.so,JSON.stringify(t))}To(e,t,r){let i=fh(this.persistenceKey,e),s=new oo(e,t,r);this.setItem(i,s.Ws())}Eo(e){let t=JSON.stringify(Array.from(e));this.setItem(this.oo,t)}Ao(e){let t=this.no.exec(e);return t?t[1]:null}Vo(e,t){let r=this.Ao(e);return Jc.Ks(r,t)}mo(e,t){let r=this.ro.exec(e),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return Yc.Ks(new $e(s),i,t)}po(e,t){let r=this.io.exec(e),i=Number(r[1]);return oo.Ks(i,t)}ao(e){return Dd.Ks(e)}So(e){return JSON.parse(e)}async fo(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Do(e.batchId,e.state,e.error);V(Wt,`Ignoring mutation for non-active user ${e.user.uid}`)}yo(e){return this.syncEngine.vo(e.targetId,e.state,e.error)}Ro(e,t){let r=t?this.Ys.insert(e,t):this.Ys.remove(e),i=this.co(this.Ys),s=this.co(r),o=[],c=[];return s.forEach(u=>{i.has(u)||o.push(u)}),i.forEach(u=>{s.has(u)||c.push(u)}),this.syncEngine.Co(o,c).then(()=>{this.Ys=r})}uo(e){this.Ys.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}co(e){let t=Lf();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}},Xc=class{constructor(){this.Fo=new Co,this.Mo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Fo.Gs(e),this.Mo[e]||"not-current"}updateQueryState(e,t,r){this.Mo[e]=t}removeLocalQueryTarget(e){this.Fo.zs(e)}isLocalQueryTarget(e){return this.Fo.activeTargetIds.has(e)}clearQueryState(e){delete this.Mo[e]}getAllActiveQueryTargets(){return this.Fo.activeTargetIds}isActiveQueryTarget(e){return this.Fo.activeTargetIds.has(e)}start(){return this.Fo=new Co,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};Nd=class{xo(e){}shutdown(){}};Qy="ConnectivityMonitor",Zc=class{constructor(){this.Oo=()=>this.No(),this.Bo=()=>this.Lo(),this.ko=[],this.qo()}xo(e){this.ko.push(e)}shutdown(){window.removeEventListener("online",this.Oo),window.removeEventListener("offline",this.Bo)}qo(){window.addEventListener("online",this.Oo),window.addEventListener("offline",this.Bo)}No(){V(Qy,"Network connectivity changed: AVAILABLE");for(let e of this.ko)e(0)}Lo(){V(Qy,"Network connectivity changed: UNAVAILABLE");for(let e of this.ko)e(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};oc=null;ph="RestConnection",Vb={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"},Vd=class{get Qo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.$o=t+"://"+e.host,this.Uo=`projects/${r}/databases/${i}`,this.Ko=this.databaseId.database===go?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Wo(e,t,r,i,s){let o=Od(),c=this.Go(e,t.toUriEncodedString());V(ph,`Sending RPC '${e}' ${o}:`,c,r);let u={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.Ko};this.zo(u,i,s);let{host:h}=new URL(c),f=fn(h);return this.jo(e,c,u,r,f).then(p=>(V(ph,`Received RPC '${e}' ${o}: `,p),p),p=>{throw ut(ph,`RPC '${e}' ${o} failed with error: `,p,"url: ",c,"request:",r),p})}Jo(e,t,r,i,s,o){return this.Wo(e,t,r,i,s)}zo(e,t,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Zi}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,s)=>e[s]=i),r&&r.headers.forEach((i,s)=>e[s]=i)}Go(e,t){let r=Vb[e];return`${this.$o}/v1/${t}:${r}`}terminate(){}};Ld=class{constructor(e){this.Ho=e.Ho,this.Yo=e.Yo}Zo(e){this.Xo=e}e_(e){this.t_=e}n_(e){this.r_=e}onMessage(e){this.i_=e}close(){this.Yo()}send(e){this.Ho(e)}s_(){this.Xo()}o_(){this.t_()}__(e){this.r_(e)}a_(e){this.i_(e)}};it="WebChannelConnection",Md=class extends Vd{constructor(e){super(e),this.u_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}jo(e,t,r,i,s){let o=Od();return new Promise((c,u)=>{let h=new ih;h.setWithCredentials(!0),h.listenOnce(sh.COMPLETE,()=>{try{switch(h.getLastErrorCode()){case Ws.NO_ERROR:let p=h.getResponseJson();V(it,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(p)),c(p);break;case Ws.TIMEOUT:V(it,`RPC '${e}' ${o} timed out`),u(new N(R.DEADLINE_EXCEEDED,"Request time out"));break;case Ws.HTTP_ERROR:let g=h.getStatus();if(V(it,`RPC '${e}' ${o} failed with status:`,g,"response text:",h.getResponseText()),g>0){let w=h.getResponseJson();Array.isArray(w)&&(w=w[0]);let k=w?.error;if(k&&k.status&&k.message){let D=function(H){let F=H.toLowerCase().replace(/_/g,"-");return Object.values(R).indexOf(F)>=0?F:R.UNKNOWN}(k.status);u(new N(D,k.message))}else u(new N(R.UNKNOWN,"Server responded with status "+h.getStatus()))}else u(new N(R.UNAVAILABLE,"Connection failed."));break;default:W(9055,{c_:e,streamId:o,l_:h.getLastErrorCode(),h_:h.getLastError()})}}finally{V(it,`RPC '${e}' ${o} completed.`)}});let f=JSON.stringify(i);V(it,`RPC '${e}' ${o} sending request:`,i),h.send(t,"POST",f,r,15)})}P_(e,t,r){let i=Od(),s=[this.$o,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=ch(),c=ah(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(u.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(u.useFetchStreams=!0),this.zo(u.initMessageHeaders,t,r),u.encodeInitMessageHeaders=!0;let f=s.join("");V(it,`Creating RPC '${e}' stream ${i}: ${f}`,u);let p=o.createWebChannel(f,u);this.T_(p);let g=!1,w=!1,k=new Ld({Ho:C=>{w?V(it,`Not sending because RPC '${e}' stream ${i} is closed:`,C):(g||(V(it,`Opening RPC '${e}' stream ${i} transport.`),p.open(),g=!0),V(it,`RPC '${e}' stream ${i} sending:`,C),p.send(C))},Yo:()=>p.close()}),D=(C,H,F)=>{C.listen(H,z=>{try{F(z)}catch(ne){setTimeout(()=>{throw ne},0)}})};return D(p,mi.EventType.OPEN,()=>{w||(V(it,`RPC '${e}' stream ${i} transport opened.`),k.s_())}),D(p,mi.EventType.CLOSE,()=>{w||(w=!0,V(it,`RPC '${e}' stream ${i} transport closed`),k.__(),this.I_(p))}),D(p,mi.EventType.ERROR,C=>{w||(w=!0,ut(it,`RPC '${e}' stream ${i} transport errored. Name:`,C.name,"Message:",C.message),k.__(new N(R.UNAVAILABLE,"The operation could not be completed")))}),D(p,mi.EventType.MESSAGE,C=>{var H;if(!w){let F=C.data[0];Y(!!F,16349);let z=F,ne=z?.error||((H=z[0])===null||H===void 0?void 0:H.error);if(ne){V(it,`RPC '${e}' stream ${i} received error:`,ne);let se=ne.status,re=function(v){let I=qe[v];if(I!==void 0)return hv(I)}(se),E=ne.message;re===void 0&&(re=R.INTERNAL,E="Unknown error status: "+se+" with message "+ne.message),w=!0,k.__(new N(re,E)),p.close()}else V(it,`RPC '${e}' stream ${i} received:`,F),k.a_(F)}}),D(c,oh.STAT_EVENT,C=>{C.stat===tc.PROXY?V(it,`RPC '${e}' stream ${i} detected buffering proxy`):C.stat===tc.NOPROXY&&V(it,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{k.o_()},0),k}terminate(){this.u_.forEach(e=>e.close()),this.u_=[]}T_(e){this.u_.push(e)}I_(e){this.u_=this.u_.filter(t=>t===e)}};ko=class{constructor(e,t,r=1e3,i=1.5,s=6e4){this.Fi=e,this.timerId=t,this.d_=r,this.E_=i,this.A_=s,this.R_=0,this.V_=null,this.m_=Date.now(),this.reset()}reset(){this.R_=0}f_(){this.R_=this.A_}g_(e){this.cancel();let t=Math.floor(this.R_+this.p_()),r=Math.max(0,Date.now()-this.m_),i=Math.max(0,t-r);i>0&&V("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.R_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.V_=this.Fi.enqueueAfterDelay(this.timerId,i,()=>(this.m_=Date.now(),e())),this.R_*=this.E_,this.R_<this.d_&&(this.R_=this.d_),this.R_>this.A_&&(this.R_=this.A_)}y_(){this.V_!==null&&(this.V_.skipDelay(),this.V_=null)}cancel(){this.V_!==null&&(this.V_.cancel(),this.V_=null)}p_(){return(Math.random()-.5)*this.R_}};Yy="PersistentStream",eu=class{constructor(e,t,r,i,s,o,c,u){this.Fi=e,this.w_=r,this.S_=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=c,this.listener=u,this.state=0,this.b_=0,this.D_=null,this.v_=null,this.stream=null,this.C_=0,this.F_=new ko(e,t)}M_(){return this.state===1||this.state===5||this.x_()}x_(){return this.state===2||this.state===3}start(){this.C_=0,this.state!==4?this.auth():this.O_()}async stop(){this.M_()&&await this.close(0)}N_(){this.state=0,this.F_.reset()}B_(){this.x_()&&this.D_===null&&(this.D_=this.Fi.enqueueAfterDelay(this.w_,6e4,()=>this.L_()))}k_(e){this.q_(),this.stream.send(e)}async L_(){if(this.x_())return this.close(0)}q_(){this.D_&&(this.D_.cancel(),this.D_=null)}Q_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.Q_(),this.F_.cancel(),this.b_++,e!==4?this.F_.reset():t&&t.code===R.RESOURCE_EXHAUSTED?(Ue(t.toString()),Ue("Using maximum backoff delay to prevent overloading the backend."),this.F_.f_()):t&&t.code===R.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.U_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.n_(t)}U_(){}auth(){this.state=1;let e=this.K_(this.b_),t=this.b_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.b_===t&&this.W_(r,i)},r=>{e(()=>{let i=new N(R.UNKNOWN,"Fetching auth token failed: "+r.message);return this.G_(i)})})}W_(e,t){let r=this.K_(this.b_);this.stream=this.z_(e,t),this.stream.Zo(()=>{r(()=>this.listener.Zo())}),this.stream.e_(()=>{r(()=>(this.state=2,this.v_=this.Fi.enqueueAfterDelay(this.S_,1e4,()=>(this.x_()&&(this.state=3),Promise.resolve())),this.listener.e_()))}),this.stream.n_(i=>{r(()=>this.G_(i))}),this.stream.onMessage(i=>{r(()=>++this.C_==1?this.j_(i):this.onNext(i))})}O_(){this.state=5,this.F_.g_(async()=>{this.state=0,this.start()})}G_(e){return V(Yy,`close with error: ${e}`),this.stream=null,this.close(4,e)}K_(e){return t=>{this.Fi.enqueueAndForget(()=>this.b_===e?t():(V(Yy,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Fd=class extends eu{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}z_(e,t){return this.connection.P_("Listen",e,t)}j_(e){return this.onNext(e)}onNext(e){this.F_.reset();let t=vb(this.serializer,e),r=function(s){if(!("targetChange"in s))return ee.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?ee.min():o.readTime?je(o.readTime):ee.min()}(e);return this.listener.J_(t,r)}H_(e){let t={};t.database=ed(this.serializer),t.addTarget=function(s,o){let c,u=o.target;if(c=Pc(u)?{documents:yv(s,u)}:{query:Pu(s,u).Vt},c.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){c.resumeToken=dv(s,o.resumeToken);let h=Xh(s,o.expectedCount);h!==null&&(c.expectedCount=h)}else if(o.snapshotVersion.compareTo(ee.min())>0){c.readTime=zi(s,o.snapshotVersion.toTimestamp());let h=Xh(s,o.expectedCount);h!==null&&(c.expectedCount=h)}return c}(this.serializer,e);let r=Ib(this.serializer,e);r&&(t.labels=r),this.k_(t)}Y_(e){let t={};t.database=ed(this.serializer),t.removeTarget=e,this.k_(t)}},Ud=class extends eu{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}get Z_(){return this.C_>0}start(){this.lastStreamToken=void 0,super.start()}U_(){this.Z_&&this.X_([])}z_(e,t){return this.connection.P_("Write",e,t)}j_(e){return Y(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Y(!e.writeResults||e.writeResults.length===0,55816),this.listener.ea()}onNext(e){Y(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.F_.reset();let t=wb(e.writeResults,e.commitTime),r=je(e.commitTime);return this.listener.ta(r,t)}na(){let e={};e.database=ed(this.serializer),this.k_(e)}X_(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>Ao(this.serializer,r))};this.k_(t)}};Bd=class{},jd=class extends Bd{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.ra=!1}ia(){if(this.ra)throw new N(R.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,r,i){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Wo(e,Zh(t,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===R.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new N(R.UNKNOWN,s.toString())})}Jo(e,t,r,i,s){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,c])=>this.connection.Jo(e,Zh(t,r),i,o,c,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===R.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new N(R.UNKNOWN,o.toString())})}terminate(){this.ra=!0,this.connection.terminate()}},qd=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.sa=0,this.oa=null,this._a=!0}aa(){this.sa===0&&(this.ua("Unknown"),this.oa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.oa=null,this.ca("Backend didn't respond within 10 seconds."),this.ua("Offline"),Promise.resolve())))}la(e){this.state==="Online"?this.ua("Unknown"):(this.sa++,this.sa>=1&&(this.ha(),this.ca(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ua("Offline")))}set(e){this.ha(),this.sa=0,e==="Online"&&(this._a=!1),this.ua(e)}ua(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ca(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this._a?(Ue(t),this._a=!1):V("OnlineStateTracker",t)}ha(){this.oa!==null&&(this.oa.cancel(),this.oa=null)}};$r="RemoteStore",zd=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Pa=[],this.Ta=new Map,this.Ia=new Set,this.da=[],this.Ea=s,this.Ea.xo(o=>{r.enqueueAndForget(async()=>{cr(this)&&(V($r,"Restarting streams for network reachability change."),await async function(u){let h=B(u);h.Ia.add(4),await ts(h),h.Aa.set("Unknown"),h.Ia.delete(4),await Qo(h)}(this))})}),this.Aa=new qd(r,i)}};Hd=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new Ge,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let o=Date.now()+r,c=new n(e,t,o,i,s);return c.start(r),c}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new N(R.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};xo=class n{static emptySet(e){return new n(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||q.comparator(t.key,r.key):(t,r)=>q.comparator(t.key,r.key),this.keyedMap=Xs(),this.sortedSet=new Pe(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};nu=class{constructor(){this.fa=new Pe(q.comparator)}track(e){let t=e.doc.key,r=this.fa.get(t);r?e.type!==0&&r.type===3?this.fa=this.fa.insert(t,e):e.type===3&&r.type!==1?this.fa=this.fa.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.fa=this.fa.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.fa=this.fa.remove(t):e.type===1&&r.type===2?this.fa=this.fa.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):W(63341,{At:e,ga:r}):this.fa=this.fa.insert(t,e)}pa(){let e=[];return this.fa.inorderTraversal((t,r)=>{e.push(r)}),e}},Hr=class n{constructor(e,t,r,i,s,o,c,u,h){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=c,this.excludesMetadataChanges=u,this.hasCachedResults=h}static fromInitialDocuments(e,t,r,i,s){let o=[];return t.forEach(c=>{o.push({type:0,doc:c})}),new n(e,t,xo.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Wo(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};Gd=class{constructor(){this.ya=void 0,this.wa=[]}Sa(){return this.wa.some(e=>e.ba())}},Wd=class{constructor(){this.queries=Xy(),this.onlineState="Unknown",this.Da=new Set}terminate(){(function(t,r){let i=B(t),s=i.queries;i.queries=Xy(),s.forEach((o,c)=>{for(let u of c.wa)u.onError(r)})})(this,new N(R.ABORTED,"Firestore shutting down"))}};(Zy=Kd||(Kd={})).Fa="default",Zy.Cache="cache";Do=class{constructor(e,t,r){this.query=e,this.Ma=t,this.xa=!1,this.Oa=null,this.onlineState="Unknown",this.options=r||{}}Ca(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new Hr(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.xa?this.Na(e)&&(this.Ma.next(e),t=!0):this.Ba(e,this.onlineState)&&(this.La(e),t=!0),this.Oa=e,t}onError(e){this.Ma.error(e)}va(e){this.onlineState=e;let t=!1;return this.Oa&&!this.xa&&this.Ba(this.Oa,e)&&(this.La(this.Oa),t=!0),t}Ba(e,t){if(!e.fromCache||!this.ba())return!0;let r=t!=="Offline";return(!this.options.ka||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Na(e){if(e.docChanges.length>0)return!0;let t=this.Oa&&this.Oa.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}La(e){e=Hr.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.xa=!0,this.Ma.next(e)}ba(){return this.options.source!==Kd.Cache}};ru=class{constructor(e,t){this.qa=e,this.byteLength=t}Qa(){return"metadata"in this.qa}};iu=class{constructor(e){this.serializer=e}Qs(e){return Jt(this.serializer,e)}$s(e){return e.metadata.exists?Ru(this.serializer,e.document,!1):We.newNoDocument(this.Qs(e.metadata.name),this.Us(e.metadata.readTime))}Us(e){return je(e)}},No=class{constructor(e,t){this.$a=e,this.serializer=t,this.Ua=[],this.Ka=[],this.collectionGroups=new Set,this.progress=Yv(e)}get queries(){return this.Ua}get documents(){return this.Ka}Wa(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.qa.namedQuery)this.Ua.push(e.qa.namedQuery);else if(e.qa.documentMetadata){this.Ka.push({metadata:e.qa.documentMetadata}),e.qa.documentMetadata.exists||++t;let r=fe.fromString(e.qa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.qa.document&&(this.Ka[this.Ka.length-1].document=e.qa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}Ga(e){let t=new Map,r=new iu(this.serializer);for(let i of e)if(i.metadata.queries){let s=r.Qs(i.metadata.name);for(let o of i.metadata.queries){let c=(t.get(o)||ie()).add(s);t.set(o,c)}}return t}async za(e){let t=await Nb(e,new iu(this.serializer),this.Ka,this.$a.id),r=this.Ga(this.documents);for(let i of this.Ua)await Ob(e,i,r.get(i.name));return this.progress.taskState="Success",{progress:this.progress,ja:this.collectionGroups,Ja:t}}};su=class{constructor(e){this.key=e}},ou=class{constructor(e){this.key=e}},au=class{constructor(e,t){this.query=e,this.Ha=t,this.Ya=null,this.hasCachedResults=!1,this.current=!1,this.Za=ie(),this.mutatedKeys=ie(),this.Xa=X_(e),this.eu=new xo(this.Xa)}get tu(){return this.Ha}nu(e,t){let r=t?t.ru:new nu,i=t?t.eu:this.eu,s=t?t.mutatedKeys:this.mutatedKeys,o=i,c=!1,u=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,h=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((f,p)=>{let g=i.get(f),w=Ko(this.query,p)?p:null,k=!!g&&this.mutatedKeys.has(g.key),D=!!w&&(w.hasLocalMutations||this.mutatedKeys.has(w.key)&&w.hasCommittedMutations),C=!1;g&&w?g.data.isEqual(w.data)?k!==D&&(r.track({type:3,doc:w}),C=!0):this.iu(g,w)||(r.track({type:2,doc:w}),C=!0,(u&&this.Xa(w,u)>0||h&&this.Xa(w,h)<0)&&(c=!0)):!g&&w?(r.track({type:0,doc:w}),C=!0):g&&!w&&(r.track({type:1,doc:g}),C=!0,(u||h)&&(c=!0)),C&&(w?(o=o.add(w),s=D?s.add(f):s.delete(f)):(o=o.delete(f),s=s.delete(f)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let f=this.query.limitType==="F"?o.last():o.first();o=o.delete(f.key),s=s.delete(f.key),r.track({type:1,doc:f})}return{eu:o,ru:r,Ds:c,mutatedKeys:s}}iu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.eu;this.eu=e.eu,this.mutatedKeys=e.mutatedKeys;let o=e.ru.pa();o.sort((f,p)=>function(w,k){let D=C=>{switch(C){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return W(20277,{At:C})}};return D(w)-D(k)}(f.type,p.type)||this.Xa(f.doc,p.doc)),this.su(r),i=i!=null&&i;let c=t&&!i?this.ou():[],u=this.Za.size===0&&this.current&&!i?1:0,h=u!==this.Ya;return this.Ya=u,o.length!==0||h?{snapshot:new Hr(this.query,e.eu,s,o,e.mutatedKeys,u===0,h,!1,!!r&&r.resumeToken.approximateByteSize()>0),_u:c}:{_u:c}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({eu:this.eu,ru:new nu,mutatedKeys:this.mutatedKeys,Ds:!1},!1)):{_u:[]}}au(e){return!this.Ha.has(e)&&!!this.eu.has(e)&&!this.eu.get(e).hasLocalMutations}su(e){e&&(e.addedDocuments.forEach(t=>this.Ha=this.Ha.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ha=this.Ha.delete(t)),this.current=e.current)}ou(){if(!this.current)return[];let e=this.Za;this.Za=ie(),this.eu.forEach(r=>{this.au(r.key)&&(this.Za=this.Za.add(r.key))});let t=[];return e.forEach(r=>{this.Za.has(r)||t.push(new ou(r))}),this.Za.forEach(r=>{e.has(r)||t.push(new su(r))}),t}uu(e){this.Ha=e.qs,this.Za=ie();let t=this.nu(e.documents);return this.applyChanges(t,!0)}cu(){return Hr.fromInitialDocuments(this.query,this.eu,this.mutatedKeys,this.Ya===0,this.hasCachedResults)}},ur="SyncEngine",Qd=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},Yd=class{constructor(e){this.key=e,this.lu=!1}},Jd=class{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.hu={},this.Pu=new Ut(c=>Y_(c),Wo),this.Tu=new Map,this.Iu=new Set,this.du=new Pe(q.comparator),this.Eu=new Map,this.Au=new Ro,this.Ru={},this.Vu=new Map,this.mu=Hi.ur(),this.onlineState="Unknown",this.fu=void 0}get isPrimaryClient(){return this.fu===!0}};tr=class{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Yr(e.databaseInfo.databaseId),this.sharedClientState=this.bu(e),this.persistence=this.Du(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Cu(e,this.localStore),this.indexBackfillerScheduler=this.Fu(e,this.localStore)}Cu(e,t){return null}Fu(e,t){return null}vu(e){return Ov(this.persistence,new Kc,e.initialUser,this.serializer)}Du(e){return new Po(Gc.Vi,this.serializer)}bu(e){return new Xc}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}};tr.provider={build:()=>new tr};Oo=class extends tr{constructor(e){super(),this.cacheSizeBytes=e}Cu(e,t){Y(this.persistence.referenceDelegate instanceof Wc,46915);let r=this.persistence.referenceDelegate.garbageCollector;return new zc(r,e.asyncQueue,t)}Du(e){let t=this.cacheSizeBytes!==void 0?mt.withCacheSize(this.cacheSizeBytes):mt.DEFAULT;return new Po(r=>Wc.Vi(r,t),this.serializer)}},Vo=class extends tr{constructor(e,t,r){super(),this.Mu=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Mu.initialize(this,e),await Xf(this.Mu.syncEngine),await ns(this.Mu.remoteStore),await this.persistence.ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){return Ov(this.persistence,new Kc,e.initialUser,this.serializer)}Cu(e,t){let r=this.persistence.referenceDelegate.garbageCollector;return new zc(r,e.asyncQueue,t)}Fu(e,t){let r=new Ph(t,this.persistence);return new Rh(e.asyncQueue,r)}Du(e){let t=Bf(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?mt.withCacheSize(this.cacheSizeBytes):mt.DEFAULT;return new Pd(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,$v(),mc(),this.serializer,this.sharedClientState,!!this.forceOwnership)}bu(e){return new Xc}},cu=class extends Vo{constructor(e,t){super(e,t,!1),this.Mu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);let t=this.Mu.syncEngine;this.sharedClientState instanceof ao&&(this.sharedClientState.syncEngine={Do:cA.bind(null,t),vo:hA.bind(null,t),Co:dA.bind(null,t),Ps:lA.bind(null,t),bo:aA.bind(null,t)},await this.sharedClientState.start()),await this.persistence.ji(async r=>{await uA(this.Mu.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())})}bu(e){let t=$v();if(!ao.C(t))throw new N(R.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=Bf(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new ao(t,e.asyncQueue,r,e.clientId,e.initialUser)}},nn=class{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>e_(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=iA.bind(null,this.syncEngine),await $d(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new Wd}()}createDatastore(e){let t=Yr(e.databaseInfo.databaseId),r=function(s){return new Md(s)}(e.databaseInfo);return function(s,o,c,u){return new jd(s,o,c,u)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,i,s,o,c){return new zd(r,i,s,o,c)}(this.localStore,this.datastore,e.asyncQueue,t=>e_(this.syncEngine,t,0),function(){return Zc.C()?new Zc:new Nd}())}createSyncEngine(e,t){return function(i,s,o,c,u,h,f){let p=new Jd(i,s,o,c,u,h);return f&&(p.fu=!0),p}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(i){let s=B(i);V($r,"RemoteStore shutting down."),s.Ia.add(5),await ts(s),s.Ea.shutdown(),s.Aa.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}};nn.provider={build:()=>new nn};Yi=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.xu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.xu(this.observer.error,e):Ue("Uncaught Error in snapshot listener:",e.toString()))}Ou(){this.muted=!0}xu(e,t){setTimeout(()=>{this.muted||e(t)},0)}};Zd=class{constructor(e,t){this.Nu=e,this.serializer=t,this.metadata=new Ge,this.buffer=new Uint8Array,this.Bu=function(){return new TextDecoder("utf-8")}(),this.Lu().then(r=>{r&&r.Qa()?this.metadata.resolve(r.qa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r?.qa)}`))},r=>this.metadata.reject(r))}close(){return this.Nu.cancel()}async getMetadata(){return this.metadata.promise}async Su(){return await this.getMetadata(),this.Lu()}async Lu(){let e=await this.ku();if(e===null)return null;let t=this.Bu.decode(e),r=Number(t);isNaN(r)&&this.qu(`length string (${t}) is not valid number`);let i=await this.Qu(r);return new ru(JSON.parse(i),e.length+r)}$u(){return this.buffer.findIndex(e=>e===123)}async ku(){for(;this.$u()<0&&!await this.Uu(););if(this.buffer.length===0)return null;let e=this.$u();e<0&&this.qu("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async Qu(e){for(;this.buffer.length<e;)await this.Uu()&&this.qu("Reached the end of bundle when more is expected.");let t=this.Bu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}qu(e){throw this.Nu.cancel(),new Error(`Invalid bundle format: ${e}`)}async Uu(){let e=await this.Nu.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}};ef=class{constructor(e,t){this.bundleData=e,this.serializer=t,this.cursor=0,this.elements=[];let r=this.Su();if(!r||!r.Qa())throw new Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(r?.qa)}`);this.metadata=r;do r=this.Su(),r!==null&&this.elements.push(r);while(r!==null)}getMetadata(){return this.metadata}Ku(){return this.elements}Su(){if(this.cursor===this.bundleData.length)return null;let e=this.ku(),t=this.Qu(e);return new ru(JSON.parse(t),e)}Qu(e){if(this.cursor+e>this.bundleData.length)throw new N(R.INTERNAL,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=e)}ku(){let e=this.cursor,t=this.cursor;for(;t<this.bundleData.length;){if(this.bundleData[t]==="{"){if(t===e)throw new Error("First character is a bracket and not a number");return this.cursor=t,Number(this.bundleData.slice(e,t))}t++}throw new Error("Reached the end of bundle when more is expected.")}};tf=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new N(R.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=await async function(i,s){let o=B(i),c={documents:s.map(p=>bo(o.serializer,p))},u=await o.Jo("BatchGetDocuments",o.serializer.databaseId,fe.emptyPath(),c,s.length),h=new Map;u.forEach(p=>{let g=_b(o.serializer,p);h.set(g.key.toString(),g)});let f=[];return s.forEach(p=>{let g=h.get(p.toString());Y(!!g,55234,{key:p}),f.push(g)}),f}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Zn(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{let i=q.fromPath(r);this.mutations.push(new vo(i,this.precondition(i)))}),await async function(r,i){let s=B(r),o={writes:i.map(c=>Ao(s.serializer,c))};await s.Wo("Commit",s.serializer.databaseId,fe.emptyPath(),o)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw W(50498,{Wu:e.constructor.name});t=ee.min()}let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new N(R.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(ee.min())?Le.exists(!1):Le.updateTime(t):Le.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(ee.min()))throw new N(R.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Le.updateTime(t)}return Le.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};nf=class{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.Gu=r.maxAttempts,this.F_=new ko(this.asyncQueue,"transaction_retry")}zu(){this.Gu-=1,this.ju()}ju(){this.F_.g_(async()=>{let e=new tf(this.datastore),t=this.Ju(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.Hu(i)}))}).catch(r=>{this.Hu(r)})})}Ju(e){try{let t=this.updateFunction(e);return!$o(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Hu(e){this.Gu>0&&this.Yu(e)?(this.Gu-=1,this.asyncQueue.enqueueAndForget(()=>(this.ju(),Promise.resolve()))):this.deferred.reject(e)}Yu(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!lv(t)}return!1}};nr="FirestoreClient",rf=class{constructor(e,t,r,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=$e.UNAUTHENTICATED,this.clientId=ki.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,async o=>{V(nr,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(V(nr,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new Ge;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=is(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}};i_=new Map;cw="firestore.googleapis.com",s_=!0,uu=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new N(R.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=cw,this.ssl=s_}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:s_;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Sv;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<kv)throw new N(R.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}p_("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=aw((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new N(R.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new N(R.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new N(R.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},Gr=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new uu({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new N(R.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new N(R.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new uu(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new yc;switch(r.type){case"firstParty":return new vh(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new N(R.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let r=i_.get(t);r&&(V("ComponentProvider","Removing Datastore"),i_.delete(t),r.terminate())}(this),Promise.resolve()}};Ye=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},be=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Mt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}toJSON(){return{type:n._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(Qr(t,n._jsonSchema))return new n(e,r||null,new q(fe.fromString(t.referencePath)))}};be._jsonSchemaVersion="firestore/documentReference/1.0",be._jsonSchema={type:He("string",be._jsonSchemaVersion),referencePath:He("string")};Mt=class n extends Ye{constructor(e,t,r){super(e,t,es(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new be(this.firestore,null,new q(e))}withConverter(e){return new n(this.firestore,e,this._path)}};o_="AsyncQueue",lu=class{constructor(e=Promise.resolve()){this.Zu=[],this.Xu=!1,this.ec=[],this.tc=null,this.nc=!1,this.rc=!1,this.sc=[],this.F_=new ko(this,"async_queue_retry"),this.oc=()=>{let r=mc();r&&V(o_,"Visibility state changed to "+r.visibilityState),this.F_.y_()},this._c=e;let t=mc();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.oc)}get isShuttingDown(){return this.Xu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.ac(),this.uc(e)}enterRestrictedMode(e){if(!this.Xu){this.Xu=!0,this.rc=e||!1;let t=mc();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.oc)}}enqueue(e){if(this.ac(),this.Xu)return new Promise(()=>{});let t=new Ge;return this.uc(()=>this.Xu&&this.rc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Zu.push(e),this.cc()))}async cc(){if(this.Zu.length!==0){try{await this.Zu[0](),this.Zu.shift(),this.F_.reset()}catch(e){if(!or(e))throw e;V(o_,"Operation failed with retryable error: "+e)}this.Zu.length>0&&this.F_.g_(()=>this.cc())}}uc(e){let t=this._c.then(()=>(this.nc=!0,e().catch(r=>{throw this.tc=r,this.nc=!1,Ue("INTERNAL UNHANDLED ERROR: ",a_(r)),r}).then(r=>(this.nc=!1,r))));return this._c=t,t}enqueueAfterDelay(e,t,r){this.ac(),this.sc.indexOf(e)>-1&&(t=0);let i=Hd.createAndSchedule(this,e,t,r,s=>this.lc(s));return this.ec.push(i),i}ac(){this.tc&&W(47125,{hc:a_(this.tc)})}verifyOperationInProgress(){}async Pc(){let e;do e=this._c,await e;while(e!==this._c)}Tc(e){for(let t of this.ec)if(t.timerId===e)return!0;return!1}Ic(e){return this.Pc().then(()=>{this.ec.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.ec)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Pc()})}dc(e){this.sc.push(e)}lc(e){let t=this.ec.indexOf(e);this.ec.splice(t,1)}};hu=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new Ge,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};PA=-1,_e=class extends Gr{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new lu,this._persistenceKey=i?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new lu(e),this._firestoreClient=void 0,await e}}};rr=class{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}},du=class{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}};Xt=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(Me.fromBase64String(e))}catch(t){throw new N(R.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(Me.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:n._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Qr(e,n._jsonSchema))return n.fromBase64String(e.bytes)}};Xt._jsonSchemaVersion="firestore/bytes/1.0",Xt._jsonSchema={type:He("string",Xt._jsonSchemaVersion),bytes:He("string")};rn=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new N(R.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Be(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};sn=class{constructor(e){this._methodName=e}};In=class n{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new N(R.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new N(R.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return te(this._lat,e._lat)||te(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:n._jsonSchemaVersion}}static fromJSON(e){if(Qr(e,n._jsonSchema))return new n(e.latitude,e.longitude)}};In._jsonSchemaVersion="firestore/geoPoint/1.0",In._jsonSchema={type:He("string",In._jsonSchemaVersion),latitude:He("number"),longitude:He("number")};Zt=class n{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,i){if(r.length!==i.length)return!1;for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}(this._values,e._values)}toJSON(){return{type:n._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Qr(e,n._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new n(e.vectorValues);throw new N(R.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}};Zt._jsonSchemaVersion="firestore/vectorValue/1.0",Zt._jsonSchema={type:He("string",Zt._jsonSchemaVersion),vectorValues:He("object")};FA=/^__.*__$/,of=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Bt(e,this.data,this.fieldMask,t,this.fieldTransforms):new Xn(e,this.data,t,this.fieldTransforms)}},fu=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Bt(e,this.data,this.fieldMask,t,this.fieldTransforms)}};pu=class n{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.Ac(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ec(){return this.settings.Ec}Rc(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Vc(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Rc({path:r,mc:!1});return i.fc(e),i}gc(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Rc({path:r,mc:!1});return i.Ac(),i}yc(e){return this.Rc({path:void 0,mc:!0})}wc(e){return mu(e,this.settings.methodName,this.settings.Sc||!1,this.path,this.settings.bc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Ac(){if(this.path)for(let e=0;e<this.path.length;e++)this.fc(this.path.get(e))}fc(e){if(e.length===0)throw this.wc("Document fields must not be empty");if(pw(this.Ec)&&FA.test(e))throw this.wc('Document fields cannot begin and end with "__"')}},af=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Yr(e)}Dc(e,t,r,i=!1){return new pu({Ec:e,methodName:t,bc:r,path:Be.emptyPath(),mc:!1,Sc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};Lo=class n extends sn{_toFieldTransform(e){if(e.Ec!==2)throw e.Ec===1?e.wc(`${this._methodName}() can only appear at the top level of your update data`):e.wc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof n}};cf=class n extends sn{_toFieldTransform(e){return new jr(e.path,new Yn)}isEqual(e){return e instanceof n}},uf=class n extends sn{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){let t=mw(this,e,!0),r=this.vc.map(s=>Xr(s,t)),i=new bn(r);return new jr(e.path,i)}isEqual(e){return e instanceof n&&pt(this.vc,e.vc)}},lf=class n extends sn{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){let t=mw(this,e,!0),r=this.vc.map(s=>Xr(s,t)),i=new An(r);return new jr(e.path,i)}isEqual(e){return e instanceof n&&pt(this.vc,e.vc)}},hf=class n extends sn{constructor(e,t){super(e),this.Cc=t}_toFieldTransform(e){let t=new Jn(e.serializer,rv(e.serializer,this.Cc));return new jr(e.path,t)}isEqual(e){return e instanceof n&&this.Cc===e.Cc}};UA=new RegExp("[~\\*/\\[\\]]");Wr=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new be(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new df(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(Vu("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},df=class extends Wr{data(){return super.data()}};Fo=class{},ir=class extends Fo{};Xi=class n extends ir{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return Ew(e._query,t),new Ye(e.firestore,e.converter,Hh(e._query,t))}_parse(e){let t=Jr(e.firestore);return function(s,o,c,u,h,f,p){let g;if(h.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new N(R.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){u_(p,f);let k=[];for(let D of p)k.push(c_(u,s,D));g={arrayValue:{values:k}}}else g=c_(u,s,p)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||u_(p,f),g=gw(c,o,p,f==="in"||f==="not-in");return pe.create(h,f,g)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};Kr=class n extends Fo{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:ve.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(i,s){let o=i,c=s.getFlattenedFilters();for(let u of c)Ew(o,u),o=Hh(o,u)}(e._query,t),new Ye(e.firestore,e.converter,Hh(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};gu=class n extends ir{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=function(i,s,o){if(i.startAt!==null)throw new N(R.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new N(R.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Ur(s,o)}(e._query,this._field,this._direction);return new Ye(e.firestore,e.converter,function(i,s){let o=i.explicitOrderBy.concat([s]);return new Ft(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}};Uo=class n extends ir{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){return new Ye(e.firestore,e.converter,kc(e._query,this._limit,this._limitType))}};Bo=class n extends ir{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=Iw(e,this.type,this._docOrFields,this._inclusive);return new Ye(e.firestore,e.converter,function(i,s){return new Ft(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)}(e._query,t))}};jo=class n extends ir{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=Iw(e,this.type,this._docOrFields,this._inclusive);return new Ye(e.firestore,e.converter,function(i,s){return new Ft(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)}(e._query,t))}};qo=class{convertValue(e,t="none"){switch(Kn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ke(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Tn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw W(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return ar(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertVectorValue(e){var t,r,i;let s=(i=(r=(t=e.fields)===null||t===void 0?void 0:t[Fi].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(o=>ke(o.doubleValue));return new Zt(s)}convertGeoPoint(e){return new In(ke(e.latitude),ke(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=Au(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(mo(e));default:return null}}convertTimestamp(e){let t=En(e);return new Re(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=fe.fromString(e);Y(Ev(r),9688,{name:e});let i=new Mr(r.get(1),r.get(3)),s=new q(r.popFirst(5));return i.isEqual(t)||Ue(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};zo=class extends qo{constructor(e){super(),this.firestore=e}convertBytes(e){return new Xt(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new be(this.firestore,null,t)}};Aw="NOT SUPPORTED",Lt=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},yt=class n extends Wr{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new Lr(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(Vu("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new N(R.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=n._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}};yt._jsonSchemaVersion="firestore/documentSnapshot/1.0",yt._jsonSchema={type:He("string",yt._jsonSchemaVersion),bundleSource:He("string","DocumentSnapshot"),bundleName:He("string"),bundle:He("string")};Lr=class extends yt{data(e={}){return super.data(e)}},_t=class n{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Lt(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Lr(this._firestore,this._userDataWriter,r.key,r,new Lt(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new N(R.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(c=>{let u=new Lr(i._firestore,i._userDataWriter,c.doc.key,c.doc,new Lt(i._snapshot.mutatedKeys.has(c.doc.key),i._snapshot.fromCache),i.query.converter);return c.doc,{type:"added",doc:u,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(c=>s||c.type!==3).map(c=>{let u=new Lr(i._firestore,i._userDataWriter,c.doc.key,c.doc,new Lt(i._snapshot.mutatedKeys.has(c.doc.key),i._snapshot.fromCache),i.query.converter),h=-1,f=-1;return c.type!==0&&(h=o.indexOf(c.doc.key),o=o.delete(c.doc.key)),c.type!==1&&(o=o.add(c.doc),f=o.indexOf(c.doc.key)),{type:rS(c.type),doc:u,oldIndex:h,newIndex:f}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new N(R.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=n._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=ki.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],r=[],i=[];return this.docs.forEach(s=>{s._document!==null&&(t.push(s._document),r.push(this._userDataWriter.convertObjectMap(s._document.data.value.mapValue.fields,"previous")),i.push(s.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}};_t._jsonSchemaVersion="firestore/querySnapshot/1.0",_t._jsonSchema={type:He("string",_t._jsonSchemaVersion),bundleSource:He("string","QuerySnapshot"),bundleName:He("string"),bundle:He("string")};on=class extends qo{constructor(e){super(),this.firestore=e}convertBytes(e){return new Xt(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new be(this.firestore,null,t)}};pf=class{constructor(e){this.kind="memory",this._onlineComponentProvider=nn.provider,e?.garbageCollector?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider={build:()=>new Oo(void 0)}}toJSON(){return{kind:this.kind}}},mf=class{constructor(e){let t;this.kind="persistent",e?.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=Rw(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}},gf=class{constructor(){this.kind="memoryEager",this._offlineComponentProvider=tr.provider}toJSON(){return{kind:this.kind}}},yf=class{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new Oo(e)}}toJSON(){return{kind:this.kind}}};_f=class{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=nn.provider,this._offlineComponentProvider={build:t=>new Vo(t,e?.cacheSizeBytes,this.forceOwnership)}}},vf=class{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=nn.provider,this._offlineComponentProvider={build:t=>new cu(t,e?.cacheSizeBytes)}}};TS={maxAttempts:5};yu=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Jr(e)}set(e,t,r){this._verifyNotCommitted();let i=zn(e,this._firestore),s=Lu(i.converter,t,r),o=Nu(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(o.toMutation(i._key,Le.none())),this}update(e,t,r,...i){this._verifyNotCommitted();let s=zn(e,this._firestore),o;return o=typeof(t=Ie(t))=="string"||t instanceof rn?ip(this._dataReader,"WriteBatch.update",s._key,t,r,i):rp(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,Le.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=zn(e,this._firestore);return this._mutations=this._mutations.concat(new Zn(t._key,Le.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new N(R.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};wf=class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Jr(e)}get(e){let t=zn(e,this._firestore),r=new zo(this._firestore);return this._transaction.lookup([t._key]).then(i=>{if(!i||i.length!==1)return W(24041);let s=i[0];if(s.isFoundDocument())return new Wr(this._firestore,r,s.key,s,t.converter);if(s.isNoDocument())return new Wr(this._firestore,r,t._key,null,t.converter);throw W(18433,{doc:s})})}set(e,t,r){let i=zn(e,this._firestore),s=Lu(i.converter,t,r),o=Nu(this._dataReader,"Transaction.set",i._key,s,i.converter!==null,r);return this._transaction.set(i._key,o),this}update(e,t,r,...i){let s=zn(e,this._firestore),o;return o=typeof(t=Ie(t))=="string"||t instanceof rn?ip(this._dataReader,"Transaction.update",s._key,t,r,i):rp(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,o),this}delete(e){let t=zn(e,this._firestore);return this._transaction.delete(t._key),this}};_u=class extends wf{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=zn(e,this._firestore),r=new on(this._firestore);return super.get(e).then(i=>new yt(this._firestore,r,t._key,i._document,new Lt(!1,!1),t.converter))}};vu=class{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}};h_=new WeakMap;If=class{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return Ef.instance.onExistenceFilterMismatch(e)}},Ef=class n{constructor(){this.Fc=new Map}static get instance(){return ac||(ac=new n,function(t){if(Dc)throw new Error("a TestingHooksSpi instance is already set");Dc=t}(ac)),ac}ct(e){this.Fc.forEach(t=>t(e))}onExistenceFilterMismatch(e){let t=Symbol(),r=this.Fc;return r.set(t,e),()=>r.delete(t)}},ac=null;(function(e,t=!0){(function(i){Zi=i})(On),Nn(new St("firestore",(r,{instanceIdentifier:i,options:s})=>{let o=r.getProvider("app").getImmediate(),c=new _e(new yh(r.getProvider("auth-internal")),new wh(o,r.getProvider("app-check-internal")),function(h,f){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new N(R.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Mr(h.options.projectId,f)}(o,i),o);return s=Object.assign({useFetchStreams:t},s),c._setSettings(s),c},"PUBLIC").setMultipleInstances(!0)),Nt(Yg,Jg,e),Nt(Yg,Jg,"esm2017")})()});var ap={};hn(ap,{AbstractUserDataWriter:()=>qo,AggregateField:()=>rr,AggregateQuerySnapshot:()=>du,Bytes:()=>Xt,CACHE_SIZE_UNLIMITED:()=>PA,CollectionReference:()=>Mt,DocumentReference:()=>be,DocumentSnapshot:()=>yt,FieldPath:()=>rn,FieldValue:()=>sn,Firestore:()=>_e,FirestoreError:()=>N,GeoPoint:()=>In,LoadBundleTask:()=>hu,PersistentCacheIndexManager:()=>vu,Query:()=>Ye,QueryCompositeFilterConstraint:()=>Kr,QueryConstraint:()=>ir,QueryDocumentSnapshot:()=>Lr,QueryEndAtConstraint:()=>jo,QueryFieldFilterConstraint:()=>Xi,QueryLimitConstraint:()=>Uo,QueryOrderByConstraint:()=>gu,QuerySnapshot:()=>_t,QueryStartAtConstraint:()=>Bo,SnapshotMetadata:()=>Lt,Timestamp:()=>Re,Transaction:()=>_u,VectorValue:()=>Zt,WriteBatch:()=>yu,_AutoId:()=>ki,_ByteString:()=>Me,_DatabaseId:()=>Mr,_DocumentKey:()=>q,_EmptyAppCheckTokenProvider:()=>Ih,_EmptyAuthCredentialsProvider:()=>yc,_FieldPath:()=>Be,_TestingHooks:()=>If,_cast:()=>he,_debugAssert:()=>w0,_internalAggregationQueryToProtoRunAggregationQueryRequest:()=>FS,_internalQueryToProtoQueryTarget:()=>MS,_isBase64Available:()=>X0,_logWarn:()=>ut,_validateIsNotUsedTogether:()=>p_,addDoc:()=>pS,aggregateFieldEqual:()=>ZA,aggregateQuerySnapshotEqual:()=>eS,and:()=>zA,arrayRemove:()=>PS,arrayUnion:()=>RS,average:()=>XA,clearIndexedDbPersistence:()=>DA,collection:()=>AA,collectionGroup:()=>SA,connectFirestoreEmulator:()=>uw,count:()=>bw,deleteAllPersistentCacheIndexes:()=>LS,deleteDoc:()=>fS,deleteField:()=>AS,disableNetwork:()=>VA,disablePersistentCacheIndexAutoCreation:()=>VS,doc:()=>lw,documentId:()=>MA,documentSnapshotFromJSON:()=>tS,enableIndexedDbPersistence:()=>kA,enableMultiTabIndexedDbPersistence:()=>xA,enableNetwork:()=>OA,enablePersistentCacheIndexAutoCreation:()=>OS,endAt:()=>YA,endBefore:()=>QA,ensureFirestoreConfigured:()=>xe,executeWrite:()=>os,getAggregateFromServer:()=>Sw,getCountFromServer:()=>yS,getDoc:()=>sS,getDocFromCache:()=>oS,getDocFromServer:()=>aS,getDocs:()=>cS,getDocsFromCache:()=>uS,getDocsFromServer:()=>lS,getFirestore:()=>np,getPersistentCacheIndexManager:()=>NS,increment:()=>CS,initializeFirestore:()=>CA,limit:()=>HA,limitToLast:()=>GA,loadBundle:()=>sf,memoryEagerGarbageCollector:()=>_S,memoryLocalCache:()=>wS,memoryLruGarbageCollector:()=>vS,namedQuery:()=>fw,onSnapshot:()=>ff,onSnapshotResume:()=>mS,onSnapshotsInSync:()=>gS,or:()=>qA,orderBy:()=>$A,persistentLocalCache:()=>IS,persistentMultipleTabManager:()=>ES,persistentSingleTabManager:()=>Rw,query:()=>BA,queryEqual:()=>tp,querySnapshotFromJSON:()=>nS,refEqual:()=>RA,runTransaction:()=>bS,serverTimestamp:()=>SS,setDoc:()=>hS,setIndexConfiguration:()=>DS,setLogLevel:()=>v0,snapshotEqual:()=>iS,startAfter:()=>KA,startAt:()=>WA,sum:()=>JA,terminate:()=>LA,updateDoc:()=>dS,vector:()=>kS,waitForPendingWrites:()=>NA,where:()=>jA,writeBatch:()=>xS});var Mu=Se(()=>{Cw()});var as={};hn(as,{APP_BASE_URL:()=>US,DEFAULT_TARGET_LANG:()=>BS,FIREBASE_WEB_CONFIG:()=>cp});var US,BS,cp,Zr=Se(()=>{"use strict";US="https://desainr.vercel.app",BS="en",cp={apiKey:"AIzaSyDb3FPl9-DA_RiY_m8flV-gePeLFnXYVoA",authDomain:"desainr.firebaseapp.com",projectId:"desainr",storageBucket:"desainr.firebasestorage.app",messagingSenderId:"897610202784",appId:"1:897610202784:web:b6a38c0fdf6b07bfe5d3c5"}});var up={};hn(up,{firebaseApp:()=>qS,firebaseAuth:()=>zS,firebaseDb:()=>$S});var jS,Yo,qS,zS,$S,lp=Se(()=>{"use strict";zm();Hg();Mu();Zr();jS=cp;Al().length?Yo=Al()[0]:Yo=bl(jS);qS=Yo,zS=nh(Yo),$S=np(Yo)});function hp(n){if(!n)return!1;let e=(n.tagName||"").toLowerCase();if(e==="input"||e==="textarea")return!0;try{return n.isContentEditable===!0}catch{return!1}}function HS(){let n=document.activeElement;if(!hp(n))return null;let e=(n.tagName||"").toLowerCase();if(e==="input"||e==="textarea")try{return{element:n,start:n.selectionStart??0,end:n.selectionEnd??0,value:String(n.value??"")}}catch{return{element:n,value:String(n.value??"")}}try{let t=window.getSelection();return!t||t.rangeCount===0?{element:n,html:n.innerHTML}:{element:n,html:n.innerHTML}}catch{return{element:n}}}function kw(n){let e=HS();if(!e)return{outcome:"none"};let t=e.element,r=(t.tagName||"").toLowerCase();if(r==="input"||r==="textarea")try{let i=String(t.value??""),s=e.start??0,o=e.end??0,c=i.slice(0,s),u=i.slice(o);t.value=c+n+u;let h=(c+n).length;try{t.selectionStart=t.selectionEnd=h}catch{}return{outcome:"replaced",undo:()=>{try{return t.value=i,!0}catch{return!1}}}}catch{return{outcome:"none"}}try{let i=window.getSelection(),s=t.innerHTML;if(i&&i.rangeCount>0){i.deleteFromDocument();let o=document.createTextNode(n);i.getRangeAt(0).insertNode(o),i.removeAllRanges();let u=document.createRange();u.setStartAfter(o),u.setEndAfter(o),i.addRange(u)}else t.textContent=n;return{outcome:"replaced",undo:()=>{try{return t.innerHTML=s,!0}catch{return!1}}}}catch{return{outcome:"none"}}}var xw=Se(()=>{"use strict"});var dp={};hn(dp,{applyReplacementOrCopyWithUndo:()=>GS});async function GS(n){try{let e=document.activeElement;if(hp(e)){let t=kw(n);if(t.outcome==="replaced")return t}try{return await navigator.clipboard.writeText(n),{outcome:"copied"}}catch{return{outcome:"none"}}}catch{return{outcome:"none"}}}var fp=Se(()=>{"use strict";xw()});var Ct={};hn(Ct,{actions:()=>QS,analyzePage:()=>JS,rewrite:()=>KS,saveMemo:()=>XS,translate:()=>YS,translateChunks:()=>pp});async function WS(){try{return(await new Promise(e=>{try{chrome.storage?.local.get?.(["desainr.idToken"],t=>e(t))}catch{e({})}}))?.["desainr.idToken"]}catch{return}}async function cs(n,e){let t=await WS();return await new Promise(r=>{try{chrome.runtime.sendMessage({type:"API_CALL",path:n,body:e,token:t},i=>{if(i)r(i);else{let s=chrome.runtime.lastError?.message||"no response";r({ok:!1,status:0,error:s})}})}catch(i){r({ok:!1,status:0,error:i?.message||String(i)})}})}function KS(n){return cs("rewrite",n)}function pp(n){return cs("translateChunks",n)}function QS(n){return cs("actions",n)}function YS(n){return cs("translate",n)}function JS(n){return cs("analyze",n)}function XS(n){return cs("saveMemo",n)}var At=Se(()=>{"use strict"});var Dw={};hn(Dw,{getSelectionInfo:()=>ZS});function ZS(){try{let n=window.getSelection();if(!n||n.rangeCount===0)return null;let e=n.getRangeAt(0);if(!e||n.isCollapsed||e.collapsed)return null;let t=n.toString();if(!t||!t.trim())return null;let r=e.getClientRects(),i;if(r&&r.length>0){let s=1/0,o=1/0,c=-1/0,u=-1/0;for(let h=0;h<r.length;h++){let f=r.item(h);f&&(f.width===0&&f.height===0||(s=Math.min(s,f.left),o=Math.min(o,f.top),c=Math.max(c,f.right),u=Math.max(u,f.bottom)))}!isFinite(s)||!isFinite(o)||!isFinite(c)||!isFinite(u)?i=e.getBoundingClientRect():i=new DOMRect(s,o,Math.max(0,c-s),Math.max(0,u-o))}else i=e.getBoundingClientRect();return{text:t,rect:i}}catch{return null}}var Nw=Se(()=>{"use strict"});var mp={};hn(mp,{translatePageAll:()=>t1});function e1(n){if(n.nodeType!==Node.TEXT_NODE)return!1;let e=n.data;if(!e||!e.trim())return!1;let t=n.parentElement;if(!t)return!1;let r=window.getComputedStyle(t);return!(r&&(r.visibility==="hidden"||r.display==="none"))}async function t1(n){let e=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT,null),t=0,r=0,i=0,s=location.href,o=5e3,c=[],u;for(;u=e.nextNode();)e1(u)&&c.push(u);for(let h of c){t++;let f=h.data?.trim?.()||"";if(!f||f.length<2||f.length>o){i++;continue}try{let{ok:p,json:g}=await pp({selection:f,url:s,targetLang:n});p&&g?.result?(h.data=g.result,r++):i++}catch{i++}}return{totalNodes:t,translated:r,skipped:i}}var gp=Se(()=>{"use strict";At()});var Ow={};hn(Ow,{disableParallelMode:()=>i1,enableParallelMode:()=>r1,isParallelModeEnabled:()=>n1});function n1(){return Fu}async function r1(n){if(!Fu){Fu=!0;try{let{translatePageAll:e}=await Promise.resolve().then(()=>(gp(),mp));await e(n)}catch{}try{Uu=new MutationObserver(()=>{}),Uu.observe(document.body,{childList:!0,subtree:!0})}catch{}}}function i1(){Fu=!1;try{Uu?.disconnect()}catch{}Uu=null}var Fu,Uu,Vw=Se(()=>{"use strict";Fu=!1,Uu=null});(()=>{let n="desainr-overlay-root",e=document.getElementById(n);if(e)try{e.style.display="none",e.textContent=""}catch{}function t(){let G=document.getElementById(n);return G||(G=document.createElement("div"),G.id=n,Object.assign(G.style,{position:"fixed",top:"20px",right:"20px",zIndex:999999,background:"white",color:"#111",border:"1px solid #ddd",borderRadius:"8px",padding:"8px 12px",boxShadow:"0 6px 20px rgba(0,0,0,0.15)",display:"none",maxWidth:"420px",fontFamily:"Segoe UI, Arial, sans-serif"}),document.documentElement.appendChild(G)),G}function r(G){let ue=t();ue.textContent=G,ue.style.display="block"}function i(){let G=t();G.style.display="none"}function s(){let G=t();G.style.display=G.style.display==="none"?"block":"none"}function o(G,ue,de=6e3){let ce=document.createElement("button");ce.textContent="Undo",Object.assign(ce.style,{marginLeft:"8px",padding:"4px 8px",border:"1px solid #ccc",borderRadius:"6px",cursor:"pointer"});let we=()=>{try{let De=ue();G.textContent=De?"Undone \u2713":"Undo failed"}catch{G.textContent="Undo failed"}finally{ce.remove(),setTimeout(()=>i(),800)}};ce.addEventListener("click",we,{once:!0}),G.appendChild(ce),setTimeout(()=>{try{ce.remove()}catch{}},de)}function c(G,ue,de=12e3){let ce=document.createElement("button");ce.textContent="Copy",Object.assign(ce.style,{marginLeft:"8px",padding:"4px 8px",border:"1px solid #ccc",borderRadius:"6px",cursor:"pointer"});let we=async()=>{try{await navigator.clipboard.writeText(ue),G.textContent="Copied \u2713"}catch{G.textContent="Copy failed"}finally{ce.remove(),setTimeout(()=>i(),800)}};ce.addEventListener("click",we,{once:!0}),G.appendChild(ce),setTimeout(()=>{try{ce.remove()}catch{}},de)}function u(G){return G.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function h(G,ue){let de=u(String(ue.summary||"Analysis complete")),ce=Array.isArray(ue.keyPoints)?ue.keyPoints:[],we=Array.isArray(ue.links)?ue.links:[],De=ce.length?`<ul style="margin:6px 0 8px 18px; padding:0;">${ce.map(me=>`<li style="margin:2px 0;">${u(me)}</li>`).join("")}</ul>`:"",jt=we.length?`<div style="margin-top:6px; max-height:160px; overflow:auto;"><div style="font-weight:600; margin-bottom:4px;">Top links</div>${we.slice(0,10).map(me=>`<div style="white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><a href="${u(me)}" target="_blank" rel="noopener noreferrer">${u(me)}</a></div>`).join("")}</div>`:"";G.innerHTML=`<div style="font-size:13px; line-height:1.35;">
      <div style="display:flex; align-items:center; justify-content:space-between; gap:12px;">
        <div style="font-weight:700;">Analysis</div>
        <button id="desainr-close-overlay" style="border:1px solid #ddd; border-radius:6px; padding:2px 6px; background:#f7f7f7; cursor:pointer;">Close</button>
      </div>
      <div style="margin-top:6px;">${de}</div>
      ${De}
      ${jt}
    </div>`;let Ne=G.querySelector("#desainr-close-overlay");Ne&&(Ne.onclick=()=>{G.style.display="none"})}let f=null,p=null;async function g(){if(p){try{p.detach()}catch{}p=null,f=null;return}let G=document.createElement("div");G.id="desainr-overlay-react-root",Object.assign(G.style,{position:"fixed",top:"20px",right:"20px",zIndex:1e6}),document.documentElement.appendChild(G);try{p=(await Promise.resolve().then(()=>(um(),cm))).mountOverlay(G,()=>{try{p?.detach()}catch{}p=null,f=null}),f=G}catch(ue){let de=t();de.style.display="block",de.textContent=`Overlay failed: ${ue?.message||ue}`,setTimeout(()=>i(),1500)}}let w=null,k=null,D="",C=null,H=0,F=["refine","translate","rephrase","summarize"];chrome.storage?.sync?.get(["desainr.pinnedActions"],G=>{G&&G["desainr.pinnedActions"]&&(F=G["desainr.pinnedActions"])});function z(G){let ue=D||window.getSelection()?.toString()||"";ue.trim()&&G(ue)}let ne="desainr.customActions",se={};async function re(){try{let G=await chrome.storage?.sync?.get?.([ne]).catch(()=>({})),ue=G&&G[ne]||[],de={};if(Array.isArray(ue))for(let ce of ue)ce&&typeof ce.id=="string"&&ce.title&&ce.instruction&&(de[String(ce.id)]={title:String(ce.title),instruction:String(ce.instruction)});return de}catch{return{}}}async function E(G){let ue=Object.entries(G).map(([de,ce])=>({id:de,title:ce.title,instruction:ce.instruction}));try{await chrome.storage?.sync?.set?.({[ne]:ue})}catch{}}function _(){try{w&&(w.remove(),w=null,k=null,dt())}catch{}}async function v(){se=await re();try{let{firebaseAuth:G,firebaseDb:ue}=await Promise.resolve().then(()=>(lp(),up)),de=G.currentUser;if(!de)return;let{getDocs:ce,collection:we,orderBy:De,query:jt}=await Promise.resolve().then(()=>(Mu(),ap)),Ne=we(ue,"users",de.uid,"customActions"),me=jt(Ne,De("createdAt","desc")),Rn=await ce(me),ft={};Rn.forEach(vt=>{let Oe=vt.data();if(Oe&&Oe.name&&Oe.instruction){let an=`custom:${vt.id}`;ft[an]={title:String(Oe.name),instruction:String(Oe.instruction)}}}),se=ft,await E(se),_()}catch{}}v();let I=null,T=null;function S(){if(I)return I;let G=document.createElement("div");G.id="desainr-result-popup",Object.assign(G.style,{position:"fixed",zIndex:1e6,top:"0px",left:"0px",display:"none"}),T=G.attachShadow({mode:"open"});let ue=document.createElement("style");ue.textContent=`
      :host { all: initial; }
      .popup { 
        min-width: 420px; width: 580px; max-width: 90vw;
        min-height: 300px; height: 460px; max-height: 80vh;
        background: #fff; color: #111; 
        border: 1px solid #e1e5e9; border-radius: 16px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.15), 0 8px 20px rgba(0,0,0,0.08);
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
        resize: both; overflow: auto;
        backdrop-filter: blur(10px);
        animation: popupSlideIn 0.25s cubic-bezier(0.2, 0.8, 0.3, 1);
        transition: width 0.15s ease, height 0.15s ease, box-shadow 0.2s ease, transform 0.1s ease;
        position: relative;
      }
      .popup:hover { 
        box-shadow: 0 24px 70px rgba(0,0,0,0.18), 0 10px 25px rgba(0,0,0,0.1); 
        transform: translateY(-1px);
      }
      @keyframes popupSlideIn {
        from { opacity: 0; transform: translateY(8px) scale(0.98); }
        to { opacity: 1; transform: translateY(0) scale(1); }
      }
      .resize-handle { 
        position: absolute; bottom: 0; right: 0; width: 16px; height: 16px;
        background: linear-gradient(-45deg, transparent 30%, #cdd1d5 30%, #cdd1d5 40%, transparent 40%, transparent 60%, #cdd1d5 60%, #cdd1d5 70%, transparent 70%);
        cursor: nw-resize; border-radius: 0 0 16px 0;
      }
      /* Responsive grid layout */
      .body { padding: 12px 16px 8px; font-size: 13.5px; line-height: 1.5; flex: 1; overflow: auto; }
      .cols { 
        display: grid; 
        grid-template-columns: 1fr 1fr; 
        gap: 16px; 
        align-items: start;
        min-height: 200px;
      }
      @media (max-width: 600px) {
        .cols { grid-template-columns: 1fr; gap: 12px; }
      }
      .orig, .res { 
        min-height: 120px; border-radius: 12px; padding: 12px; 
        white-space: pre-wrap; font-size: 13px; line-height: 1.6;
        transition: all 0.2s ease;
      }
      .orig { 
        color: #4a5568; background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%); 
        border: 1px solid #e2e8f0;
      }
      .res { 
        background: linear-gradient(135deg, #ffffff 0%, #fafbfc 100%); 
        border: 1px solid #e1e7ed;
        box-shadow: 0 2px 8px rgba(0,0,0,0.04);
      }
      .orig:hover, .res:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
      .col-title { 
        font-size: 11px; color: #718096; margin: 0 0 8px 4px; 
        font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;
      }
      .ftr { 
        display: flex; align-items: center; justify-content: space-between; 
        gap: 12px; padding: 12px 16px; 
        border-top: 1px solid #f0f4f7; background: #fafbfc;
        border-radius: 0 0 16px 16px;
      }
      .ftr-left { font-size: 12px; color: #718096; font-weight: 500; }
      .btns { display: flex; gap: 8px; }
      button { 
        border: 1px solid #e2e8f0; border-radius: 8px; 
        padding: 6px 12px; background: #ffffff; cursor: pointer; 
        font-size: 12px; font-weight: 500; color: #4a5568;
        transition: all 0.15s ease;
        box-shadow: 0 1px 3px rgba(0,0,0,0.04);
      }
      button:hover { 
        background: #f7fafc; border-color: #cbd5e0; 
        transform: translateY(-0.5px); box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      }
      button.primary { 
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
        color: #fff; border-color: #667eea;
      }
      button.primary:hover { 
        background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
        border-color: #5a6fd8;
      }
      
      /* Modern scrollbar styles */
      ::-webkit-scrollbar {
        width: 6px;
        height: 6px;
      }
      ::-webkit-scrollbar-track {
        background: transparent;
        border-radius: 10px;
      }
      ::-webkit-scrollbar-thumb {
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.2));
        border-radius: 10px;
        transition: all 0.3s ease;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.4), rgba(118, 75, 162, 0.4));
      }
      ::-webkit-scrollbar-corner {
        background: transparent;
      }
      
      /* Firefox scrollbar */
      .orig, .res, .body {
        scrollbar-width: thin;
        scrollbar-color: rgba(102, 126, 234, 0.2) transparent;
      }
      
      /* Add smooth scrolling */
      .orig, .res {
        scroll-behavior: smooth;
        overflow-y: auto;
      }
    `,T.appendChild(ue);let de=document.createElement("div");return de.className="popup",de.innerHTML=`
      <div class="body">
        <div class="cols">
          <div>
            <div class="col-title">Original</div>
            <div class="orig" id="orig"></div>
          </div>
          <div>
            <div class="col-title" id="resTitle">Result</div>
            <div class="res" id="res"></div>
          </div>
        </div>
      </div>
      <div class="ftr">
        <div class="ftr-left" id="footerTitle">Result</div>
        <div class="btns">
          <button id="regen" title="Regenerate">\u21BB</button>
          <button id="copy" title="Copy">Copy</button>
          <button id="cancel" title="Cancel">Cancel</button>
          <button id="replace" class="primary" title="Replace">Replace</button>
        </div>
      </div>
      <div class="resize-handle" title="Drag to resize"></div>`,T.appendChild(de),document.documentElement.appendChild(G),I=G,G}async function y(G,ue,de,ce){let we=S(),De=T,jt={textContent:""},Ne=De.getElementById("orig"),me=De.getElementById("res"),Rn=De.getElementById("resTitle"),ft=De.getElementById("footerTitle"),vt=De.getElementById("cancel"),Oe=De.getElementById("copy"),an=De.getElementById("replace"),ei=De.getElementById("regen"),lt=De.querySelector(".popup"),ti=De.querySelector(".body"),Ke=G;ft&&(ft.textContent=Ke),jt.textContent=Ke,Rn&&(Rn.textContent=G==="Translate"?"Translated":"Result"),Ne.textContent=ue,me.textContent=de;let ni=()=>{if(!lt)return;let A=window.innerWidth,O=window.innerHeight,U=420,M=300,Q=Math.floor(A*.9),Z=Math.floor(O*.8);lt.style.maxWidth=`${Q}px`,lt.style.maxHeight=`${Z}px`,lt.style.width="auto",lt.style.height="auto";let K=Math.min(Q,Math.max(U,Math.ceil(lt.scrollWidth))),$=Math.min(Z,Math.max(M,Math.ceil(lt.scrollHeight)));if(A>=1200&&$<Math.floor(O*.35)){let L=Math.max(U,Math.min(Q,Math.ceil($*1.6)));L<K&&(K=L)}lt.style.width=`${K}px`,lt.style.height=`${$}px`;try{ri()}catch{}},wt=()=>requestAnimationFrame(ni),qt=new MutationObserver(()=>wt());try{qt.observe(Ne,{childList:!0,subtree:!0,characterData:!0}),qt.observe(me,{childList:!0,subtree:!0,characterData:!0})}catch{}let lr=()=>wt();try{window.addEventListener("resize",lr,{passive:!0})}catch{}function us(){let A=($,L=!1)=>L?$.split(/(?<=[.!?])\s*/).filter(J=>J.trim().length>0).map(J=>J.trim()):$.split(/(?<=[.!?])\s+/).filter(J=>J.trim().length>0).map(J=>J.trim()),O=A(ue,!1),U=A(de,!0);Ne.innerHTML="",me.innerHTML="";let M=null,Q=($,L,J)=>{let oe=document.createElement("span");return oe.textContent=$,oe.style.cssText=`
          cursor: pointer; 
          transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
          display: inline;
          padding: 0;
          border-radius: 0;
        `,oe.dataset.sentIdx=String(L),oe.className="sentence-span",J.appendChild(oe),(L<O.length-1||L<U.length-1)&&J.appendChild(document.createTextNode(" ")),oe};O.forEach(($,L)=>{Q($,L,Ne)}),U.forEach(($,L)=>{L<O.length&&Q($,L,me)});let Z=($,L)=>{De.querySelectorAll(`span[data-sent-idx="${$}"]`).forEach(oe=>{let ae=oe;L?(ae.style.background="linear-gradient(90deg, rgba(99,102,241,0.15) 0%, rgba(99,102,241,0.1) 100%)",ae.style.borderRadius="6px",ae.style.padding="3px 6px",ae.style.boxShadow="0 2px 4px rgba(99,102,241,0.1)",ae.style.transform="scale(1.02)"):(ae.style.background="",ae.style.borderRadius="",ae.style.padding="0",ae.style.boxShadow="",ae.style.transform="")})};De.querySelectorAll(".sentence-span").forEach($=>{let L=$;L.addEventListener("mouseenter",()=>{let J=L.dataset.sentIdx;M!==J&&(M&&Z(M,!1),Z(J,!0),M=J)}),L.addEventListener("click",()=>{let J=L.dataset.sentIdx,oe=O[parseInt(J)],ae=U[parseInt(J)];oe&&ae&&(L.style.transform="scale(0.98)",setTimeout(()=>{L.style.transform="scale(1.02)"},100))})}),[Ne,me].forEach($=>{$.addEventListener("mouseleave",()=>{M&&(Z(M,!1),M=null)})})}if(G==="Translate")try{us()}catch{}wt();function ri(){let A=0,O=0,U=10,M=ce||new DOMRect(window.innerWidth/2-200,80,400,0),Q=I.getBoundingClientRect();A=Math.min(Math.max(U,M.left),window.innerWidth-Q.width-U),O=Math.min(Math.max(U,M.top+M.height+U),window.innerHeight-Q.height-U),we.style.left=`${Math.round(A)}px`,we.style.top=`${Math.round(O)}px`}we.style.display="block",requestAnimationFrame(()=>ri());let Qe=A=>{try{(A.composedPath?.()||[]).includes(we)||cn()}catch{we.contains(A.target)||cn()}};function cn(){we.style.display="none";try{document.removeEventListener("pointerdown",Qe,!0)}catch{}try{window.removeEventListener("resize",lr)}catch{}try{qt.disconnect()}catch{}}try{document.addEventListener("pointerdown",Qe,!0)}catch{}vt.onclick=()=>cn(),Oe.onclick=async()=>{try{await navigator.clipboard.writeText(de)}catch{}},an.onclick=async()=>{let{applyReplacementOrCopyWithUndo:A}=await Promise.resolve().then(()=>(fp(),dp)),{outcome:O,undo:U}=await A(de),M=t();O==="replaced"?(M.textContent="Replaced \u2713",U&&o(M,U)):O==="copied"?(M.textContent="Copied \u2713",c(M,de)):M.textContent="Done",M.style.display="block",setTimeout(()=>i(),900),cn()},ei&&(ei.style.display=G==="Translate"?"":"none"),ei.onclick=async()=>{try{if(jt.textContent==="Translate"){me.textContent="Working\u2026";let A=await chrome.storage?.local.get?.(["desainr.settings.targetLang","desainr.settings.modelId","desainr.settings.thinkingMode"]).catch(()=>({})),O=A?.["desainr.settings.targetLang"]||(await Promise.resolve().then(()=>(Zr(),as))).DEFAULT_TARGET_LANG,U=A?.["desainr.settings.modelId"],M=A?.["desainr.settings.thinkingMode"]||"none",{translateChunks:Q}=await Promise.resolve().then(()=>(At(),Ct)),{ok:Z,status:K,json:$,error:L}=await Q({selection:ue,url:location.href,targetLang:O,modelId:U,thinkingMode:M});if(Z&&$?.result)me.textContent=$.result,wt();else{let J=$?.error||L||"unknown";me.textContent=`Failed (${K}): ${J}`,wt()}}else{let A=t();A.textContent="Regenerate is available for Translate results only.",A.style.display="block",setTimeout(()=>i(),1e3)}}catch(A){me.textContent=`Error: ${A?.message||A}`,wt()}}}function dt(){if(w)return w;let G=document.createElement("div");G.id="desainr-mini-toolbar",Object.assign(G.style,{position:"fixed",zIndex:"999999",top:"0px",left:"0px",display:"none"}),k=G.attachShadow({mode:"open"});let ue=document.createElement("style");ue.textContent=`
      .wrap { 
        display: flex; align-items: center; gap: 4px; padding: 4px; 
        background: #ffffff; border: 1px solid rgba(0,0,0,0.08); 
        border-radius: 24px; box-shadow: 0 4px 16px rgba(0,0,0,0.12), 0 1px 3px rgba(0,0,0,0.08);
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
        backdrop-filter: blur(12px); background: rgba(255,255,255,0.95);
      }
      .btn-wrap {
        position: relative; display: inline-flex; align-items: center; justify-content: center;
      }
      .btn { 
        position: relative; border: none; background: transparent; 
        width: 36px; height: 36px; border-radius: 50%; 
        cursor: pointer; display: flex; align-items: center; justify-content: center;
        transition: all 0.2s ease; font-size: 12px;
      }
      .btn:hover { background: rgba(99,102,241,0.1); transform: scale(1.05); }
      .btn:focus-visible { outline: 2px solid #6366f1; outline-offset: 2px; box-shadow: 0 0 0 3px rgba(99,102,241,0.2); }
      .btn.active { background: rgba(99,102,241,0.15); }
      .btn svg.ico { 
        color: #4a5568; 
        transition: all 0.2s ease;
      }
      .btn:hover svg.ico { 
        color: #6366f1; 
        transform: scale(1.1);
      }
      .btn span:not(.ico) { display: none; }
      /* toolbar pin button removed; pin/unpin controls live only in More menu */
      
      /* Monica-style tooltip */
      .btn::after {
        content: attr(title); position: absolute; bottom: -28px; left: 50%;
        transform: translateX(-50%) scale(0.8); opacity: 0;
        background: rgba(0,0,0,0.8); color: white; padding: 4px 8px;
        border-radius: 6px; font-size: 11px; white-space: nowrap;
        pointer-events: none; transition: all 0.2s ease;
      }
      .btn:hover::after { opacity: 1; transform: translateX(-50%) scale(1); }
      
      .divider { width: 1px; height: 20px; background: rgba(0,0,0,0.08); margin: 0 4px; }
      .more { position: relative; }
      .menu { 
        position: absolute; top: 44px; right: 0; 
        background: rgba(255,255,255,0.98); backdrop-filter: blur(20px);
        border: 1px solid rgba(0,0,0,0.08); border-radius: 12px; 
        box-shadow: 0 8px 32px rgba(0,0,0,0.12), 0 2px 8px rgba(0,0,0,0.08);
        padding: 4px; min-width: 220px; display: none;
        animation: menuSlide 0.2s ease;
      }
      @keyframes menuSlide {
        from { opacity: 0; transform: translateY(-8px); }
        to { opacity: 1; transform: translateY(0); }
      }
      .menu.open { display: block; }
      .mi { 
        display: flex; align-items: center; gap: 10px; 
        padding: 8px 12px; border-radius: 8px; cursor: pointer;
        transition: all 0.15s ease; font-size: 13px; color: #4a5568;
      }
      .mi:hover { background: rgba(99,102,241,0.08); color: #6366f1; transform: translateX(2px); }
      .mi:focus-visible { outline: 2px solid #6366f1; outline-offset: 2px; background: rgba(99,102,241,0.08); }
      .mi .mi-icon { 
        width: 16px; height: 16px; opacity: 0.6; margin-right: 2px;
        transition: all 0.2s ease;
      }
      .mi:hover .mi-icon { opacity: 1; color: #6366f1; }
      .mi .mi-pin {
        margin-left: auto; border: none; background: transparent; cursor: pointer;
        width: 28px; height: 28px; border-radius: 8px; display: flex; align-items: center; justify-content: center;
      }
      .mi .mi-pin:hover { background: rgba(99,102,241,0.08); }
      .mi .mi-pin:focus-visible { outline: 2px solid #6366f1; outline-offset: 2px; }
      .mi .mi-pin svg { width: 16px; height: 16px; color: #6b7280; }
      .mi .mi-pin.pinned svg { color: #6366f1; }
    `;let de={refine:{title:"Refine",svg:'<svg class="ico" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456ZM16.894 20.567 16.5 21.75l-.394-1.183a2.25 2.25 0 0 0-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 0 0 1.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 0 0 1.423 1.423l1.183.394-1.183.394a2.25 2.25 0 0 0-1.423 1.423Z"/></svg>'},translate:{title:"Translate",svg:'<svg class="ico" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M12 21a9.004 9.004 0 0 0 8.716-6.747M12 21a9.004 9.004 0 0 1-8.716-6.747M12 21c2.485 0 4.5-4.03 4.5-9S14.485 3 12 3m0 18c-2.485 0-4.5-4.03-4.5-9S9.515 3 12 3m0 0a8.997 8.997 0 0 1 7.843 4.582M12 3a8.997 8.997 0 0 0-7.843 4.582m15.686 0A11.953 11.953 0 0 1 12 10.5c-2.998 0-5.74-1.1-7.843-2.918m15.686 0A8.959 8.959 0 0 1 21 12c0 .778-.099 1.533-.284 2.253m0 0A17.919 17.919 0 0 1 12 16.5c-3.162 0-6.133-.815-8.716-2.247m0 0A9.015 9.015 0 0 1 3 12c0-1.605.42-3.113 1.157-4.418"/></svg>'},rephrase:{title:"Rephrase",svg:'<svg class="ico" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M7.5 21 3 16.5m0 0L7.5 12M3 16.5h13.5m0-13.5L21 7.5m0 0L16.5 12M21 7.5H7.5"/></svg>'},summarize:{title:"Summarize",svg:'<svg class="ico" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"/></svg>'},"add-details":{title:"Add Details",svg:'<svg class="ico" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15"/></svg>'},"more-informative":{title:"More Informative",svg:'<svg class="ico" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"/></svg>'},explain:{title:"Explain",svg:'<svg class="ico" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 5.25h.008v.008H12v-.008Z"/></svg>'},simplify:{title:"Simplify",svg:'<svg class="ico" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 0 1-.659 1.591l-5.432 5.432a2.25 2.25 0 0 0-.659 1.591v2.927a2.25 2.25 0 0 1-1.244 2.013L9.75 21v-6.568a2.25 2.25 0 0 0-.659-1.591L3.659 7.409A2.25 2.25 0 0 1 3 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0 1 12 3Z"/></svg>'}},ce='<svg class="ico" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 7.5 12 3l2.187 4.5L18.75 9 14.25 11.25 12 15.75 9.75 11.25 5.25 9l4.563-1.5Z"/><path stroke-linecap="round" stroke-linejoin="round" d="M6 18l1-2 1 2 2 1-2 1-1 2-1-2-2-1 2-1Z"/></svg>';for(let[A,O]of Object.entries(se))de[A]={title:O.title,svg:ce};let we=document.createElement("div");we.className="wrap",we.setAttribute("role","toolbar"),we.setAttribute("aria-label","DesAInR toolbar");let De='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M17.593 3.322c1.1.128 1.907 1.077 1.907 2.185V21L12 17.25 4.5 21V5.507c0-1.108.806-2.057 1.907-2.185a48.507 48.507 0 0 1 11.186 0Z"/></svg>',jt='<svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M6.32 2.577a49.255 49.255 0 0 1 11.36 0c1.497.174 2.57 1.46 2.57 2.93V21a.75.75 0 0 1-1.085.67L12 18.089l-7.165 3.583A.75.75 0 0 1 3.75 21V5.507c0-1.47 1.073-2.756 2.57-2.93Z" clip-rule="evenodd"/></svg>',Ne="";F.forEach(A=>{let O=de[A];O&&(Ne+=`
          <div class="btn-wrap" data-action-id="${A}">
            <button id="btn-${A}" class="btn" title="${O.title}" aria-label="${O.title}" tabindex="0">${O.svg}</button>
          </div>`)});let Rn=Object.keys(de).map(A=>{let O=de[A];if(!O)return"";let U=O.svg.replace('class="ico"','class="mi-icon"').replace('width="20"','width="16"').replace('height="20"','height="16"'),M=F.includes(A),Q=`<button class="mi-pin ${M?"pinned":""}" data-action-id="${A}" title="${M?"Unpin from toolbar":"Pin to toolbar"}" aria-label="${M?"Unpin from toolbar":"Pin to toolbar"}: ${O.title}" aria-pressed="${M?"true":"false"}" tabindex="0">${M?jt:De}</button>`;return`<div class="mi" data-action-id="${A}" title="${O.title}" role="menuitem" tabindex="-1">${U}${O.title}${Q}</div>`}).join("");we.innerHTML=Ne+'<div class="divider"></div><div class="more"><button id="btn-more" class="btn" title="More Actions" aria-label="More Actions" aria-haspopup="true" aria-expanded="false" aria-controls="menu" tabindex="0"><svg class="ico" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M6.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM12.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM18.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z" /></svg></button><div id="menu" class="menu" role="menu" aria-label="All actions">'+Rn+'<div style="height:4px; border-top: 1px solid rgba(0,0,0,0.06); margin: 4px 8px;"></div><div class="mi" data-act="Analyze" role="menuitem" tabindex="-1"><svg class="mi-icon" viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M20.25 7.5l-8.25-4.5-8.25 4.5M20.25 7.5L12 12m8.25-4.5v9L12 21m0-9L3.75 7.5M12 12v9" /></svg>Analyze</div><div class="mi" data-act="Custom" role="menuitem" tabindex="-1"><svg class="mi-icon" viewBox="0 0 20 20" width="16" height="16" fill="currentColor"><path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" /></svg>Custom...</div></div></div>',k.appendChild(ue),k.appendChild(we),document.documentElement.appendChild(G),w=G,we.addEventListener("click",A=>{let O=A.target.closest(".btn-pin");if(!O)return;A.stopPropagation();let U=O.getAttribute("data-action-id")||"";U&&(F=F.filter(M=>M!==U),chrome.runtime.sendMessage({type:"SAVE_PINNED_ACTIONS",actions:F}))}),G.addEventListener("mousedown",()=>{H=Date.now()+350},!0);async function ft(){z(async A=>{let{rewrite:O}=await Promise.resolve().then(()=>(At(),Ct));try{await y("Rewrite",A,"Working\u2026",C||void 0);let U=await chrome.storage?.local.get?.(["desainr.settings.modelId","desainr.settings.thinkingMode"]).catch(()=>({})),M=U?.["desainr.settings.modelId"],Q=U?.["desainr.settings.thinkingMode"]||"none",{ok:Z,status:K,json:$,error:L}=await O({selection:A,url:location.href,task:"clarify",modelId:M,thinkingMode:Q});if(Z&&$?.result)await y("Rewrite",A,$.result,C||void 0);else{let J=$?.error||L||"unknown";await y("Rewrite",A,`Failed (${K}): ${J}`,C||void 0)}}catch(U){await y("Rewrite",A,`Error: ${U?.message||U}`,C||void 0)}finally{Qe()}})}let vt=k.getElementById("btn-more"),Oe=k.getElementById("menu");function an(A){if(H=Date.now()+350,A){Oe.classList.add("open"),vt.setAttribute("aria-expanded","true");let O=Oe.querySelector(".mi");O&&O.focus()}else Oe.classList.remove("open"),vt.setAttribute("aria-expanded","false"),vt.focus()}vt.addEventListener("click",()=>{an(!Oe.classList.contains("open"))}),vt.addEventListener("keydown",A=>{(A.key==="Enter"||A.key===" "||A.key==="ArrowDown")&&(A.preventDefault(),an(!0))});let ei=["Rephrase it","Add details","More informative","Make it polite"],lt=0;function ti(A,O){return(async()=>{let{actions:U}=await Promise.resolve().then(()=>(At(),Ct));try{await y(A,O,"Working\u2026",C||void 0);let M=await chrome.storage?.local.get?.(["desainr.settings.modelId","desainr.settings.thinkingMode"]).catch(()=>({})),Q=M?.["desainr.settings.modelId"],Z=M?.["desainr.settings.thinkingMode"]||"none",{ok:K,status:$,json:L,error:J}=await U({selection:O,clientMessage:O,customInstruction:A,modelId:Q,thinkingMode:Z});if(K&&L?.result)await y(A,O,L.result,C||void 0);else{let oe=L?.error||J||"unknown";await y(A,O,`Failed (${$}): ${oe}`,C||void 0)}}catch(M){await y(A,O,`Error: ${M?.message||M}`,C||void 0)}finally{Qe()}})()}async function Ke(A){z(async O=>{let{actions:U}=await Promise.resolve().then(()=>(At(),Ct));try{await y(A,O,"Working\u2026",C||void 0);let M=await chrome.storage?.local.get?.(["desainr.settings.modelId","desainr.settings.thinkingMode"]).catch(()=>({})),Q=M?.["desainr.settings.modelId"],Z=M?.["desainr.settings.thinkingMode"]||"none",{ok:K,status:$,json:L,error:J}=await U({selection:O,clientMessage:O,customInstruction:A,modelId:Q,thinkingMode:Z});if(K&&L?.result)await y(A,O,L.result,C||void 0);else{let oe=L?.error||J||"unknown";await y(A,O,`Failed (${$}): ${oe}`,C||void 0)}}catch(M){await y(A,O,`Error: ${M?.message||M}`,C||void 0)}finally{Qe()}})}async function ni(){z(async A=>{let{actions:O}=await Promise.resolve().then(()=>(At(),Ct));try{await y("Rephrase",A,"Working\u2026",C||void 0);let U=await chrome.storage?.local.get?.(["desainr.settings.modelId","desainr.settings.thinkingMode"]).catch(()=>({})),M=U?.["desainr.settings.modelId"],Q=U?.["desainr.settings.thinkingMode"]||"none",{ok:Z,status:K,json:$,error:L}=await O({selection:A,clientMessage:A,customInstruction:"Rephrase it",modelId:M,thinkingMode:Q});if(Z&&$?.result)await y("Rephrase",A,$.result,C||void 0);else{let J=$?.error||L||"unknown";await y("Rephrase",A,`Failed (${K}): ${J}`,C||void 0)}}catch(U){await y("Rephrase",A,`Error: ${U?.message||U}`,C||void 0)}finally{Qe()}})}async function wt(){z(async A=>{let{translate:O}=await Promise.resolve().then(()=>(At(),Ct));try{await y("Translate",A,"Working\u2026",C||void 0);let U=await chrome.storage?.local.get?.(["desainr.settings.modelId","desainr.settings.thinkingMode"]).catch(()=>({})),M=U?.["desainr.settings.modelId"],Q=U?.["desainr.settings.thinkingMode"]||"none",{ok:Z,status:K,json:$,error:L}=await O({text:A,modelId:M,thinkingMode:Q});if(Z&&$?.result)await y("Translate",A,$.result,C||void 0);else{let J=$?.error||L||"unknown";await y("Translate",A,`Failed (${K}): ${J}`,C||void 0)}}catch(U){await y("Translate",A,`Error: ${U?.message||U}`,C||void 0)}finally{Qe()}})}F.forEach(A=>{let O=k.getElementById(`btn-${A}`);O&&O.addEventListener("click",async()=>{if(A==="refine")await ft();else if(A==="translate")await wt();else if(A==="rephrase")await Ke("Rephrase it");else if(A==="summarize")await Ke("Summarize");else if(A==="add-details")await Ke("Add details");else if(A==="more-informative")await Ke("More informative");else if(A==="explain")await Ke("Explain");else if(A==="simplify")await Ke("Simplify");else if(A.startsWith("custom:")){let U=se[A];U&&await qt(U.title,U.instruction)}})}),we.addEventListener("keydown",A=>{let O=A.target;if(O.classList.contains("btn")&&(A.key==="ArrowRight"||A.key==="ArrowLeft")){A.preventDefault();let U=Array.from(we.querySelectorAll(".btn")),M=U.indexOf(O);if(M>=0){let Q=A.key==="ArrowRight"?(M+1)%U.length:(M-1+U.length)%U.length;U[Q]?.focus()}}}),Oe.addEventListener("keydown",A=>{let O=Array.from(Oe.querySelectorAll(".mi")),M=(k.activeElement||document.activeElement)?.closest?.(".mi"),Q=M?O.indexOf(M):-1;if(A.key==="Escape"){A.preventDefault(),an(!1);return}A.key==="ArrowDown"?(A.preventDefault(),Q=(Q+1+O.length)%O.length,O[Q]?.focus()):A.key==="ArrowUp"?(A.preventDefault(),Q=(Q-1+O.length)%O.length,O[Q]?.focus()):A.key==="Home"?(A.preventDefault(),O[0]?.focus()):A.key==="End"?(A.preventDefault(),O[O.length-1]?.focus()):(A.key==="Enter"||A.key===" ")&&(A.preventDefault(),M&&M.click())}),Oe.addEventListener("click",async A=>{H=Date.now()+350;let O=A.target,U=O.closest(".mi-pin");if(U){A.stopPropagation();let K=U.getAttribute("data-action-id")||"";if(!K)return;if(F.includes(K))F=F.filter(L=>L!==K);else{if(F.length>=9){let L=t();L.textContent="You can only pin up to 9 actions",L.style.display="block",setTimeout(()=>i(),1200);return}F=[...F,K]}chrome.runtime.sendMessage({type:"SAVE_PINNED_ACTIONS",actions:F});return}let M=O.closest(".mi");if(!M)return;Oe.classList.remove("open"),vt.setAttribute("aria-expanded","false");let Q=M.getAttribute("data-action-id")||"";if(Q){z(async()=>{if(Q==="refine")await ft();else if(Q==="translate")await wt();else if(Q==="rephrase")await Ke("Rephrase it");else if(Q==="summarize")await Ke("Summarize");else if(Q==="add-details")await Ke("Add details");else if(Q==="more-informative")await Ke("More informative");else if(Q==="explain")await Ke("Explain");else if(Q==="simplify")await Ke("Simplify");else if(Q.startsWith("custom:")){let K=se[Q];K&&await qt(K.title,K.instruction)}Qe()});return}let Z=M.getAttribute("data-act")||"";if(Z){if(Z==="Custom\u2026"||Z==="Custom"){lr();return}if(Z==="Analyze"){let{analyzePage:K}=await Promise.resolve().then(()=>(At(),Ct)),$=D||window.getSelection()?.toString()||"";try{await y("Analyze",$,"Working\u2026",C||void 0);let{ok:L,status:J,json:oe,error:ae}=await K({url:location.href,title:document.title});if(L)await y("Analyze",$,oe?.summary||"",C||void 0);else{let Ce=oe?.error||ae||"unknown";await y("Analyze",$,`Failed (${J}): ${Ce}`,C||void 0)}}catch(L){await y("Analyze",$,`Error: ${L?.message||L}`,C||void 0)}finally{Qe()}return}z(async K=>{let{actions:$}=await Promise.resolve().then(()=>(At(),Ct));try{await y(Z,K,"Working\u2026",C||void 0);let L=await chrome.storage?.local.get?.(["desainr.settings.modelId","desainr.settings.thinkingMode"]).catch(()=>({})),J=L?.["desainr.settings.modelId"],oe=L?.["desainr.settings.thinkingMode"]||"none",{ok:ae,status:Ce,json:Ze,error:kt}=await $({selection:K,clientMessage:K,customInstruction:Z,modelId:J,thinkingMode:oe});if(ae&&Ze?.result)await y(Z,K,Ze.result,C||void 0);else{let xt=Ze?.error||kt||"unknown";await y(Z,K,`Failed (${Ce}): ${xt}`,C||void 0)}}catch(L){await y(Z,K,`Error: ${L?.message||L}`,C||void 0)}finally{Qe()}})}}),k.getElementById("btn-translate").addEventListener("click",async()=>{z(async A=>{let{translateChunks:O}=await Promise.resolve().then(()=>(At(),Ct));try{await y("Translate",A,"Working\u2026",C||void 0);let U=await chrome.storage?.local.get?.(["desainr.settings.targetLang","desainr.settings.modelId","desainr.settings.thinkingMode"]).catch(()=>({})),M=U?.["desainr.settings.targetLang"]||(await Promise.resolve().then(()=>(Zr(),as))).DEFAULT_TARGET_LANG,Q=U?.["desainr.settings.modelId"],Z=U?.["desainr.settings.thinkingMode"]||"none",{ok:K,status:$,json:L,error:J}=await O({selection:A,url:location.href,targetLang:M,modelId:Q,thinkingMode:Z});if(K&&L?.result)await y("Translate",A,L.result,C||void 0);else{let oe=L?.error||J||"unknown";await y("Translate",A,`Failed (${$}): ${oe}`,C||void 0)}}catch(U){await y("Translate",A,`Error: ${U?.message||U}`,C||void 0)}finally{Qe()}})});async function qt(A,O){let{actions:U}=await Promise.resolve().then(()=>(At(),Ct)),M=D||window.getSelection()?.toString()||"";try{await y(A,M,"Working\u2026",C||void 0);let Q=await chrome.storage?.local.get?.(["desainr.settings.modelId","desainr.settings.thinkingMode"]).catch(()=>({})),Z=Q?.["desainr.settings.modelId"],K=Q?.["desainr.settings.thinkingMode"]||"none",{ok:$,status:L,json:J,error:oe}=await U({selection:M,clientMessage:M,customInstruction:O,modelId:Z,thinkingMode:K});if($&&J?.result)await y(A,M,J.result,C||void 0);else{let ae=J?.error||oe||"unknown";await y(A,M,`Failed (${L}): ${ae}`,C||void 0)}}catch(Q){await y(A,M,`Error: ${Q?.message||Q}`,C||void 0)}finally{}}function lr(){let A=document.createElement("div");A.setAttribute("role","dialog"),A.setAttribute("aria-modal","true"),A.style.position="fixed",A.style.inset="0",A.style.zIndex="1000001",A.style.background="rgba(0,0,0,0.35)",A.style.display="flex",A.style.alignItems="center",A.style.justifyContent="center";let O=document.createElement("div");O.style.width="520px",O.style.maxWidth="92vw",O.style.background="#fff",O.style.border="1px solid #e1e5e9",O.style.borderRadius="16px",O.style.boxShadow="0 20px 60px rgba(0,0,0,0.15), 0 8px 20px rgba(0,0,0,0.08)",O.style.padding="16px",O.style.fontFamily="-apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif",O.innerHTML=`
      <div style="display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:8px;">
        <div style="font-weight:700; font-size:15px; display:flex; align-items:center; gap:8px;">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 7.5 12 3l2.187 4.5L18.75 9 14.25 11.25 12 15.75 9.75 11.25 5.25 9l4.563-1.5Z"/><path stroke-linecap="round" stroke-linejoin="round" d="M6 18l1-2 1 2 2 1-2 1-1 2-1-2-2-1 2-1Z"/></svg>
          New Custom Action
        </div>
        <button id="ca-close" style="border:1px solid #e2e8f0; border-radius:8px; padding:6px 12px; background:#ffffff; cursor:pointer; font-size:12px; font-weight:500; color:#4a5568; box-shadow:0 1px 3px rgba(0,0,0,0.04);">Close</button>
      </div>
      <label style="display:block; font-size:12px; color:#6b7280; margin:8px 0 4px;">Button name</label>
      <input id="ca-name" type="text" placeholder="e.g., Polite reply" style="width:100%; padding:10px 12px; border:1px solid #e2e8f0; border-radius:12px; font-size:13px; box-shadow: inset 0 1px 2px rgba(0,0,0,0.02);" />
      <label style="display:block; font-size:12px; color:#6b7280; margin:10px 0 4px;">API prompt / instruction</label>
      <textarea id="ca-instruction" rows="5" placeholder="Describe what to do with the selected text..." style="width:100%; padding:10px 12px; border:1px solid #e2e8f0; border-radius:12px; font-size:13px; resize:vertical; box-shadow: inset 0 1px 2px rgba(0,0,0,0.02);"></textarea>
      <div style="display:flex; justify-content:flex-end; gap:8px; margin-top:12px;">
        <button id="ca-save" style="border:1px solid #667eea; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color:#fff; border-radius:8px; padding:6px 12px; cursor:pointer; font-size:12px; font-weight:600;">Save</button>
      </div>
    `,A.appendChild(O),document.documentElement.appendChild(A);let U=()=>{try{A.remove()}catch{}};O.querySelector("#ca-close").onclick=U,A.onclick=Z=>{Z.target===A&&U()},A.addEventListener("keydown",Z=>{Z.key==="Escape"&&(Z.preventDefault(),U()),Z.key==="Enter"&&(Z.ctrlKey||Z.metaKey)&&(Z.preventDefault(),O.querySelector("#ca-save")?.click())});let M=O.querySelector("#ca-save");M.onclick=async()=>{let Z=String(O.querySelector("#ca-name").value||"").trim(),K=String(O.querySelector("#ca-instruction").value||"").trim();if(!Z||!K){M.disabled=!1;return}M.disabled=!0;try{let $="";try{let{firebaseAuth:L,firebaseDb:J}=await Promise.resolve().then(()=>(lp(),up)),oe=L.currentUser;if(oe){let{addDoc:ae,collection:Ce,serverTimestamp:Ze}=await Promise.resolve().then(()=>(Mu(),ap));$=`custom:${(await ae(Ce(J,"users",oe.uid,"customActions"),{name:Z,instruction:K,createdAt:Ze()})).id}`}}catch{}$||($=`custom:local-${Date.now()}`),se[$]={title:Z,instruction:K},await E(se),U(),r("Custom action saved \u2713"),setTimeout(()=>i(),1e3),_()}finally{M.disabled=!1}};let Q=O.querySelector("#ca-name");setTimeout(()=>Q?.focus(),10)}function us(){let A=`
      <!DOCTYPE html>
      <html>
      <head>
        <title>Customize Toolbar</title>
        <style>
          body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            min-height: 100vh;
            color: #1f2937;
          }
          .container {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
          }
          h1 {
            margin: 0 0 24px;
            font-size: 24px;
            color: #1f2937;
          }
          .actions-list {
            list-style: none;
            padding: 0;
            margin: 0;
          }
          .action-item {
            display: flex;
            align-items: center;
            padding: 12px;
            margin-bottom: 8px;
            background: #f9fafb;
            border-radius: 8px;
            cursor: move;
            transition: all 0.2s;
          }
          .action-item:hover {
            background: #f3f4f6;
            transform: translateX(2px);
          }
          .action-item input[type="checkbox"] {
            margin-right: 12px;
            width: 18px;
            height: 18px;
            cursor: pointer;
          }
          .action-item label {
            flex: 1;
            cursor: pointer;
            font-size: 15px;
          }
          .pinned-section {
            background: #eff6ff;
            border: 2px dashed #3b82f6;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 20px;
            min-height: 180px;
          }
          .pinned-title {
            font-size: 14px;
            font-weight: 600;
            color: #3b82f6;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
          }
          .buttons {
            display: flex;
            gap: 12px;
            margin-top: 24px;
          }
          button {
            flex: 1;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
          }
          .save-btn {
            background: #10b981;
            color: white;
          }
          .save-btn:hover {
            background: #059669;
          }
          .cancel-btn {
            background: #e5e7eb;
            color: #4b5563;
          }
          .cancel-btn:hover {
            background: #d1d5db;
          }
        </style>
      </head>
      <body>
        <div class="container">
          <h1>Customize Toolbar Actions</h1>
          <div class="pinned-section">
            <div class="pinned-title">Pinned Actions (Max 9)</div>
            <ul class="actions-list" id="pinnedList"></ul>
          </div>
          <div>
            <div class="pinned-title" style="color: #6b7280;">Available Actions</div>
            <ul class="actions-list" id="availableList"></ul>
          </div>
          <div class="buttons">
            <button class="save-btn" id="saveBtn">Save Changes</button>
            <button class="cancel-btn" id="cancelBtn">Cancel</button>
          </div>
        </div>
        <script>
          const allActions = [
            { id: 'refine', label: 'Refine' },
            { id: 'translate', label: 'Translate' },
            { id: 'rephrase', label: 'Rephrase' },
            { id: 'summarize', label: 'Summarize' },
            { id: 'add-details', label: 'Add Details' },
            { id: 'more-informative', label: 'More Informative' },
            { id: 'explain', label: 'Explain' },
            { id: 'simplify', label: 'Simplify' }
          ];
          
          let pinnedActions = ${JSON.stringify(F)};
          
          function renderLists() {
            const pinnedList = document.getElementById('pinnedList');
            const availableList = document.getElementById('availableList');
            
            pinnedList.innerHTML = '';
            availableList.innerHTML = '';
            
            pinnedActions.forEach(actionId => {
              const action = allActions.find(a => a.id === actionId);
              if (action) {
                const li = document.createElement('li');
                li.className = 'action-item';
                li.draggable = true;
                li.dataset.actionId = action.id;
                li.innerHTML = '<input type="checkbox" checked> <label>' + action.label + '</label>';
                pinnedList.appendChild(li);
              }
            });
            
            allActions.forEach(action => {
              if (!pinnedActions.includes(action.id)) {
                const li = document.createElement('li');
                li.className = 'action-item';
                li.draggable = true;
                li.dataset.actionId = action.id;
                li.innerHTML = '<input type="checkbox"> <label>' + action.label + '</label>';
                availableList.appendChild(li);
              }
            });
            
            // Add event listeners
            document.querySelectorAll('.action-item input').forEach(input => {
              input.addEventListener('change', (e) => {
                const actionId = e.target.parentElement.dataset.actionId;
                if (e.target.checked) {
                  if (pinnedActions.length < 9) {
                    pinnedActions.push(actionId);
                    renderLists();
                  } else {
                    e.target.checked = false;
                    alert('You can only pin up to 9 actions');
                  }
                } else {
                  pinnedActions = pinnedActions.filter(id => id !== actionId);
                  renderLists();
                }
              });
            });
          }
          
          renderLists();
          
          document.getElementById('saveBtn').addEventListener('click', () => {
            try {
              window.opener && window.opener.postMessage({ source: 'desainr', type: 'SAVE_PINNED_ACTIONS', actions: pinnedActions }, '*');
            } catch {}
            window.close();
          });
          
          document.getElementById('cancelBtn').addEventListener('click', () => {
            window.close();
          });
        <\/script>
      </body>
      </html>
    `,O=new Blob([A],{type:"text/html"}),U=URL.createObjectURL(O);window.open(U,"_blank","width=550,height=650")}async function ri(){let O=(await Promise.resolve().then(()=>(Nw(),Dw))).getSelectionInfo();if(!O){Qe();return}D=O.text,C=O.rect;let U=dt();if(!U)return;U.style.display="block";let M=8,Q=O.rect,Z=Q.left,K=Q.top-44,$=U.getBoundingClientRect(),L=window.innerWidth,J=window.innerHeight;Z+$.width+M>L&&(Z=Math.max(M,L-$.width-M)),Z<M&&(Z=M),K<M&&(K=Math.min(J-$.height-M,Q.bottom+M)),U.style.left=`${Math.round(Z)}px`,U.style.top=`${Math.round(K)}px`}function Qe(){I&&I.style.display!=="none"||w&&(w.style.display="none")}document.addEventListener("keydown",A=>{if(A.key==="Escape"&&(Qe(),p)){try{p.detach()}catch{}p=null,f=null}}),document.addEventListener("selectionchange",()=>{if(Date.now()<H)return;(window.getSelection()?.toString()||"").trim()||Qe()}),document.addEventListener("mousedown",A=>{if(!w)return;let O=A.composedPath?.();(O?O.includes(w):w.contains(A.target))||Qe()},!0),chrome.runtime.onMessage.addListener(A=>{A?.type==="TOGGLE_OVERLAY"&&g(),A?.type==="CONTEXT_MENU"&&cn(A.id,A.info),A?.type==="SAVE_PINNED_ACTIONS"&&(F=A.actions,chrome.storage?.sync?.set({"desainr.pinnedActions":F}),w&&(w.remove(),w=null,k=null),dt())}),window.addEventListener("message",A=>{let O=A?.data;if(!(!O||O.source!=="desainr"||O.type!=="SAVE_PINNED_ACTIONS"))try{F=Array.isArray(O.actions)?O.actions:[],chrome.storage?.sync?.set({"desainr.pinnedActions":F}),w&&(w.remove(),w=null,k=null),dt();try{chrome.runtime.sendMessage({type:"SAVE_PINNED_ACTIONS",actions:F})}catch{}}catch{}},!1),document.addEventListener("mouseup",()=>{ri().catch(()=>{})});async function cn(A,O){let{rewrite:U,translateChunks:M,analyzePage:Q,saveMemo:Z}=await Promise.resolve().then(()=>(At(),Ct)),{DEFAULT_TARGET_LANG:K}=await Promise.resolve().then(()=>(Zr(),as)),{applyReplacementOrCopyWithUndo:$}=await Promise.resolve().then(()=>(fp(),dp)),L=t();L.style.display="block";try{if(A==="desainr-refine"){L.textContent="Refining selection...";let J=window.getSelection()?.toString()||"",{ok:oe,status:ae,json:Ce,error:Ze}=await U({selection:J,url:location.href,task:"clarify"});if(oe&&Ce?.result){let{outcome:kt,undo:xt}=await $(Ce.result);kt==="replaced"?(L.textContent="Refined \u2713 (replaced selection)",xt&&o(L,xt)):kt==="copied"?L.textContent="Refined \u2713 (copied)":L.textContent="Refined \u2713"}else L.textContent=`Refine failed (${ae}): ${Ze||"unknown"}`}else if(A==="desainr-translate"){L.textContent="Translating selection...";let J=window.getSelection()?.toString()||"",{ok:oe,status:ae,json:Ce,error:Ze}=await M({selection:J,url:location.href,targetLang:K});if(oe&&Ce?.result){let{outcome:kt,undo:xt}=await $(Ce.result);kt==="replaced"?(L.textContent="Translated \u2713 (replaced selection)",xt&&o(L,xt)):kt==="copied"?L.textContent="Translated \u2713 (copied)":L.textContent="Translated \u2713"}else L.textContent=`Translate failed (${ae}): ${Ze||"unknown"}`}else if(A==="desainr-save-memo"){L.textContent="Saving to memo...";let J=window.getSelection()?.toString()||"";if(!J)L.textContent="No text selected";else{let oe={title:`Selection from ${document.title||location.hostname}`,content:J,url:location.href,type:"selection",metadata:{pageTitle:document.title,timestamp:new Date().toISOString()},tags:["selection","extension"]},{ok:ae,json:Ce,error:Ze}=await Z(oe);ae&&Ce?L.textContent=`\u2713 Saved to memo (ID: ${Ce.memoId})`:L.textContent=`Save to memo failed: ${Ze||"unknown"}`}}else if(A==="desainr-analyze"){L.textContent="Analyzing page...";let{ok:J,status:oe,json:ae,error:Ce}=await Q({url:location.href,title:document.title});J?h(L,{summary:ae?.summary,keyPoints:ae?.keyPoints,links:ae?.links}):L.textContent=`Analyze failed (${oe}): ${Ce||"unknown"}`}else if(A==="desainr-translate-page"){L.textContent="Translating page...";let{translatePageAll:J}=await Promise.resolve().then(()=>(gp(),mp)),{DEFAULT_TARGET_LANG:oe}=await Promise.resolve().then(()=>(Zr(),as));try{let ae=await J(oe);L.textContent=`Translated page \u2713 (${ae.translated}/${ae.totalNodes} nodes, skipped ${ae.skipped})`}catch(ae){L.textContent=`Translate page error: ${ae?.message||ae}`}}else if(A==="desainr-toggle-parallel"){let{isParallelModeEnabled:J,enableParallelMode:oe,disableParallelMode:ae}=await Promise.resolve().then(()=>(Vw(),Ow)),{DEFAULT_TARGET_LANG:Ce}=await Promise.resolve().then(()=>(Zr(),as));try{J()?(L.textContent="Disabling parallel translate...",ae(),L.textContent="Parallel translate OFF"):(L.textContent="Enabling parallel translate...",await oe(Ce),L.textContent="Parallel translate ON")}catch(Ze){L.textContent=`Parallel toggle error: ${Ze?.message||Ze}`}}else L.textContent=`Unknown action: ${A}`}catch(J){L.textContent=`Error: ${J?.message||J}`}finally{setTimeout(()=>{try{i()}catch{}},800)}}}})();})();
/*! Bundled license information:

@firebase/util/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2022 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2025 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2021 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/component/dist/esm/index.esm2017.js:
  (**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/logger/dist/esm/index.esm2017.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/app/dist/esm/index.esm2017.js:
  (**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2023 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2021 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

firebase/app/dist/esm/index.esm.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/auth/dist/esm2017/index-35c79a8a.js:
  (**
   * @license
   * Copyright 2021 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2022 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2023 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2025 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2020 Google LLC.
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/webchannel-wrapper/dist/bloom-blob/esm/bloom_blob_es2018.js:
  (** @license
  Copyright The Closure Library Authors.
  SPDX-License-Identifier: Apache-2.0
  *)
  (** @license
  
   Copyright The Closure Library Authors.
   SPDX-License-Identifier: Apache-2.0
  *)

@firebase/webchannel-wrapper/dist/webchannel-blob/esm/webchannel_blob_es2018.js:
  (** @license
  Copyright The Closure Library Authors.
  SPDX-License-Identifier: Apache-2.0
  *)
  (** @license
  
   Copyright The Closure Library Authors.
   SPDX-License-Identifier: Apache-2.0
  *)

@firebase/firestore/dist/index.esm2017.js:
  (**
  * @license
  * Copyright 2020 Google LLC
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
  * You may obtain a copy of the License at
  *
  *   http://www.apache.org/licenses/LICENSE-2.0
  *
  * Unless required by applicable law or agreed to in writing, software
  * distributed under the License is distributed on an "AS IS" BASIS,
  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  * See the License for the specific language governing permissions and
  * limitations under the License.
  *)
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2023 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2025 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2021 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2018 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2022 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2021 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law | agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
*/
