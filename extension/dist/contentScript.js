const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["chunks/apiClient-TEkhLY64.js","chunks/auth-DCUILQwn.js","chunks/parallel-D57MIqZr.js","chunks/pageTranslate-BaNjmQL3.js"])))=>i.map(i=>d[i]);
const I="modulepreload",U=function(k){return"/"+k},D={},x=function(h,C,L){let R=Promise.resolve();if(C&&C.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),g=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));R=Promise.allSettled(C.map(y=>{if(y=U(y),y in D)return;D[y]=!0;const E=y.endsWith(".css"),P=E?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${y}"]${P}`))return;const T=document.createElement("link");if(T.rel=E?"stylesheet":I,E||(T.as="script"),T.crossOrigin="",T.href=y,g&&T.setAttribute("nonce",g),document.head.appendChild(T),E)return new Promise((O,A)=>{T.addEventListener("load",O),T.addEventListener("error",()=>A(new Error(`Unable to preload CSS for ${y}`)))})}))}function w(i){const g=new Event("vite:preloadError",{cancelable:!0});if(g.payload=i,window.dispatchEvent(g),!g.defaultPrevented)throw i}return R.then(i=>{for(const g of i||[])g.status==="rejected"&&w(g.reason);return h().catch(w)})};(()=>{const k="desainr-overlay-root";function h(){let t=document.getElementById(k);return t||(t=document.createElement("div"),t.id=k,Object.assign(t.style,{position:"fixed",top:"20px",right:"20px",zIndex:999999,background:"white",color:"#111",border:"1px solid #ddd",borderRadius:"8px",padding:"8px 12px",boxShadow:"0 6px 20px rgba(0,0,0,0.15)",display:"none",maxWidth:"420px",fontFamily:"Segoe UI, Arial, sans-serif"}),t.textContent="DesAInR Overlay (stub) – press Ctrl/Cmd+M to toggle.",document.documentElement.appendChild(t)),t}function C(t,r,u=6e3){const f=document.createElement("button");f.textContent="Undo",Object.assign(f.style,{marginLeft:"8px",padding:"4px 8px",border:"1px solid #ccc",borderRadius:"6px",cursor:"pointer"});const _=()=>{try{const s=r();t.textContent=s?"Undone ✓":"Undo failed"}catch{t.textContent="Undo failed"}finally{f.remove(),setTimeout(()=>t.textContent="DesAInR Overlay (stub) – press Ctrl/Cmd+M to toggle.",1200)}};f.addEventListener("click",_,{once:!0}),t.appendChild(f),setTimeout(()=>{try{f.remove()}catch{}},u)}function L(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function R(t,r){const u=L(String(r.summary||"Analysis complete")),f=Array.isArray(r.keyPoints)?r.keyPoints:[],_=Array.isArray(r.links)?r.links:[],s=f.length?`<ul style="margin:6px 0 8px 18px; padding:0;">${f.map(n=>`<li style="margin:2px 0;">${L(n)}</li>`).join("")}</ul>`:"",l=_.length?`<div style="margin-top:6px; max-height:160px; overflow:auto;"><div style="font-weight:600; margin-bottom:4px;">Top links</div>${_.slice(0,10).map(n=>`<div style="white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><a href="${L(n)}" target="_blank" rel="noopener noreferrer">${L(n)}</a></div>`).join("")}</div>`:"";t.innerHTML=`<div style="font-size:13px; line-height:1.35;">
      <div style="display:flex; align-items:center; justify-content:space-between; gap:12px;">
        <div style="font-weight:700;">Analysis</div>
        <button id="desainr-close-overlay" style="border:1px solid #ddd; border-radius:6px; padding:2px 6px; background:#f7f7f7; cursor:pointer;">Close</button>
      </div>
      <div style="margin-top:6px;">${u}</div>
      ${s}
      ${l}
    </div>`;const e=t.querySelector("#desainr-close-overlay");e&&(e.onclick=()=>{t.style.display="none"})}let w=null,i=null;async function g(){if(i){try{i.detach()}catch{}i=null,w=null;return}const t=document.createElement("div");t.id="desainr-overlay-react-root",Object.assign(t.style,{position:"fixed",top:"20px",right:"20px",zIndex:1e6}),document.documentElement.appendChild(t);try{i=(await x(()=>import("./chunks/index-DRa-41pw.js"),[])).mountOverlay(t,()=>{try{i==null||i.detach()}catch{}i=null,w=null}),w=t}catch(r){const u=h();u.style.display="block",u.textContent=`Overlay failed: ${(r==null?void 0:r.message)||r}`,setTimeout(()=>u.textContent="DesAInR Overlay (stub) – press Ctrl/Cmd+M to toggle.",3e3)}}let y=null,E=null,P="";function T(){if(y)return y;const t=document.createElement("div");t.id="desainr-mini-toolbar",Object.assign(t.style,{position:"absolute",zIndex:"999999",top:"0px",left:"0px",display:"none"}),E=t.attachShadow({mode:"open"});const r=document.createElement("style");r.textContent=`
      .wrap { display:flex; gap:6px; padding:6px 8px; border:1px solid #ddd; border-radius:8px; background:#fff; box-shadow: 0 8px 24px rgba(0,0,0,0.18); font-family: Segoe UI, Arial, sans-serif; }
      button { border:1px solid #ddd; border-radius:6px; padding:6px 8px; background:#f7f7f7; cursor:pointer; }
      button:hover { background:#ececec; }
    `;const u=document.createElement("div");u.className="wrap",u.innerHTML=`
      <button id="btn-refine" title="Refine">Refine</button>
      <button id="btn-translate" title="Translate">Translate</button>
      <button id="btn-analyze" title="Analyze Page">Analyze</button>
    `,E.appendChild(r),E.appendChild(u),document.documentElement.appendChild(t);function f(_){var l;const s=P||((l=window.getSelection())==null?void 0:l.toString())||"";s.trim()&&_(s)}return E.getElementById("btn-refine").addEventListener("click",async()=>{f(async _=>{const{rewrite:s}=await x(async()=>{const{rewrite:n}=await import("./chunks/apiClient-TEkhLY64.js");return{rewrite:n}},__vite__mapDeps([0,1])),{applyReplacementOrCopyWithUndo:l}=await x(async()=>{const{applyReplacementOrCopyWithUndo:n}=await import("./chunks/domReplace-Gc1VOXTT.js");return{applyReplacementOrCopyWithUndo:n}},[]),e=h();e.style.display="block",e.textContent="Refining...";try{const{ok:n,status:c,json:a,error:p}=await s({selection:_,url:location.href,task:"clarify"});if(n&&(a!=null&&a.result)){const{outcome:o,undo:d}=await l(a.result);o==="replaced"?(e.textContent="Refined ✓ (replaced selection)",d&&C(e,d)):o==="copied"?e.textContent="Refined ✓ (copied)":e.textContent="Refined ✓"}else e.textContent=`Refine failed (${c}): ${p||"unknown"}`}catch(n){e.textContent=`Refine error: ${(n==null?void 0:n.message)||n}`}finally{setTimeout(()=>e.textContent="DesAInR Overlay (stub) – press Ctrl/Cmd+M to toggle.",3e3),A()}})}),E.getElementById("btn-translate").addEventListener("click",async()=>{f(async _=>{const{translateChunks:s}=await x(async()=>{const{translateChunks:c}=await import("./chunks/apiClient-TEkhLY64.js");return{translateChunks:c}},__vite__mapDeps([0,1])),{DEFAULT_TARGET_LANG:l}=await x(async()=>{const{DEFAULT_TARGET_LANG:c}=await import("./chunks/config-3JFiQANb.js");return{DEFAULT_TARGET_LANG:c}},[]),{applyReplacementOrCopyWithUndo:e}=await x(async()=>{const{applyReplacementOrCopyWithUndo:c}=await import("./chunks/domReplace-Gc1VOXTT.js");return{applyReplacementOrCopyWithUndo:c}},[]),n=h();n.style.display="block",n.textContent="Translating...";try{const{ok:c,status:a,json:p,error:o}=await s({selection:_,url:location.href,targetLang:l});if(c&&(p!=null&&p.result)){const{outcome:d,undo:m}=await e(p.result);d==="replaced"?(n.textContent="Translated ✓ (replaced selection)",m&&C(n,m)):d==="copied"?n.textContent="Translated ✓ (copied)":n.textContent="Translated ✓"}else n.textContent=`Translate failed (${a}): ${o||"unknown"}`}catch(c){n.textContent=`Translate error: ${(c==null?void 0:c.message)||c}`}finally{setTimeout(()=>n.textContent="DesAInR Overlay (stub) – press Ctrl/Cmd+M to toggle.",3e3),A()}})}),E.getElementById("btn-analyze").addEventListener("click",async()=>{const{analyzePage:_}=await x(async()=>{const{analyzePage:l}=await import("./chunks/apiClient-TEkhLY64.js");return{analyzePage:l}},__vite__mapDeps([0,1])),s=h();s.style.display="block",s.textContent="Analyzing page...";try{const{ok:l,status:e,json:n,error:c}=await _({url:location.href,title:document.title});l?R(s,{summary:n==null?void 0:n.summary,keyPoints:n==null?void 0:n.keyPoints,links:n==null?void 0:n.links}):s.textContent=`Analyze failed (${e}): ${c||"unknown"}`}catch(l){s.textContent=`Analyze error: ${(l==null?void 0:l.message)||l}`}finally{setTimeout(()=>s.textContent="DesAInR Overlay (stub) – press Ctrl/Cmd+M to toggle.",8e3),A()}}),y=t,t}async function O(){const r=(await x(()=>import("./chunks/selection-C-hFlCdG.js"),[])).getSelectionInfo();if(!r){A();return}P=r.text;const u=T();u.style.left=`${Math.max(8,r.pageX)}px`,u.style.top=`${Math.max(8,r.pageY-44)}px`,u.style.display="block"}function A(){y&&(y.style.display="none")}document.addEventListener("keydown",t=>{if(t.key==="Escape"&&(A(),i)){try{i.detach()}catch{}i=null,w=null}}),document.addEventListener("mousedown",t=>{var f;if(!y)return;const r=(f=t.composedPath)==null?void 0:f.call(t);(r?r.includes(y):y.contains(t.target))||A()},!0),chrome.runtime.onMessage.addListener(t=>{(t==null?void 0:t.type)==="TOGGLE_OVERLAY"&&g(),(t==null?void 0:t.type)==="CONTEXT_MENU"&&$(t.id,t.info)}),document.addEventListener("mouseup",()=>{O().catch(()=>{})});async function $(t,r){var n,c;const{rewrite:u,translateChunks:f,analyzePage:_}=await x(async()=>{const{rewrite:a,translateChunks:p,analyzePage:o}=await import("./chunks/apiClient-TEkhLY64.js");return{rewrite:a,translateChunks:p,analyzePage:o}},__vite__mapDeps([0,1])),{DEFAULT_TARGET_LANG:s}=await x(async()=>{const{DEFAULT_TARGET_LANG:a}=await import("./chunks/config-3JFiQANb.js");return{DEFAULT_TARGET_LANG:a}},[]),{applyReplacementOrCopyWithUndo:l}=await x(async()=>{const{applyReplacementOrCopyWithUndo:a}=await import("./chunks/domReplace-Gc1VOXTT.js");return{applyReplacementOrCopyWithUndo:a}},[]),e=h();e.style.display="block";try{if(t==="desainr-refine"){e.textContent="Refining selection...";const a=((n=window.getSelection())==null?void 0:n.toString())||"",{ok:p,status:o,json:d,error:m}=await u({selection:a,url:location.href,task:"clarify"});if(p&&(d!=null&&d.result)){const{outcome:b,undo:v}=await l(d.result);b==="replaced"?(e.textContent="Refined ✓ (replaced selection)",v&&C(e,v)):b==="copied"?e.textContent="Refined ✓ (copied)":e.textContent="Refined ✓"}else e.textContent=`Refine failed (${o}): ${m||"unknown"}`}else if(t==="desainr-translate"){e.textContent="Translating selection...";const a=((c=window.getSelection())==null?void 0:c.toString())||"",{ok:p,status:o,json:d,error:m}=await f({selection:a,url:location.href,targetLang:s});if(p&&(d!=null&&d.result)){const{outcome:b,undo:v}=await l(d.result);b==="replaced"?(e.textContent="Translated ✓ (replaced selection)",v&&C(e,v)):b==="copied"?e.textContent="Translated ✓ (copied)":e.textContent="Translated ✓"}else e.textContent=`Translate failed (${o}): ${m||"unknown"}`}else if(t==="desainr-analyze"){e.textContent="Analyzing page...";const{ok:a,status:p,json:o,error:d}=await _({url:location.href,title:document.title});a?R(e,{summary:o==null?void 0:o.summary,keyPoints:o==null?void 0:o.keyPoints,links:o==null?void 0:o.links}):e.textContent=`Analyze failed (${p}): ${d||"unknown"}`}else if(t==="desainr-translate-page"){e.textContent="Translating page...";const{translatePageAll:a}=await x(async()=>{const{translatePageAll:o}=await import("./chunks/pageTranslate-BaNjmQL3.js");return{translatePageAll:o}},[]),{DEFAULT_TARGET_LANG:p}=await x(async()=>{const{DEFAULT_TARGET_LANG:o}=await import("./chunks/config-3JFiQANb.js");return{DEFAULT_TARGET_LANG:o}},[]);try{const o=await a(p);e.textContent=`Translated page ✓ (${o.translated}/${o.totalNodes} nodes, skipped ${o.skipped})`}catch(o){e.textContent=`Translate page error: ${(o==null?void 0:o.message)||o}`}}else if(t==="desainr-toggle-parallel"){const{isParallelModeEnabled:a,enableParallelMode:p,disableParallelMode:o}=await x(async()=>{const{isParallelModeEnabled:m,enableParallelMode:b,disableParallelMode:v}=await import("./chunks/parallel-D57MIqZr.js");return{isParallelModeEnabled:m,enableParallelMode:b,disableParallelMode:v}},__vite__mapDeps([2,3])),{DEFAULT_TARGET_LANG:d}=await x(async()=>{const{DEFAULT_TARGET_LANG:m}=await import("./chunks/config-3JFiQANb.js");return{DEFAULT_TARGET_LANG:m}},[]);try{a()?(e.textContent="Disabling parallel translate...",o(),e.textContent="Parallel translate OFF"):(e.textContent="Enabling parallel translate...",await p(d),e.textContent="Parallel translate ON")}catch(m){e.textContent=`Parallel toggle error: ${(m==null?void 0:m.message)||m}`}}else e.textContent=`Unknown action: ${t}`}catch(a){e.textContent=`Error: ${(a==null?void 0:a.message)||a}`}finally{setTimeout(()=>e.textContent="DesAInR Overlay (stub) – press Ctrl/Cmd+M to toggle.",1800)}}})();export{x as _};
