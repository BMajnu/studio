import{APP_BASE_URL as i}from"./chunks/config-3JFiQANb.js";import{i as c,r as s}from"./chunks/auth-DCUILQwn.js";chrome.runtime.onInstalled.addListener(()=>{chrome.contextMenus.create({id:"desainr-refine",title:"DesAInR: Refine Selection",contexts:["selection"]}),chrome.contextMenus.create({id:"desainr-translate",title:"DesAInR: Translate Selection",contexts:["selection"]}),chrome.contextMenus.create({id:"desainr-analyze",title:"DesAInR: Analyze Page",contexts:["page"]}),chrome.contextMenus.create({id:"desainr-translate-page",title:"DesAInR: Translate Page",contexts:["page"]}),chrome.contextMenus.create({id:"desainr-toggle-parallel",title:"DesAInR: Toggle Parallel Translate",contexts:["page"]}),chrome.alarms.create("desainr_refresh_token",{periodInMinutes:45})});c();setTimeout(()=>{s(!0).catch(()=>{})},5e3);chrome.runtime.onStartup.addListener(()=>{chrome.alarms.create("desainr_refresh_token",{periodInMinutes:45}),s(!0).catch(()=>{})});chrome.alarms.onAlarm.addListener(e=>{e.name==="desainr_refresh_token"&&s(!0).catch(()=>{})});chrome.contextMenus.onClicked.addListener((e,t)=>{t!=null&&t.id&&chrome.tabs.sendMessage(t.id,{type:"CONTEXT_MENU",id:e.menuItemId,info:e})});chrome.commands.onCommand.addListener(e=>{e==="toggle-overlay"&&chrome.tabs.query({active:!0,currentWindow:!0},t=>{const r=t[0];r!=null&&r.id&&chrome.tabs.sendMessage(r.id,{type:"TOGGLE_OVERLAY"})})});chrome.runtime.onMessage.addListener((e,t,r)=>{if((e==null?void 0:e.type)==="API_CALL")return(async()=>{try{const n=`${i}/api/extension/${e.path}`,a=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.token}`},body:JSON.stringify(e.body??{})}),o=await a.json().catch(()=>({}));r({ok:a.ok,status:a.status,json:o})}catch(n){r({ok:!1,status:0,error:(n==null?void 0:n.message)||String(n)})}})(),!0});
