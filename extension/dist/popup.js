import{A as f}from"./chunks/config-Dk1h10Ki.js";let h=null,B=0;async function w(t){var n;try{await((n=chrome.storage)==null?void 0:n.local.set({DESAINR_BASE_URL:t}))}catch{}}async function I(){const t=Date.now();return h&&t-B<6e4?h:(h=f,B=t,await w(f),f)}async function k(t){return new Promise(n=>{chrome.tabs.query({active:!0,currentWindow:!0},async s=>{const e=s[0];if(!(e!=null&&e.id))return n(!1);const o=e.id,i=()=>new Promise(r=>{try{chrome.tabs.sendMessage(o,t,()=>{var m;const a=(m=chrome.runtime.lastError)==null?void 0:m.message;r(!a)})}catch{r(!1)}});let l=await i();if(l)return n(!0);try{await chrome.scripting.executeScript({target:{tabId:o},files:["contentScript.js"]})}catch(r){return console.warn("[DesAInR][popup] scripting injection failed:",r),n(!1)}l=await i(),n(l)})})}function g(t){const n=document.getElementById("error");n&&(n.textContent=t,n.style.display="block",setTimeout(()=>{n.style.display="none"},5e3))}function x(t){const n=document.getElementById("loading"),s=document.getElementById("signin-section"),e=document.getElementById("signout-section");n&&(n.style.display="block"),s&&(s.style.display="none"),e&&(e.style.display="none")}function y(){const t=document.getElementById("user-name"),n=document.getElementById("user-email"),s=document.getElementById("user-avatar"),e=document.getElementById("user-session");t&&(t.textContent=""),n&&(n.textContent=""),s&&(s.src="",s.style.display="none"),e&&(e.textContent="")}function v(t){const n=document.getElementById("user-name"),s=document.getElementById("user-email"),e=document.getElementById("user-avatar"),o=document.getElementById("user-session");n&&(n.textContent=(t==null?void 0:t.name)||(t==null?void 0:t.email)||"Signed account"),s&&(s.textContent=(t==null?void 0:t.email)||""),e&&(t!=null&&t.picture?(e.src=t.picture,e.style.display=""):(e.src="",e.style.display="none")),o&&(o.textContent=t!=null&&t.expired?"Expired":"Active")}async function L(){try{chrome.runtime.sendMessage({type:"AUTH_GET_PROFILE"},t=>{var s;if((s=chrome.runtime.lastError)==null?void 0:s.message){y();return}if(t!=null&&t.ok&&t.profile){v(t.profile);const e=document.getElementById("status-text");e&&(e.textContent=t.profile.expired?"Signed in (expired)":"Signed in")}else{y();const e=document.getElementById("status-text");e&&(e.textContent="Not signed in")}})}catch{y()}}function d(t){const n=document.getElementById("status-dot"),s=document.getElementById("status-text"),e=document.getElementById("loading"),o=document.getElementById("signin-section"),i=document.getElementById("signout-section");e&&(e.style.display="none"),n&&n.classList.add("active"),s&&(s.textContent=t?"Signed in":"Not signed in"),o&&(o.style.display=t?"none":"block"),i&&(i.style.display=t?"block":"none"),t?L():y()}document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("open-overlay"),n=document.getElementById("open-webapp"),s=document.getElementById("setting-target-lang"),e=document.getElementById("setting-model-id"),o=document.getElementById("setting-thinking-mode"),i=document.getElementById("save-settings"),l=document.getElementById("signin"),r=document.getElementById("signout");(async()=>{try{d(!1),chrome.runtime.sendMessage({type:"AUTH_HAS_TOKEN"},async a=>{var c;if((c=chrome.runtime.lastError)==null?void 0:c.message){d(!1);return}const u=!!(a&&a.hasToken);if(d(u),u)try{const E=await chrome.storage.local.get(["desainr.settings.targetLang","desainr.settings.modelId","desainr.settings.thinkingMode"]);s&&(s.value=E["desainr.settings.targetLang"]||"bn"),e&&(e.value=E["desainr.settings.modelId"]||"gemini-flash-lite-latest"),o&&(o.value=E["desainr.settings.thinkingMode"]||"none")}catch{}})}catch{d(!1)}})(),t==null||t.addEventListener("click",async()=>{if(!await k({type:"TOGGLE_OVERLAY"})){g("This page does not allow the overlay or the content script is blocked. Try a regular website tab.");return}window.close()}),n==null||n.addEventListener("click",async()=>{try{const a=await I();await chrome.tabs.create({url:`${a}/`}),window.close()}catch(a){g((a==null?void 0:a.message)||"Failed to open web app")}}),i==null||i.addEventListener("click",async()=>{try{const a=((s==null?void 0:s.value)||"").trim(),m=((e==null?void 0:e.value)||"").trim(),u=((o==null?void 0:o.value)||"").trim();await chrome.storage.local.set({"desainr.settings.targetLang":a,"desainr.settings.modelId":m,"desainr.settings.thinkingMode":u||"none"}),g("");const c=document.getElementById("error");c&&(c.style.display="block",c.style.background="#c6f6d5",c.style.color="#22543d",c.textContent="âœ“ Settings saved successfully",setTimeout(()=>{c.style.display="none",c.style.background="",c.style.color=""},1500))}catch(a){g((a==null?void 0:a.message)||"Failed to save settings")}}),l==null||l.addEventListener("click",async()=>{x();try{chrome.runtime.sendMessage({type:"AUTH_REQUEST_TOKEN"},async a=>{if(a&&a.ok){d(!0),window.close();return}try{const m=await I();await chrome.tabs.create({url:`${m}/login?next=/`})}catch{}d(!1)})}catch{d(!1)}}),r==null||r.addEventListener("click",async()=>{try{chrome.runtime.sendMessage({type:"AUTH_CLEAR_TOKEN"},()=>{d(!1)})}catch{d(!1)}})});
