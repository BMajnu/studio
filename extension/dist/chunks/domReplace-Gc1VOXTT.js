function d(n){if(!n)return!1;const t=n.tagName.toLowerCase();return t==="input"||t==="textarea"}async function p(n){var t;try{if((t=navigator.clipboard)!=null&&t.writeText)return await navigator.clipboard.writeText(n),!0}catch{}try{const o=document.createElement("textarea");o.value=n,o.style.position="fixed",o.style.opacity="0",document.body.appendChild(o),o.focus(),o.select();const e=document.execCommand("copy");return document.body.removeChild(o),e}catch{return!1}}function f(n){const t=window.getSelection();if(!t||t.rangeCount===0)return null;const o=document.activeElement;if(d(o))try{const e=o,r=e.selectionStart??0,i=e.selectionEnd??r,c=e.value??"";e.value=c.slice(0,r)+n+c.slice(i);const l=r+n.length;return e.selectionStart=e.selectionEnd=l,e.dispatchEvent(new Event("input",{bubbles:!0})),{undo:()=>{try{return e.value=c,e.selectionStart=r,e.selectionEnd=i,e.dispatchEvent(new Event("input",{bubbles:!0})),!0}catch{return!1}}}}catch{}try{const e=t.getRangeAt(0),r=e.cloneContents(),i=e.cloneContents(),c=Array.from(i.childNodes).some(s=>s.nodeType!==Node.TEXT_NODE),l=e.endContainer!==e.startContainer;if(c&&l)return null;e.deleteContents();const a=document.createTextNode(n);return e.insertNode(a),e.setStartAfter(a),e.collapse(!0),t.removeAllRanges(),t.addRange(e),{undo:()=>{try{const s=a.parentNode;if(!s)return!1;const u=r.cloneNode(!0);return s.insertBefore(u,a),s.removeChild(a),!0}catch{return!1}}}}catch{return null}}async function m(n){const t=f(n);return t?{outcome:"replaced",undo:t.undo}:await p(n)?{outcome:"copied"}:{outcome:"failed"}}export{m as applyReplacementOrCopyWithUndo,p as copyToClipboard,f as replaceSelectionSafelyWithUndo};
