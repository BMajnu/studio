const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["chunks/apiClient-TEkhLY64.js","chunks/auth-DCUILQwn.js"])))=>i.map(i=>d[i]);
import{_ as E}from"../contentScript.js";import{collectTextNodes as x}from"./pageTranslate-BaNjmQL3.js";const y="desainr-parallel-wrapper",N="desainr-parallel-original",g="desainr-parallel-translated",T="desainr-parallel-style";let l=!1,m=null;function L(){if(document.getElementById(T))return;const e=document.createElement("style");e.id=T,e.textContent=`
    .${y} { display: inline; white-space: pre-wrap; }
    .${N} { opacity: 0.95; }
    .${g} { opacity: 0.75; color: #555; margin-left: 0.4em; }
  `,document.documentElement.appendChild(e)}async function _(e,u){var a;const{translateChunks:o}=await E(async()=>{const{translateChunks:c}=await import("./apiClient-TEkhLY64.js");return{translateChunks:c}},__vite__mapDeps([0,1])),n=await o({selection:e,url:location.href,targetLang:u});return n.ok&&((a=n.json)!=null&&a.result)?n.json.result:e}function h(e,u){const o=e.parentElement;if(!o||o.closest&&o.closest(`.${y}`))return;const n=e.data,a=document.createElement("span");a.className=y,a.dataset.orig=n;const c=document.createElement("span");c.className=N,c.textContent=n;const p=document.createElement("span");p.className=g,p.textContent=u,a.appendChild(c),a.appendChild(document.createTextNode(" ")),a.appendChild(p),o.replaceChild(a,e)}function A(e){return!!e&&e.classList.contains(y)}function D(){var u;if(!l)return;l=!1,m&&(m.disconnect(),m=null);const e=Array.from(document.querySelectorAll(`.${y}`));for(const o of e){const n=((u=o.dataset)==null?void 0:u.orig)??"",a=document.createTextNode(n);o.parentNode&&o.parentNode.replaceChild(a,o)}}function P(){return l}async function R(e){var w;if(l)return;l=!0,L();const n=x().slice(0,400),{DEFAULT_TARGET_LANG:a}=await E(async()=>{const{DEFAULT_TARGET_LANG:f}=await import("./config-3JFiQANb.js");return{DEFAULT_TARGET_LANG:f}},[]),c=e||a;let p=!1;try{const{translateChunksBatch:f}=await E(async()=>{const{translateChunksBatch:t}=await import("./apiClient-TEkhLY64.js");return{translateChunksBatch:t}},__vite__mapDeps([0,1])),i=n.map(t=>t.text),s=await f({chunks:i,url:location.href,targetLang:c}),r=(w=s.json)==null?void 0:w.results;if(s.ok&&Array.isArray(r)&&r.length===n.length){for(let t=0;t<n.length;t++)try{h(n[t].node,r[t])}catch{}p=!0}}catch{}if(!p){let i=0;async function s(){if(!l)return;const r=i++;if(r>=n.length)return;const t=n[r];try{const d=await _(t.text,c);h(t.node,d)}catch{}await s()}await Promise.all(new Array(3).fill(0).map(()=>s()))}m=new MutationObserver(async f=>{if(l)for(const i of f)if(i.type==="characterData"&&i.target.nodeType===Node.TEXT_NODE){const s=i.target,r=s.parentElement;if(!r||A(r))continue;const t=s.data;if(t&&t.trim())try{const d=await _(t,c);if(!l)return;h(s,d)}catch{}}else i.type==="childList"&&i.addedNodes.forEach(async s=>{if(s.nodeType===Node.TEXT_NODE){const r=s,t=r.parentElement;if(!t||A(t))return;const d=r.data;if(d&&d.trim())try{const C=await _(d,c);if(!l)return;h(r,C)}catch{}}})}),m.observe(document.body,{subtree:!0,childList:!0,characterData:!0})}export{D as disableParallelMode,R as enableParallelMode,P as isParallelModeEnabled};
