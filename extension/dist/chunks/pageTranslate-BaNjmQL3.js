const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["chunks/apiClient-TEkhLY64.js","chunks/auth-DCUILQwn.js"])))=>i.map(i=>d[i]);
import{_ as E}from"../contentScript.js";const m=new Set(["script","style","noscript","template","textarea","input","select","option","code","pre","kbd","samp","var","svg","canvas","math","video","audio"]);function g(t){if(!t)return!1;if(t.isContentEditable)return!0;const a=t.getAttribute("contenteditable");return a===""||a==="true"}function T(t){if(!t)return!1;const e=t.tagName.toLowerCase();return e==="input"||e==="textarea"||e==="select"||e==="option"}function N(t){return!!(!t||m.has(t.tagName.toLowerCase())||T(t)||g(t))}function y(t){const e=getComputedStyle(t);if(e.display==="none"||e.visibility==="hidden"||e.opacity==="0"||t.hidden)return!0;const a=t.getBoundingClientRect();return a.width===0&&a.height===0}function C(t){let e=t;for(;e;){if(N(e)||y(e))return!0;e=e.parentElement}return!1}function w(t,e=5){const a=[];let n=t,r=0;for(;n&&r<e;){const s=n.tagName.toLowerCase(),i=n.id?`#${n.id}`:"",d=n.className&&typeof n.className=="string"?`.${n.className.trim().split(/\s+/).slice(0,2).join(".")}`:"";a.unshift(`${s}${i}${d}`),n=n.parentElement,r++}return a.join(">")}function _(t=document.body){const e=[],a=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,{acceptNode:r=>{if(r.nodeType!==Node.TEXT_NODE)return NodeFilter.FILTER_REJECT;const s=r.data;if(!s||!s.trim())return NodeFilter.FILTER_REJECT;const i=r.parentElement;return!i||i.closest&&i.closest(".desainr-parallel-wrapper")||C(i)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}});let n=a.nextNode();for(;n;){const r=n,s=r.parentElement;e.push({node:r,text:r.data,index:e.length,parent:s,path:w(s)}),n=a.nextNode()}return e}function F(t){return t.map(e=>e.text)}async function x(t,e,a){const n=new Array(t.length);let r=0,s=0;return new Promise((i,d)=>{const c=()=>{for(;s<e&&r<t.length;){const u=r++;s++,Promise.resolve(a(t[u],u)).then(f=>{n[u]=f,s--,r>=t.length&&s===0?i(n):c()}).catch(f=>{n[u]=void 0,s--,r>=t.length&&s===0?i(n):c()})}};t.length===0?i(n):c()})}async function k(t,e=3,a=400){var h;const{translateChunksBatch:n,translateChunks:r}=await E(async()=>{const{translateChunksBatch:o,translateChunks:l}=await import("./apiClient-TEkhLY64.js");return{translateChunksBatch:o,translateChunks:l}},__vite__mapDeps([0,1])),s=_(),i=s.slice(0,a),d=F(i);let c=[],u=!1;try{const o=await n({chunks:d,url:location.href,targetLang:t});o.ok&&Array.isArray((h=o.json)==null?void 0:h.results)&&(c=o.json.results??[],u=!0)}catch{}(!u||c.length!==d.length)&&(c=await x(d,e,async o=>{var p;const l=await r({selection:o,url:location.href,targetLang:t});return l.ok&&((p=l.json)!=null&&p.result)?l.json.result:o}));let f=0;for(let o=0;o<i.length;o++)try{const l=c[o];typeof l=="string"&&l!==i[o].text&&(i[o].node.data=l,f++)}catch{}return{totalNodes:s.length,translated:f,skipped:i.length-f}}export{_ as collectTextNodes,F as snapshotTexts,k as translatePageAll};
